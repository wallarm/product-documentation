## 前提条件

* AWSアカウント
* AWS EC2、セキュリティグループについての理解
* [US Cloud](https://us1.my.wallarm.com/)または[EU Cloud](https://my.wallarm.com/)に対するWallarmコンソールの**管理者**ロールおよび二要素認証が無効化されたアカウントへのアクセス
* US Wallarm Cloudを利用する場合、`https://us1.api.wallarm.com:444`へのアクセス、またはEU Wallarm Cloudを利用する場合、`https://api.wallarm.com:444`へのアクセス。プロキシサーバー経由でのみアクセス設定が可能な場合は[こちらの説明][wallarm-api-via-proxy]を使用してください。
* Wallarmインスタンス上で全てのコマンドをスーパーユーザーとして実行（例:`root`）

## 1. AWSでSSHキーペアを作成する

展開作業中には、SSH経由で仮想マシンに接続する必要があります。Amazon EC2では、インスタンスに接続するために使用できる名前付きの公開鍵と秘密鍵のペアを作成することができます。

キーペアを作成するには：

1. Amazon EC2ダッシュボードの**キーペア**タブに移動します。
2. **キーペアの作成**ボタンをクリックします。
3. キーペアの名前を入力し、**作成**ボタンをクリックします。

PEM形式の秘密SSHキーが自動的にダウンロードされます。将来作成されたインスタンスに接続するためにキーを保存してください。

SSHキーの作成に関する詳細情報を見るには、[AWSドキュメンテーション][link-ssh-keys]に進んでください。

## 2. セキュリティグループを作成する

セキュリティグループは、仮想マシンに対する許可された接続と禁止された接続を定義します。最終的な接続リストは、保護対象のアプリケーションによります（例えば、TCP/80とTCP/443のポートへの全ての受信接続を許可するなど）。

フィルタリングノードのためのセキュリティグループを作成するには：

1. Amazon EC2ダッシュボードの**セキュリティグループ**タブに移動し、**セキュリティグループを作成**ボタンをクリックします。
2. ダイアログウィンドウにセキュリティグループの名前と任意の説明を入力します。
3. 必要なVPCを選択します。
4. **受信**タブと**送信**タブで、受信接続と送信接続のルールを設定します。
5. セキュリティグループを作成するために**作成**ボタンをクリックします。

![セキュリティグループの作成][img-create-sg]

!!! warning "セキュリティグループからの送信接続のルール"
    セキュリティグループを作成する際、送信接続はデフォルトで全て許可されています。フィルタリングノードから送信接続を制限する場合、Wallarm APIサーバーへのアクセスが許可されていることを確認してください。Wallarm APIサーバーの選択はご利用のWallarm Cloudによります：

    *   US Cloudを利用している場合、ノードが`us1.api.wallarm.com`へのアクセスを許可されている必要があります。
    *   EU Cloudを利用している場合、ノードが`api.wallarm.com`へのアクセスを許可されている必要があります。
    
    フィルタリングノードは、正常な操作のためにWallarm APIサーバーへのアクセスを必要とします。

セキュリティグループの作成に関する詳細情報を見るには、[AWSドキュメンテーション][link-sg]に進んでください。

## 3. Wallarmノードインスタンスを立ち上げる

Wallarmフィルタリングノードを持つインスタンスを立ち上げるには、[ここ](https://aws.amazon.com/marketplace/pp/B073VRFXSD)に進んでフィルタリングノード4.6にサブスクライブします。

インスタンスを作成する際には、以前に作成した[セキュリティグループ][anchor1]を以下のように指定する必要があります：

1. インスタンス作成ウィザードを使用している間に、対応するタブをクリックして**6.　セキュリティグループを設定**ステップに進みます。
2. **セキュリティグループを割り当て**設定で**既存のセキュリティグループを選択**オプションを選びます。
3. 表示されるリストからセキュリティグループを選択します。

すべての必要なインスタンス設定を指定したら、**レビューと起動**ボタンをクリックし、インスタンスが正しく設定されていることを確認したら、**起動**ボタンをクリックします。

表示されるウィンドウで、以下の操作を行うことで以前に作成した[キーペア][anchor2]を指定します：

1. 最初のドロップダウンリストで**既存のキーペアを選択**オプションを選択します。
2. 2つ目のドロップダウンリストでキーペアの名前を選択します。
3. セカンドドロップダウンリストで指定したキーペアからPEM形式の秘密鍵にアクセスできることを確認し、これを確認するチェックボックスにチェックを入れます。
4. **インスタンスを起動**ボタンをクリックします。

インスタンスは、フィルタリングノードが事前インストールされた状態で立ち上がります。

AWSでのインスタンスの立ち上げに関する詳細情報を見るには、[AWSドキュメンテーション][link-launch-instance]に進んでください。

## 4. SSH経由でフィルタリングノードインスタンスに接続する

インスタンスへのSSH経由での接続方法についての詳細情報を見るには、[AWSドキュメンテーション](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html)に進んでください。

インスタンスに接続するためには`admin`ユーザー名を使う必要があります。

!!! info "SSH経由で接続するためのキーの使用"
    SSH経由でインスタンスに接続するために、あなたが[以前に作成した][anchor2]PEM形式の秘密鍵を使用してください。これはインスタンスの作成時に指定したSSHキーペアの秘密鍵でなければなりません。

## 5. フィルタリングノードをWallarm Cloudに接続する

--8<-- "../include/waf/installation/connect-waf-and-cloud-4.6-only-with-postanalytics.ja.md"