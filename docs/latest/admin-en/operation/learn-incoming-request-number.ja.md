# アプリケーションが処理する月間リクエスト数を調べる

Wallarmの主なライセンス／課金方法は、お客様の環境に展開されたWallarmフィルタリングノードが処理するリクエストのレベルに基づいています。このドキュメントでは、アプリケーションが処理するリクエスト数を簡単に調べる方法を説明します。

## 情報へのアクセスがあるチーム

通常、企業内の以下のチームが簡単に情報にアクセスできます。

* DevOps
* 技術運用
* クラウド運用
* プラットフォーム運用
* DevSecOps
* システム管理者
* アプリケーション管理者
* NOC

## リクエスト数を調べる方法

アプリケーションが処理するリクエスト数を調べる方法はいくつかあります。

* AWSのELBやALBロードバランサーを使用しているお客様は、ロードバランサーのAWS監視メトリクスを使用して、ロードバランサーで提供されるアプリケーションの1日および1週間あたりのリクエストレベルを推定することができます：

    ![!AWS監視例](../../images/operation/aws-requests-example.png)

    例えば、グラフに1分当たりの平均リクエスト数が350と表示され、月平均で730時間あると仮定すると、月間リクエスト数は `350 * 60 * 730 = 15,330,000` となります。

* GCPのHTTPロードバランサーのユーザは、監視メトリック **https/request_count** を使用できます。ただし、ネットワークロードバランサーではこのメトリックは使用できません。
* Microsoft IISのユーザは、**Requests Per Sec** メトリックに基づいて1秒あたりのリクエスト数の平均を計算し、1か月あたりに単一のIISサーバで処理されるリクエスト数を計算できます。計算には、月平均で `730 * 3,600` 秒あることを仮定します。
* New Relic、Datadog、AppDynamics、SignalFXなどのApplication Performance Monitoring（APM）サービスを利用しているユーザは、APMコンソールから情報を取得できます（エッジレイヤー内のすべての関係するサーバーの集計値を取得し、1つのサーバーだけでないことを確認してください）。
* Datadog、AWS CloudWatch（およびその他多くの）などのクラウドベースのインフラストラクチャ監視システムのユーザや、PrometheusやNagiosなどの内部監視システムのユーザは、おそらくすでにエッジ位置（ロードバランサ、Webサーバ、アプリケーションサーバ）で提供されるリクエストレベルを監視しており、その情報を使用して1か月あたりの平均処理リクエスト数を簡単に推定できます。
* 別のアプローチとして、エッジロードバランサやWebサーバのログを使用して、一定期間（理想的には24時間）のログレコード数をカウントすることができます。これは、提供されたリクエストごとに1つのログレコードがあると仮定しています。例えば、このWebサーバは、ログファイルに653,525件のリクエストが記録された状態で、NGINXアクセスログファイルを1日に1回ローテーションしています：

    ```bash
    cd /var/log/nginx/
    zcat access.log.2.gz |wc -l
    # 653525
    ```

    * サーバーが1か月間に提供するリクエストの推定値は `653,525 * 30 = 19,605,750` です。
    * 使用されているWebサーバの総数を把握することで、アプリケーション全体が処理するリクエスト数を推定することができます。

* Google Analyticsや類似のユーザーエクスペリエンストラッキングおよび監視サービスを利用している純粋なWebアプリケーションの場合、提供されたページとすべての埋め込まれたオブジェクトの数に関する情報をサービスから抽出できます。