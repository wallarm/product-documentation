# DDoS保護

DDoS（Distributed Denial of Service）攻撃とは、複数のソースからのトラフィックでウェブサイトやオンラインサービスを圧倒し、利用できなくすることを目的とするサイバー攻撃の一種です。このドキュメントでは、DDoS保護に関する推奨事項と、Wallarmでリソースを保護する方法について説明します。

DDoS攻撃は、しばしばボットネットと呼ばれるネットワークに侵入されたコンピュータシステムから発射されます。攻撃者は、これらのシステムを使用して、ターゲットに大量のトラフィックを送り、サーバーを過負荷にさせ、正当なリクエストに対応できなくします。DDoS攻撃は、ウェブサイト、オンラインゲーム、さらにはソーシャルメディアプラットフォームなど、あらゆる種類のオンラインサービスに対して行われる可能性があります。

DDoS攻撃を実行するために攻撃者が使用できる技術は多岐にわたり、使用する方法やツールは大幅に異なることがあります。いくつかの攻撃は比較的単純で、サーバーに対して大量の接続リクエストを送信するなどの低レベルな技術を使用していますが、他の攻撃は、IPアドレスのスプーフィングやネットワークインフラストラクチャの脆弱性を悪用するなど、複雑な戦術を使用しています。

## DDoS攻撃の分類

ウェブサイトやオンラインサービスの可用性を妨害するために攻撃者が使用できるいくつかのタイプのDDoS攻撃があります。以下に、一般的なDDoS攻撃のタイプを示します。

| OSI層/攻撃タイプ | [容量攻撃および増幅攻撃](#volum-amplif-attacks) | [プロトコル脆弱性およびロジックボム攻撃](#proto-attacks-logicbombs) |
| ---- | ----------- | -------- |
| L3/L4 | <ul><li>UDPフラッド: これらの攻撃は、利用可能な帯域幅を消費し、サービスを混乱させるために、ターゲットに大量のUDPパケットを送信します。</li><li>ICMPフラッド（スマーフ攻撃）: これらの攻撃は、ICMPを使用して、エコーリクエストパケット（一般に「ping」リクエストとして知られています）を大量にターゲットに送信し、帯域幅を消費し、サービスを混乱させることを目的としています。</li></ul> | <ul><li>SYNフラッド: これらの攻撃は、TCP接続が確立される仕組みを悪用します。攻撃者は、ターゲットに大量のSYNパケットを送信しますが、接続を確立するために使用される3ウェイハンドシェイクプロセスを完了することはありません。これにより、ターゲットサーバーのリソースが占有され、ハンドシェイクプロセスの完了を待つ状態になります。</li><li>Ping of Death: これらの攻撃は、ターゲットをクラッシュさせるために過剰なパケットを送信します。パケットは、ターゲットが処理できる最大サイズよりも大きく、それらを処理しようとする試みがターゲットのクラッシュや利用不可を引き起こす可能性があります。</li></ul> |
| L7 | <ul><li>HTTPフラッド: これらの攻撃は、サーバーやWebアプリケーションに対して大量の一見正当なGETやPOSTリクエストを使ってターゲットを圧倒するために使用されます。この種類の攻撃は、マルウェアに感染したコンピュータのネットワークであるボットネットを使って行われることがよくあり、攻撃者が制御しています。</li><li>増幅攻撃: これらの攻撃は、増幅技術を利用してターゲットに送信されるトラフィック量を増幅することを目的としています。たとえば、攻撃者は、サーバーに対して小さなリクエストを送信し、それに対するはるかに大きなレスポンスが返されることで、ターゲットに送信されるトラフィック量を効果的に増幅することができます。攻撃者が増幅攻撃を開始するために使用できるいくつかの異なる技術があります。NTP増幅、DNS増幅などがあります。</li></ul> | <ul><li>Slowloris: Slowloris攻撃は、最小限の帯域幅が必要であり、1台のコンピュータを使用して行うことができるという点で独特です。攻撃は、Webサーバーに対して同時に複数の接続を開始し、それらを長期間維持することで機能します。攻撃者は、部分的なリクエストを送信し、HTTPヘッダをたまに補完することで、到達の完了段階を防ぐように作動します。</li></ul> |
| API/アプリ特定（L7+） | <ul><li>Heavy Request: これらの攻撃は、特別に作成されたリクエストを使用して、サーバーが大量のデータを送信するようにします。このタイプの攻撃は、Webアプリケーションの事前調査が必要であり、その脆弱性を悪用することを基盤としているため、ターゲット攻撃に一般的に使用されます。</li></ul> | <ul><li>ロジックボム: これらの攻撃は、大量のデータを含む特別に作成されたリクエストを使用し、リクエスト処理中の脆弱性を悪用することで、ターゲットシステムに大量のリソース消費を引き起こすように設計されています。ロジックボムには、XMLボム、JSONボムなど、さまざまなタイプがあります。</li></ul> |

<a name="volum-amplif-attacks"></a>**容量攻撃および増幅攻撃**は、大量のトラフィックでターゲットを圧倒することを目的としています。目標は、ターゲットのサーバーまたはネットワークの帯域幅やコンピューティングリソースを飽和させ、正当なリクエストに応答できなくすることです。

<a name="proto-attacks-logicbombs"></a>**プロトコル脆弱性およびロジックボム攻撃**は、サービスやネットワークの通信方法における脆弱性を悪用することを目的としたDDoS攻撃です。これらの攻撃は、特定のプロトコルを悪用したり、ターゲットが処理するのが難しい不正なパケットを送信することで、通常のトラフィックの流れを妨げることができます。## DDoS攻撃の軽減

DDoS攻撃はさまざまな形態を取り、異なるOSIレイヤーを対象とするため、単一の対策では効果がありません。DDoS攻撃に対する包括的な保護を提供するために、対策の組み合わせを使用することが重要です。

* インターネットサービスプロバイダやクラウドサービスプロバイダは、通常L3-L4 DDoS攻撃防御の最初の線を提供します。高度なL3-L4 DDoS攻撃に対しては、以下のような追加の軽減ツールが必要です。

    1 Gbps以上の速度でトラフィックを生成するDDoS攻撃は、トラフィックスクラブを行う専門のDDoS保護サービスが必要になることがあります。トラフィックスクラブとは、悪意のあるトラフィックをすべてフィルタリングして、正当なリクエストのみがサービスに転送されるように、トラフィックを第三者サービスを経由してルーティングする技術です。L3-L4 DDoS攻撃に対する追加の保護策として、NGFWのようなソリューションを使用することもできます。
* L7 DDoS攻撃は、アプリケーション層を対象とした攻撃として知られており、L3-L4攻撃よりもターゲットになりやすく、洗練されています。典型的には、L7 DDoS攻撃は、攻撃対象のアプリケーションの特殊な機能を狙ったものであり、正当なトラフィックとの区別が難しいことがあります。L7 DDoS攻撃からの保護には、アプリケーション層のトラフィックを解析するWAF/WAAPまたは専門のAnti-DDoSソリューションを使用してください。また、APIゲートウェイやWEBサーバーをピーク負荷に耐えられるように設定することも推奨されます。

保護策を選択する際には、以下の要素に基づいて、組織のニーズとリソースを慎重に評価してください。

* 攻撃の種類
* 攻撃の量
* ウェブアプリケーションやAPIの複雑さ、およびコスト

また、DDoS攻撃をできるだけ早く特定し、適切な対策を講じるために、対応計画を準備することが必要です。

## WallarmによるL7 DDoS保護

Wallarmは、L7 DDoS脅威に対する幅広い保護策を提供しています。

* [API Abuse Prevention](../../about-wallarm/api-abuse-prevention.md)。API Abuse Prevention機能を有効にすることで、さまざまなタイプの悪意のあるボットを特定し、停止することができます。
* [Brute force trigger](protecting-against-bruteforce.md) は、パスワードなどのパラメータ値を大量に試行するリクエストを防止します。
* [Forced browsing trigger](protecting-against-bruteforce.md) は、ウェブアプリケーションの隠されたリソース、すなわちディレクトリやファイルを検出する悪意のある試行を防止します。
* [denylistsおよびgraylists](../../user-guides/ip-lists/overview.md) を使ったジオロケーションフィルタリング。攻撃を行っている特定の地域からのアプリケーションやAPIへのアクセスを防止します。
* [denylistsおよびgraylists](../../user-guides/ip-lists/overview.md) を使って信頼できない送信元をブロックします。ターゲット攻撃からの保護には、攻撃者が場所を隠し、ジオフィルタを迂回することができる信頼できない送信元（Tor、Proxy、VPN）をブロックすることが役立ちます。
* [Logic (Data) bomb](#data-bomb) 検出。Wallarmは、ZipまたはXMLボムを含む悪意のあるリクエストを自動的に検出し、ブロックします。

NGINXベースのWallarmノードを使用している場合は、L7 DDoSに対するセキュリティを強化するために、NGINXを以下のように設定することが推奨されます。

* キャッシュ。共通のリクエストに対するキャッシュレスポンスを設定して、DDoS攻撃の一部のトラフィックを吸収し、ウェブアプリケーションやAPIに到達するのを防ぎます。
* レート制限。着信リクエストのレート制限ルールを作成し、対象となるウェブアプリケーションやAPIに送信できるトラフィック量を制限します。
* 接続数の制限。1つのクライアントIPアドレスから開くことができる接続数に制限を設けることで、リソースの使いすぎを防ぐことができます。
* 遅い接続のクローズ。接続が十分な頻度でデータを書き込まない場合、それをクローズすることで、長期間オープンになり、新しい接続がサーバーに受け入れられる能力を阻害する可能性のある接続を防ぎます。

[NGINXの設定例や他のおすすめを参照してください](https://www.nginx.com/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus/)

[Wallarmサービスを使用したKong-based Ingressコントローラー](../../installation/kubernetes/kong-ingress-controller/deployment.md) を使用している場合は、[API Gatewayを安全にするためのベストプラクティス](https://konghq.com/learning-center/api-gateway/secure-api-gateway) に従うことが推奨されています。