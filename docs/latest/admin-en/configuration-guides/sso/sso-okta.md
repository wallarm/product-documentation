#   Connecting SSO with Okta

[link-okta]:                        https://www.okta.com/
[img-dashboard]:            ../../../../images/admin-guides/configuration-guides/sso/okta/dashboard.png
[img-general]:              ../../../../images/admin-guides/configuration-guides/sso/okta/wizard-general.png  
[img-saml]:                 ../../../../images/admin-guides/configuration-guides/sso/okta/wizard-saml.png
[img-saml-preview]:         ../../../../images/admin-guides/configuration-guides/sso/okta/wizard-saml-preview.png
[img-feedback]:             ../../../../images/admin-guides/configuration-guides/sso/okta/wizard-feedback.png
[link-okta-docs]:           https://help.okta.com/en/prod/Content/Topics/Apps/Apps_App_Integration_Wizard.htm
[img-transfer-metadata-manually]:   ../../../../images/admin-guides/configuration-guides/sso/okta/transfer-metadata-manually.png
[img-sp-wizard-finish]:             ../../../../images/admin-guides/configuration-guides/sso/okta/sp-wizard-finish.png
[img-sp-metadata]:              ../../../../images/admin-guides/configuration-guides/sso/okta/sp-metadata.png
[img-assignments]:  ../../../../images/admin-guides/configuration-guides/sso/okta/assignments.png

This guide covers the process of connecting the [Okta][link-okta] service as an identity provider to Wallarm, which acts as the service provider.

To fulfill steps, you need accounts with administration rights both for Wallarm and Okta.

## Step 1 (Wallarm): Activate SSO service

By default, SSO service for authentication in Wallarm is not active, corresponding blocks are not visible in the **Integrations** section in Wallarm Console.

To activate the SSO service, contact the [Wallarm support team](https://support.wallarm.com/).

## Step 2 (Wallarm): Generate metadata

You need Wallarm metadata to enter on the Okta side:

1. In Wallarm Console, go to **Integrations** → **SSO SAML AUTHENTICATION** and initiate the **Okta SSO** configuration.

    ![Integrations - SSO](../../../../images/admin-guides/configuration-guides/sso/sso-integration-add.png)

1. In the SSO configuration wizard, at the **Send details** step, overview the Wallarm metadata, that should be passed to the Okta service.

    ![Wallarm's metadata][img-sp-metadata]

    * **Wallarm Entity ID** is a unique application identifier generated by the Wallarm application for the identity provider.
    * **Assertion Consumer Service URL (ACS URL)** is the address on the Wallarm side of the application on which identity provider sends requests with the SamlResponse parameter.

1. Copy metadata or save them as XML.

## Step 3 (Okta): Configure application

To configure application in Okta:

1. Log in to Okta as administrator.
1. Click **Administrator** → **Dashboard** → **Add Applications**.

    ![Okta dashboard][img-dashboard]

1. Click **Create New App**.
1. Set:

    * **Platform** → “Web”.
    * **Sign‑on method** → “SAML 2.0”.

1. Proceed and in the **Create SAML Integration** wizard set general integration settings, such as **App Name** and optionally **App logo**.

    ![General settings][img-general]

1. Proceed and enter the Wallarm's metadata. Required fields:

    *   **Single sign‑on URL** = **Assertion Consumer Service URL (ACS URL)** in Wallarm.
    *   **Audience URI (SP Entity ID)** = **Wallarm Entity ID** in Wallarm.

        ![Configure SAML][img-saml]

1. Optionally, set other parameters described in [Okta documentation][link-okta-docs].

    ![SAML settings preview][img-saml-preview]

1.  Proceed and set **Are you a customer or partner** to "I'm an Okta customer adding an internal app".
1. Optionally, set other parameters.

    ![Feedback form][img-feedback]

1. Click **Finish**. You will be redirected to the page of the created application.
1. To get Okta metadata, go to the **Sign On** tab, do one of the following:

    * Click **Identity Provider metadata** and save displayed data as XML.
    * Click **View Setup instructions** and copy displayed data.

1. Provide Okta users with access to the created application by going to **Administrator** → **Dashboard** → **Assign Applications** and assigning users to the application.

    ![Assigning users to the application][img-assignments]

## Step 4 (Okta): Configure provisioning

The **provisioning** is an automatic transfer of data from SAML SSO solution (Okta) to Wallarm: your Okta users and their group membership define access to Wallarm and permissions there; all user management is performed on Okta side.

For this to work, provide the attribute mapping:

1. In Okta application, map:

    * `email`
    * `first_name`
    * `last_name`
    * user group(s) to `wallarm_role:[role]` where `role` is:

        * `admin` (**Administrator**)
        * `analytic` (**Analyst**)
        * `api_developer` (**API Developer**)
        * `auditor` (**Read Only**)
        * `partner_admin` (**Global Administrator**)
        * `partner_analytic` (**Global Analyst**)
        * `partner_auditor` (**Global Read Only**)

            See all role descriptions [here](../../../user-guides/settings/users.md#user-roles).

1. Save the changes.

## Step 5 (Wallarm): Enter Okta metadata

1. In Wallarm Console, in the SSO configuration wizard, proceed to the **Upload metadata** step.
1. Do one of the following:

    * Upload Okta metadata as an XML file.
    * Enter metadata manually as follows:
    
        *   **Identity Provider Single Sign‑On URL** → **Identity provider SSO URL**.
        *   **Identity Provider Issuer** → **Identity provider issuer**.
        *   **X.509 Certificate** → **X.509 Certificate** field.
    
            ![Entering the metadata manually][img-transfer-metadata-manually]
    
1. Complete SSO configuration wizard. Wallarm will test if data to/from your Okta can now be transferred.
