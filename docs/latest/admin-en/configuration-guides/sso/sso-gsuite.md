# Connecting SSO with G Suite

[img-gsuite-console]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-console.png
[img-gsuite-add-app]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-add-app.png
[img-fetch-metadata]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-fetch-metadata.png
[img-fill-in-sp-data]:      ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-fill-in-sp-data.png
[img-app-page]:             ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-app-page.png
[link-gsuite-adm-console]:  https://admin.google.com
[img-sp-wizard-transfer-metadata]:  ../../../../images/admin-guides/configuration-guides/sso/gsuite/sp-wizard-transfer-metadata.png
[img-transfer-metadata-manually]:   ../../../../images/admin-guides/configuration-guides/sso/gsuite/transfer-metadata-manually.png
[img-sp-wizard-finish]:             ../../../../images/admin-guides/configuration-guides/sso/gsuite/sp-wizard-finish.png

This guide covers the process of connecting the [G Suite](https://gsuite.google.com/) (Google) service as an identity provider to Wallarm, which acts as the service provider.

## Step 1 (Wallarm): Activate SSO service

By default, SSO service for authentication in Wallarm is not active, corresponding blocks are not visible in the **Integrations** section in Wallarm Console.

To activate the SSO service, contact the [Wallarm support team](mailto:support@wallarm.com).

## Step 2 (Wallarm): Generate metadata

You need Wallarm metadata to enter on the G Suite side:

1. In Wallarm Console, go to **Integrations** → **SSO SAML AUTHENTICATION** and initiate the **Google SSO** configuration.

    ![Integrations - SSO](../../../../images/admin-guides/configuration-guides/sso/sso-integration-add.png)

1. In the SSO configuration wizard, at the **Send details** step, overview the Wallarm metadata, that should be passed to the G Suite service.

    ![Wallarm's metadata](../../../../images/admin-guides/configuration-guides/sso/gsuite/sp-metadata.png)

    * **Wallarm Entity ID** is a unique application identifier generated by the Wallarm application for the identity provider.
    * **Assertion Consumer Service URL (ACS URL)** is the address on the Wallarm side of the application on which identity provider sends requests with the SamlResponse parameter.

1. Copy metadata or save them as XML. 

## Step 3 (G Suite): Configure application

!!! info "Prerequisites"
    The following values are used as demonstration values in this guide:

    * `WallarmApp` as a value for the **Application Name** parameter (in G Suite).
    * `https://sso.online.wallarm.com/acs` as a value for the **ACS URL** parameter (in G Suite).
    * `https://sso.online.wallarm.com/entity-id` as a value for the **Entity ID** parameter (in G Suite).

!!! warning
    Ensure that you replace the sample values for the **ACS URL** and **Entity ID** parameters with the real ones obtained in the previous step.

To configure application in G Suite:

1. Log in to the Google [admin console][link-gsuite-adm-console]. 
1. Go to **Apps**.

    ![G Suite admin console][img-gsuite-console]

1. Click **SAML apps** → **Add a service/App to your domain**.
1. Click **Setup my own custom app**.

    ![Adding a new application to G Suite][img-gsuite-add-app]

    You will be provided with G Suite metadata:

    * **SSO URL**
    * **Entity ID**
    * **Certificate** (X.509)

1. Copy metadata or save them as XML. 
1. Click **Next**.

    ![Saving metadata][img-fetch-metadata]

1. Enter the Wallarm's metadata. Required fields:

    * **ACS URL** = **Assertion Consumer Service URL** parameter in Wallarm.
    * **Entity ID** = the **Wallarm Entity ID** parameter in Wallarm.

1. Fill in the remaining parameters if required, and click **Next**.

    ![Filling in service provider information][img-fill-in-sp-data]

1. Click **Finish**. You will be redirected to the page of the created application.

    ![Application page in G Suite][img-app-page]

1. Activate application via **Edit Service** → **Service status** → **ON for everyone**.
1. Save the changes.

## Step 4 (G Suite): Configure provisioning

The **provisioning** is an automatic transfer of data from SAML SSO solution (G Suite) to Wallarm: your G Suite users and their group membership define access to Wallarm and permissions there; all user management is performed on G Suite side.

For this to work, provide the attribute mapping:

1. In G Suite application, via **Add new mapping**, map:

    * `email`
    * `first_name`
    * `last_name`
    * user group(s) to `wallarm_role:[role]` where `role` is:

        * `admin` (**Administrator**)
        * `analytic` (**Analyst**)
        * `api_developer` (**API Developer**)
        * `auditor` (**Read Only**)
        * `partner_admin` (**Global Administrator**)
        * `partner_analytic` (**Global Analyst**)
        * `partner_auditor` (**Global Read Only**)

            See all role descriptions [here](../../../user-guides/settings/users.md#user-roles). Contact the [Wallarm support team](mailto:support@wallarm.com) to get more roles available.

    ![SAML SSO solution - G Suite - Mapping](../../../images/admin-guides/configuration-guides/sso/simple-sso-mapping.png)

1. Save the changes.

## Step 5 (Wallarm): Enter G Suite metadata

1. In Wallarm Console, in the SSO configuration wizard, proceed to the **Upload metadata** step.
1. Do one of the following:

    * Upload G Suite metadata as an XML file.

        ![Metadata uploading][img-sp-wizard-transfer-metadata]

    * Enter metadata manually as follows:

        * **SSO URL** → **Identity provider SSO URL**
        * **Entity ID** → **Identity provider issuer**
        * **Certificate** → **X.509 Certificate**

            ![Entering the metadata manually][img-transfer-metadata-manually]

1. Complete SSO configuration wizard. Wallarm to G Suite connection will be tested.

    ![Completing SSO wizard][img-sp-wizard-finish]
