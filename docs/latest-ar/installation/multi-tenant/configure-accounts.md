# إنشاء حسابات المستأجر في لوحة تحكم Wallarm

توفر هذه التعليمات الخطوات المطلوبة لتكوين [حسابات المستأجر](overview.md) بشكل صحيح.

--8<-- "../include/waf/features/multi-tenancy/partner-client-term.md"

## تكوين حسابات المستأجر

لتكوين حسابات المستأجر:

1. اشترك في لوحة تحكم Wallarm وأرسل طلبًا لتنشيط ميزة التعددية لحسابك إلى الدعم الفني لـ Wallarm.
1. قم بإنشاء حساب مستأجر.
1. اربط حركة مرور محددة بالمستأجر وتطبيقاته.

### الخطوة 1: الاشتراك وإرسال طلب لتنشيط ميزة التعددية

1. قم بملء وتأكيد نموذج التسجيل في لوحة تحكم Wallarm في [ السحابة الأمريكية](https://us1.my.wallarm.com/signup) أو [ السحابة الأوروبية](https://my.wallarm.com/signup).

    ![نموذج التسجيل](../../images/signup-en.png)

    !!! info "البريد الإلكتروني للشركة"
        يرجى الاشتراك باستخدام عنوان البريد الإلكتروني للشركة.
2. افتح صندوق البريد وقم بتنشيط الحساب باستخدام الرابط الموجود في الرسالة المستلمة.
3. أرسل طلبًا لتنشيط ميزة التعددية لحسابك إلى [الدعم الفني لـ Wallarm](mailto:support@wallarm.com). أرسل البيانات التالية مع الطلب:
   * اسم السحابة Wallarm المستخدمة (السحابة الأمريكية أو السحابة الأوروبية)
   * الأسماء للحساب العالمي ولحساب المستأجر الفني
   * عناوين البريد الإلكتروني للموظفين الذين سيتم السماح لهم بالوصول إلى حسابات المستأجر (بعد تنشيط ميزة التعددية، ستتمكن من إضافة الموظفين بنفسك)
   * شعار لـ واجهة لوحة تحكم Wallarm
   * نطاق مخصص لـ واجهة لوحة تحكم Wallarm، الشهادة والمفتاح التشفير للنطاق
   * عنوان البريد الإلكتروني للدعم الفني الخاص بك

بعد الحصول على طلبك، سيقوم الدعم الفني لـ Wallarm بـ:

1. إنشاء حساب عالمي وحساب مستأجر فني في سحابة Wallarm.
2. يضيفك إلى قائمة مستخدمي الحساب العميل التقني بوظيفة [المسؤول العالمي](../../user-guides/settings/users.md).
3. إذا تم تقديم عناوين البريد الإلكتروني لموظفيك، سوف يضيف الدعم الفني لـ Wallarm الموظفين إلى قائمة المستخدمين للحساب المستأجر التقني بوظيفة [القراءة العالمية فقط](../../user-guides/settings/users.md).

   سيتم إرسال رسائل بريد إلكتروني للموظفين غير المسجلين مع الرابط لتعيين كلمة مرور جديدة للوصول إلى الحساب المستأجر التقني.
4. إرسال UUID الخاص بك (UUID المستأجر الرئيسي الذي يشير إلى شركة Wallarm الشريكة أو عميل Wallarm الذي يستخدم التعددية للبيئات المعزولة).

  سيكون المطلوب UUID المستلم في الخطوات اللاحقة.

### الخطوة 2: إنشاء المستأجر

#### من خلال لوحة تحكم Wallarm

تحت حساب **المسئول العالمي**، يمكنك إنشاء المستأجرين من خلال لوحة تحكم Wallarm → محدد المستأجر → **إنشاء مستأجر**.

![إنشاء مستأجر من خلال لوحة تحكم Wallarm](../../images/partner-waf-node/tenant-create-via-ui.png)

يمكنك إنشاء [مستخدم](../../user-guides/settings/users.md#user-roles) **مسؤول** جديد للمستأجر الجديد الخاص بك. سيتم إرسال البريد الإلكتروني للدعوة إلى العنوان المحدد.

#### عبر Wallarm API

لإنشاء المستأجر، يمكنك إرسال طلبات مصادقة إلى Wallarm API. يمكن إرسال الطلبات المصادقة على Wallarm API من عميل API الخاص بك أو من [لوحة تحكم Wallarm API](../../api/overview.md) التي تحدد طريقة المصادقة:

* لإرسال الطلبات من **لوحة تحكم Wallarm API**، يلزم تسجيل الدخول إلى لوحة تحكم Wallarm بوظيفة **المسئول العالمي** وتحديث صفحة Wallarm API Console المتوفرة على:
  * https://apiconsole.us1.wallarm.com/ للسحابة الأمريكية
  * https://apiconsole.eu1.wallarm.com/ للسحابة الأوروبية
* لإرسال الطلبات من **عميل API الخاص بك**، يلزم تمرير [رمز API مع صلاحيات المسؤول العالمي](../../user-guides/settings/api-tokens.md#creating-tokens-with-global-role-permissions) في الطلب.

في هذه الخطوة، سيتم إنشاء حساب المستأجر المرتبط بالحساب العالمي.

1. أرسل الطلب POST إلى المسار `/v1/objects/client/create` مع البارامترات التالية:

   البارامتر | الوصف |  جزء الطلب | المطلوب
   --------- | -------- | ------------- | ---------
   `X-WallarmApi-Token` | [رمز API](../../user-guides/settings/api-tokens.md#configuring-tokens)  مع تصريح ** المسؤول العالمي **. | رأس | نعم ، عند إرسال طلب من عميل API الخاص بك
   `name` | اسم المستأجر.|  الجسم |  نعم
   `vuln_prefix` | بادئة التحيز التي ستستخدمها Wallarm لتتبع التحيز والربط مع المستأجر. يجب أن تحتوي البادئة على أربعة أحرف كبيرة أو أرقام وتكون ذات صلة باسم المستأجر ، على سبيل المثال: `TNNT` لـ 'Tenant'. | الجسم | نعم
   `partner_uuid` | [معرف المستأجر الرئيسي](#step-2-get-access-to-the-tenant-account-creation) المستلم عند إنشاء حساب عالمي. | الجسم | نعم

   ??? info "إظهار مثال على الطلب الذي أرسلته من عميل API الخاص بك"
       === " السحابة الأمريكية"
           ```bash
           curl -v -X POST "https://us1.api.wallarm.com/v1/objects/client/create" -H "X-WallarmApi-Token: <YOUR_TOKEN>" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"name\": \"Tenant\", \"vuln_prefix\": \"TNNT\", \"partner_uuid\": \"YOUR_PARTNER_UUID\"}"
           ```
       === " السحابة الأوروبية"
           ``` bash
           curl -v -X POST "https://api.wallarm.com/v1/objects/client/create" -H "X-WallarmApi-Token: <YOUR_TOKEN>" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"name\": \"Tenant\", \"vuln_prefix\": \"TNNT\", \"partner_uuid\": \"YOUR_PARTNER_UUID\"}"
           ```

   ??? info "إظهار مثال على الرد"
       ``` bash
       {
       "status":200,
       "body": {
           "id":10110,
           "name":"Tenant 1",
           "components":["waf"],
           "vuln_prefix":"TNTST",
           ...
           "uuid":"11111111-1111-1111-1111-111111111111",
           ...
           }
       }
       ```

2. انسخ قيمة البارامتر `uuid` من الرد على الطلب. سيتم استخدام البارامتر عند ربط حركة مرور المستأجر بحساب المستأجر.

ستتم عرض المستأجرين المنشأين في لوحة تحكم Wallarm لـ [المستخدمين العالميين](../../user-guides/settings/users.md#user-roles). مثل `Tenant 1` و `Tenant 2` :

![محدد المستأجر في لوحة تحكم Wallarm](../../images/partner-waf-node/clients-selector-in-console.png)

### الخطوة 3: ربط حركة مرور محددة بمستأجرك

 !!! info "متى يتم التكوين؟"
     يتم أداء هذا التكوين أثناء نشر العقدة وفقط إذا كانت حركة مرور جميع المستأجرين [تتم المعالجة أو ستتم المعالجة](deploy-multi-tenant-node.md) بواسطة عقدة Wallarm واحدة فقط.

     إذا كانت العقدة المنفصلة تعالج حركة مرور كل مستأجر، يرجى تجاوز هذه الخطوة والمتابعة إلى [نشر العقدة وتكوينها](deploy-multi-tenant-node.md).

لتقديم معلومات لـ Wallarm Cloud حول أي حركة مرور يجب عرضها تحت حساب المستأجر الذي تحته، نحتاج إلى ربط حركة مرور محددة بالمستأجر المنشأ. لهذا، قم بتضمين المستأجر في ملف التكوين NGINX باستخدام `uuid` الخاص به (المستلم في **الخطوة 3**) كقيمة للتوجيه [`wallarm_partner_client_uuid`](../../admin-en/configure-parameters-en.md#wallarm_partner_client_uuid). على سبيل المثال:

```
server {
  server_name  tenant1.com;
  wallarm_partner_client_uuid 11111111-1111-1111-1111-111111111111;
  ...
}
```

في التكوين أعلاه، سترتبط حركة المرور التي تستهدف `tenant1.com` بالعميل `11111111-1111-1111-1111-111111111111`.

## توفير الوصول للمستخدمين إلى الحسابات

* على حساب المستأجر التقني، هناك **عالمية** و**عادية** [الأدوار](../../user-guides/settings/users.md) لتوفرها للمستخدمين.

   سيكون للمستخدمين العالميين الوصول إلى جميع حسابات المستأجر المرتبطة.

   سيكون للمستخدمين العاديين الوصول فقط إلى الحساب المستأجر التقني.
* على حسابات المستأجر معينة، هناك فقط **عادية** [الأدوار](../../user-guides/settings/users.md) لتوفرها للمستخدمين.

   سيتمكن المستخدمون من تتبع الطلبات المحظورة، وتحليل الثغرات التي تم اكتشافها، وأداء تكوينات إضافية للعقدة التصفية ضمن حساب المستأجر معين. سيتمكن المستخدمون من إضافة بعضهم البعض بأنفسهم إذا سمحت الأدوار بذلك.

[اشرع في نشر العقدة ذات التعددية والتكوين →](deploy-multi-tenant-node.md)

## تعطيل وتنشيط حسابات المستأجر في لوحة تحكم Wallarm

 في لوحة تحكم Wallarm، يمكن للمستخدم بدور **المسئول العالمي** تعطيل حسابات المستأجر المرتبطة بالحساب العالمي الذي يخدمه هذا المسئول. عندما يتم تعطيل حساب المستأجر:

* ليس لدى مستخدمي هذا الحساب المستأجر الوصول إلى لوحة تحكم Wallarm.
* ستتوقف العقدة (العقد) المثبتة على هذا [مستوى المستأجر](deploy-multi-tenant-node.md#multi-tenant-node-characteristics) عن معالجة حركة المرور.

الحسابات المعطلة لا تتم حذفها ويمكن تنشيطها مرة أخرى.

لتعطيل حساب المستأجر، في محدد المستأجر، من قائمة المستأجر، اختر **تعطيل**، ثم أكد. سيتم تعطيل حساب المستأجر وإخفاؤه من قائمة المستأجر.

![مستأجر - تعطيل](../../images/partner-waf-node/tenant-deactivate.png)

 لتنشيط حساب المستأجر المعطل مسبقا، في محدد المستأجر، انقر على **إظهار حسابات المستأجر المعطلة**، ثم اختر **تنشيط** لمستأجرك.