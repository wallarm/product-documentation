# إنشاء حسابات المُستأجر في وحدة تحكم Wallarm

توفر لك هذه التعليمات الخطوات الصحيحة لضبط حسابات [المُستأجر](overview.md) بشكل صحيح.

--8<-- "../include/waf/features/multi-tenancy/partner-client-term.md"

## ضبط حسابات المُستأجر

لضبط حسابات المُستأجر:

1. قم بالتسجيل في وحدة تحكم Wallarm وأرسل طلبًا لتفعيل ميزة الإيجار المتعدد لحسابك إلى دعم فني Wallarm.
1. قم بإنشاء حساب المُستأجر.
1. قم بربط حركة المرور المحددة بالمُستأجر وتطبيقاته.

### الخطوة 1: التسجيل وإرسال طلب لتفعيل ميزة الإيجار المتعدد

1. املأ وأكد نموذج التسجيل في وحدة تحكم Wallarm في [السحابة الأمريكية](https://us1.my.wallarm.com/signup) أو [السحابة الأوروبية](https://my.wallarm.com/signup).

    ![نموذج التسجيل](../../images/signup-en.png)

    !!! info "البريد الإلكتروني للشركة"
        يرجى التسجيل باستخدام عنوان بريد إلكتروني للشركة.
2. افتح صندوق البريد الوارد الخاص بك وفعل الحساب باستخدام الرابط من الرسالة المستلمة.
3. أرسل طلبًا لتفعيل ميزة الإيجار المتعدد لحسابك إلى [دعم فني Wallarm](mailto:support@wallarm.com). أرسل المعلومات التالية مع الطلب:
    * اسم سحابة Wallarm المستخدمة (السحابة الأمريكية أو السحابة الأوروبية)
    * أسماء لحساب عالمي وحساب تقني للمُستأجر
    * عناوين البريد الإلكتروني للموظفين الذين سيتم منحهم الوصول إلى حسابات المُستأجر (بعد تفعيل ميزة الإيجار المتعدد، ستتمكن من إضافة الموظفين بنفسك)
    * الشعار لوحدة تحكم Wallarm الموسومة
    * نطاق مخصص لوحدة تحكم Wallarm، شهادة ومفتاح تشفير للنطاق
    * عنوان بريدك الإلكتروني للدعم الفني

بعد تلقي طلبك، سيقوم دعم فني Wallarm بـ:

1. إنشاء حساب عالمي وحساب تقني للمُستأجر في سحابة Wallarm.
2. إضافتك إلى قائمة مستخدمي حساب التقني للمُستأجر بـ[دور](../../user-guides/settings/users.md) **المدير العالمي**.
3. إذا تم توفير عناوين بريد إلكتروني للموظفين، سيضيف دعم فني Wallarm الموظفين إلى قائمة مستخدمي حساب التقني للمُستأجر بـ[دور](../../user-guides/settings/users.md) **القراءة العالمية فقط**.

    سيستلم الموظفون غير المسجلين رسائل بريد إلكتروني مع رابط لتعيين كلمة مرور جديدة للوصول إلى حساب التقني للمُستأجر.
4. إرسال UUID الخاص بك (UUID الرئيسي للمُستأجر يشير إلى شركة شريكة في Wallarm أو عميل Wallarm يستخدم الإيجار المتعدد للبيئات المعزولة).

    ستكون UUID المستلمة مطلوبة في الخطوات التالية.

### الخطوة 2: إنشاء المُستأجر

#### عبر وحدة تحكم Wallarm

تحت حساب **المدير العالمي**، يمكنك إنشاء مُستأجرين عبر وحدة تحكم Wallarm → مُحدد المُستأجر → **إنشاء مُستأجر**.

![!إنشاء مُستأجر عبر وحدة تحكم Wallarm](../../images/partner-waf-node/tenant-create-via-ui.png)

يمكنك إنشاء [مستخدم](../../user-guides/settings/users.md#user-roles) **مدير** جديد لمُستأجرك الجديد. سيتم إرسال بريد إلكتروني للدعوة إلى العنوان المحدد.

#### عبر واجهة برمجة تطبيقات Wallarm

لإنشاء المُستأجر، يمكنك إرسال طلبات مُصادق عليها إلى واجهة برمجة تطبيقات Wallarm. يمكن إرسال الطلبات المُصادق عليها إلى واجهة برمجة تطبيقات Wallarm من عميل API الخاص بك أو من [وحدة تحكم واجهة برمجة تطبيقات Wallarm](../../api/overview.md) التي تحدد طريقة المصادقة:

* للطلبات التي سيتم إرسالها من **وحدة تحكم واجهة برمجة تطبيقات Wallarm**، يتطلب تسجيل الدخول إلى وحدة تحكم Wallarm بدور مستخدم **المدير العالمي** وتحديث صفحة وحدة تحكم واجهة برمجة تطبيقات Wallarm المتاحة على:
    * https://apiconsole.us1.wallarm.com/ للسحابة الأمريكية
    * https://apiconsole.eu1.wallarm.com/ للسحابة الأوروبية
* للطلبات التي سيتم إرسالها من **عميل API الخاص بك**، يتطلب إرسال [رمز API بأذونات المدير العالمي](../../user-guides/settings/api-tokens.md#creating-tokens-with-global-role-permissions) في الطلب.

في هذه الخطوة، سيتم إنشاء حساب المُستأجر المرتبط بحساب عالمي.

1. أرسل الطلب POST إلى المسار `/v1/objects/client/create` بالمعايير التالية:

    المعيار | الوصف | جزء الطلب | مطلوب
    --------- | -------- | ------------- | ---------
    `X-WallarmApi-Token` | [رمز API](../../user-guides/settings/api-tokens.md#configuring-tokens) بأذونات **المدير العالمي**. | رأس | نعم، عند إرسال طلب من عميل API الخاص بك
    `name` | اسم المُستأجر. | الجسم | نعم
    `vuln_prefix` | بادئة الثغرة الأمنية التي ستستخدمها Wallarm لتتبع الثغرات الأمنية وربطها بالمُستأجر. يجب أن تحتوي البادئة على أربعة أحرف كبيرة أو أرقام وأن تكون متعلقة باسم المُستأجر، على سبيل المثال: `TNNT` للمُستأجر `Tenant`. | الجسم | نعم
    `partner_uuid` | [UUID الرئيسي للمُستأجر](#step-2-get-access-to-the-tenant-account-creation) المستلم عند إنشاء حساب عالمي. | الجسم | نعم

    ??? info "عرض مثال على الطلب المُرسل من عميل API الخاص بك"
        === "السحابة الأمريكية"
            ```bash
            curl -v -X POST "https://us1.api.wallarm.com/v1/objects/client/create" -H "X-WallarmApi-Token: <YOUR_TOKEN>" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"name\": \"Tenant\", \"vuln_prefix\": \"TNNT\", \"partner_uuid\": \"YOUR_PARTNER_UUID\"}"
            ```
        === "السحابة الأوروبية"
            ``` bash
            curl -v -X POST "https://api.wallarm.com/v1/objects/client/create" -H "X-WallarmApi-Token: <YOUR_TOKEN>" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"name\": \"Tenant\", \"vuln_prefix\": \"TNNT\", \"partner_uuid\": \"YOUR_PARTNER_UUID\"}"
            ```

    ??? info "عرض مثال على الاستجابة"
        ``` bash
        {
        "status":200,
        "body": {
            "id":10110,
            "name":"Tenant 1",
            "components":["waf"],
            "vuln_prefix":"TNTST",
            ...
            "uuid":"11111111-1111-1111-1111-111111111111",
            ...
            }
        }
        ```

2. انسخ قيمة المُعامل `uuid` من الاستجابة إلى الطلب. سيتم استخدام المُعامل عند ربط حركة مرور المُستأجر بحساب المُستأجر.

سيتم عرض المُستأجرين المُنشأين في وحدة تحكم Wallarm لـ[المستخدمين العالميين](../../user-guides/settings/users.md#user-roles). على سبيل المثال، `Tenant 1` و `Tenant 2`:

![مُحدد المستأجرين في وحدة تحكم Wallarm](../../images/partner-waf-node/clients-selector-in-console.png)

### الخطوة 3: ربط حركة مرور محددة بمُستأجرك

!!! info "متى تقوم بالضبط؟"
    يتم إجراء هذا الضبط أثناء نشر العُقدة وفقط إذا كانت حركة مرور جميع المستأجرين [تتم معالجتها أو ستتم معالجتها](deploy-multi-tenant-node.md) بواسطة عقدة Wallarm واحدة فقط.

    إذا كانت عقدة منفصلة تعالج حركة مرور كل مُستأجر، يرجى تخطي هذه الخطوة والمُضي قدمًا إلى [نشر العُقدة وضبطها](deploy-multi-tenant-node.md).

لتوفير معلومات لسحابة Wallarm حول أي حركة مرور يجب عرضها تحت أي حساب مُستأجر، نحتاج إلى ربط حركة المرور المحددة بالمُستأجر المُنشأ. للقيام بذلك، قم بتضمين المُستأجر في ملف تكوين NGINX باستخدام `uuid` الخاص به (المُستلم في **الخطوة 3**) كقيمة لمُعامل [`wallarm_partner_client_uuid`](../../admin-en/configure-parameters-en.md#wallarm_partner_client_uuid). على سبيل المثال:

```
server {
  server_name  tenant1.com;
  wallarm_partner_client_uuid 11111111-1111-1111-1111-111111111111;
  ...
}
```

في التكوين أعلاه، سيتم ربط حركة مرور المُوجهة إلى `tenant1.com` بالعميل `11111111-1111-1111-1111-111111111111`.

## منح المستخدمين الوصول إلى الحسابات

* على حساب التقني للمُستأجر، توجد [أدوار](../../user-guides/settings/users.md) **عالمية** و**عادية** لمنح الوصول للمستخدمين.

    سيكون للمستخدمين العالميين الوصول إلى جميع حسابات المُستأجرين المرتبطة.

    سيكون للمستخدمين العاديين الوصول فقط إلى حساب التقني للمستأجر.
* على حسابات مُستأجر معين، توجد فقط [أدوار](../../user-guides/settings/users.md) **عادية** لمنح الوصول للمستخدمين.

    سيكون بإمكان المستخدمين تتبع الطلبات المحظورة، تحليل الثغرات الأمنية المكتشفة، وإجراء تكوينات إضافية لعقدة التصفية ضمن حساب مُستأجر معين. سيتمكن المستخدمون من إضافة بعضهم البعض بأنفسهم إذا سمحت الأدوار بهذا الإجراء.

[المُضي قدمًا إلى نشر عقدة الإيجار المتعدد وضبطها →](deploy-multi-tenant-node.md)

## تفعيل وإلغاء تفعيل حسابات المُستأجر في وحدة تحكم Wallarm

في وحدة تحكم Wallarm، يمكن للمستخدم بدور **المدير العالمي** تفعيل حسابات المُستأجر المرتبطة بالحساب العالمي الذي يخدمه هذا الإداري.