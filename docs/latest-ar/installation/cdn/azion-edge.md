[ptrav-attack-docs]:                ../../attacks-vulns-list.md#path-traversal
[attacks-in-ui-image]:              ../../images/admin-guides/test-attacks-quickstart-sqli-xss.png

# جدار الحماية آزيون مع وظائف والارم

[وظائف آزيون الحافة](https://www.azion.com/en/products/edge-functions/) تمكن من تنفيذ كود تخصصي عند حافة الشبكة، مما يتيح تطبيق قواعد خاصة بالعميل للتعامل مع الطلبات. بدمج الكود المخصص من والارم، يمكن توجيه الحركة الواردة إلى عقدة والارم للتحليل والتصفية. هذا الإعداد يحسن من التدابير الأمنية المقدمة بالفعل من قبل [جدار حماية آزيون الحافة](https://www.azion.com/en/products/edge-firewall/). هذا الدليل يوفر تعليمات حول كيفية دمج عقدة والارم مع آزيون إيدج لحماية الخدمات التي تعمل على آزيون إيدج.

يتضمن الحل نشر عقدة والارم خارجياً وإدخال كود مخصص أو سياسات في منصة معينة. هذا يتيح توجيه الحركة إلى عقدة والارم الخارجية للتحليل والحماية ضد التهديدات المحتملة. يشار إلى واصلات والارم كحلقة الوصل الأساسية بين منصات مثل آزيون إيدج، إيدج آكاماي، مولسوفت, أبيجي، وأدبي لامبدا، وعقدة والارم الخارجية. هذا النهج يضمن التكامل السلس، تحليل الحركة الآمن، تخفيف المخاطر، وأمان المنصة الشامل.

## حالات الاستخدام

من بين جميع خيارات [نشر والارم المدعومة](../supported-deployment-options.md)، هذا الحل هو الخيار الموصى به لحالات الاستخدام التالية:

* تأمين واجهات برمجة التطبيقات أو الحركة التي تعمل على آزيون إيدج.
* الحاجة إلى حل أمني يقدم مراقبة هجمات شاملة، تقارير، وحجب فوري للطلبات الخبيثة.

## القيود

هناك بعض القيود للحل حيث يعمل فقط مع الطلبات الواردة:

* اكتشاف الثغرات الأمنية باستخدام طريقة [الاكتشاف السلبي](../../about-wallarm/detecting-vulnerabilities.md#passive-detection) لا يعمل بشكل صحيح. يحدد الحل ما إذا كانت واجهة برمجة التطبيقات معرضة للخطر أو لا بناءً على استجابات الخادم للطلبات الخبيثة التي تكون نموذجية للثغرات التي يقوم بفحصها.
* لا يمكن لـ [اكتشاف واجهات برمجة التطبيقات والارم](../../api-discovery/overview.md) استكشاف جرد واجهة برمجة التطبيقات بناءً على حركتك، حيث يعتمد الحل على تحليل الاستجابات.
* لا يتوفر [الحماية ضد التصفح القسري](../../admin-en/configuration-guides/protecting-against-bruteforce.md) نظرًا لأنه يتطلب تحليل رمز الاستجابة.

## المتطلبات

للمضي قدمًا في النشر، تأكد من تلبية المتطلبات التالية:

* فهم تقنيات آزيون إيدج
* واجهات برمجة التطبيقات أو الحركة التي تعمل على آزيون إيدج.

## النشر

لتأمين واجهات برمجة التطبيقات على آزيون إيدج بواسطة والارم، اتبع الخطوات التالية:

1. نشر عقدة والارم باستخدام أحد خيارات النشر المتاحة.
1. الحصول على كود والارم لوظائف الحافة وتشغيله على آزيون.

### 1. نشر عقدة والارم

عند استخدام والارم على آزيون إيدج، يكون تدفق الحركة [في الخط](../inline/overview.md).

1. اختر واحدًا من [حلول أو أعمال دعم عقدة والارم](../supported-deployment-options.md#in-line) للنشر في الخط واتبع تعليمات النشر المقدمة.
1. قم بتهيئة العقدة المنشورة باستخدام النموذج التالي:

    ```
    server {
        listen 80;

        server_name _;

        access_log off;
        wallarm_mode off;

        location / {
            proxy_set_header Host $http_x_forwarded_host;
            proxy_pass http://unix:/tmp/wallarm-nginx.sock;
        }
    }

    server {
        listen 443 ssl;

        server_name yourdomain-for-wallarm-node.tld;

        ### تهيئة SSL هنا

        access_log off;
        wallarm_mode off;

        location / {
            proxy_set_header Host $http_x_forwarded_host;
            proxy_pass http://unix:/tmp/wallarm-nginx.sock;
        }
    }


    server {
        listen unix:/tmp/wallarm-nginx.sock;
        
        server_name _;
        
        wallarm_mode monitoring;
        #wallarm_mode block;

        real_ip_header X-EDGEWRK-REAL-IP;
        set_real_ip_from unix:;

        location / {
            echo_read_request_body;
        }
    }
    ```

    يرجى الانتباه إلى التهيئات التالية:

    * شهادات TLS/SSL لحركة HTTPS: لتمكين عقدة والارم من التعامل مع حركة HTTPS الآمنة، قم بتهيئة شهادات TLS/SSL وفقًا لذلك. ستعتمد التهيئة المحددة على طريقة النشر المختارة. على سبيل المثال، إذا كنت تستخدم NGINX، يمكنك الرجوع إلى [مقالته](https://docs.nginx.com/nginx/admin-guide/security-controls/terminating-ssl-http/) للحصول على إرشادات.
    * تهيئة [وضع تشغيل والارم](../../admin-en/configure-wallarm-mode.md).
1. بعد اكتمال النشر، سجل عنوان IP للعقدة حيث ستحتاج إليه لاحقًا لضبط عنوان توجيه الطلبات الواردة.

### 2. الحصول على كود والارم لوظائف الحافة وتشغيله على آزيون

للحصول على كود والارم لوظائف آزيون الحافة وتشغيله، اتبع الخطوات التالية:

1. اتصل بـ [support@wallarm.com](mailto:support@wallarm.com) للحصول على كود والارم.
1. على آزيون إيدج، انتقل إلى **الفوترة والاشتراكات** وفعل الاشتراك في **تسريع التطبيق** و**وظائف الحافة**.
1. إنشاء **تطبيق حافة** جديد واحفظه.
1. افتح التطبيق الذي تم إنشاؤه → **الإعدادات الرئيسية** وفعل **تسريع التطبيق** و**وظائف الحافة**.
1. انتقل إلى **النطاقات** وانقر على **إضافة نطاق**.
1. انتقل إلى **وظائف الحافة**، انقر على **إضافة وظيفة** واختر نوع `جدار الحماية الحافة`.
1. الصق كود والارم محل `wallarm.node.tld` بعنوان [عقدة والارم المنشورة مسبقًا](#1-deploy-a-wallarm-node).
1. اذهب إلى **جدار الحماية الحافة** → **إضافة مجموعة قواعد** → اكتب **الاسم** → اختر **النطاقات** وفعل **وظائف الحافة**.
1. انتقل إلى تبويب **الوظائف**، انقر على **إضافة وظيفة** واختر الوظيفة التي تم إنشاؤها مسبقًا.
1. انتقل إلى تبويب **محرك القواعد** → **قاعدة جديدة** وحدد المعايير للحركة لتكون مفلترة بواسطة والارم:

    * لتحليل وتصفية جميع الطلبات، اختر `إذا بدأ URI الطلب بـ /`.
    * في **السلوكيات**، اختر `ثم تشغيل وظيفة` واختر الوظيفة التي تم إنشاؤها مسبقًا.

## الاختبار

لتجربة وظيفة السياسة المنشورة، اتبع الخطوات التالية:

1. أرسل طلب مع اختبار هجوم [اجتياز المسار][ptrav-attack-docs] إلى واجهة برمجة التطبيقات الخاصة بك:

    ```
    curl http://<YOUR_APP_IP_OR_DOMAIN>/etc/passwd
    ```
1. افتح واجهة والارم → قسم **الهجمات** في [السحابة الأمريكية](https://us1.my.wallarm.com/attacks) أو [السحابة الأوروبية](https://my.wallarm.com/attacks) وتأكد من ظهور الهجوم في القائمة.
    
    ![الهجمات في الواجهة][attacks-in-ui-image]

    إذا كان وضع عقدة والارم مضبوطاً على الحجب، سيتم حجب الطلب أيضًا.

## هل تحتاج مساعدة؟

إذا واجهت أي مشاكل أو كنت بحاجة إلى مساعدة مع النشر الموصوف لـ والارم بالتعاون مع آزيون إيدج، يمكنك التواصل مع فريق [دعم والارم](mailto:support@wallarm.com). هم متاحون لتوفير الإرشاد والمساعدة في حل أي مشاكل قد تواجهها خلال عملية التنفيذ.