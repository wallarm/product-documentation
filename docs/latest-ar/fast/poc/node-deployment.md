#   تشغيل عقدة FAST عبر واجهة برمجة تطبيقات Wallarm

!!! info "متطلبات الفصل"
    لتتبع الخطوات الموضحة في هذا الفصل، يجب عليك الحصول على [رمز][doc-get-token].
    
    تُستخدم القيم التالية كأمثلة طوال هذا الفصل:
    
    * `token_Qwe12345` كرمز.
    * `tr_1234` كمعرف لتشغيل اختبار.
    * `rec_0001` كمعرف لتسجيل اختبار.

يتضمن تشغيل وتكوين عقدة FAST الخطوات التالية:
1.  [نشر حاوية Docker مع عقدة FAST.][anchor-node]
2.  [الحصول على تشغيل اختبار.][anchor-testrun]

##  نشر حاوية Docker مع عقدة FAST

!!! warning "السماح بالوصول إلى خوادم واجهة برمجة تطبيقات Wallarm"
    من الضروري للعمل الصحيح لعقدة FAST أن يكون لها الوصول إلى خوادم واجهة برمجة تطبيقات Wallarm `us1.api.wallarm.com` أو `api.wallarm.com` عبر بروتوكول HTTPS (`TCP/443`).
    
    تأكد من أن جدار الحماية الخاص بك لا يقيد الوصول من الحاوية Docker إلى خوادم واجهة برمجة تطبيقات Wallarm.

يتطلب بعض التكوين قبل تشغيل حاوية Docker مع عقدة FAST. لتكوين العقدة، ضع الرمز داخل الحاوية باستخدام متغير البيئة `WALLARM_API_TOKEN`. بالإضافة إلى ذلك، يمكنك استخدام متغير `ALLOWED_HOSTS` إذا كنت بحاجة [لتحديد عدد الطلبات التي سيتم تسجيلها][doc-limit-requests].

لتمرير متغيرات البيئة إلى الحاوية، ضع المتغيرات في ملف نصي وحدد مسار الملف باستخدام الخيار [`--env-file`][link-docker-envfile] لأمر [`docker run`][link-docker-run] (انظر [التعليمات][doc-docker-run-fast] في دليل "البدء السريع").

شغل حاوية مع عقدة FAST بتنفيذ الأمر التالي:

```
docker run \ 
--rm \
--name <name> \
--env-file=<environment variables file> \
-p <target port>:8080 \
wallarm/fast 
```

يُفترض في هذا الدليل أن الحاوية تعمل مرة واحدة فقط للوظيفة CI/CD المحددة ويتم إزالتها عند انتهاء الوظيفة. لذلك، تمت إضافة الخيار [`--rm`][link-docker-rm] إلى الأمر المذكور أعلاه.

يرجى الرجوع إلى دليل "البدء السريع" للحصول على [وصف تفصيلي][doc-docker-run-fast] لمعاملات الأمر.

??? info "مثال"
    يفترض هذا المثال أن عقدة FAST تستخدم رمز `token_Qwe12345` وهي معدة لتسجيل جميع طلبات الأساس التي تحتوي `example.local` كجزء من قيمة رأس `Host`.  

    يُظهر المثال التالي محتوى ملف مع متغيرات البيئة:

    | fast.cfg |
    | -------- |
    | `WALLARM_API_TOKEN=token_Qwe12345`<br>`ALLOWED_HOSTS=example.local` |

    الأمر أدناه يشغل حاوية Docker باسم `fast-poc-demo` مع السلوك التالي:
    
    * الحاوية يتم إزالتها بعد انتهاء عملها.
    * متغيرات البيئة يتم تمريرها إلى الحاوية باستخدام ملف `fast.cfg`. 
    * منفذ `8080` للحاوية يتم نشره إلى منفذ `9090` لمضيف Docker.

    ```
    docker run --rm --name fast-poc-demo --env-file=fast.cfg -p 9090:8080  wallarm/fast
    ```

إذا كان نشر عقدة FAST ناجحًا، فإن وحدة التحكم بالحاوية وملف السجل سيحتويان على الرسائل التالية:

```
[info] Node connected to Wallarm Cloud
[info] Waiting for TestRun to check…
```

الآن عقدة FAST تستمع على عنوان IP لمضيف Docker، والمنفذ الذي حددته مسبقاً بخيار `-p` لأمر `docker run`.

##  الحصول على تشغيل اختبار

تحتاج إما لـ[إنشاء][anchor-testrun-creation] تشغيل اختبار أو [نسخ][anchor-testrun-copying] واحدة. يعتمد الاختيار على [سيناريو إنشاء تشغيل الاختبار][doc-testing-scenarios] المناسب لك.

### الحصول على معرف سياسة الاختبار

إذا كنت تخطط لاستخدام [سياسة اختبار][doc-testpolicy] خاصة بك، فـ[أنشئ واحدة][link-wl-portal-new-policy] واحصل على معرف السياسة. لاحقًا، قم بتمرير المعرف إلى معامل `policy_id` عند إجراء استدعاء واجهة برمجة التطبيقات لإنشاء أو نسخ تشغيل الاختبار.

خلاف ذلك، إذا اخترت استخدام سياسة الاختبار الافتراضية، فيجب حذف معامل `policy_id` من استدعاء واجهة برمجة التطبيقات.

!!! info "مثال على سياسة الاختبار"
    يحتوي دليل "البدء السريع" على [تعليمات خطوة بخطوة][doc-testpolicy-creation-example] حول كيفية إنشاء سياسة اختبار نموذجية.

### إنشاء تشغيل اختبار

عند إنشاء تشغيل اختبار، يتم أيضًا إنشاء [تسجيل اختبار][doc-testrecord] جديد.

يجب استخدام طريقة إنشاء تشغيل الاختبار هذه إذا كان مطلوبًا اختبار تطبيق الهدف مع تسجيل طلبات الأساس.

!!! info "كيفية إنشاء تشغيل اختبار"
    يُوصف هذا العملية بالتفصيل [هنا][doc-create-testrun].

تحتاج عقدة FAST إلى بعض الوقت لتمريره بعد إنشاء تشغيل الاختبار لتسجيل الطلبات.

تأكد من أن عقدة FAST جاهزة لتسجيل الطلبات قبل أن ترسل أي طلبات إلى تطبيق الهدف باستخدام أداة الاختبار.

للقيام بذلك، تحقق بانتظام من حالة تشغيل الاختبار بإرسال طلب GET إلى العنوان `https://us1.api.wallarm.com/v1/test_run/test_run_id`:

--8<-- "../include/fast/poc/api-check-testrun-status-recording.md"

إذا كان الطلب إلى خادم واجهة برمجة التطبيقات ناجحًا، ستُعرض لك استجابة الخادم. توفر هذه الاستجابة معلومات مفيدة، بما في ذلك حالة عملية التسجيل (قيمة معامل `ready_for_recording`).

إذا كانت قيمة المعامل `true`، فإن عقدة FAST جاهزة للتسجيل ويمكنك تشغيل أداة الاختبار الخاصة بك لبدء إرسال الطلبات إلى تطبيق الهدف.

خلاف ذلك، أصدر نفس استدعاء واجهة برمجة التطبيقات مرارًا وتكرارًا حتى تكون العقدة جاهزة.


### نسخ تشغيل اختبار

عند نسخ تشغيل اختبار، يتم إعادة استخدام [تسجيل اختبار][doc-testrecord] موجود.

يتم استخدام هذه الطريقة لإنشاء تشغيل الاختبار إذا كان مطلوبًا اختبار تطبيق الهدف باستخدام طلبات الأساس المسجلة بالفعل.

!!! info "كيفية نسخ تشغيل اختبار"
    يُوصف هذا العملية بالتفصيل [هنا][doc-copy-testrun].

بمجرد إنشاء تشغيل الاختبار بنجاح، تبدأ عقدة FAST الاختبار على الفور. لا حاجة لاتخاذ أي إجراءات إضافية.

## الخطوات التالية

يمكن أن يستغرق عملية الاختبار وقتًا طويلاً لإكماله. استخدم المعلومات من [هذا المستند][doc-waiting-for-tests] لتحديد ما إذا كان الاختبار الأمني مع FAST قد انتهى.

يمكنك الرجوع إلى مستندات [“النشر عبر واجهة برمجة التطبيقات”][doc-integration-overview-api] أو [“تدفق عمل CI/CD مع FAST”][doc-integration-overview] إذا لزم الأمر.