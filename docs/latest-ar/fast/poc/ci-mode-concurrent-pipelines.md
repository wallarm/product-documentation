[doc-ci-recording]:             ci-mode-recording.md
[doc-ci-recording-example]:     ci-mode-recording.md#deployment-of-a-fast-node-in-recording-mode
[doc-ci-testing]:               ci-mode-testing.md
[doc-ci-testing-example]:       ci-mode-testing.md#deployment-of-a-fast-node-in-the-testing-mode

#   استخدام FAST في تدفقات عمل CI/CD المتزامنة

!!! info "البيانات الضرورية" 
    القيم التالية تُستخدم كأمثلة في هذا الوثيقة:

    * `token_Qwe12345` كرمز.
    * `rec_1111` و `rec_2222` كمعرفات لسجلات الاختبار.

يمكن نشر عدة عقد FAST في نفس الوقت في تدفقات عمل CI/CD المتزامنة. هذه العقد تشارك نفس الرمز وتعمل مع عقدة FAST سحابية واحدة.

هذا مخطط النشر قابل للتطبيق على عقد FAST التي تعمل في كلا الوضعين [التسجيل][doc-ci-recording] و [الاختبار][doc-ci-testing].

لتجنب النزاعات أثناء تشغيل عقد FAST المتزامنة، يتم تمرير متغير البيئة `BUILD_ID` إلى حاوية كل عقدة. يخدم هذا المتغير الأغراض التالية:
1.  يُستخدم كمعرف إضافي لسجل اختبار يتم إنشاؤه بواسطة عقدة FAST في وضع التسجيل.
2.  يتيح تحديد أي سجل اختبار يجب أن يُستخدم بواسطة تشغيل اختبار يتم إنشاؤه بواسطة عقدة FAST في وضع الاختبار (بحيث يصبح تشغيل الاختبار مرتبطًا بسجل الاختبار).
3.  يعرف مسار عمل معين في CI/CD.

يمكن أن يتضمن متغير البيئة `BUILD_ID` أي تركيبة من الحروف والأرقام كقيمة له.

بعد ذلك، سيُعطى مثال على كيفية تشغيل عقدتي FAST في نفس الوقت: في وضع التسجيل أولاً، ثم في وضع الاختبار. النهج الموضح أدناه قابل للتوسيع (يمكنك استخدام عدد العقد التي تحتاجها، عدد العقد غير محدود باثنين كما في المثال أدناه) وهو قابل للتطبيق في مسار عمل CI/CD واقعي.


##  تشغيل عقدة FAST في وضع التسجيل لاستخدامها في تدفقات عمل CI/CD المتزامنة

!!! info "ملاحظة على الأمثلة"
    الأمثلة أدناه تستخدم فقط مجموعة الضرورية من متغيرات البيئة، كفاية لكي تكون حاوية عقدة FAST قائمة وتعمل. وذلك لأجل البساطة.

اشتغل بالأمر التالي لتشغيل أول حاوية لعقدة FAST في وضع التسجيل:

```
docker run --rm --name fast-node-1 \    # يشغل هذا الأمر الحاوية fast-node-1
-e WALLARM_API_HOST=api.wallarm.com \   # مضيف خادم API لـ Wallarm (في هذه الحالة المضيف موجود في سحابة Wallarm الأوروبية)
-e WALLARM_API_TOKEN='qwe_12345' \      # الرمز للاتصال بعقدة FAST السحابية
-e CI_MODE=recording \                  # هذه العقدة ستعمل في وضع التسجيل
-e BUILD_ID=1 \                         # قيمة BUILD_ID (يجب أن تختلف عن الأخرى للمسار المتزامن)
-p 8080:8080 wallarm/fast               # تحديد خرائط المنافذ هنا. أيضًا، تُحدد هنا صورة Docker المستخدمة.
```

اشتغل بالأمر التالي لتشغيل الحاوية المتزامنة الثانية لعقدة FAST في وضع التسجيل:

```
docker run --rm --name fast-node-2 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \      # ينبغي أن تكون قيمة الرمز متطابقة مع المستخدمة لأول عقدة FAST
-e CI_MODE=recording \
-e BUILD_ID=2 \                         # قيمة BUILD_ID تختلف عن التي تم استخدامها لأول عقدة FAST في مسار CI/CD آخر.
-p 8000:8080 wallarm/fast
```

!!! info "ملاحظة على أوامر `docker run`"
    يُفترض تشغيل الأوامر المذكورة أعلاه على مضيف Docker نفسه، لذا بالإضافة إلى قيم `BUILD_ID` المختلفة، لدى هذه الأوامر أسماء حاويات متميزة (`fast-node-1` و `fast-node-2`) وقيم منافذ هدف مختلفة (`8080` و `8000`).
    
    إذا كنت تشغل حاويات عقد FAST على مضيفي Docker منفصلين، فقد تختلف أوامر `docker run` فقط في قيم `BUILD_ID`.

بعد تنفيذ هذه الأوامر الاثنين، عقدتا FAST ستعملان في وضع التسجيل باستخدام نفس عقدة FAST السحابية، ولكن **سيتم إنشاء سجلات اختبار مختلفة**.

ستكون نتيجة مخرجات أداة CI/CD مشابهة لما وُصف [هنا][doc-ci-recording-example].

عندما يتم تعبئة سجلات الاختبار بكل الطلبات الأساسية اللازمة، أوقف عقد FAST المقابلة وشغل عقد أخرى في وضع الاختبار.

##  تشغيل عقدة FAST في وضع الاختبار لاستخدامها في تدفقات عمل CI/CD المتزامنة

لنفترض أن سجلات الاختبار `rec_1111` و `rec_2222` تم إعدادها أثناء تشغيل عقد FAST `fast-node-1` و `fast-node-2` في وضع التسجيل.

ثم، لتوجيه عقدة FAST في وضع الاختبار لاستخدام سجل الاختبار `rec_1111`, امرر متغير البيئة `BUILD_ID=1` إلى حاوية العقدة. بالمثل، امرر متغير البيئة `BUILD_ID=2` لاستخدام سجل الاختبار `rec_2222`. استخدم أوامر `docker run` المقابلة أدناه لتشغيل عقد FAST في وضع الاختبار.

اشتغل بالأمر التالي لتشغيل أول حاوية لعقدة FAST في وضع الاختبار:

```
docker run --rm --name fast-node-1 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \
-e CI_MODE=testing \                    # هذه العقدة ستعمل في وضع الاختبار
-e BUILD_ID=1 \                         # متغير `BUILD_ID=1` يقابل سجل الاختبار `rec_1111`
wallarm/fast
```

اشتغل بالأمر التالي لتشغيل الحاوية المتزامنة الثانية لعقدة FAST في وضع التسجيل:

```
docker run --rm --name fast-node-2 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \
-e CI_MODE=testing \                    # هذه العقدة ستعمل في وضع الاختبار
-e BUILD_ID=2 \                         # متغير `BUILD_ID=2` يقابل سجل الاختبار `rec_2222`
wallarm/fast
```

ستكون نتيجة مخرجات أداة CI/CD مشابهة لما وُصف [هنا][doc-ci-testing-example].

كنتيجة لتمرير قيم متغيرات البيئة `BUILD_ID` المقابلة إلى عقد FAST، **سيبدأ تشغيل اختباران في نفس الوقت**، كل واحد يعمل مع سجل اختبار مختلف.

لذلك، يمكنك تشغيل بعض عقد FAST لتدفقات عمل CI/CD المتزامنة بتحديد متغير البيئة `BUILD_ID` دون إنشاء أي نزاع بين العقد (لن يتم إيقاف تشغيل اختبار جديد تشغيل اختبار قيد التنفيذ).