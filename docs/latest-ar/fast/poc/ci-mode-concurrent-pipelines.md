[doc-ci-recording]:             ci-mode-recording.md
[doc-ci-recording-example]:     ci-mode-recording.md#deployment-of-a-fast-node-in-recording-mode
[doc-ci-testing]:               ci-mode-testing.md
[doc-ci-testing-example]:       ci-mode-testing.md#deployment-of-a-fast-node-in-the-testing-mode

# استخدام FAST في تدفقات عمل CI/CD المتزامنة

!!! info "البيانات الضرورية" 
    تُستخدم القيم التالية كأمثلة في هذا المستند:

    * `token_Qwe12345` كرمز.
    * `rec_1111` و `rec_2222` كمعرفات لسجلات الاختبار.

يمكن نشر عقد FAST متعددة بشكل متزامن في تدفقات عمل CI/CD المتزامنة. تشارك هذه العقد نفس الرمز وتعمل مع عقدة FAST سحابية واحدة.

تطبق هذه الخطة على عقد FAST التي تعمل في كلا الوضعين [التسجيل][doc-ci-recording] و[الاختبار][doc-ci-testing].

لتجنب الصراعات أثناء تشغيل عقد FAST المتزامنة، يتم تمرير متغير البيئة `BUILD_ID` إلى حاوية كل عقدة. يخدم هذا المتغير الأغراض التالية:
1. يُستخدم كمعرف إضافي لسجل الاختبار الذي تُنشئه عقدة FAST في وضع التسجيل.
2. يُمكن من تحديد أي سجل اختبار ينبغي استخدامه بواسطة تشغيل اختبار يُنشئه عقدة FAST في وضع الاختبار (حتى يصبح تشغيل الاختبار مرتبطًا بسجل الاختبار).
3. يحدد عملية CI/CD معينة.

يمكن لمتغير البيئة `BUILD_ID` أن يحتوي على أي مزيج من الحروف والأرقام كقيمة له.

بعد ذلك، سيُعطى مثال على كيفية تشغيل عقدتي FAST بشكل متزامن: في وضع التسجيل أولاً، ثم في وضع الاختبار. النهج الموصوف أدناه قابل للتطوير (يمكن استخدام عدد العقد التي تحتاجها، عدد العقد غير محدود إلى اثنين كما في المثال أدناه) ويطبق على تدفق عمل CI/CD الحقيقي.


## تشغيل عقدة FAST في وضع التسجيل لاستخدامها في تدفقات عمل CI/CD المتزامنة

!!! info "ملاحظة حول الأمثلة"
    الأمثلة أدناه تستخدم فقط المجموعة الأساسية من متغيرات البيئة، بما يكفي لأن تكون حاوية عقدة FAST قيد التشغيل والعمل. هذا من أجل البساطة.

قم بتشغيل الأمر التالي لتشغيل أول حاوية عقدة FAST في وضع التسجيل:

```
docker run --rm --name fast-node-1 \    # هذا الأمر يشغل الحاوية fast-node-1
-e WALLARM_API_HOST=api.wallarm.com \   # مضيف خادم API Wallarm (في هذه الحالة المضيف يقع في السحابة الأوروبية Wallarm)
-e WALLARM_API_TOKEN='qwe_12345' \      # الرمز للاتصال بعقدة FAST السحابية
-e CI_MODE=recording \                  # هذه العقدة ستعمل في وضع التسجيل
-e BUILD_ID=1 \                         # قيمة BUILD_ID (يجب أن تكون مختلفة عن الأخرى للتدفق المتزامن)
-p 8080:8080 wallarm/fast               # تعيين المنفذ هنا. أيضًا، يُحدد هنا صورة Docker للاستخدام.
```

قم بتشغيل الأمر التالي لتشغيل ثاني حاوية عقدة FAST متزامنة في وضع التسجيل:

```
docker run --rm --name fast-node-2 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \      # ينبغي أن تكون قيمة الرمز متطابقة مع تلك المستخدمة لأول عقدة FAST
-e CI_MODE=recording \
-e BUILD_ID=2 \                         # تختلف قيمة BUILD_ID عن تلك المستخدمة لأول عقدة FAST في تدفق CI/CD آخر.
-p 8000:8080 wallarm/fast
```

!!! info "ملاحظة حول أوامر `docker run`"
    من المفترض تشغيل الأوامر المذكورة أعلاه على نفس مضيف Docker، لذا بالإضافة إلى قيم `BUILD_ID` المختلفة، تحتوي هذه الأوامر على أسماء حاويات متميزة (`fast-node-1` و `fast-node-2`) وقيم منافذ هدف مختلفة (`8080` و `8000`).
    
    إذا كنت تشغل حاويات عقدة FAST على مضيفي Docker منفصلين، فقد تختلف أوامر `docker run` فقط في قيم `BUILD_ID`.

بعد تنفيذ هذين الأمرين، ستعمل عقدتا FAST في وضع التسجيل باستخدام نفس العقدة السحابية FAST، لكن **سيُنشأ سجل اختبار مميز**.

سيكون مخرجات وحدة التحكم في أداة CI/CD مشابهة لما وُصف [هنا][doc-ci-recording-example].

عندما يتم تعبئة سجلات الاختبار بجميع الطلبات الأساسية الضرورية، أوقف تشغيل العقد FAST المقابلة وابدأ تشغيل عقد أخرى في وضع الاختبار.

## تشغيل عقدة FAST في وضع الاختبار لاستخدامها في تدفقات عمل CI/CD المتزامنة

لنفترض أنه تم إعداد سجلات الاختبار `rec_1111` و `rec_2222` خلال عملية تشغيل عقدتي FAST `fast-node-1` و `fast-node-2` في وضع التسجيل.

ثم، لتوجيه عقدة FAST في وضع الاختبار لاستخدام سجل الاختبار `rec_1111`، قم بتمرير متغير البيئة `BUILD_ID=1` إلى حاوية العقدة. بالمثل، قم بتمرير متغير البيئة `BUILD_ID=2` لاستخدام سجل الاختبار `rec_2222`. استخدم الأوامر `docker run` التالية أدناه لتشغيل عقد FAST في وضع الاختبار.

قم بتشغيل الأمر التالي لتشغيل أول حاوية عقدة FAST في وضع الاختبار:

```
docker run --rm --name fast-node-1 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \
-e CI_MODE=testing \                    # ستعمل هذه العقدة في وضع الاختبار
-e BUILD_ID=1 \                         # متغير `BUILD_ID=1` يتوافق مع سجل الاختبار `rec_1111`
wallarm/fast
```

قم بتشغيل الأمر التالي لتشغيل ثاني حاوية عقدة FAST متزامنة في وضع التسجيل:

```
docker run --rm --name fast-node-2 \
-e WALLARM_API_HOST=api.wallarm.com \
-e WALLARM_API_TOKEN='qwe_12345' \
-e CI_MODE=testing \                    # ستعمل هذه العقدة في وضع الاختبار
-e BUILD_ID=2 \                         # متغير `BUILD_ID=2` يتوافق مع سجل الاختبار `rec_2222`
wallarm/fast
```

ستكون مخرجات وحدة التحكم في أداة CI/CD مشابهة لما وُصف [هنا][doc-ci-testing-example].

نتيجة لتمرير قيم متغير البيئة `BUILD_ID` المقابلة إلى عقد FAST، **ستبدأ تشغيلات الاختبار في العمل بشكل متزامن**، كل منها يعمل مع سجل اختبار مميز.

لذلك، يمكنك تشغيل عدة عقد FAST لتدفقات عمل CI/CD المتزامنة من خلال تحديد متغير البيئة `BUILD_ID` دون إنشاء أي صراع بين العقد (تشغيل اختبار جديد لن يوقف تنفيذ تشغيل الاختبار الجاري).  