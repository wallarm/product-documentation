[img-sample-job-ci-mode]:       ../../images/fast/poc/en/integration-overview/sample-job-ci-mode.png

[doc-recording-mode]:           ci-mode-recording.md#running-a-fast-node-in-recording-mode
[doc-testing-mode]:             ci-mode-testing.md#running-a-fast-node-in-testing-mode
[doc-proxy-configuration]:      proxy-configuration.md
[doc-fast-container-stopping]:  ci-mode-recording.md#stopping-and-removing-the-docker-container-with-the-fast-node-in-recording-mode
[doc-recording-variables]:      ci-mode-recording.md#environment-variables-in-recording-mode
[doc-integration-overview]:     integration-overview.md


#   الدمج عن طريق عقدة FAST: المبادئ والخطوات

لإجراء اختبار الأمان في وضع CI، يجب تشغيل عقدة FAST بشكل متسلسل في وضعين:
1.  [وضع التسجيل][doc-recording-mode]
2.  [وضع الاختبار][doc-testing-mode]

متغير البيئة `CI_MODE` يحدد وضع التشغيل لعقدة FAST. يمكن لهذا المتغير أن يأخذ القيم التالية:
* `recording`
* `testing`

في هذا السيناريو، تقوم عقدة FAST أولاً بإنشاء تسجيل اختبار وتكتب الطلبات الأساسية فيه. عند انتهاء التسجيل، تقوم العقدة بإنشاء تشغيل اختبار يستخدم الطلبات الأساسية المسجلة مسبقًا كأساس لاختبارات الأمان الخاصة بها.

يتم عرض هذا السيناريو في الصورة أدناه:

![مثال على وظيفة CI/CD مع عقدة FAST في وضع CI][img-sample-job-ci-mode]

خطوات سير العمل المقابلة هي:

1.  بناء ونشر التطبيق المستهدف.

2.  [تشغيل عقدة FAST في وضع التسجيل][doc-recording-mode].

    في وضع التسجيل، تؤدي عقدة FAST الإجراءات التالية:
    
    * توجيه الطلبات الأساسية من مصدر الطلبات إلى التطبيق المستهدف.
    * تسجيل هذه الطلبات الأساسية في التسجيل الاختباري لإنشاء مجموعة اختبار الأمان بناءً عليها لاحقًا.
    
    !!! معلومة "ملاحظة على تشغيلات الاختبار"
        لا يتم إنشاء تشغيل اختبار في وضع التسجيل.

3.  التحضير وإعداد أداة الاختبار:
    
    1.  نشر وأداء تكوين أساسي لأداة الاختبار.
    
    2.  [تكوين عقدة FAST كخادم بروكسي][doc-proxy-configuration].
        
4.  تشغيل الاختبارات الموجودة.
    
    ستقوم عقدة FAST بتوجيه وتسجيل الطلبات الأساسية إلى التطبيق المستهدف.
    
5.  إيقاف وإزالة حاوية عقدة FAST.

    إذا لم تواجه عقدة FAST أخطاء حرجة أثناء التشغيل، تعمل حتى إما أن ينتهي مؤقت [`INACTIVITY_TIMEOUT`][doc-recording-variables] أو توقف أداة CI/CD الحاوية عنوة.
    
    بعد الانتهاء من الاختبارات الحالية، يتعين [إيقاف تشغيل عقدة FAST][doc-fast-container-stopping]. هذا سيوقف عملية تسجيل الطلبات الأساسية. ثم يمكن التخلص من حاوية العقدة.          

6.  [تشغيل عقدة FAST في وضع الاختبار][doc-testing-mode].

    في وضع الاختبار، تقوم عقدة FAST بالإجراءات التالية:
    
    * إنشاء تشغيل اختبار بناءً على الطلبات الأساسية المسجلة في الخطوة 4.
    * بدء إنشاء وتنفيذ مجموعة اختبار الأمان.
    
7.  الحصول على نتائج الاختبار. إيقاف حاوية عقدة FAST.    
    
    إذا لم تواجه عقدة FAST أخطاء حرجة أثناء التشغيل، تعمل حتى اكتمال اختبارات الأمان. تتوقف العقدة تلقائيًا. ثم يمكن التخلص من حاوية العقدة.

##  دورة حياة حاوية عقدة FAST (النشر عبر وضع CI)
   
يفترض هذا السيناريو أن حاوية Docker مع عقدة FAST تعمل أولاً في وضع التسجيل، ثم في وضع الاختبار.
 
بعد انتهاء تنفيذ عقدة FAST في أي من الوضعين، يتم إزالة حاوية العقدة. بعبارة أخرى، يتم إعادة إنشاء حاوية عقدة FAST في كل مرة يتغير فيها وضع التشغيل.