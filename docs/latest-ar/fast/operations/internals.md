[img-testpolicy-id]:                        ../../images/fast/operations/common/internals/policy-id.png
[img-execution-timeline-recording]:         ../../images/fast/operations/en/internals/execution-timeline.png
[img-execution-timeline-no-recording]:      ../../images/fast/operations/en/internals/execution-timeline-existing-testrecord.png
[img-testrecord]:                           ../../images/fast/operations/en/internals/testrecord-explained.png           
[img-fast-node]:                            ../../images/fast/operations/common/internals/fast-node.png
[img-reuse-token]:                          ../../images/fast/operations/common/internals/reuse-token.png
[img-components-relations]:                 ../../images/fast/operations/common/internals/components-relations.png
[img-common-timeline-no-recording]:         ../../images/fast/operations/en/internals/common-timeline-existing-testrecord.png

[doc-ci-intro]:                     ../poc/integration-overview.md
[doc-node-deployment-api]:          ../poc/node-deployment.md
[doc-node-deployment-ci-mode]:      ../poc/ci-mode-recording.md
[doc-quick-start]:                  ../qsg/deployment-options.md
[doc-integration-overview]:         ../poc/integration-overview.md

[link-create-policy]:               test-policy/general.md
[link-use-policy]:                  test-policy/using-policy.md
[doc-policy-in-detail]:             test-policy/overview.md

[anchor-testpolicy]:    #fast-test-policy
[anchor-testrun]:       #test-run
[anchor-token]:         #token
[anchor-testrecord]:    #test-record

[doc-testpolicy-creation-example]:  ../qsg/test-preparation.md#2-create-a-test-policy-targeted-at-xss-vulnerabilities
[doc-about-timeout]:                create-testrun.md
[doc-node-deployment]:              ../poc/node-deployment.md#run-docker-container-with-the-fast-node

[link-wl-portal-new-policy]:    https://us1.my.wallarm.com/testing/policies/new#general 
[link-wl-portal-policy-tab]:    https://us1.my.wallarm.com/testing/policies
[link-wl-portal-node-tab]:      https://us1.my.wallarm.com/testing/nodes

# كيف تعمل FAST

--8<-- "../include/fast/cloud-note.md"

!!! info "ملاحظة قصيرة عن محتوى المستند"
    العلاقات بين الكيانات (انظر أدناه) وسيناريوهات الاختبار الموضحة في هذا الفصل تتعلق بالاختبار باستخدام Wallarm API. هذا النوع من الاختبارات يستخدم جميع الكيانات؛ لذا، يمكن تزويد القارئ برؤية متكاملة حول كيف تتفاعل هذه الكيانات مع بعضها البعض.
    
    عند دمج FAST في سير العمل CI/CD، تظل هذه الكيانات بدون تغيير؛ ولكن، قد يكون ترتيب الخطوات مختلفًا لحالة معينة. اقرأ [هذا المستند][doc-ci-intro] للحصول على تفاصيل إضافية.

تستخدم FAST الكيانات التالية:

* [سجل الاختبار.][anchor-testrecord]
* [سياسة اختبار FAST.][anchor-testpolicy]
* [جولة الاختبار.][anchor-testrun]
* [الرمز.][anchor-token]

هناك العديد من العلاقات المهمة بين الكيانات المذكورة سابقًا:
* قد تستخدم سياسة الاختبار وسجل الاختبار في عدة مواضع وعقد FAST.
* يتعلق الرمز بعقدة FAST واحدة في سحابة Wallarm، وحاوية Docker واحدة بتلك العقدة FAST، وجولة اختبار واحدة.
* يمكنك تمرير قيمة الرمز الحالية إلى حاوية Docker بالعقدة FAST، بشرط أن الرمز لا يكون قيد الاستخدام من قِبل أي حاوية Docker أخرى بالعقدة.
* إذا أنشأت جولة اختبار جديدة للعقدة FAST بينما توجد جولة اختبار أخرى في مكانها، فسوف تتوقف الجولة الاختبار الحالية وتستبدل بالجديدة.

![العلاقات بين المكونات][img-components-relations]

##   الكيانات التي تستخدمها FAST

تعمل العقدة FAST كوكيل لجميع الطلبات من مصدر الطلب إلى التطبيق المستهدف. وفقًا للمصطلحات Wallarm، تسمى هذه الطلبات *طلبات قاعدة*.

عندما تستلم العقدة FAST الطلبات، تحفظها في الكائن "سجل الاختبار" المتخصص لإنشاء اختبارات الأمان في وقت لاحق بناءً عليها. وفقًا للمصطلحات Wallarm، يطلق على هذه العملية "تسجيل طلبات القاعدة".

بعد تسجيل طلبات القاعدة، تنشئ العقدة FAST مجموعة اختبار أمان وفقًا لـ [سياسة الاختبار][anchor-testpolicy]. بعد ذلك، يتم تنفيذ مجموعة الاختبار لتقييم التطبيق المستهدف ضد الثغرات الأمنية.

يتيح سجل الاختبار إعادة استخدام طلبات القاعدة التي تم تسجيلها سابقًا لاختبار نفس التطبيق المستهدف أو تطبيق آخر مرة أخرى؛ ليس هناك حاجة لتكرار إرسال طلبات القاعدة متطابقة من خلال العقدة FAST. هذا ممكن فقط إذا كانت طلبات القاعدة في سجل الاختبار مناسبة لاختبار التطبيق.

### سجل الاختبار

تنشئ FAST مجموعة اختبارات الأمان من طلبات القاعدة المخزنة في سجل الاختبار.

لتعبئة سجل اختبار مع بعض طلبات القاعدة، يجب تنفيذ [جولة الاختبار][anchor-testrun] المتصلة بسجل الاختبار هذا وعقدة FAST ويجب إرسال بعض طلبات القاعدة من خلال العقدة FAST.

بشكل بديل، من الممكن تعبئة سجل الاختبار بدون إنشاء جولة اختبار. للقيام بذلك، يجب تشغيل العقدة FAST في نمط التسجيل. انظر [هذا المستند][doc-node-deployment-ci-mode] للتفاصيل. 

بما أن سجل الاختبار مشغول بالطلبات، فيمكن استخدامه مع جولة اختبار أخرى إذا كان بإمكان التطبيق تحت الاختبار تقييمه ضد الثغرات الأمنية باستخدام مجموعة فرعية من طلبات القاعدة المخزنة في سجل الاختبار.

يُطبَّق سجل اختبار واحد على عدة عقدات FAST وجولات اختبار. قد يكون ذلك مفيدًا إذا:
* تم اختبار نفس التطبيق المستهدف مرة أخرى.
* يتم اختبار تطبيقات مستهدفة متعددة متزامنة مع نفس طلبات القاعدة.

![العمل مع سجل الاختبار][img-testrecord]
 

### سياسة اختبار FAST

تحدد *سياسة الاختبار* مجموعة من القواعد لإجراء عملية اكتشاف الثغرات. بشكل خاص، يمكنك تحديد أنواع الثغرات التي يجب اختبار التطبيق من أجلها. بالإضافة إلى ذلك، تحدد السياسة البارامترات المؤهلة في طلب القاعدة التي يمكن معالجتها أثناء إنشاء مجموعة اختبار أمان. يتم استخدام هذه القطع من البيانات بواسطة FAST لإنشاء طلبات الاختبار التي تُستخدَم لمعرفة ما إذا كان التطبيق المستهدف قابلاً للتوسيع.

يمكنك [إنشاء][link-create-policy] سياسة جديدة أو [استخدام][link-use-policy] واحدة موجودة.

!!! info "اختيار سياسة الاختبار المناسبة"
    يعتمد اختيار سياسة الاختبار على كيفية عمل التطبيق المستهدف. من الأفضل أن تنشئ سياسة اختبار متميزة لكل من التطبيقات التي تختبرها.

!!! info "معلومات إضافية"

    * [مثال سياسة الاختبار][doc-testpolicy-creation-example] من دليل البدء السريع 
    * [تفاصيل سياسة الاختبار][doc-policy-in-detail]

### جولة اختبار

تصف "جولة الاختبار" التكرار الفردي لعملية اختبار الثغرات.

تحتوي جولة الاختبار على:

* معرّف [سياسة الاختبار][anchor-testpolicy]
* معرّف [سجل الاختبار][anchor-testrecord]

تستخدم العقدة FAST هذه القيم أثناء إجراء اختبار الأمن للتطبيق المستهدف.

كل جولة اختبار مقترنة بشكل وثيق مع عقدة FAST واحدة. إذا أنشأت جولة اختبار جديدة `B` للعقدة FAST في حين يكون هناك جولة اختبار أخرى `A` قيد التقدم لهذه العقدة، فإن تنفيذ جولة الاختبار `A` يتوقف ويتم استبداله بجولة الاختبار `B`.

من الممكن إنشاء جولة اختبار لسيناريوهين اختبار مختلفين:
* في السيناريو الأول، يتم اختبار نفس التطبيق المستهدف للثغرات ويجري تسجيل طلبات القاعدة في نفس الوقت (إلى سجل اختبار جديد). التحويلات ذلك الحذف السحابي عبر الحذف الجديد

    سيشار إلى إنشاء جولة اختبار لهذا السيناريو بـ "إنشاء جولة اختبار"  طوال الدليل.

* في السيناريو الثاني، يتم اختبار نفس التطبيق المستهدف للثغرات مع طلبات القاعدة المستخرجة من سجل اختبار موجود وغير فارغ. في هذا السيناريو، ليس من الضروري نشر أي مصدر طلب.

    سيشار إلى إنشاء جولة اختبار لهذا السيناريو بـ "نسخ جولة الاختبار"  طوال الدليل.

عندما تنشئ أو تنقل جولة اختبار، يبدأ تنفيذها فورًا. بناءً على سيناريو الاختبار المعمول به، سيتبع العملية خطوات مختلفة (انظر أدناه).

### تدفق تنفيذ الجولة (يجري تسجيل طلبات القاعدة)

عند إنشاء جولة اختبار، يبدأ تنفيذها على الفور ويتبع الخطوات التالية:

1.  تنتظر العقدة FAST جولة اختبار.

    عندما تحدد العقدة أن بدأت جولة الاختبار، تجلب العقدة معرفي سياسة الاختبار وسجل الاختبار من جولة الاختبار.
    
2.  بعد الحصول على المعرفين، يبدأ *عملية تسجيل طلبات القاعدة*.
    
    الآن العقدة FAST جاهزة لتلقي الطلبات من مصدر الطلب إلى التطبيق المستهدف.
    
3.  بناءً على أن تسجيل الطلب نشط، فإن الوقت قد حان لبدء تنفيذ الاختبارات الموجودة. يتم إرسال طلبات HTTP و HTTPS من خلال العقدة FAST، التي تتعرف عليها كطلبات القاعدة.

    سيتم تخزين جميع طلبات القاعدة في سجل الاختبار المقابل لجولة الاختبار.
    
4.  بعد الانتهاء من تنفيذ الاختبار، يمكنك إيقاف عملية التسجيل.
    
    هناك قيمة توقيت خاصة محددة بعد إنشاء جولة الاختبار. يحدد كم من الوقت يجب أن تنتظر FAST طلبات القاعدة الجديدة قبل إيقاف عملية التسجيل بسبب عدم وجود طلبات القاعدة (معامل [`inactivity_timeout`][doc-about-timeout]).
    
    إذا لم تتوقف عن عملية التسجيل يدويًا، ثم:
    
    * تواصل جولة الاختبار تنفيذها حتى تنتهي قيمة التوقيت، حتى لو انتهت اختبارات الأمان FAST بالفعل.
    * لا تتمكن جولات الاختبار الأخرى من إعادة استخدام سجل الاختبار حتى تتوقف هذه الجولة.
    
    يمكنك إيقاف عملية التسجيل على العقدة FAST إذا لم يكن هناك المزيد من طلبات القاعدة في الانتظار. إن النقاط التالية:

    *  لا تزال عمليات إنشاء وتنفيذ الاختبارات الأمنية قائمة. يتوقف تنفيذ جولة الاختبار عند الانتهاء من تقييم التطبيق المستهدف ضد الثغرات. يساعد هذا السلوك على تقليل وقت تنفيذ الفاتورة اعتماد بالذمة (CI/CD).
    *  تكتسب جولات الاختبار الأخرى القدرة على إعادة استخدام سجل الاختبار بمجرد توقف التسجيل.
    
5.  تنشئ العقدة FAST طلب تجربة واحد أو أكثر بناءً على كل طلب أساسي وارد (فقط إذا كان الطلب الأساسي يفي بالسياسة الاختبار المطبقة).
  
6.  تنفذ العقدة FAST الطلبات الاختبار بإرسالها إلى التطبيق المستهدف.

إيقاف عملية تسجيل طلبات القاعدة لا يؤثر على عمليات إنشاء وتنفيذ الطلبات الاختبار.

تكون عمليات تسجيل طلبات القاعدة وإنشاء وتنفيذ اختبارات الأمان FAST متوازية:

![تدفق تنفيذ الجولة (تجري عملية تسجيل طلب القاعدة)][img-execution-timeline-recording]

ملاحظة: يظهر الرسم البياني أعلاه التدفق الموضح في [دليل البدء السريع FAST][doc-quick-start]. تصلح هذه الدورة مع تسجيل طلب القاعدة إما لاختبار الأمان اليدوي أو الأمان آلي باستخدام أدوات CI/CD.

في هذا السيناريو، مطلوب API Wallarm للتلاعب بجولة الاختبار. انظر [هذا المستند][doc-node-deployment-api] للتفاصيل.


### تدفق تنفيذ الجولة (يتم استخدام طلبات القاعدة المسجلة مسبقًا)

عند نسخ جولة اختبار، يبدأ تنفيذها فورًا ويتبع الخطوات التالية:

1.  تنتظر العقدة FAST جولة اختبار.

    عندما تحدد العقدة أن بدأت جولة الاختبار، تجلب العقدة معرفي سياسة الاختبار وسجل الاختبار من جولة الاختبار.
    
2.  بعد الحصول على المعرفين، تستخرج العقدة طلبات القاعدة من سجل الاختبار.

3.  تنشئ العقدة FAST طلب تجربة واحد أو أكثر بناءً على كل طلب أساسي مستخرج (فقط إذا كان طلب الأساسي يفي بالسياسة الاختبار المطبقة).

4.  تنفذ العقدة FAST الطلبات الاختبار بالإرسال إلى التطبيق المستهدف.

تجري عملية استخراج الطلبات القاعدة قبل إنشاء وتنفيذ اختبارات الأمان FAST:

![تدفق تنفيذ الجولة (يتم استخدام طلبات القاعدة المسجلة مسبقًا)][img-execution-timeline-no-recording]

لاحظ أنه تدفق التنفيذ المستخدم في [دليل البدء السريع FAST][doc-quick-start]. يصلح التدفق الذي يستخدم طلبات القاعدة المسجلة مسبقًا للاختبار الأمان آلي باستخدام أدوات CI/CD.

في هذا السيناريو، يمكن استخدام API Wallarm أو FAST node في النمط CI للتلاعب بجولة الاختبار. انظر [هذا المستند][doc-integration-overview] للتفاصيل.

يظهر الرسم البياني أدناه السير العمل CI/CD الأكثر شيوعًا، مما يتفق مع الجدول الزمني الموضح أعلاه:

![تدفق تنفيذ الجولة (CI Mode)][img-common-timeline-no-recording]


##  العمل مع جولات الاختبار

أثناء قراءة هذا الدليل، ستتعرف على كيفية التحكم في عملية تنفيذ جولة الاختبار باستخدام مكالمات API، على وجه الخصوص:
* كيفية إيقاف عملية تسجيل طلبات القاعدة إذا لم يكن هناك المزيد من الطلبات من مصدر الطلب.
* كيفية التحقق من حالة تنفيذ جولة الاختبار.

تحتاج إلى الحصول على [*رمز*][anchor-token] للقيام بتلك المكالمات API ولربط جولة الاختبار بالعقدة FAST.

### الرمز

تتألف عقدة FAST من:
* حاوية Docker التي تعمل مع برنامج FAST.
    
    هنا حيث يتم عملية الوكيل للحركة، وإنشاء الاختبار الأمان، والتنفيذ.
    
* عقدة سحابة Wallarm FAST.

الرمز يربط الحاوية التي تعمل مع Docker بالعقدة في السحابة:

![FAST node][img-fast-node]

لنشر عقدة FAST، قم بما يلي:
1.  أنشئ عقدة FAST في سحابة Wallarm باستخدام [بوابة Wallarm][link-wl-portal-node-tab]. نسخ الرمز المقدم.
2.  قم بنشر حاوية Docker مع العقدة وتمرير قيمة الرمز إلى الحاوية (توضح هذه العملية بالتفصيل [هنا][doc-node-deployment]).

يخدم الرمز الأغراض التالية أيضًا:
* ربط جولة الاختبار مع العقدة FAST.
* يسمح لك بإدارة عملية تنفيذ جولة الاختبار عن طريق إجراء مكالمات API.

يمكنك أن تخلق العديد من العقدات FAST في سحابة Wallarm كما تحتاج والحصول على الرمز لكل عقدة. على سبيل المثال، إذا كان لديك العديد من الفواتير اعتماد بالذمة (CI/CD) حيث هناك حاجة إلى FAST، قد تنشئ عقدة FAST في السحابة لكل فاتورة.

من الممكن إعادة استخدام الرموز التي حصلت عليها في وقت سابق إذا لم يتم استخدام الرموز في الحاويات Docker النشطة الأخرى مع العقدة FAST (على سبيل المثال، أي حاوية Docker مع عقدة تستخدم نفس الرمز هي متوقفة أو مزالة):

![إعادة استخدام الرمز][img-reuse-token]