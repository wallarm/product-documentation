[img-testpolicy-id]:                        ../../images/fast/operations/common/internals/policy-id.png
[img-execution-timeline-recording]:         ../../images/fast/operations/en/internals/execution-timeline.png
[img-execution-timeline-no-recording]:      ../../images/fast/operations/en/internals/execution-timeline-existing-testrecord.png
[img-testrecord]:                           ../../images/fast/operations/en/internals/testrecord-explained.png           
[img-fast-node]:                            ../../images/fast/operations/common/internals/fast-node.png
[img-reuse-token]:                          ../../images/fast/operations/common/internals/reuse-token.png
[img-components-relations]:                 ../../images/fast/operations/common/internals/components-relations.png
[img-common-timeline-no-recording]:         ../../images/fast/operations/en/internals/common-timeline-existing-testrecord.png

[doc-ci-intro]:                     ../poc/integration-overview.md
[doc-node-deployment-api]:          ../poc/node-deployment.md
[doc-node-deployment-ci-mode]:      ../poc/ci-mode-recording.md
[doc-quick-start]:                  ../qsg/deployment-options.md
[doc-integration-overview]:         ../poc/integration-overview.md

[link-create-policy]:               test-policy/general.md
[link-use-policy]:                  test-policy/using-policy.md
[doc-policy-in-detail]:             test-policy/overview.md

[anchor-testpolicy]:    #fast-test-policy
[anchor-testrun]:       #test-run
[anchor-token]:         #token
[anchor-testrecord]:    #test-record

[doc-testpolicy-creation-example]:  ../qsg/test-preparation.md#2-create-a-test-policy-targeted-at-xss-vulnerabilities
[doc-about-timeout]:                create-testrun.md
[doc-node-deployment]:              ../poc/node-deployment.md#run-docker-container-with-the-fast-node

[link-wl-portal-new-policy]:    https://us1.my.wallarm.com/testing/policies/new#general 
[link-wl-portal-policy-tab]:    https://us1.my.wallarm.com/testing/policies
[link-wl-portal-node-tab]:      https://us1.my.wallarm.com/testing/nodes

# كيف يعمل الفاست (FAST)
--8<-- "../include/fast/cloud-note.md"

!!! معلومة "ملاحظة قصيرة على محتوى المستند"
العلاقات بين الكيانات (انظر أدناه) وسيناريوهات الاختبار التي وصفت في هذا الفصل تتعلق بالاختبار باستخدام واجهة برمجة التطبيقات (API) الخاصة بـ Wallarm. هذا النوع من الاختبارات يستخدم جميع الكيانات؛ لذا، يمكن تقديم نظرة كاملة إلى القارئ حول كيفية تفاعل هذه الكيانات مع بعضها البعض.
    
    عند دمج الفاست في سير عمل CI/CD، تبقى هذه الكيانات كما هي؛ ومع ذلك، قد تختلف ترتيب الخطوات لحالة معينة. اقرأ [هذا المستند][doc-ci-intro] للحصول على تفاصيل إضافية.
    
الفاست يستخدم الكيانات التالية:

* [سجل الاختبار.][anchor-testrecord]
* [سياسة اختبار الفاست.][anchor-testpolicy]
* [تشغيل الاختبار.][anchor-testrun]
* [رمز التوكن.][anchor-token]

هناك بعض العلاقات المهمة بين الكيانات المذكورة في وقت سابق:
* قد تستخدم سياسة الاختبار وسجل الاختبار في عدة أماكن تشغيل الاختبار وعقدات الفاست.
* يتعلق الرمز التوكن بـ FAST node واحدة في سحابة Wallarm، حاوية Docker واحدة تحتوي على تلك العقدة، وتشغيل اختبار واحدة.
* يمكنك تمرير قيمة رمز التوكن الموجودة إلى حاوية Docker التي تحتوي على العقدة، بشرط ألا يكون الرمز قيد الاستخدام من قبل أي حاوية Docker أخرى تحتوي على العقدة.
* إذا قمت بإنشاء تشغيل اختبار جديد للعقدة بينما موجود تشغيل اختبار أخر، سوف يتوقف التشغيل الحالي ويتم استبداله بالجديد.

![العلاقات بين المكونات][img-components-relations]

##   الكيانات المستخدمة بواسطة الفاست

العقدة الفاست تعمل كوكيل لجميع الطلبات من مصدر الطلب إلى التطبيق المستهدف. وفقًا لمصطلحات Wallarm، يطلق على هذه الطلبات *طلبات الخط الأساسي*.

عندما تتلقى عقدة الفاست الطلبات، فإنها تحفظها في كائن "سجل الاختبار" الخاص لإنشاء اختبارات الأمان على أساسها في وقت لاحق. وفقًا لمصطلحات Wallarm، يطلق على هذه العملية "تسجيل طلبات الخط الأساسي".

بعد تسجيل طلبات الخط الأساسي، تُنشِئ العقدة الفاست مجموعة اختبارات الأمان وفقًا لـ[*سياسة الاختبار*][anchor-testpolicy]. ثم، يتم تنفيذ مجموعة الاختبارات الأمان لتقييم التطبيق المستهدف ضد الثغرات الأمنية.

سجل الاختبار يتيح إعادة استخدام طلبات الخط الأساسي المسجلة مسبقًا لاختبار نفس التطبيق المستهدف أو تطبيق مستهدف آخر مرة أخرى؛ ليس هناك حاجة إلى تكرار إرسال طلبات الخط الأساسي المتطابقة من خلال العقدة الفاست. وهذا ممكن فقط إذا كانت طلبات الخط الأساسي في سجل الاختبار مناسبة لاختبار التطبيق.


### سجل الاختبار

تنشئ الفاست مجموعة الاختبارات الأمان من طلبات الخط الأساسي التي تم تخزينها في سجل الاختبار.

لتعبئة سجل الاختبار ببعض طلبات الخط الأساسي، يجب تنفيذ [تشغيل الاختبار][anchor-testrun] الذي مرتبط بهذا السجل والعقدة الفاست ويجب إرسال بعض طلبات الخط الأساسي من خلال العقدة. 

بشكل بديل، من الممكن أن تقوم بتعبئة سجل الاختبار دون إنشاء تشغيل اختبار. للقيام بذلك، يجب تشغيل العقدة في وضع التسجيل. راجع [هذا المستند][doc-node-deployment-ci-mode] للحصول على التفاصيل.

بما أن سجل الاختبار معبأ بالطلبات، فمن الممكن استخدامه مع تشغيل اختبار آخر إذا كان بإمكان التطبيق تحت الاختبار أن يتم تقييمه ضد الثغرات الأمنية باستخدام مجموعة فرعية من طلبات الخط الأساسي المخزنة في سجل الاختبار.

يمكن توظيف سجل اختبار واحد بواسطة عقدات وتشغيل الاختبارات الفاست المتعددة. قد يكون هذا مفيدا إذا:
* تم اختبار نفس التطبيق المستهدف مرة أخرى.
* قد يتم اختبار التطبيقات المستهدفة متعددة بشكل متزامن مع نفس طلبات الخط الأساسي.

![العمل مع سجل الاختبار][img-testrecord]


### سياسة اختبار الفاست

تحدد *سياسة الاختبار* مجموعة من القواعد لإجراء عملية الكشف عن الثغرات الأمنية. بشكل خاص، يمكنك تحديد أنواع الثغرات التي يجب اختبار التطبيق لها. بالإضافة إلى ذلك، تحدد السياسة أي العوامل في الطلب الأساسي مؤهلة ليتم معالجتها أثناء إنشاء مجموعة الاختبارات الأمان. تستخدم هذه المعلومات من قبل الفاست لإنشاء طلبات الاختبار التي يتم استخدامها لمعرفة ما إذا كان التطبيق المستهدف قابلاً للاستغلال.

يمكنك [إنشاء][link-create-policy] سياسة جديدة أو [استخدام][link-use-policy] واحدة موجودة بالفعل.

!!! معلومة "اختيار سياسة الاختبار المناسبة"
اختيار السياسة يعتمد على كيف يعمل التطبيق المستهدف الذي يتم اختباره. يوصى بإنشاء سياسة اختبار مميزة لكل من التطبيقات التي تقوم باختبارها.

!!! معلومة "معلومات إضافية"
    * [مثال على سياسة الاختبار][doc-testpolicy-creation-example] من الدليل السريع
    * [تفاصيل سياسة الاختبار][doc-policy-in-detail]
    
### تشغيل الاختبار

يصف *تشغيل الاختبار* التكرار الواحد لعملية اختبار الثغرات الأمنية.

تشغيل الاختبار يحتوي على:

* مُعرِّف [سياسة الاختبار][anchor-testpolicy]
* مُعرِّف [سجل الاختبار][anchor-testrecord]

توظف العقدة الفاست هذه القيم أثناء إجراء اختبار الأمان للتطبيق المستهدف.

يتم الربط بشدة بين كل تشغيل اختبار وعقدة الفاست الواحدة. إذا قمت بإنشاء تشغيل اختبار جديد `B` للعقدة بينما هناك تشغيل اختبار `A` آخر قيد التقدم لهذه العقدة، تتوقف تنفيذ تشغيل الاختبار `A` ويتم استبدالها بتشغيل الاختبار `B`.

من الممكن إنشاء تشغيل اختبار لسيناريوهات اختبار مختلفين:
* في السيناريو الأول، يجري اختبار التطبيق المستهدف للثغرات الأمنية وتكون تسجيلات طلبات الخط الأساسي تتم في نفس الوقت (إلى سجل اختبار جديد). يجب أن تتدفق الطلبات من مصدر الطلب إلى التطبيق المستهدف عبر العقدة الفاست لكي يتم تسجيل طلبات الخط الأساسي. 
* في السيناريو الثاني، يتم اختبار التطبيق المستهدف بالثغرات الأمنية مع طلبات الخط الأساسي المستخرجة من سجل الاختبار الحالي الغير فارغ. في هذا السيناريو، ليس من الضروري نشر أي مصدر طلب.

عند إنشائك أو نسخ تشغيل الاختبار، يبدأ تنفيذه فورا. بحسب سيناريو الاختبار المفعّل في العمل، ستتبع العملية خطوات مختلفة (أنظر أدناه).

### تدفق تنفيذ تشغيل الاختبار (يتم تسجيل طلبات الخط الأساسي)

عندما تقوم بإنشاء تشغيل اختبار، يبدأ تنفيذه فورا ويتبع الخطوات التالية:

1.  العقدة الفاست تنتظر تشغيل الاختبار. 
    عندما تحدد العقدة أنه بدأ الاختبار، تجلب العقدة مُعرِّفات سياسة الاختبار و سجل الاختبار من تشغيل الاختبار.
2.  بعد الحصول على المُعرِّفات، يبدأ *عملية تسجيل طلبات الخط الأساسي*.
    الآن العقدة جاهزة لتلقي الطلبات من مصدر الطلب إلى التطبيق المستهدف.
3.  بالنظر إلى أن تسجيل الطلب نشط، فقد حان الوقت لبدء تنفيذ الاختبارات الموجودة. يتم إرسال طلبات HTTP و HTTPS عبر العقدة الفاست، والتي تتعرف عليها كطلبات خط أساسي.
    جميع طلبات الخط الأساسي سيتم تخزينها في سجل الاختبار الذي يتوافق مع تشغيل الاختبار.
4.  بعد الانتهاء من تنفيذ الاختبار، يمكنك إيقاف عملية التسجيل.
    هناك قيمة توقيت خاصة محددة بعد إنشاء تشغيل الاختبار. تحدد مدى انتظار الفاست لطلبات الخط الأساسي الجديدة قبل إيقاف عملية التسجيل بسبب عدم وجود طلبات الخط الأساسي (المعلمة [`inactivity_timeout`][doc-about-timeout]).
    إذا لم تقم بإيقاف عملية التسجيل يدويًا، في هذه الحالة: 
    
    * يستمر تشغيل الاختبار في تنفيذه حتى تنتهي قيمة التوقيت، حتى لو أنهت الفاست الاختبارات الأمنية بالفعل.
    * تشغيلات الاختبار الأخرى غير قادرة على إعادة استخدام سجل الاختبار حتى يتوقف هذا الاختبار.
    
    يمكنك إيقاف عملية التسجيل على العقدة الفاست إذا لم تكن هناك أي طلبات خط أساسي أخرى في انتظارها. لاحط ما يلي:
  
    * لا بد من إيقاف عمليات إنشاء وتنفيذ الاختبارات الأمان. يتوقف تنفيذ تشغيل الاختبار عندما تنتهي تقييم التطبيق المستهدف ضد الثغرات الأمنية. هذا السلوك يساعد على تقليل وقت تنفيذ وظيفة CI/CD.
    * يكتسب تشغيل الاختبار الأخرى القدرة على إعادة استخدام سجل الاختبار بمجرد إيقاف التسجيل.
5.  تنشئ العقدة الفاست طلب اختبار واحد أو أكثر على أساس كل طلب أساسي وارد (فقط إذا كان الطلب الأساسي يستوفي سياسة الاختبار المطبقة).
6.  تنفذ العقدة الفاست طلبات الاختبار بإرسالها إلى التطبيق المستهدف.

إيقاف عملية تسجيل طلبات الخط الأساسي ليس له أي تأثير على عمليات إنشاء وتنفيذ طلبات الاختبار.

تتم عمليات تسجيل طلبات الخط الأساسي وإنشاء وتنفيذ اختبارات الأمان الفاست بشكل متوازي:

![تدفق تنفيذ تشغيل الاختبار (يجري تسجيل طلبات الخط الأساسي)][img-execution-timeline-recording]

ملاحظة: يعرض الرسم البياني أعلاه التدفق الذي وصف في [دليل البداية السريع للفاست][doc-quick-start]. يناسب التدفق مع تسجيل طلبات الخط الأساسي إما للاختبارات الأمنية اليدوية أو الأتمتة باستخدام أدوات CI/CD.

في هذا السيناريو، يتطلب واجهة برمجة التطبيقات (API) لـ Wallarm التلاعب بتشغيل الاختبار. راجع [هذا المستند][doc-node-deployment-api] للحصول على التفاصيل.


### تدفق تنفيذ تشغيل الاختبار (تستخدم طلبات الخط الأساسي المسجلة مسبقًا)

عندما تقوم بنسخ تشغيل الاختبار، يبدأ تنفيذه فورا ويتبع الخطوات التالية:

1.  العقدة الفاست تنتظر تشغيل الاختبار. 
    عندما تحدد العقدة أنه بدأ الاختبار، تجلب العقدة مُعرِّفات سياسة الاختبار و سجل الاختبار من تشغيل الاختبار.
2.  بعد الحصول على المُعرِّفات، تستخرج العقدة طلبات الخط الأساسي من سجل الاختبار.
3.  تنشئ العقدة الفاست طلب اختبار واحد أو أكثر على أساس كل طلب أساسي مستخرج (فقط إذا كان الطلب الأساسي يستوفي سياسة الاختبار المطبقة).
4.  تنفذ العقدة الفاست طلبات الاختبار بإرسالها إلى التطبيق المستهدف.

عملية استخراج طلبات الخط الأساسي تحدث قبل إنشاء وتنفيذ اختبارات الأمان الفاست:

![تدفق تنفيذ تشغيل الاختبار (طلبات الخط الأساسي المسجلة مسبقاً هي التي تستخدم)][img-execution-timeline-no-recording]

لاحظ أنه يتم استخدام التدفق التنفيذي في [دليل البداية السريع للفاست][doc-quick-start]. يناسب التدفق الذي يستخدم طلبات الخط الأساسي المسجلة مسبقاً لاختبارات الأمان المؤتمتة باستخدام أدوات CI/CD.

في هذا السيناريو، يمكن استخدام واجهة برمجة التطبيقات (API) لـ Wallarm أو عقدة الفاست في نمط CI للتلاعب بتشغيل الاختبار. راجع [هذا المستند][doc-integration-overview] للحصول على التفاصيل.

يظهر الرسم البياني أدناه سير العمل CI/CD الأكثر شيوعًا، الذي يتوافق مع الجدول الزمني الموضح أعلاه:

![تدفق تنفيذ تشغيل الاختبار (وضع CI)][img-common-timeline-no-recording]


##  العمل مع تشغيل الاختبارات

أثناء قرائتك لهذا الدليل، سوف تتعلم كيفية إدارة عملية تنفيذ تشغيل الاختبار باستخدام استدعاءات API، بشكل خاص:
* كيفية إيقاف عملية تسجيل طلبات الخط الأساسي إذا لم تكن هناك المزيد من الطلبات من مصدر الطلب.
* كيفية التحقق من حالة تنفيذ تشغيل الاختبار.

تحتاج إلى الحصول على [رمز التوكن][anchor-token] لإجراء مثل هذه الاستدعاءات API وربط تشغيل الاختبار بالعقدة الفاست.

### الرمز التوكن

تتألف العقدة الفاست من:
* حاوية Docker التي تعمل وتحتوي على برامج الفاست.
    هنا هو المكان الذي تتم فيه عملية توجيه حركة المرور، وإنشاء اختبار الأمان، تنفيذ.
* العقدة الفاست في سحابة Wallarm.

الرمز التوكن يربط حاوية Docker التي تعمل مع العقدة في السحابة:

![العقدة الفاست][img-fast-node]

لنشر عقدة فاست، قم بما يلي:
1.  إنشاء عقدة فاست في سحابة Wallarm باستخدام [بوابة Wallarm][link-wl-portal-node-tab]. أنسخ الرمز المُقدم.
2.  نشر حاوية Docker مع العقدة وتمرير قيمة الرمز إلى الحاوية (أوصفت هذه العملية بتفصيل [هنا][doc-node-deployment]).

الرمز التوكن يخدم الأغراض التالية أيضًا:
* ربط تشغيل الاختبار بالعقدة الفاست.
* يتيح لك إدارة عملية تنفيذ تشغيل الاختبار بواسطة استدعاءات API.

يمكنك إنشاء العديد من العقدات في سحابة Wallarm كما تحتاج والحصول على رمز لكل من العقدات. على سبيل المثال، إذا كان لديك عدة وظائف CI/CD حيث يلزم الفاست، يمكنك تشغيل عقدة فاست في السحابة لكل وظيفة.

من الممكن إعادة استخدام الرموز التي حصلت عليها في وقت سابق إذا لم يتم استخدام الرموز بواسطة حاويات Docker النشطة الأخرى التي تحتوي على العقدة (على سبيل المثال، أي حاوية Docker بعقدة تحتوي على نفس الرمز متوقفة أو مزالة):

![إعادة استخدام الرمز][img-reuse-token]