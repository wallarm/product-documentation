# اختبار أمان OpenAPI على CI/CD <a href="../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../images/api-security-tag.svg" style="border: none;"></a>

اختبار أمان OpenAPI على CI/CD، الذي تقدمه وولارم، يوفر حلاً لتحديد ومعالجة نقاط الضعف الأمنية ضمن سيناريوهات الأعمال التجارية الحرجة لواجهة برمجة التطبيقات (API)، بما في ذلك واجهات برمجة التطبيقات الظل والزومبي. يشرح هذا المقال كيفية تشغيل واستخدام هذا الحل.

يعمل الحل من خلال توليد طلبات اختبار مصممة خصيصًا للكشف عن نقاط الضعف، مثل مشاركة مصادر الأصل المتقاطعة، وعبور المسار، وعيوب التحكم في الوصول، وغيرها. ثم يدمج بسلاسة في خط أنابيب CI/CD باستخدام Docker لفحص واجهات برمجة التطبيقات الخاصة بك تلقائيًا بحثًا عن هذه الثغرات.

لديك المرونة لاختيار نقاط النهاية التي ترغب في اختبارها:

* **اكتشاف نقاط النهاية التلقائي**: عند استخدام وحدة [اكتشاف واجهة برمجة التطبيقات](../api-discovery/overview.md) الخاصة بوولارم، يتم التعرف على نقاط النهاية التلقائية لواجهة برمجة التطبيقات من خلال بيانات الحركة الفعلية. يمكنك بعد ذلك اختيار نقاط النهاية هذه للاختبار. هذا يضمن أن يركز اختبار الأمان على نقاط النهاية المستخدمة بنشاط بما في ذلك الظل والزومبي، مما يقدم تقييمًا دقيقًا لنقاط الضعف في واجهة برمجة التطبيقات الخاصة بك.
* **تحميل مواصفات يدويًا**: بدلاً من ذلك، يمكنك تحميل مواصفات OpenAPI الخاصة بك واستخدام الحل لاختبار نقاط النهاية من المواصفات. هذا مفيد إذا كان لديك مواصفات محدثة وتريد تشغيل اختبارات على نقاط النهاية المحددة ضمنها.

## القضايا التي يتناولها اختبار الأمان OpenAPI

* يتيح لك هذا الحل إجراء اختبارات أمان أثناء اختبار الانحدار الخاص بواجهات برمجة التطبيقات الخاصة بك. إذا أجريت تغييرات على وظائف واجهات برمجة التطبيقات الخاصة بك، يمكن لاختبار أمان وولارم الكشف عما إذا كانت تغييراتك قد أدخلت أية قضايا أمان.
* عن طريق نشر التغييرات الخاصة بك في بيئة التجريب وتشغيل اختبارات الأمان على خط أنابيب CI/CD في هذه المرحلة، يمكنك منع الثغرات الأمنية المحتملة من الوصول إلى الإنتاج واستغلالها من قبل المهاجمين.
* إذا كنت تستخدم اختبار الأمان بناءً على البيانات المستقاة من [اكتشاف واجهة برمجة التطبيقات](../api-discovery/overview.md)، فإنه يختبر أيضًا واجهات برمجة التطبيقات الظل والزومبي. يتم اكتشاف هذه واجهات برمجة التطبيقات تلقائيًا بواسطة الوحدة حيث قد تتلقى حركة المرور، حتى لو كان فريقك والوثائق الخاصة بك غير مدركين لوجودها. من خلال إدراج واجهات برمجة التطبيقات الزومبي في عملية اختبار الأمان، يعالج الحل الثغرات الأمنية التي قد تمر دون أن يلاحظها أحد، مما يوفر تقييمًا أمنيًا أكثر شمولاً.

## متطلبات

* خطة اشتراك **الأمان المتقدم لواجهات برمجة التطبيقات** [المتقدمة](../about-wallarm/subscription-plans.md#subscription-plans). إذا كنت على خطة مختلفة، يرجى الاتصال بفريق [المبيعات](mailto:sales@wallarm.com) للانتقال إلى الخطة المطلوبة.

## تشغيل اختبار الأمان

للتحكم وتخصيص ميزة اختبار أمان OpenAPI، يمكنك استخدام سياسات الاختبار. بمجرد إنشاء سياسة اختبار، تتلقى أمرًا يتيح لك دمج وتشغيل اختبار الأمان ضمن خط أنابيب CI/CD باستخدام Docker.

لتشغيل اختبار الأمان OpenAPI، اتبع الخطوات التالية:

1. انتقل إلى وحدة تحكم وولارم → **اختبار OpenAPI** باتباع الرابط لـ [السحابة الأمريكية](https://us1.my.wallarm.com/security-testing) أو [السحابة الأوروبية](https://my.wallarm.com/security-testing) و**إنشاء سياسة اختبار**.

    ![!إنشاء سياسة](../images/user-guides/openapi-testing/create-testing-policy.png)
1. اختر نقاط النهاية التي ترغب في اختبارها إما من [جرد API الذي تم اكتشافه تلقائيًا](../api-discovery/overview.md) أو قم بتحميل مواصفات OpenAPI 3.0 بتنسيق JSON.

    على الرغم من أن وحدة اكتشاف واجهة برمجة التطبيقات تحدد تلقائيًا نقاط نهاية جديدة، إلا أنها لا تتضمن تلقائيًا في سياسات الاختبار القائمة للثغرات. نتيجة لذلك، يتطلب كل نقطة نهاية تم اكتشافها حديثًا سياسة منفصلة.
1. اختر أنواع الثغرات الأمنية التي ترغب في اختبارها في نقاط النهاية الخاصة بك.
1. إذا لزم الأمر، أضف رؤوسًا مخصصة لاختبار الثغرات الأمنية، مثل رؤوس المصادقة أو مؤشرات لطلبات اختبار وولارم.

    سيتم استخدام هذه الرؤوس لكل طلب إلى كل نقطة نهاية.
1. انسخ أمر Docker المقدم واملأ القيم للمتغيرات البيئية التي لم يتم تعبئتها تلقائيًا.
1. دمج الأمر في خط أنابيب CI/CD للاختبار التلقائي.

مثال على أمر Docker:

=== "السحابة الأمريكية"
    ```
    docker run -e WALLARM_API_HOST=us1.api.wallarm.com -e WALLARM_API_TOKEN=${WALLARM_API_TOKEN} -e WALLARM_TESTING_POLICY_ID=7 -e TARGET_URL=${WALLARM_SCANNER_TARGET_URL} -v ${WALLARM_REPORT_PATH}:/app/reports --pull=always wallarm/oas-fast-scanner:latest
    ```
=== "السحابة الأوروبية"
    ```
    docker run -e WALLARM_API_HOST=api.wallarm.com -e WALLARM_API_TOKEN=${WALLARM_API_TOKEN} -e WALLARM_TESTING_POLICY_ID=7 -e TARGET_URL=${WALLARM_SCANNER_TARGET_URL} -v ${WALLARM_REPORT_PATH}:/app/reports --pull=always wallarm/oas-fast-scanner:latest
    ```

قائمة المتغيرات البيئية التي [حاوية Docker](https://hub.docker.com/r/wallarm/oas-fast-scanner) تقبلها مذكورة أدناه:

المتغير البيئي | الوصف | مطلوب؟
--- | ---- | ----
`WALLARM_API_HOST` | خادم API وولارم:<ul><li>`us1.api.wallarm.com` للسحابة الأمريكية</li><li>`api.wallarm.com` للسحابة الأوروبية</li></ul> | نعم
`WALLARM_API_TOKEN` | [رمز API وولارم](../user-guides/settings/api-tokens.md) مع أذونات **اختبار OpenAPI**. | نعم
`WALLARM_TESTING_POLICY_ID` | معرف سياسة اختبار وولارم. يتم توليده تلقائيًا بمجرد إنشاء السياسة. | نعم
`TARGET_URL` | عنوان URL الذي تستضيف فيه نقاط النهاية التي ترغب في اختبارها. يتم إرسال طلبات الاختبار إلى هذا المضيف، على سبيل المثال، مرحلة التجريب، أو البناء المحلي. | نعم

لنهج أكثر أمانًا في تمرير المتغيرات إلى الحاوية، يُنصح بحفظ قيم متغيرات البيئة للحاوية التي لم يتم تعبئتها تلقائيًا كمتغيرات بيئة محلية على جهازك. يمكنك القيام بذلك من خلال تنفيذ الأوامر التالية في طرفيتك:

```
export WALLARM_API_TOKEN=<VALUE>
export WALLARM_SCANNER_TARGET_URL=<VALUE>
```

لحفظ نتائج اختبار الأمان على جهاز الاستضافة، حدد مسار الجهاز المطلوب في متغير `${WALLARM_REPORT_PATH}` ضمن خيار `-v` لأمر Docker.

## تفسير نتائج اختبار الأمان

عند تشغيل اختبارات الأمان، تولد وولارم سلسلة من طلبات الاختبار النموذجية المصممة خصيصًا للكشف عن الثغرات الأمنية التي تم اختيارها في سياسة الاختبار الخاصة بك. يتم إرسال هذه الطلبات بشكل متسلسل إلى النقاط المحددة في سياساتك.

من خلال تحليل الردود على الطلبات المولدة، تحدد وولارم الثغرات الأمنية المفتوحة الموجودة في نقاط النهاية الخاصة بواصف برمجة التطبيقات. ثم تعيد رمز `0` أو `1` عبر الإخراج القياسي (stdout) لحاوية Docker:

* رمز `0` يشير إلى عدم كشف أية ثغرات أمنية مفتوحة.
* رمز `1` يشير إلى وجود ثغرات أمنية مفتوحة.

إذا تلقيت رمز `1` لثغرات أمنية معينة، فمن المهم اتخاذ الإجراءات المناسبة لمعالجتها.

## إنشاء تقرير اختبار الأمان

يمكنك الحصول على تقرير أمان يوفر معلومات مفصلة حول الطلبات التي كشفت عن الثغرات الأمنية. يتم توليد التقرير بتنسيقات متعددة، بما في ذلك CSV، وYAML، وJSON.

لحفظ نتائج اختبار الأمان على جهاز الاستضافة، حدد مسار الجهاز المطلوب في متغير `${WALLARM_REPORT_PATH}` ضمن خيار `-v ${WALLARM_REPORT_PATH}:/app/reports` لأمر Docker.

من المهم ضمان وجود صلاحيات كتابة مناسبة لمسار الجهاز على الجهاز لكي يتمكن الحاوية Docker من حفظ ملفات التقرير بنجاح.

مثال على تقرير JSON:

```json
[
    {
        "type":"ptrav",
        "threat":80,
        "payload":"/../../../../../../../../../etc/passwd",
        "exploit_example":"curl -v -X GET -H 'x-test