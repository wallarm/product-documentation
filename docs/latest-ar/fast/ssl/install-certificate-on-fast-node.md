[link-openssl]:                 https://www.openssl.org/docs/man1.0.2/man1/x509.html
[link-pem-encoding]:            https://www.ssl.com/guide/pem-der-crt-and-cer-x-509-encodings-and-conversions/


#   تثبيت شهادة SSL الخاصة بك على عقدة FAST

!!! info "المتطلبات الأساسية"
    يفترض هذا الدليل أن:
    
    * متصفحك مُعد لاستخدام عقدة FAST كوكيل HTTP أو HTTPS.
    * متصفحك يثق بالفعل بشهادة SSL التي ستقوم بتثبيتها لعقدة FAST.

!!! warning "متطلبات الشهادة"
    لإتمام هذا التثبيت بنجاح، يجب أن تكون شهادة SSL إما شهادة جذرية أو شهادة وسيطة.
    
    يجب أن تكون الشهادة ومفتاحها الخاص [مُشفرة باستخدام PEM][link-pem-encoding]. إذا كانت شهادتك بتشفير مختلف، يمكنك استخدام أداة تحويل الشهادات المتاحة، مثل [OpenSSL][link-openssl] لتحويلها إلى شهادة مشفرة باستخدام PEM.

##  تثبيت شهادة SSL

لتثبيت شهادة SSL على عقدة FAST، اتبع الخطوات التالية:
1.  تأكد من أن لديك بالفعل شهادة SSL، بالإضافة إلى المفتاح الخاص الذي وقع الشهادة، بتنسيق PEM.

2.  ضع ملف الشهادة وملف المفتاح في نفس الدليل على مضيف Docker. سيكون من الضروري تركيب هذا الدليل على حاوية Docker التي تحتوي على عقدة FAST في الخطوات التالية.

3.  حدد موقع عقدة FAST التي تتواجد فيها الشهادة والمفتاح باستخدام المتغيرات البيئية التالية:

    ```
    CA_CERT=<المسار الداخلي للشهادة>
    CA_KEY=<المسار الداخلي للمفتاح>
    ```
    
    في الأسطر أعلاه، استبدل القيم `<المسار الداخلي للشهادة>` و `<المسار الداخلي للمفتاح>` بالمسار المتوقع للشهادة والمفتاح بعد تركيب الدليل في حاوية Docker.

4.  قم بنشر حاوية Docker التي تحتوي على عقدة FAST بتشغيل الأمر التالي:

    ```
    docker run --name <اسم> \ 
    -e WALLARM_API_TOKEN=<رمز> \
    -e ALLOWED_HOSTS=<قائمة المضيفين> \
    -e CA_CERT=<المسار الداخلي للشهادة> \
    -e CA_KEY=<المسار الداخلي للمفتاح> \
    -v <مسار الدليل الذي يحتوي على الشهادة والمفتاح>:<المسار الداخلي للدليل> \
    -p <منفذ النشر>:8080 \
    wallarm/fast
    ```
    
    يُحدد هذا الأمر المعلمات التالية:
    
    * اسم حاوية.
    * الرمز وقائمة المواقع للتطبيق الهدف باستخدام المتغيرات البيئية `WALLARM_API_TOKEN` و `ALLOWED_HOSTS` (الأخيرة ليست إلزامية).
    * موقع ملف شهادة SSL داخل الحاوية بواسطة المتغير `CA_CERT`.
    * موقع ملف المفتاح الخاص داخل الحاوية بواسطة المتغير `CA_KEY`.
    * منفذ نشر التطبيق.
    
    استخدم خيار `-v` من أمر `docker run` لتركيب دليل مضيف Docker `<مسار الدليل الذي يحتوي على الشهادة والمفتاح>` في الحاوية. تصبح محتويات هذا الدليل متاحة داخل الحاوية على المسار `<المسار الداخلي للدليل>`. 
        
    !!! warning "ملاحظة"
        يجب أن تشير المسارات إلى ملفات الشهادة والمفتاح المحددة بمتغيرات البيئة `CA_CERT` و `CA_KEY` إلى الملفات في المعلم `<المسار الداخلي للدليل>` الذي حددته بخيار `-v` من أمر `docker run`.   

الآن يجب أن تكون شهادة SSL مثبتة بنجاح. ستقوم نسخة عقدة FAST الآن بتوكيل طلبات HTTPS بدون أية رسائل حول الشهادات غير الموثوقة.


##  مثال على تثبيت شهادة SSL.

فيما يلي يفترض أن يكون الحال:
* ملفات `cert.pem` و `cert.key` التي تحتوي على شهادة SSL والمفتاح الخاص المقابل موجودة في دليل `/home/user/certs` على مضيف Docker حيث يتم تشغيل عقدة FAST،
* محتويات دليل `/home/user/certs` ستكون متاحة داخل الحاوية التي تحتوي على عقدة FAST على مسار `/tmp/certs`،
* يُستخدم رمز `fast_token`،
* فقط `example.com` مدرج في قائمة المضيفين، و
* ستعمل عقدة FAST في الحاوية باسم `fast-node` وسيتم نشر منفذها الداخلي `8080` في `localhost:8080`،

ثم تحتاج إلى تنفيذ الأمر التالي لربط شهادة SSL بعقدة FAST:

```
docker run --name fast-node \
-e WALLARM_API_TOKEN="fast_token" \
-e ALLOWED_HOSTS="example.com" \
-e CA_CERT="/tmp/certs/cert.pem" \
-e CA_KEY="/tmp/certs/cert.key" \
-v /home/user/certs:/tmp/certs \
-p 8080:8080 \
wallarm/fast
```   