[link-openssl]:                 https://www.openssl.org/docs/man1.0.2/man1/x509.html
[link-pem-encoding]:            https://www.ssl.com/guide/pem-der-crt-and-cer-x-509-encodings-and-conversions/

#   تثبيت شهادة SSL الخاصة بك على عقدة FAST

!!! info "المتطلبات الأساسية"
    يفترض هذا الدليل أن:
    
    * متصفحك مُعد لاستخدام عقدة FAST كوكيل HTTP أو HTTPS.
    * متصفحك يثق بالفعل بشهادة SSL التي ستقوم بتثبيتها لعقدة FAST.

!!! warning "متطلبات الشهادة"
    لإكمال هذا التثبيت بنجاح، يجب أن تكون شهادة SSL إما شهادة جذر أو شهادة وسيطة.
    
    يجب أن تكون الشهادة ومفتاح التشفير الخاص المتوافق معها مُشفرين باستخدام تشفير PEM. إذا كان للشهادة تشفير مختلف، يمكنك استخدام أي أداة تحويل شهادات متاحة، مثل [OpenSSL][link-openssl]، لتحويلها إلى شهادة مُشفرة بتشفير PEM.

##  تثبيت شهادة SSL

لتثبيت شهادة SSL على عقدة FAST، اتبع هذه الخطوات:
1.  تأكد من أن لديك بالفعل شهادة SSL، بالإضافة إلى مفتاح التشفير الخاص الذي وقع الشهادة، بتشفير PEM.

2.  ضع ملف الشهادة وملف المفتاح في نفس الدليل على مضيف Docker. سيكون من الضروري تركيب هذا الدليل على وعاء Docker الحاوي لعقدة FAST في الخطوات التالية.

3.  حدد مكان وجود الشهادة والمفتاح في عقدة FAST باستخدام متغيرات البيئة التالية:

    ```
    CA_CERT=<مسار داخلي إلى الشهادة>
    CA_KEY=<مسار داخلي إلى المفتاح>
    ```
    
    في الأسطر أعلاه، استبدل القيم `<مسار داخلي إلى الشهادة>` و`<مسار داخلي إلى المفتاح>` بالمسار المتوقع للشهادة والمفتاح بعد تركيب الدليل في وعاء Docker.

4.  قم بنشر وعاء Docker الذي يحتوي عقدة FAST بتشغيل الأمر التالي:

    ```
    docker run --name <الاسم> \ 
    -e WALLARM_API_TOKEN=<رمز> \
    -e ALLOWED_HOSTS=<قائمة المضيفين> \
    -e CA_CERT=<مسار داخلي إلى الشهادة> \
    -e CA_KEY=<مسار داخلي إلى المفتاح> \
    -v <مسار الدليل الذي يحتوي على الشهادة والمفتاح>:<المسار الداخلي للدليل> \
    -p <منفذ النشر>:8080 \
    wallarm/fast
    ```
    
    يُعرف هذا الأمر البارامترات التالية:
    
    * اسم الوعاء.
    * الرمز وقائمة المضيفين للتطبيق المستهدف باستخدام متغيرات البيئة `WALLARM_API_TOKEN` و `ALLOWED_HOSTS` (آخر واحد ليس إلزاميًا).
    * مكان ملف شهادة SSL داخل الوعاء باستخدام متغير `CA_CERT`.
    * مكان ملف المفتاح الخاص داخل الوعاء باستخدام متغير `CA_KEY`.
    * منفذ نشر التطبيق.
    
    استخدم خيار `-v` لأمر `docker run` لتركيب دليل مضيف Docker `<مسار الدليل الذي يحتوي على الشهادة والمفتاح>` في الوعاء. تصبح محتويات هذا الدليل متاحة داخل الوعاء على المسار `<المسار الداخلي للدليل>`. 
        
    !!! warning "ملاحظة"
        يجب أن تشير المسارات لملفات الشهادة والمفتاح المحددة بمتغيري البيئة `CA_CERT` و`CA_KEY` إلى الملفات في المعلم `<المسار الداخلي للدليل>` الذي حددته بخيار `-v` لأمر `docker run`.   

الآن يجب أن تكون شهادة SSL قد تم تثبيتها بنجاح. ستقوم نسخة عقدة FAST الآن بتوكيل الطلبات HTTPS دون أي رسائل تحذير من شهادات غير موثوق بها.


##  مثال على تثبيت شهادة SSL.

يُفترض أن يكون الحال كالتالي:
* ملفات `cert.pem` و `cert.key` مع شهادة SSL ومفتاح التشفير الخاص المتوافق موجودة في دليل `/home/user/certs` لمضيف Docker حيث يتم إطلاق عقدة FAST،
* ستكون محتويات دليل `/home/user/certs` متاحة داخل الوعاء الذي يحتوي عقدة FAST على المسار `/tmp/certs`،
* يُستخدم رمز `fast_token`,
* فقط `example.com` مدرج في قائمة المضيفين، و
* ستعمل عقدة FAST في الوعاء باسم `fast-node` وسيتم نشر منفذها الداخلي `8080` في `localhost:8080`،

في هذه الحالة، تحتاج إلى تنفيذ الأمر التالي لربط شهادة SSL على عقدة FAST:

```
docker run --name fast-node \
-e WALLARM_API_TOKEN="fast_token" \
-e ALLOWED_HOSTS="example.com" \
-e CA_CERT="/tmp/certs/cert.pem" \
-e CA_KEY="/tmp/certs/cert.key" \
-v /home/user/certs:/tmp/certs \
-p 8080:8080 \
wallarm/fast
```   