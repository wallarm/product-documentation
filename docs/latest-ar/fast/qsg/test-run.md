[img-fast-node-internals]: ../../images/fast/qsg/en/test-run/18-qsg-fast-test-run-proxy-internals.png
[img-view-recording-cloud]: ../../images/fast/qsg/common/test-run/20-qsg-fast-test-run-baselines-recording.png
[img-request-exec-result]:  ../../images/fast/qsg/common/test-run/22-qsg-fast-test-run-gruyere-request.png
[img-incoming-baselines]:   ../../images/fast/qsg/common/test-run/23-qsg-fast-test-run-processing.png    
[img-xss-found]:            ../../images/fast/qsg/common/test-run/24-qsg-fast-test-run-vuln.png

[link-deployment]:          deployment.md
[link-wl-console]:          https://us1.my.wallarm.com
[link-previous-chapter]:    test-preparation.md
[link-create-tr-gui]:       ../operations/create-testrun.md#creating-a-test-run-via-web-interface

[anchor1]:  #1-create-and-run-the-test-run  
[anchor2]:  #2-execute-the-https-baseline-request-you-created-earlier 

# تشغيل الاختبار

سترشدك هذه الفصل عبر عملية إنشاء وتنفيذ مجموعة اختبارات الأمان. سيتم بناء مجموعة الاختبار باستخدام سياسة الاختبار وطلب الأساس الذي أنشأته [سابقًا][link-previous-chapter]. بعد إكمال جميع الخطوات اللازمة، ستجد ثغرة XSS نتيجة للاختبارات الخاصة بك.

لبدء اختبار أمان التطبيق، يجب إنشاء دورة اختبار. *دورة الاختبار* تصف عملية اختبار الثغرات الأمنية لمرة واحدة. لكل دورة اختبار معرّف فريد، وهو أمر حاسم لتشغيل FAST بشكل صحيح. عند إنشاء دورة الاختبار، يتم إرسال معرّف دورة الاختبار وسياسة الاختبار إلى عقدة FAST. ثم يبدأ عملية الاختبار الأمني على العقدة.

FAST تنشئ وتنفذ مجموعة اختبارات الأمان على النحو التالي:

1. العقدة توكل جميع الطلبات الواردة بشكل شفاف حتى يتم إرسال سياسة الاختبار ومعرّف دورة الاختبار إليها.

2. بمجرد إنشاء دورة الاختبار وتشغيلها، ستستقبل عقدة FAST سياسة الاختبار ومعرّف دورة الاختبار من سحابة Wallarm.

3. إذا تلقت العقدة طلب أساس إلى التطبيق المستهدف، فإن:
   1. العقدة توسم الطلب الوارد بمعرّف دورة الاختبار
   2. يتم حفظ الطلب الموسوم في سحابة Wallarm
   3. يتم إرسال الطلب الأساسي الأولي إلى التطبيق المستهدف دون تعديل
    
    !!! info "عملية تسجيل الطلبات الأساسية"
        غالبًا ما يُشار إلى هذه العملية باسم تسجيل الطلبات الأساسية. يمكنك إيقاف التسجيل إما من واجهة الويب الخاصة بالسحابة أو عن طريق إجراء استدعاء API إلى API Wallarm. ستواصل العقدة إرسال الأسس الأولية إلى التطبيق المستهدف.
    
    تبدأ عملية تسجيل الأساس إذا تلقت العقدة سياسة الاختبار ومعرّف دورة الاختبار أولاً.
    
    تحدد عقدة FAST ما إذا كان الطلب يعتبر أساسًا من خلال فحص متغير البيئة `ALLOWED_HOSTS`. تم إعداد هذا المتغير خلال عملية [نشر العقدة][link-deployment]. إذا كان نطاق هدف الطلب مسموحًا به بواسطة المتغير، فإن الطلب يعتبر أساسًا. إذا اتبعت الدليل، فسيتم اعتبار جميع الطلبات إلى نطاق `google-gruyere.appspot.com` كأساسية.
    
    جميع الطلبات الأخرى التي لا تستهدف التطبيق تُوكل بشكل شفاف دون أي تعديلات.

4. عقدة FAST تجلب جميع الطلبات الأساسية المسجلة من سحابة Wallarm بناءً على معرّف دورة الاختبار.

5. عقدة FAST تولد اختبارات أمان لكل طلب أساسي باستخدام سياسة الاختبار التي تلقتها من السحابة.

6. يتم تنفيذ مجموعة اختبارات الأمان المولدة عن طريق إرسال الطلبات إلى التطبيق المستهدف من العقدة. يتم ربط نتائج الاختبار بمعرّف دورة الاختبار وتخزينها في السحابة.

    ![منطق عمل عقدة FAST الداخلي][img-fast-node-internals]

    !!! info "ملاحظة حول دورة الاختبار قيد الاستخدام"
        في أي فترة زمنية معينة، يمكن تشغيل دورة اختبار واحدة فقط على عقدة FAST. إذا أنشأت دورة اختبار أخرى لنفس العقدة، سيتم إيقاف تنفيذ دورة الاختبار الحالية.

لبدء عملية إنشاء وتنفيذ مجموعة اختبارات الأمان، افعل ما يلي:

1. [أنشئ وشغّل دورة الاختبار][anchor1]
2. [نفّذ طلب الأساس HTTPS الذي أنشأته سابقًا][anchor2]
    
##  1. أنشئ وشغّل دورة الاختبار  

أنشئ دورة اختبار عبر واجهة الويب الخاصة بحساب Wallarm باستخدام [التعليمات][link-create-tr-gui].

بعد اتباع التعليمات، قم بتعيين الإعدادات الأساسية التالية عند إنشاء دورة اختبار:

* اسم دورة الاختبار: `DEMO TEST RUN`
* سياسة الاختبار: `DEMO POLICY`
* عقدة FAST: `DEMO NODE`

هذه التعليمات لا تحتوي على إعدادات متقدمة.

بعد حفظ دورة الاختبار، سيتم إرسال معرّفها تلقائيًا إلى عقدة FAST. في علامة التبويب "Testruns"، سترى دورة الاختبار المُنشأة بمؤشر أحمر يومض. يعني هذا المؤشر أن الطلبات الأساسية لدورة الاختبار يتم تسجيلها.

يمكنك النقر على عمود "Baseline req." لرؤية جميع الطلبات الأساسية التي يتم تسجيلها.

![عرض الطلبات الأساسية المسجلة][img-view-recording-cloud]

!!! info "جاهزية العقدة للتسجيل"
    يجب الانتظار حتى ترى إخراج وحدة التحكم الذي يشير إلى أن عقدة FAST باسم `DEMO NODE` جاهزة لتسجيل الطلبات الأساسية لدورة الاختبار باسم `DEMO TEST RUN`
    
    إذا كانت العقدة جاهزة لتسجيل الطلب الأساسي، سترى رسالة مماثلة في إخراج وحدة التحكم:
    
    `[info] Recording baselines for TestRun#N ‘DEMO TEST RUN’`
    
    ستكون العقدة قادرة على توليد مجموعة اختبار أمان بناءً على الطلبات الأساسية فقط بعد ظهور هذه الرسالة.

##  2. نفّذ طلب الأساس HTTPS الذي أنشأته سابقًا

للقيام بذلك، انتقل إلى الرابط الذي [أنشأته][link-previous-chapter] باستخدام متصفح Mozilla Firefox المُعد مسبقًا.

!!! info "مثال على رابط"
    <https://google-gruyere.appspot.com/430232491618310677730226710602783767322/snippets.gtl?password=paSSw0rd&uid=123>

نتيجة تنفيذ الطلب موضحة أدناه:

![نتيجة تنفيذ الطلب][img-request-exec-result]

يُلاحظ من إخراج وحدة التحكم أن عقدة FAST قد سجلت طلب أساس:

--8<-- "../include/fast/console-include/qsg/fast-node-testing.md"

يمكنك ملاحظة بعض الطلبات الأساسية التي يتم حفظها في سحابة Wallarm:

![الطلبات الأساسية الواردة][img-incoming-baselines]

تقترح هذه الوثيقة تنفيذ طلب واحد فقط لأغراض العرض. بناءً على ذلك، لا يوجد طلبات إضافية إلى التطبيق المستهدف، أوقف عملية تسجيل الأساس من خلال تحديد خيار **Stop recording** من قائمة "Actions".

!!! info "التحكم في عملية تنفيذ دورة الاختبار"
    تم إنشاء مجموعة الاختبار الأمني بسرعة كبيرة لدورة الاختبار التي أنشأتها. ومع ذلك، قد يستغرق العملية وقتًا كبيرًا بناءً على عدد الطلبات الأساسية وسياسة الاختبار المستخدمة واستجابة التطبيق المستهدف. يمكنك إيقاف أو توقيف عملية الاختبار من خلال تحديد خيار مناسب من قائمة "Actions".

تتوقف دورة الاختبار تلقائيًا عند الانتهاء من عملية الاختبار، بناءً على أن عملية تسجيل الأساس لم تكن جارية. ستُعرض بعض المعلومات الموجزة عن الثغرات المكتشفة في عمود "Result". يجب أن تجد FAST بعض ثغرات XSS للطلب HTTPS المُنفذ:

![الثغرة المكتشفة][img-xss-found]

الآن، يجب أن تكون قد أكملت جميع أهداف الفصل، بالإضافة إلى نتيجة اختبار الطلب HTTPS إلى تطبيق Google Gruyere. وتُظهر النتيجة اكتشاف ثلاث ثغرات XSS.