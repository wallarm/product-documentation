[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

# مرحلة المطابقة

!!! info "نطاق المرحلة"  
    هذه المرحلة تُستخدم في امتداد التعديل وهي اختيارية لعمله (قد يكون قسم `match` غائبًا أو موجودًا في ملف YAML).

    يجب أن تكون هذه المرحلة غائبة من ملف YAML لامتداد غير التعديلي.
    
    اقرأ عن أنواع الامتداد بالتفصيل [هنا][link-ext-logic].

!!! info "صياغة وصف عناصر الطلب"
     عند إنشاء امتداد FAST، تحتاج إلى فهم هيكل الطلب HTTP الذي يُرسل إلى التطبيق وهيكل الاستجابة HTTP التي يتلقاها من التطبيق لكي تصف بشكل صحيح عناصر الطلب التي تحتاج إلى العمل معها، باستخدام النقاط. 
    
    لمشاهدة المعلومات بالتفصيل، تابع إلى هذا [الرابط][link-points].
 
 تتحقق هذه المرحلة إذا كان الطلب الأساسي الوارد يطابق المعايير المحددة.

قسم `match` في ملف امتداد YAML يحتوي على مصفوفة من أزواج `<مفتاح: قيمة>`. يصف كل زوج عنصرًا معينًا من الطلب (المفتاح) وبيانات هذا العنصر (القيمة). قد يحتوي المفتاح والقيمة على تعبيرات منتظمة بـ [تنسيق تعبيرات Ruby المنتظمة][link-ruby-regexp].

تبحث مرحلة المطابقة عن مطابقات لكل أزواج `<مفتاح: قيمة>` المعطاة في الطلب الأساسي.
* يتم فحص الطلب ضد وجود العناصر المطلوبة (على سبيل المثال، قيمة المسار في URL، العامل GET، أو الرأس HTTP) بالبيانات المطلوبة. 
    
    ??? info "مثال 1"
        `'GET_a_value': '^\d+$'` — يجب أن يكون العامل GET بالاسم `a` بقيمة تحتوي على أرقام فقط موجودًا في الطلب.
    
    ??? info "مثال 2"
        `'GET_b*_value': '.*'` — يجب أن يكون العامل GET بالاسم الذي يبدأ بـ `b`، بأي قيمة (بما في ذلك القيمة الفارغة)، موجودًا في الطلب.
    
* إذا تم تعيين القيمة إلى `null` لمفتاح معين، يتم فحص غياب العنصر المقابل في الطلب.
    
    ??? info "مثال"
        `'GET_a': null` — يجب أن يكون العامل GET بالاسم `a` غائبًا من الطلب.

لكي يمر الطلب الأساسي خلال مرحلة المطابقة، من الضروري أن يلبي الطلب جميع أزواج `<مفتاح: قيمة>` في قسم `match`. إذا لم يتم العثور على مطابقة لأي من أزواج `<مفتاح: قيمة>` الموصوفة في قسم `match` في الطلب الأساسي، سيتم رفض الطلب.

??? info "مثال"
    يحتوي قسم `match` الظاهر أدناه على قائمة أزواج `<مفتاح: قيمة>`. لكي يمر الطلب الأساسي خلال مرحلة المطابقة، يجب أن يلبي جميع هذه الأزواج.

    ```
    match:
    - 'HEADER_HOST_value': 'example.com'
    - 'GET_password_value': '^\d+$'
    - 'HEADER_CONTENT-TYPE_value': null
    ```

    1. يجب أن يحتوي الطلب الأساسي على الرأس HTTP بالاسم `Header`، بقيمة تحتوي `example.com` كجزء فرعي.
    2. يجب أن تحتوي قيمة عامل `password` GET على أرقام فقط.
    3. يجب أن يكون الرأس `Content-Type` غائبًا.