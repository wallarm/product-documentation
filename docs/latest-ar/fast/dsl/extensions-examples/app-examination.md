[img-login]:                ../../../images/fast/dsl/common/extension-examples/ojs_broken.png
[img-wireshark]:            ../../../images/fast/dsl/common/extension-examples/wireshark.png

[link-juice-shop]:          https://www.owasp.org/index.php/OWASP_Juice_Shop_Project
[link-ojs-install-manual]:  https://bkimminich.gitbooks.io/pwning-owasp-juice-shop/content/part1/running.html

#   فحص التطبيق النموذجي

!!! info "كلمات قليلة عن التطبيق"
    يستعمل هذا الدليل تطبيق [OWASP Juice Shop][link-juice-shop] الضعيف لإظهار إمكانيات نظام الامتداد FAST.
    
    من المفترض أن نسخة من هذا التطبيق متاحة عبر اسم النطاق `ojs.example.local`. إذا كان هناك اسم نطاق مختلف مُعين للتطبيق المنشور (انظر [تعليمات التثبيت][link-ojs-install-manual])، يُرجى استبدال `ojs.example.local` بالاسم المناسب.
 لتأسيس امتداد FAST بنجاح، تحتاج إلى فهم آلية عمل التطبيق الشبكي أو API الذي تحتاج لاختباره للثغرات (الهيكل الداخلي للتطبيق أو API، تنسيق الطلب والاستجابة، منطق معالجة الاستثناءات، إلخ).

لنقم بفحص تطبيق OWASP Juice Shop لمعرفة بعض الطرق المحتملة لاستغلال الثغرات.

للقيام بذلك، انتقل إلى صفحة تسجيل الدخول (`http://ojs.example.local/#/login`) باستخدام متصفح، أدخل رمز `'` في حقل "البريد الإلكتروني" وكلمة السر `12345` في حقل "كلمة المرور"، ثم اضغط على زر "تسجيل الدخول". بمساعدة أدوات مطوري المتصفح أو برنامج التقاط حركة مرور Wireshark، يمكننا اكتشاف أن استخدام رمز الفاصلة العلوية في حقل "البريد الإلكتروني" يتسبب في خطأ داخلي في الخادم.

بعد تحليل جميع المعلومات من الطلب إلى الخادم، يمكننا الخروج بالاستنتاجات التالية:
* يتم استدعاء طريقة API REST `POST /rest/user/login` عندما يحاول المستخدم تسجيل الدخول.
* يتم نقل بيانات اعتماد تسجيل الدخول إلى طريقة API هذه بتنسيق JSON كما هو موضح أدناه.
    
    ```
    {
        "email": "'",
        "password": "12345"
    }
    ```
    
بعد تحليل جميع المعلومات من استجابة الخادم، يمكننا الخروج بالاستنتاج أن قيم `email` و `password` تُستخدم في الاستعلام SQL التالي: 
    
```
SELECT * FROM Users WHERE email = ''' AND password = '827ccb0eea8a706c4c34a16891f84e7b'
```

لذلك، يمكننا الافتراض أنه يمكن استغلال تطبيق OWASP Juice Shop للهجمات بحقن SQL (SQLi) من خلال نموذج تسجيل الدخول.

![نموذج تسجيل الدخول لتطبيق OWASP Juice Shop][img-login]

!!! info "استغلال الثغرة"
    الثغرة القابلة للاستغلال: SQLi.
    
    تستغل الوثائق الرسمية ثغرة SQLi عن طريق إدخال البريد الإلكتروني `'or 1=1 -- ` وأي كلمة مرور في نموذج تسجيل الدخول.
    
    بعد هذا الهجوم، ستتمكن من تسجيل الدخول كمسؤول لتطبيق الويب.
    
    كبديل، يمكنك استخدام البيانات التي تحتوي على بريد إلكتروني للمسؤول الموجود كقيمة لحقل `email` (قد تحتوي حقل `password` على أي قيمة).
    
    ```
    {
        "email": "admin@juice-sh.op'--",
        "password": "12345"
    }
    ```
 لفهم كيفية اكتشاف حالة استغلال الثغرة بنجاح، سجل الدخول إلى الموقع كمسؤول باستخدام قيم البريد الإلكتروني وكلمة المرور المذكورة أعلاه. اعترض استجابة خادم API باستخدام تطبيق Wireshark:
* حالة HTTP للاستجابة: `200 OK` (إذا كانت هناك أية مشاكل أثناء تسجيل الدخول، فسيرد الخادم بحالة `401 Unauthorized`). 
* استجابة الخادم بتنسيق JSON التي تُعلم عن توثيق ناجح:

    ```
    {
        "authentication": {
            "token": "some long token",     # قيمة الرمز ليست مهمة
            "bid": 1,                       # معرّف سلة التسوق للمستخدم
            "umail": "admin@juice-sh.op"    # عنوان بريد المستخدم مخزّن في معامل umail
        }
    }
    ```

![اعتراض استجابة خادم API باستخدام تطبيق Wireshark][img-wireshark]