[img-login]:                ../../../images/fast/dsl/common/extension-examples/ojs_broken.png
[img-wireshark]:            ../../../images/fast/dsl/common/extension-examples/wireshark.png

[link-juice-shop]:          https://www.owasp.org/index.php/OWASP_Juice_Shop_Project
[link-ojs-install-manual]:  https://bkimminich.gitbooks.io/pwning-owasp-juice-shop/content/part1/running.html

# فحص تطبيق العينة

!!! info "بضع كلمات حول التطبيق"
    يستخدم هذا الدليل التطبيق القابل للاختراق [OWASP Juice Shop][link-juice-shop] لإظهار قدرات آلية توسعة FAST.
    
    يُفترض أن نسخة هذا التطبيق متاحة عبر اسم النطاق `ojs.example.local`. إذا تم تعيين اسم نطاق مختلف للتطبيق المنشور (انظر [تعليمات التثبيت][link-ojs-install-manual])، فيُرجى استبدال `ojs.example.local` بالاسم المناسب للنطاق.
لبناء توسعة FAST بنجاح، تحتاج إلى فهم آلية عمل التطبيق الويب أو API الذي تحتاج إلى اختباره للتحقق من الثغرات الأمنية (الهيكل الداخلي للتطبيق أو API، تنسيق الطلب والرد، منطق معالجة الاستثناء، إلخ).

دعونا نقوم بفحص تطبيق OWASP Juice Shop لمعرفة بعض الطرق المحتملة لاستغلال الثغرات.

للقيام بذلك، انتقل إلى صفحة الدخول (`http://ojs.example.local/#/login`) باستخدام متصفح، أدخل الرمز `'` في حقل "البريد الإلكتروني" وكلمة السر `12345` في حقل "كلمة السر"، واضغط على زر "تسجيل الدخول". باستخدام أدوات مطور المتصفح أو برنامج Wireshark لالتقاط حركة المرور، يمكننا معرفة أن استخدام رمز العلامة الفاصلة في حقل "البريد الإلكتروني" يتسبب في خطأ داخلي في الخادم.

بعد تحليل كل المعلومات من الطلب إلى الخادم، يمكننا الوصول إلى الاستنتاجات التالية:
* يتم استدعاء طريقة REST API `POST /rest/user/login` عندما يحاول المستخدم تسجيل الدخول.
* يتم نقل بيانات اعتماد تسجيل الدخول إلى هذه الطريقة API بتنسيق JSON كما هو موضح أدناه.
    
    ```
    {
        "email": "'",
        "password": "12345"
    }
    ```
    
بعد تحليل كل المعلومات من رد الخادم، يمكننا الوصول إلى الاستنتاج بأن قيم `email` و`password` تُستخدم في استعلام SQL التالي: 
    
```
SELECT * FROM Users WHERE email = ''' وكلمة السر = '827ccb0eea8a706c4c34a16891f84e7b'
```

لذلك، يمكننا افتراض أن OWASP Juice Shop قد يكون عرضة لهجمات الحقن SQL (SQLi) من خلال نموذج تسجيل الدخول.

![نموذج تسجيل الدخول لتطبيق OWASP Juice Shop][img-login]

!!! info "استغلال الثغرة"
    الثغرة القابلة للاستغلال: SQLi.
    
    تستغل الوثائق الرسمية ثغرة SQLi من خلال إدخال البريد الإلكتروني `'أو 1=1 --` وأي كلمة سر في نموذج تسجيل الدخول.
    
    بعد هذا الهجوم، ستتمكن من تسجيل الدخول كمسؤول تطبيق الويب.
    
    بديلاً، يمكنك استخدام الحمولة التي تحتوي على البريد الإلكتروني للمسؤول الحالي كقيمة لحقل `email` (قد يحتوي حقل `password` على أي قيمة).
    
    ```
    {
        "email": "admin@juice-sh.op'--",
        "password": "12345"
    }
    ```
 لفهم كيفية اكتشاف حالة استغلال الثغرة بنجاح، قم بتسجيل الدخول إلى الموقع كمسؤول باستخدام قيم البريد الإلكتروني وكلمة السر المذكورة أعلاه. اعترض رد خادم API باستخدام تطبيق Wireshark:
* حالة HTTP للرد: `200 OK` (إذا كانت هناك أي مشاكل أثناء تسجيل الدخول، فسيرد الخادم بحالة `401 Unauthorized`). 
* رد الخادم بتنسيق JSON الذي يُعلم عن التوثيق الناجح:

    ```
    {
        "authentication": {
            "token": "some long token",     # قيمة الرمز غير مهمة
            "bid": 1,                       # معرف سلة التسوق للمستخدم
            "umail": "admin@juice-sh.op"    # عنوان البريد الإلكتروني للمستخدم مخزن في معامل umail
        }
    }
    ```

![اعتراض رد خادم API باستخدام تطبيق Wireshark][img-wireshark]