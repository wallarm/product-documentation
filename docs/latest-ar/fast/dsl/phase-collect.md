[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

[img-collect-uniq]:    ../../images/fast/dsl/en/phases/collect-uniq.png

# مرحلة الجمع

!!! info "نطاق المرحلة"
    تُستخدم هذه المرحلة في امتداد تعديلي وهي اختيارية لعمله (قد يكون القسم `collect` غائبًا أو موجودًا في ملف YAML).
    
    كما أن هذه المرحلة تُستخدم بشكل ضمني من قبل امتداد غير تعديلي لأن هذا النوع من الامتدادات يستخدم شرط الفرادة.
    
    اقرأ عن أنواع الامتدادات بالتفصيل [هنا][link-ext-logic].

!!! info "بناء جملة وصف عناصر الطلب"
    عند إنشاء امتداد FAST، يجب أن تفهم بنية الطلب HTTP المرسل إلى التطبيق وبنية الاستجابة HTTP الواردة من التطبيق لكي تصف بشكل صحيح عناصر الطلب التي تحتاج للعمل معها باستخدام النقاط.
    
    لمشاهدة معلومات مفصلة، انتقل إلى هذا [الرابط][link-points].

تجمع هذه المرحلة جميع طلبات الأساس التي تفي بالشرط المحدد. لاتخاذ قرار بشأن جمع الطلب، تستخدم المرحلة معلومات حول الطلبات التي جُمِعَت بالفعل خلال تشغيل الاختبار.

تحدث عملية جمع طلبات الأساس في الوقت الفعلي. سيتم معالجة كل طلب حسب الترتيب الذي يكتب به عقدة FAST طلبات الأساس. لا داعي للانتظار حتى ينتهي عملية كتابة الطلب ليتم معالجة الطلبات وجمعها بواسطة مرحلة الجمع.

## شرط الفرادة

لا يسمح شرط الفرادة بتقدم تلك الطلبات الأساسية التي ليست فريدة وفقًا للمعايير المحددة للمعالجة في المراحل المتبقية. لا يتم إنشاء طلبات اختبار لهذه الطلبات المصفاة. قد يكون هذا مفيدًا لتقليل حمل التطبيق المستهدف في حالة استقباله لعدة طلبات أساسية من النوع نفسه.

يُحدد فرادة كل من الطلبات الواردة على أساس البيانات في الطلبات التي تلقيتها سابقًا.

![مرحلة الجمع مع شرط الفرادة][img-collect-uniq]

تُعرف قائمة العناصر في طلب يجب استخدامها لتحديد فرادة الطلب الأساس في شرط الفرادة.

عند استلام الطلب الأساس، يقوم الامتداد في مرحلة الجمع بالإجراءات التالية لكل من عناصر الطلب في القائمة:
1. إذا لم يكن هناك مثل هذا العنصر في الطلب الأساس، انتقل إلى العنصر التالي في القائمة.
2. إذا كان هناك مثل هذا العنصر في الطلب الأساس وكانت بيانات هذا العنصر فريدة (بمعنى آخر، لا تتطابق مع أي من بيانات الطلبات الأساسية التي تم تلقيها سابقًا)، اعتبر هذا الطلب الأساس فريدًا وانقله إلى المراحل التالية. احفظ بيانات عنصر هذا الطلب.
3. إذا كان هناك مثل هذا العنصر في الطلب الأساس وبيانات هذا العنصر ليست فريدة (بمعنى آخر، تتطابق مع بيانات الطلبات الأساسية التي تم تلقيها سابقًا)، تجاهل هذا الطلب الأساس لأنه لا يفي بشرط الفرادة. لن يتم تنفيذ الامتداد لهذا الطلب.
4. إذا تم الوصول إلى نهاية القائمة ولم يتم العثور على عنصر طلب يمكن فحصه للفرادة، تجاهل هذا الطلب الأساس. لن يتم تنفيذ الامتداد لهذا الطلب.

يمكنك وصف شرط الفرادة في القسم `collect` من ملف YAML الخاص بالامتداد باستخدام قائمة `uniq` التي تحتوي على العناصر التي سيتم تحديد فرادة الطلب الأساس وفقًا لها.

```
collect:
  - uniq:
    - [عنصر الطلب]
    - [عنصر الطلب 1، عنصر الطلب 2، …، عنصر الطلب N]
    - testrun
```  

قد يحتوي عنصر الطلب في القائمة على [تعبيرات منتظمة بتنسيق تعبيرات Ruby المنتظمة][link-ruby-regexp].

يشتمل شرط الفرادة `uniq` على مصفوفة عناصر الطلب التي تحتوي على البيانات المستخدمة للتحقق من فرادة الطلب الأساس. قد يُستخدم أيضًا معلم `testrun`.

تتضمن معلمات شرط الفرادة ما يلي:

* **`- [عنصر الطلب]`**
    
    يجب أن يحتوي الطلب على بيانات فريدة في عنصر الطلب حتى يُعامل الطلب على أنه فريد.
    
    ??? info "مثال"
        `- [GET_uid_value]` — يُحدد فرادة الطلب ببيانات معلمة `uid` GET (بمعنى آخر، يجب أن يتم تشغيل الامتداد لكل من الطلبات الأساس مع قيمة فريدة لمعلمة `uid` GET).

        * `example.com/example/app.php?uid=1` هو طلب فريد.
        * `example.com/demo/app.php?uid=1` ليس طلبًا فريدًا.
        * `example.com/demo/app.php?uid=` هو طلب فريد.
        * `example.org/billing.php?uid=1` ليس طلبًا فريدًا.
        * `example.org/billing.php?uid=abc` هو طلب فريد.

* **`- [عنصر الطلب 1، عنصر الطلب 2، …، عنصر الطلب N]`**
    
    يجب أن يحتوي الطلب على مجموعة من العناصر N، ويجب أن تكون بيانات عنصر الطلب في كل من هذه المجموعات فريدة حتى يُعامل الطلب على أنه فريد.
    
    ??? info "مثال 1"
        `- [GET_uid_value, HEADER_COOKIE_value]` — يُحدد فرادة الطلب ببيانات معلمة `uid` GET وبيانات رأس HTTP `Cookie` (بمعنى آخر، يجب تشغيل الامتداد لكل من الطلبات الأساس مع قيمة فريدة لمعلمة `uid` GET ورأس `Cookie`).

        * `example.org/billing.php?uid=1, Cookie: client=john` هو طلب فريد.
        * `example.org/billing.php?uid=1, Cookie: client=ann` هو طلب فريد.
        * `example.com/billing.aspx?uid=1, Cookie: client=john` ليس طلبًا فريدًا.
    
    ??? info "مثال 2"
        `- [PATH_0_value, PATH_1_value]` — حدد فرادة الطلب بزوج العنصر الأول والثاني من المسار (بمعنى آخر، تشغيل الامتداد لكل من الطلبات الأساس مع قيمة فريدة للزوج الذي يحتوي على معلمات `PATH_0` و `PATH_1`).
            
        يقوم Wallarm بتحليل عناصر الطلب أثناء معالجة العنصر. لكل من مسارات URI على شكل `/en-us/apps/banking/` يضع محلل المسار كل من عناصر المسار في مصفوفة PATH.
            
        يمكنك الوصول إلى قيم كل من عناصر المصفوفة باستخدام مؤشره. للمسار `/en-us/apps/banking/` المذكور سابقًا، يوفر المحلل البيانات التالية:

        * `"PATH_0_value": "en-us"`
        * `"PATH_1_value": "apps"`
        * `"PATH_2_value": "banking"`
            
        وبالتالي، سيُرضي شرط الفرادة لـ `[PATH_0_value, PATH_1_value]` أي طلب يحتوي على قيم مختلفة في العنصر الأول والثاني من المسار.

        * `example.com/en-us/apps/banking/charge.php` هو طلب فريد.
        * `example.com/en-us/apps/banking/vip/charge.php` ليس طلبًا فريدًا.
        * `example.com/de-de/apps/banking/vip/charge.php` هو طلب فريد.
    
* **`- testrun`**
    
    سيتم تنفيذ الامتداد مرة واحدة في تشغيل الاختبار إذا تم إنشاء طلب الاختبار بنجاح (بمعنى آخر، إذا تم تجاوز جميع المراحل الأخرى).
    
    على سبيل المثال، إذا لم يمكن إنشاء طلبات اختبار استنادًا إلى طلب الأساس المستلم بسبب استبعاد الطلبات الأساس في مرحلة المطابقة، فإن الامتداد في مرحلة الجمع يستمر في جمع طلبات الأساس حتى يتم معالجة أحدها من خلال مرحلة المطابقة ثم يتم إنشاء طلبات الاختبار للتطبيق المستهدف استنادًا إليه.
    
    لا يُسمح باستخدام أي من عناصر الطلب في قائمة `uniq` إذا كنت تستخدم بالفعل معامل `testrun`. سيحتوي شرط الفرادة `uniq` على عنصر واحد فقط.
    
    ```
    collect:
      - uniq:
        - testrun 
    ```
    
    إذا كانت هناك عدة عناصر في قائمة `uniq`، فمن الضروري أن يكون لدى الطلب معلم فريد واحد على الأقل من قائمة `uniq` لتحديد الطلب الأساس كفريد. 



!!! info "معلمات مرحلة الجمع"
    حاليًا، يُدعم فقط شرط الفرادة للطلبات الأساسية المستلمة في مرحلة الجمع. في المستقبل، قد يتم توسيع وظيفة هذه المرحلة.