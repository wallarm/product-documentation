[رابط-النقاط]:                  points/intro.md
[رابط-إيقاف-التسجيل]:           ../qsg/test-run.md#2-execute-the-https-baseline-request-you-created-earlier

[وثيقة-تمديد-التعديل]:           extensions-examples/mod-extension.md
[وثيقة-تمديد-غير-التعديل]:       extensions-examples/non-mod-extension.md
[وثيقة-سياسة-الاختبار]:          logic.md#how-test-policy-influences-the-request-processing

[صورة-سياسة-الاختبار-نقاط-الإدراج]:          ../../images/fast/dsl/common/using-extensions/tp_insertion_points.png
[صورة-سياسة-الاختبار-الهجمات]:               ../../images/fast/dsl/common/using-extensions/tp_attacks_test.png
[صورة-إنشاء-اختبار]:             ../../images/fast/dsl/common/using-extensions/create_testrun.png
[صورة-تفاصيل-الاختبار]:          ../../images/fast/dsl/common/using-extensions/testrun_details.png
[صورة-السجل]:                    ../../images/fast/dsl/common/using-extensions/log.png
[صورة-الثغرات]:                  ../../images/fast/dsl/common/using-extensions/vulnerabilities.png
[صورة-تفاصيل-الثغرة-بالتعديل]:       ../../images/fast/dsl/common/using-extensions/vuln_details-mod.png

[مرسى-ربط-التمديدات]:            #connecting-extensions

# استخدام تمديدات FAST

## ربط التمديدات

لكي تستخدم التمديدات التي تم إنشاؤها، ينبغي عليك ربطها بعقدة FAST.

يمكنك القيام بذلك بإحدى الطرق التالية:
* ضع التمديدات في دليل وقم بتركيب هذا الدليل داخل حاوية Docker لعقدة FAST باستخدام خيار `-v` لأمر `docker run`.
    
    ```
    sudo docker run --name <اسم الحاوية> --env-file=<ملف المتغيرات البيئية> -v <دليل التمديدات>:/opt/custom_extensions -p <المنفذ المستهدف>:8080 wallarm/fast
    ```
    
    **مثال:**
    
    قم بتشغيل الأمر أدناه لإطلاق عقدة FAST في حاوية Docker مع الوسائط التالية:

    1.  اسم الحاوية: `fast-node`.
    2.  ملف المتغيرات البيئية: `/home/user/fast.cfg`.
    3.  مسار دليل تمديدات FAST: `/home/user/extensions`.
    4.  المنفذ الذي يتم عليه نشر منفذ `8080` للحاوية: `9090`.

    ```
    sudo docker run --name fast-node --env-file=/home/user/fast.cfg -v /home/user/extensions:/opt/custom_extensions -p 9090:8080 wallarm/fast
    ```

* ضع التمديدات في مستودع Git عام وحدد المتغير البيئي الذي يشير إلى المستودع اللازم داخل حاوية Docker لعقدة FAST.
    
    للقيام بذلك، قم بما يلي:
    
    1.  أضف متغير `GIT_EXTENSIONS` إلى الملف الذي يحتوي على المتغيرات البيئية.

        **مثال:**
        
        إذا كانت التمديدات الخاصة بك موجودة في مستودع Git `https://github.com/wallarm/fast-detects`، فحدد المتغير البيئي التالي:
        
        ```
        GIT_EXTENSIONS=https://github.com/wallarm/fast-detects
        ```  
    
    2.  قم بتشغيل حاوية Docker لعقدة FAST باستخدام الملف الذي يحتوي على المتغيرات البيئية كما يلي:
        
        ```
        sudo docker run --name <اسم الحاوية> --env-file=<ملف المتغيرات البيئية> -p <المنفذ المستهدف>:8080 wallarm/fast
        ```
        
        **مثال:**
        
        قم بتشغيل الأمر أدناه لإطلاق عقدة FAST في حاوية Docker مع الوسائط التالية:

        1.  اسم الحاوية: `fast-node`.
        2.  ملف المتغيرات البيئية: `/home/user/fast.cfg`.
        3.  المنفذ الذي يتم عليه نشر منفذ `8080` للحاوية: `9090`.
        
        ```
        sudo docker run --name fast-node --env-file=/home/user/fast.cfg -p 9090:8080 wallarm/fast
        ```

--8<-- "../include/fast/wallarm-api-host-note.md"

إذا تم إطلاق عقدة FAST بنجاح، فإنها تكتب إلى وحدة التحكم الإخراج التالي الذي يبلغ عن الاتصال الناجح بـ Wallarm Cloud وعدد التمديدات المحملة:

--8<-- "../include/fast/console-include/dsl/fast-node-run-ok.md"

إذا حدث خطأ أثناء إطلاق العقدة، يتم كتابة معلومات الخطأ إلى وحدة التحكم. يتم عرض رسالة عن خطأ في بناء جملة التمديد في المثال التالي:

--8<-- "../include/fast/console-include/dsl/fast-node-run-fail.md"

!!! info "متطلبات موقع التمديدات"
    لن يتم الاتصال بالتمديدات من الدلائل المتداخلة (على سبيل المثال، إذا تم وضع التمديد في دليل `extensions/level-2/`). حسب الطريقة المختارة للاتصال، يجب وضع التمديدات إما في جذر الدليل الذي يتم تركيبه داخل حاوية Docker لعقدة FAST أو في جذر مستودع Git.

## التحقق من عمل التمديدات

للتحقق من عمل التمديدات [`mod-extension.yaml`][وثيقة-تمديد-التعديل] و[`non-mod-extension.yaml`][وثيقة-تمديد-غير-التعديل] التي تم إنشاؤها مسبقًا، قم بالإجراءات التالية:

1.  قم بربط التمديدات بعقدة FAST باتباع [الخطوات المذكورة أعلاه][مرسى-ربط-التمديدات].

2.  أنشئ سياسة الاختبار. سيتم استخدامها من قبل كافة تمديدات FAST المرتبطة بعقدة FAST. المعلومات التفصيلية عن كيفية عمل سياسات الاختبار موجودة [هنا][وثيقة-سياسة-الاختبار].

    لنذكركم بأن التمديد المعدل يغير نقطة `POST_JSON_DOC_HASH_email_value` في طلب الأساس، والتمديد غير المعدل يتطلب الإذن للعمل مع نقطة `URI`.
    
    لذا، لإجراء كلا التمديدين خلال اختبار واحد، يجب أن تسمح سياسة الاختبار بالعمل مع:
    
    * المعلمات POST
    * معلمة URI
    
    ![معالج سياسة الاختبار، علامة التبويب "نقاط الإدراج"][صورة-سياسة-الاختبار-نقاط-الإدراج]
    
    أيضًا، تتحقق التمديدات إذا كان التطبيق عرضة لهجوم SQLi؛ لذلك قد يكون من المفيد فحص التطبيق بحثًا عن ثغرات أخرى باستخدام قاعدة البيانات السريعة لـ Wallarm FAST (على سبيل المثال، RCE). سيساعدك هذا في التأكيد على أن ثغرة SQLi يتم اكتشافها باستخدام التمديدات التي تم إنشاؤها بدلاً من الكشف السريع المضمّن في FAST.
    
    ![معالج سياسة الاختبار، علامة التبويب "الهجمات للاختبار"][صورة-سياسة-الاختبار-الهجمات]
    
    يجب أن تبدو سياسة الاختبار الناتجة كما يلي:
    
    ```
    X-Wallarm-Test-Policy: type=rce; insertion=include:'POST_.*','URI';
    ```

3.  أنشئ اختبارًا لعقدة FAST بناءً على سياسة الاختبار التي تم إنشاؤها.
    
    ![اختبار][صورة-إنشاء-اختبار]

4.  انتظر حتى تكتب عقدة FAST رسالة معلوماتية إلى وحدة التحكم مشابهة للتالي: `Recording baselines for TestRun#`. هذا يعني أن عقدة FAST جاهزة لتسجيل طلبات الأساس.<br>
--8<-- "../include/fast/console-include/dsl/fast-node-recording.md"

5.  أنشئ وأرسل طلب POST بمعلمات عشوائية إلى صفحة تسجيل الدخول في OWASP Juice Shop من خلال عقدة FAST، كما هو موضح في المثال التالي:
    
    ```
    curl --proxy http://<عنوان IP لعقدة FAST> \
        --request POST \
        --url http://ojs.example.local/rest/user/login \
        --header 'accept-language: en-US,en;q=0.9' \
        --header 'content-type: application/json' \
        --header 'host: ojs.example.local' \
        --data '{"email":"test@example.com", "password":"12345"}'
    ```
    
    يمكنك استخدام `curl` أو أدوات أخرى لإرسال الطلب.
    
    !!! info "إيقاف عملية تسجيل طلب الأساس"
        بعد إرسال طلب الأساس، يُنصح بإيقاف عملية التسجيل. يتم وصف هذه الإجراء في [هنا][رابط-إيقاف-التسجيل].

6.  في إخراج وحدة التحكم لعقدة FAST سترى كيف:  

    * يتم اختبار التطبيق المستهدف باستخدام قاعدة البيانات السريعة لـ FAST،
    * يتم تنفيذ تمديد FAST المعدل لمعالم POST في طلب الأساس، و
    * يتم تنفيذ تمديد FAST غير المعدل لمعلمة URI في طلب الأساس.
    --8<-- "../include/fast/console-include/dsl/fast-node-working.md"

    يمكنك مشاهدة السجل الكامل لمعالجة الطلب بفتح معلومات اختبار على واجهة الويب لـ Wallarm والنقر على رابط "تفاصيل".
    
    ![معلومات اختبار مفصلة][صورة-تفاصيل-الاختبار]
    
    ![السجل الكامل لمعالجة الطلب][صورة-السجل]

7.  يمكنك أيضًا مشاهدة معلومات عن الثغرات التي تم اكتشافها بالنقر على الرابط الذي يحتوي على عدد القضايا المكتشفة، على سبيل المثال، "2 قضايا". ستفتح صفحة "الثغرات" على واجهة الويب لـ Wallarm.

    ![الثغرات على واجهة الويب لـ Wallarm][صورة-الثغرات]
    
    ستحتوي أعمدة "المخاطر"، "النوع"، و"العنوان" على القيم التي تم تحديدها في قسم `meta-info` للتمديدات لتلك الثغرات التي تم اكتشافها بمساعدة تمديدات FAST.

8.  يمكنك النقر على ثغرة لعرض معلومات تفصيلية عنها، بما في ذلك وصفها (من قسم `meta-info` لملف التمديد) ومثال على الطلب الذي يستغلها.

    مثال على المعلومات حول ثغرة (تم اكتشافها بواسطة التمديد المعدل):
    
    ![معلومات تفصيلية عن الثغرة][صورة-تفاصيل-الثغرة-بالتعديل]