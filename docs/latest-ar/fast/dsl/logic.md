# منطق الإضافات

يمكن وصف منطق الإضافة باستخدام عدة مراحل:
1. [جمع][link-phase-collect]
2. [مطابقة][link-phase-match]
3. [تعديل][link-phase-modify]
4. [توليد][link-phase-generate]
5. [إرسال][link-phase-send]
6. [كشف][link-phase-detect]

من خلال دمج هذه المراحل، تسمح لك FAST DSL بوصف نوعين من الإضافات:
* الأول يقوم بإنشاء طلب أو أكثر للاختبار من خلال تغيير معطيات طلب الأساس الوارد.

    سيشار إلى هذه الإضافة بـ "إضافة تعديلية" طوال هذا الدليل.

* الثاني يستخدم طلبات اختبار محددة مسبقًا ولا يغير معطيات طلب الأساس الوارد.

    سيشار إلى هذه الإضافة بـ "إضافة غير تعديلية" طوال هذا الدليل.

كل نوع من الإضافات يستخدم مجموعة مختلفة من المراحل. بعض هذه المراحل إجبارية، بينما البعض الآخر ليس كذلك.

استخدام مرحلة الكشف إلزامي لكل نوع من الإضافات. تتلقى هذه المرحلة ردود التطبيق المستهدف على طلبات الاختبار. تستخدم الإضافة هذه الردود لتحديد ما إذا كان التطبيق يحتوي على بعض الثغرات الأمنية. يتم إرسال المعلومات من مرحلة الكشف إلى سحابة Wallarm.

!!! معلومات "تركيبة وصف عناصر الطلب"
    عند إنشاء إضافة FAST، تحتاج إلى فهم بنية طلب HTTP المرسل إلى التطبيق وبنية الرد HTTP المستلم من التطبيق حتى تتمكن من وصف عناصر الطلب التي تحتاج إلى العمل معها باستخدام النقاط بشكل صحيح.
    
    لرؤية معلومات مفصلة، يرجى الانتقال إلى هذا [الرابط][link-points].
 
## كيف تعمل الإضافة التعديلية

 أثناء عمل الإضافة التعديلية، يمر طلب الأساس تسلسلًا عبر مراحل الجمع، والمطابقة، والتعديل، والتوليد، وهي جميعها اختيارية وقد لا تكون مدرجة في الإضافة. نتيجة المرور عبر هذه المراحل سيتم تشكيل طلب اختبار فردي أو عدة طلبات اختبار والتي سيتم إرسالها إلى التطبيق المستهدف لفحصه بحثًا عن الثغرات الأمنية.

!!! معلومات "إضافة بدون المراحل الاختيارية"
    إذا لم تطبق أي من المراحل الاختيارية على طلب الأساس، فإن طلب الاختبار يطابق طلب الأساس.

![نظرة عامة على مراحل الإضافة التعديلية][img-phases-mod-overview]

إذا كان طلب الأساس يستوفي سياسة [اختبار FAST][doc-policy-in-detail] المحددة، فإن الطلب يحتوي على معطيات واحدة أو أكثر مسموح بمعالجتها. تقوم الإضافة التعديلية بتكرار هذه المعطيات:

 1. تمر كل معطية من خلال مراحل الإضافة ويتم إنشاء طلبات الاختبار المقابلة وتنفيذها.
 2. تتابع الإضافة مع المعطية التالية حتى يتم معالجة جميع المعطيات التي تتوافق مع السياسة.

الصورة أدناه تظهر طلب POST مع بعض معطيات POST كمثال.

![نظرة عامة على طريقة عمل الإضافة التعديلية][img-mod-workflow]

## كيف تعمل الإضافة غير التعديلية

أثناء عمل الإضافة غير التعديلية، يمر طلب الأساس عبر مرحلة إرسال واحدة فقط.

أثناء هذه المرحلة، يتم استخراج اسم المضيف أو عنوان IP فقط من قيمة رأس `Host` لطلب الأساس. ثم، يتم إرسال طلبات الاختبار المحددة مسبقًا إلى هذا المضيف.

نظرًا لإمكانية واجهة عقدة FAST بعدة طلبات أساس واردة بنفس قيمة رأس `Host`، تمر هذه الطلبات عبر مرحلة جمع ضمنية لجمع تلك الطلبات التي تحتوي على قيمة فريدة لرأس `Host` (انظر [“شرط الفرادة”][doc-collect-uniq]).

![نظرة عامة على مراحل الإضافة غير التعديلية][img-phases-non-mod-overview]

 عندما تعمل الإضافة غير التعديلية، يتم إرسال واحد أو أكثر من طلبات الاختبار المحددة مسبقًا إلى المضيف المذكور في رأس `Host` لكل طلب أساس يتم معالجته في مرحلة الإرسال:

![نظرة عامة على طريقة عمل الإضافة غير التعديلية][img-non-mod-workflow]


## كيف تعالج الإضافات الطلبات

### معالجة طلب مع عدة إضافات

قد يتم تعريف عدة إضافات للاستخدام من قبل عقدة FAST في نفس الوقت.
كل طلب أساس وارد سيمر من خلال جميع الإضافات المتصلة.

![الإضافات التي يستخدمها العمال][img-workers]

 في كل لحظة من الزمن، تعالج الإضافة طلب أساس واحد. تدعم FAST معالجة الطلبات الأساسية المتوازية؛ كل طلب أساس تم استلامه سيتم إرساله إلى عامل فارغ لتسريع المعالجة. قد يشغل عمال مختلفون نفس الإضافات في نفس الوقت لطلبات أساس مختلفة. تحدد الإضافة ما إذا كان يجب إنشاء طلبات اختبار على أساس طلب الأساس.

 يعتمد عدد الطلبات التي يمكن لعقدة FAST معالجتها بالتوازي على عدد العمال. يتم تحديد عدد العمال بالقيمة المخصصة للمتغير البيئي `WORKERS` عند تنفيذ حاوية Docker الخاصة بعقدة FAST (القيمة الافتراضية للمتغير هي 10).

!!! معلومات "تفاصيل سياسة الاختبار"
    يتوفر وصف أكثر تفصيلًا للعمل مع سياسات الاختبار بالرابط [الرابط][doc-policy-in-detail].