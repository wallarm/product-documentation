[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-logic]:           logic.md
[link-markers]:         detect/markers.md
[link-ext-logic]:       logic.md

[img-generate-methods]:     ../../images/fast/dsl/en/phases/generate-methods.png
[img-generate-payload]:     ../../images/fast/dsl/en/phases/generate-payload.png

# مرحلة التوليد

!!! info "نطاق المرحلة"
    تُستخدم هذه المرحلة في امتداد تعديلي وهي اختيارية لعمله (قد يكون قسم `generate` غائباً أو موجوداً في ملف YAML).

    يجب ألا تكون هذه المرحلة موجودة في ملف YAML الخاص بامتداد غير تعديلي.
    
    اقرأ عن أنواع الامتدادات بالتفصيل [هنا][link-ext-logic].

!!! info "بناء جملة وصف عنصر الطلب"
     عند إنشاء امتداد FAST، تحتاج لفهم بنية الطلب HTTP المرسل إلى التطبيق وبنية الاستجابة HTTP الواردة من التطبيق لتتمكن من وصف عناصر الطلب التي تحتاج للعمل معها باستخدام النقاط بشكل صحيح.
     
     لرؤية معلومات مفصلة، يرجى التوجه إلى هذا [الرابط][link-points].
 
تحدد هذه المرحلة payload ليتم إدراجه في المعايير المحددة لطلب أساسي لإنشاء طلبات اختبار تعتمد على هذا الطلب.

يمتلك قسم `generate` البنية التالية:

```
generate:
  - into:
    - parameter 1
    - parameter 2
    - …
    - parameter N
  - method:
    - postfix
    - prefix
    - random
    - replace
  - payload:
    - payload 1
    - payload 2
    - …
    - payload N
```

* يتيح معامل `into` تحديد عنصر أو عدة عناصر طلب ينبغي إدراج payload فيها. يمكن أن تكون قيمة هذا المعامل نصاً أو مصفوفة من النصوص. يمكنك استخدام تعبير منتظم مهيأ بـRuby كقيمة لمعامل `into`.
    
    هذا المعامل اختياري وقد يكون غائباً في القسم. إذا تم حذف معامل `into`، يتم إدراج payload في عنصر الطلب المسموح بتعديله وفقاً لسياسة الاختبار المعطاة.
    
    لنفترض أن العناصر القابلة للتعديل التالية تم استخراجها من الطلب الأساسي وفقاً لسياسة الاختبار:
    
    * `GET_uid_value`
    * `HEADER_COOKIE_value`
    
    سيقوم الامتداد بمعالجة جميع عناصر الإدراج القابلة للتعديل تباعاً.
    
    إذا كان معامل `into` غائباً، فإن payloads سيتم إدراجها تباعاً في معامل `GET_uid_value` وسيتم استخدام طلبات الاختبار المنتجة للتحقق من التطبيق المستهدف بحثاً عن الثغرات الأمنية. ثم، بعد معالجة نتائج طلب الاختبار، يعالج الامتداد معامل `HEADER_COOKIE_value` ويدرج payloads بشكل مماثل في هذا المعامل.
    
    إذا احتوى معامل `into` على معامل الطلب `GET_uid_value` كما هو موضح في المثال التالي، فإن payload سيتم إدراجه في معامل `GET_uid_value` ولكن ليس في معامل `HEADER_COOKIE_value`.
    
    ```
    into: 
      - 'GET_uid_value'
    ```
    نظراً لأن المثال التالي يحتوي على معامل واحد فقط، يمكن كتابة قيمة معامل into في سطر واحد:
    
    `into: 'GET_uid_value'`

* معامل `method` — يحدد هذا المعامل اختياري قائمة الطرق التي سيتم استخدامها لإدراج payload في عنصر الطلب الأساسي. 
    * `prefix` — إدراج payload قبل قيمة عنصر الطلب الأساسي.
    * `postfix` — إدراج payload بعد قيمة عنصر الطلب الأساسي.
    * `random` — إدراج payload في موضع عشوائي ضمن قيمة عنصر الطلب الأساسي.
    * `replace` — استبدال قيمة عنصر الطلب الأساسي بـpayload.
    
    ![طرق إدراج payload][img-generate-methods]
    
    إذا كان معامل `method` غائباً، سيتم استخدام طريقة `replace` افتراضياً.
    
    يعتمد عدد طلبات الاختبار المنشأة على عدد الطرق المحددة: طلب اختبار واحد لكل طريقة إدراج.
    
    على سبيل المثال، إذا تم تحديد طرق الإدراج التالية:
    
    ```
    method:
      - prefix
      - replace
    ```
    
    ثم لوجود payload واحد، يتم إنشاء طلبان اختبار؛ لوجود payloadان، يتم إنشاء أربعة طلبات اختبار (طلبان اختبار لكل payload)، وهكذا.

* يحدد معامل `payload` قائمة payloads التي سيتم إدراجها في معامل الطلب لإنشاء طلب اختبار سيختبر بعد ذلك التطبيق المستهدف بحثاً عن الثغرات الأمنية.
    
    هذا المعامل إلزامي، ويجب أن يكون دائماً موجوداً في القسم. يجب أن تحتوي القائمة على payload واحد على الأقل. إذا كان هناك عدة payloads، يقوم عقدة FAST بإدراج payloads تباعاً في معامل الطلب ويختبر التطبيق المستهدف بحثاً عن الثغرات الأمنية باستخدام كل من طلبات الاختبار المنشأة.
    
    ![توليد payload][img-generate-payload]
    
    payload هو نص يتم إدراجه في أحد المعاملات أثناء معالجة الطلب.
    
    ??? info "مثال على عدة payloads"
        ```
        payload:
          - "') or 1=('1"
          - "/%5c../%5c../%5c../%5c../%5c../%5c../%5c../etc/passwd/"
        ```
    
    يمكنك استخدام علامات خاصة كجزء من payload لتوسيع إمكانيات اكتشاف الثغرات:

    * **`STR_MARKER`** — إدراج نص عشوائي في payload بالضبط في الموضع الذي يُحدد فيه `STR_MARKER`.
        
        على سبيل المثال، يمكن استخدام `STR_MARKER` لفحص التطبيق بحثاً عن ثغرة XXS.
        
        ??? info "مثال"
            `'userSTR_MARKER'`
    
    * **`CALC_MARKER`** — إدراج نص يحتوي على تعبير حسابي عشوائي (مثلاً، `1234*100`) في payload بالضبط في الموضع الذي يُحدد فيه `CALC_MARKER`.
        
        على سبيل المثال، يمكن استخدام `CALC_MARKER` لفحص التطبيق بحثاً عن ثغرة RCE.
        
        ??? info "مثال"
            `'; bc <<< CALC_MARKER'`
    
    * **`DNS_MARKER`** — إدراج نص يحتوي على نطاق عشوائي (مثلاً، `r4nd0m.wlrm.tl`) في payload بالضبط في الموضع الذي يُحدد فيه `DNS_MARKER`.
        
        على سبيل المثال، يمكن استخدام `DNS_MARKER` لفحص التطبيق بحثاً عن ثغرات Out-of-Bound DNS.

        ??? info "مثال"
            `'; ping DNS_MARKER'`
    
    !!! info "منطق عمل العلامات"
        إذا اكتشفت مرحلة الكشف علامة من أي payload في استجابة الخادم، فإن الهجوم ناجح، ما يعني أن الثغرة الأمنية تم استغلالها بنجاح. لرؤية معلومات مفصلة عن منطق عمل مرحلة الكشف مع العلامات، يرجى التوجه إلى هذا [الرابط][link-markers].