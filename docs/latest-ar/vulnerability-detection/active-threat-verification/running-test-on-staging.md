# إجراء اختبارات التحقق من الهجمات النشطة على الأنظمة غير الإنتاجية <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

يحول [التحقق من الهجمات النشطة من Wallarm](overview.md) المهاجمين إلى اختبارين لاختراق نظامك بأنفسهم. بعد تحليل طلب المهاجم، يصيغ ويختبر طلبات محتملة قد تكشف عن ثغرات في تطبيقك. على الرغم من أن الإعداد الافتراضي يرسل الاختبارات إلى عنوان الطلب الأصلي، توصي Wallarm بتهيئة الوحدة النمطية لتوجيه الاختبارات إلى بيئة تجريبية. تسمح لك هذه التهيئة باستخدام حركة هجوم الإنتاج لاختبار التطبيقات وواجهات برمجة التطبيقات قبل الإنتاج. ترشدك هذه المقالة حول كيفية تهيئة Wallarm لهذا الاستخدام الموصى به.

يمكن أن يشكل الاختبار في بيئة الإنتاج باستخدام بيانات إنتاج حقيقية مخاطر، مثل تسبب توقف الخدمة بسبب الاختبار المكثف أو تسريب بيانات المستخدمين الحقيقيين. إزالة هذه المخاطر تتحقق من خلال الاختبار في بيئة تجريبية أو تطويرية. تسمح لك هذه الطريقة بتجربة الثغرات باستخدام بيانات شبيهة بالإنتاج دون المشاكل المرتبطة بها. إضافة إلى ذلك، فهي تضمن سلامة أنظمتك الحية مع تحديد الثغرات أثناء التطوير.

لتهيئة الوحدة النمطية للاختبارات غير الإنتاجية، اتبع هذه الخطوات:

1. قم بتهيئة استضافة البيئة غير الإنتاجية.
1. قم بتهيئة قطعة تحقق غير إنتاجية أو مفتاح API.
1. قم بتفعيل التحقق من الهجمات النشطة.

يوضح الرسم التوضيحي التالي كيف تعمل الوحدة النمطية في هذا الاستخدام:

![مخطط ATV](../../images/vulnerability-detection/active-threat-verification-scheme-staging.png)

## 1. تهيئة استضافة البيئة غير الإنتاجية

تتيح قاعدة [**إعادة كتابة الهجوم قبل التحقق النشط**](modify-requests-before-replay.md) تعديل عنوان إعادة تشغيل الهجوم من خلال استبدال إما قيمة عنوان `HOST` الأصلية أو مسارات الطلب. لتحقيق ذلك:

1. انتقل إلى واجهة مستخدم Wallarm Console → **القواعد** → قم بإنشاء قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**.
1. قم بملء استمارة إنشاء القاعدة باتباع الإرشادات:

      * **إذا كان الطلب** [يحدد](../../user-guides/rules/rules.md#branch-description) نقاط النهاية التي يجب تطبيق القاعدة عليها.
      * **القواعد** تحدد القيمة الجديدة لعنوان `HOST` أو لمسار الطلب (جزء URL بدون النطاق، مثل، `/test-blogs/new`).

        يجب أن تكون القيمة مفككة ومحددة باستخدام [لغة القالب Liquid](https://shopify.github.io/liquid/) كالتالي: موضوعة في أقواس مزدوجة `{{}}` وعلامات اقتباس فردية `''`. على سبيل المثال: `{{'example.com'}}`.
      
      * **جزء من الطلب**: اختر إما `header: HOST` أو `uri`، اعتمادًا على جزء الطلب الذي تنوي تعديله.
1. انتظر حتى [يكتمل تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

على سبيل المثال، التالي هو القاعدة لتشغيل الهجمات المستهدفة في الأصل `example.com` على بيئة الاختبار `example-test.env.srv.loc`. تنسيق العنوان هو `{{'example-test.env.srv.loc'}}`.

![!مثال على القاعدة التي تعدل HOST](../../images/user-guides/rules/rewrite-request-example-host.png)

## 2. تهيئة قطعة تحقق غير إنتاجية أو مفتاح API

قد تتطلب واجهات برمجة التطبيقات لتطبيقك المصادقة. ومع ذلك، نظرًا لأن الوحدة النمطية [تزيل](overview.md#test-request-security) بيانات التصديق قبل إعادة تشغيل الهجمات، أو لأن بيانات المصادقة الإنتاجية غير صالحة للبيئات التجريبية أو التطويرية، قد تبقى الثغرات غير ملاحظة.

لمعالجة ذلك، ضع في الاعتبار تهيئة معلمات المصادقة المحددة للتحقق من الهجمات النشطة في بيئاتك غير الإنتاجية. يمكن القيام بذلك عندما:

* يتم تضمين البيانات في رؤوس الطلبات، و
* تكون رؤوس الطلبات متسقة بين البيئة الأصلية والبيئة الجديدة غير الإنتاجية.

لا توفر هذه الطريقة الوصول الضروري وحسب، بل تضمن أيضًا أن تتمكن من التحكم في عملية الإعادة بأمان.

لتزويد الطلبات المعاد تشغيلها بتفاصيل المصادقة الضرورية:

1. انتقل إلى واجهة مستخدم Wallarm Console → **القواعد** → قم بإنشاء قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**.
1. قم بملء استمارة إنشاء القاعدة باتباع الإرشادات:

    * **إذا كان الطلب** [يحدد](../../user-guides/rules/rules.md#branch-description) نقاط النهاية التي يجب تطبيق القاعدة عليها.
    * **القواعد** توفر قيمة القطعة أو الرمز المصمم لطلبات التحقق من الهجمات النشطة.

        يجب أن تكون القيمة مفككة ومحددة باستخدام [لغة القالب Liquid](https://shopify.github.io/liquid/) كالتالي: موضوعة في أقواس مزدوجة `{{}}` وعلامات اقتباس فردية `''`. على سبيل المثال: `{{'example.com'}}`.

    * **جزء من الطلب**: اختر `header` وحدد اسم العنوان لتمرير بيانات المصادقة.
1. انتظر حتى [يكتمل تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

على سبيل المثال، التالي هو القاعدة لضمان حمل الهجمات التي يتم إعادة تشغيلها على `example.com` قيمة `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` في عنوان `COOKIE`.

تنسيق قيمة العنوان هو `{{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![!مثال على القاعدة التي تعدل COOKIE](../../images/user-guides/rules/rewrite-request-example-cookie.png)

## 3. تفعيل الوحدة النمطية

بمجرد تحديد جميع الإعدادات الضرورية لتشغيل إعادة تشغيل الهجمات على البيئات غير الإنتاجية، قم بتفعيل الوحدة النمطية لبدء عملية اكتشاف الثغرات:

1. تأكد من أن لديك [خطة اشتراك](../../about-wallarm/subscription-plans.md#subscription-plans) نشطة لـ**Advanced API Security**. الوحدة النمطية متاحة فقط تحت هذه الخطة.

    إذا كنت مشتركًا في خطة مختلفة، يرجى الاتصال بفريق [المبيعات لدينا](mailto:sales@wallarm.com) للانتقال إلى الخطة المطلوبة.
1. انتقل إلى واجهة مستخدم Wallarm Console → **الثغرات** → **تكوين** باتباع الرابط لـ[السحابة الأمريكية](https://us1.my.wallarm.com/vulnerabilities/active?configure=true) أو [السحابة الأوروبية](https://my.wallarm.com/vulnerabilities/active?configure=true)، وقم بتبديل مفتاح التحقق من **الهجمات النشطة**.

![!إعدادات فحص الثغرات](../../images/user-guides/vulnerabilities/vuln-scan-settings.png)

هذا الإجراء يفعل الوحدة النمطية لجميع الموارد حيث يتم تهيئة عقدة التصفية. سيتم تشغيل إعادة الهجمات بالنظر إلى الإعداد الذي حددته مسبقًا.

لديك القدرة على [تفعيل أو تعطيل الوحدة النمطية](enable-disable-active-threat-verification.md) لنقاط نهاية محددة.

## مراقبة ومعالجة الثغرات المكتشفة

يمكنك اختيار تلقي [الإشعارات](../../user-guides/settings/integrations/integrations-intro.md) الفورية بشأن الثغرات المكتشفة إلى أنظمة مثل Splunk وOpsGenie وما إلى ذلك. دمج إشعارات الثغرات في سير العمل اليومي يسرع بشكل كبير من وقت الاستجابة للتهديدات المحتملة.

![تكامل Opsgenie](../../images/user-guides/settings/integrations/add-opsgenie-integration-vulns.png)

يجب إصلاح جميع الثغرات على جانب التطبيق لأنها تجعل نظامك أكثر عرضة للأعمال الخبيثة. إذا لم يمكن إصلاح ثغرة ما، يمكن لقاعدة [التصحيح الافتراضي](../../user-guides/rules/vpatch-rule.md) أن تساعد في منع الهجمات المتعلقة والقضاء على خطر الحادث.

تُدرج الثغرات المكتشفة أيضًا في قسم [**الثغرات**](../../user-guides/vulnerabilities.md) في واجهة مستخدم Wallarm Console. هنا يمكنك تحليلها وإدارتها.

![علامة التبويب الثغرات](../../images/user-guides/vulnerabilities/check-vuln.png)