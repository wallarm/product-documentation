# إجراء اختبارات تحقق من التهديدات النشطة على الأنظمة غير الإنتاجية <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

[تحقق وولارم من التهديدات النشطة](overview.md) يحول المهاجمين إلى فاحصي الاختراق الخاصين بك. بعد تحليل طلب المهاجم، يصمم ويختبر طلبات محتملة تكشف عن الثغرات في تطبيقك. بينما يقوم التكوين الافتراضي بإرسال الاختبارات إلى عنوان الطلب الأصلي، توصي وولارم بتكوين الوحدة لإعادة توجيه الاختبارات إلى بيئة تجريبية. يسمح هذا التكوين باستخدام حركة المرور للهجمات الإنتاجية لاختبار التطبيقات وواجهات برمجة التطبيقات قبل الإنتاج. يرشدك هذا المقال على كيفية تكوين وولارم لهذا الاستخدام الموصى به.

الاختبار في بيئة الإنتاج باستخدام بيانات الإنتاج الحقيقية قد يشكل مخاطر، مثل تسبب توقف بسبب الاختبار المكثف أو تعريض بيانات المستخدم الحقيقية للخطر. يعمل الاختبار في بيئة تجريبية أو تطوير على القضاء على هذه المخاطر. يتيح لك هذا النهج اختبار الثغرات باستخدام بيانات شبيهة بالإنتاج دون المشكلات المرتبطة بها. بالإضافة إلى ذلك، يضمن سلامة أنظمتك الحية مع التعرف على الثغرات أثناء التطوير.

لضبط الوحدة للاختبارات غير الإنتاجية، اتبع الخطوات التالية:

1. قم بتكوين مضيف بيئة غير إنتاجية.
1. قم بتكوين ملف تعريف ارتباط للمصادقة غير الإنتاجية أو مفتاح API.
1. مكّن التحقق من التهديد النشط.

يوضح الرسم التخطيطي التالي كيفية عمل الوحدة في هذا السيناريو:

![مخطط ATV](../../images/vulnerability-detection/active-threat-verification-scheme-staging.png)

## 1. تكوين مضيف بيئة غير إنتاجية

قاعدة [**إعادة كتابة الهجوم قبل التحقق النشط**](modify-requests-before-replay.md) تسمح لك بتعديل عنوان إعادة تشغيل الهجوم عن طريق استبدال إما قيمة الرأس `HOST` الأصلية أو مسارات الطلب. لتحقيق هذا:

1. الانتقال إلى وحدة التحكم وولارم → **القواعد** → إنشاء القاعدة **إعادة كتابة الهجوم قبل التحقق النشط**.
1. ملء نموذج إنشاء القاعدة وفقا للتعليمات:

      * **إذا كان الطلب** [يحدد](../../user-guides/rules/rules.md#branch-description) نقاط النهاية لتطبيق القاعدة عليها.
      * **القواعد** تحدد القيمة الجديدة لرأس `HOST` أو لمسار الطلب (قطاع URL بدون النطاق، مثل، `/test-blogs/new`).

        يجب فك تشفير القيمة وضبطها باستخدام [لغة القوالب Liquid](https://shopify.github.io/liquid/) كالتالي: وضعها في أقواس مزدوجة `{{}}` وعلامات اقتباس فردية `''`. على سبيل المثال: `{{'example.com'}}`.
      
      * **جزء من الطلب**: اختر إما `header: HOST` أو `uri`، بناءً على جزء الطلب الذي تنوي تعديله.
1. انتظر [اكتمال تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

على سبيل المثال، القاعدة التالية لتشغيل الهجمات الموجهة في الأصل إلى `example.com` على بيئة الاختبار `example-test.env.srv.loc`. صيغة العنوان هي `{{'example-test.env.srv.loc'}}`.

![!مثال على القاعدة التي تعدل HOST](../../images/user-guides/rules/rewrite-request-example-host.png)

## 2. تكوين ملف تعريف ارتباط أو مفتاح API لتسجيل الدخول غير إنتاجي

قد تتطلب واجهات برمجة تطبيقات تطبيقك المصادقة. ومع ذلك، نظرًا لأن الوحدة [تزيل](overview.md#test-request-security) بيانات المصادقة قبل إعادة تشغيل الهجمات، أو لأن بيانات المصادقة الإنتاجية غير صالحة لبيئات التجريب والتطوير، قد لا يتم اكتشاف الثغرات.

لمعالجة هذا، ضع في اعتبارك ضبط معاملات مصادقة محددة للتحقق من التهديد النشط في بيئاتك غير الإنتاجية. يمكن القيام بذلك عندما:

* يتم تضمين البيانات في رؤوس الطلبات، و
* رؤوس الطلبات متسقة بين البيئات الأصلية والجديدة غير الإنتاجية.

هذه الطريقة لا توفر الوصول الضروري فحسب، بل تضمن أيضًا أنك يمكنك التحكم بأمان في عملية إعادة التشغيل.

لتزويد الطلبات المعاد تشغيلها بتفاصيل المصادقة الضرورية:

1. الانتقال إلى وحدة التحكم وولارم → **القواعد** → إنشاء القاعدة **إعادة كتابة الهجوم قبل التحقق النشط**.
1. ملء نموذج إنشاء القاعدة وفقا للتعليمات:

    * **إذا كان الطلب** [يحدد](../../user-guides/rules/rules.md#branch-description) نقاط النهاية لتطبيق القاعدة عليها.
    * **القواعد** توفر قيمة ملف التعريف أو الرمز المصممة لطلبات التحقق من التهديد النشط.

        يجب فك تشفير القيمة وضبطها باستخدام [لغة القوالب Liquid](https://shopify.github.io/liquid/) كالتالي: وضعها في أقواس مزدوجة `{{}}` وعلامات اقتباس فردية `''`. على سبيل المثال: `{{'example.com'}}`.

    * **جزء من الطلب**: اختر `header` وأشر إلى اسم الرأس لتمرير بيانات المصادقة.
1. انتظر [اكتمال تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

على سبيل المثال، القاعدة التالية لضمان أن الهجمات المعاد تشغيلها على `example.com` تحمل القيمة `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` في رأس `COOKIE`.

صيغة قيمة الرأس هي `{{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![!مثال على القاعدة التي تعدل COOKIE](../../images/user-guides/rules/rewrite-request-example-cookie.png)

## 3. تمكين الوحدة

بمجرد أن تحدد كل الإعدادات الضرورية لتشغيل إعادة تشغيل الهجمات على بيئات غير إنتاجية، مكّن الوحدة لبدء عملية الكشف عن الثغرات:

1. تأكد من وجود [خطة الاشتراك](../../about-wallarm/subscription-plans.md#subscription-plans) **الأمان المتقدم لواجهة برمجة التطبيقات** النشطة لديك. الوحدة متاحة فقط تحت هذه الخطة.

    إذا كنت في خطة مختلفة، يرجى التواصل مع فريق [المبيعات](mailto:sales@wallarm.com) للانتقال إلى الخطة المطلوبة.
1. الانتقال إلى وحدة التحكم وولارم → **الثغرات الأمنية** → **تكوين** عن طريق اتباع الرابط لـ[السحابة الأمريكية](https://us1.my.wallarm.com/vulnerabilities/active?configure=true) أو [السحابة الأوروبية](https://my.wallarm.com/vulnerabilities/active?configure=true)، وتفعيل مفتاح **التحقق من التهديد النشط**.

![إعدادات فحص الثغرات](../../images/user-guides/vulnerabilities/vuln-scan-settings.png)

هذا الإجراء يمكّن الوحدة لجميع الموارد حيث يتم تكوين العقدة التصفية. سيتم تشغيل إعادة تشغيل الهجوم مع الأخذ في الاعتبار الإعداد الذي حددته من قبل.

لديك القدرة على [تمكين أو تعطيل الوحدة](enable-disable-active-threat-verification.md) لنقاط النهاية المحددة.

## مراقبة ومعالجة الثغرات الأمنية المكتشفة

يمكنك اختيار تلقي [إشعارات](../../user-guides/settings/integrations/integrations-intro.md) في الوقت المناسب بخصوص الثغرات الأمنية المكتشفة إلى أنظمة مثل Splunk، OpsGenie، وغيرها. تكامل إشعارات الثغرات الأمنية في سير عملك اليومي يسرع بشكل كبير من وقت استجابتك للتهديدات المحتملة.

![تكامل Opsgenie](../../images/user-guides/settings/integrations/add-opsgenie-integration-vulns.png)

يجب إصلاح جميع الثغرات الأمنية على جانب التطبيق لأنها تجعل نظامك أكثر عرضة للأعمال الخبيثة. إذا لم يكن بالإمكان إصلاح ثغرة أمنية، يمكن أن تساعد قاعدة [التصحيح الافتراضي](../../user-guides/rules/vpatch-rule.md) في منع الهجمات المتعلقة والقضاء على خطر وقوع حادث.

يتم أيضًا تسجيل الثغرات الأمنية المكتشفة في قسم [**الثغرات الأمنية**](../../user-guides/vulnerabilities.md) في واجهة المستخدم لوحدة التحكم وولارم. هنا يمكنك تحليلها وإدارتها.

![علامة التبويب الثغرات الأمنية](../../images/user-guides/vulnerabilities/check-vuln.png)