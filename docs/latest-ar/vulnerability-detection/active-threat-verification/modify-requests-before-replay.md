# إعادة صياغة الطلبات قبل إعادة تشغيل الهجوم <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

يمكنك تعديل الطلبات التي يستخدمها وحدة [التحقق من التهديدات النشطة بواسطة Wallarm](overview.md) لإعادة تشغيل الهجوم. قد يكون هذا مفيدًا بشكل خاص عند استبدال بيانات المصادقة الأصلية ببيانات اختبار أو عند إجراء إعادة تشغيل الهجمات على عناوين بديلة. يقدم هذا الدليل التعليمات حول كيفية تحقيق ذلك.

بشكل افتراضي، تحتفظ الوحدة ببيانات الطلب الأصلية، باستثناء [إزالة معلمات المصادقة المحددة](overview.md#test-request-security). يُستخدم قانون **إعادة كتابة الهجوم قبل التحقق النشط** لتعديل عناصر الطلب الأصلية قبل إنشاء مجموعة اختبار الهجوم استنادًا إليها. يمكن تعديل العناصر التالية:

* الرأس مع بيانات المصادقة للطلب لاستبدال [بيانات المصادقة الأصلية ببيانات الاختبار](#replacing-original-authentication-data-with-test-data).
* الرأس `HOST`. على سبيل المثال، يمكن تعديل الرأس `HOST` لإعادة تشغيل الهجوم على [بيئة التجريب أو الاختبار](#modifying-the-application-address-for-attack-replaying).
* المسار لـ [إعادة كتابة عنوان التطبيق المستخدم لإعادة تشغيل الهجوم](#modifying-the-application-address-for-attack-replaying).

!!! تحذير "تعديل أي عنصر طلب أصلي"
    يسمح القانون بتعديل الرؤوس (`header`) والمسارات (`uri`) فقط للطلبات الأصلية. لا يمكن تعديل العناصر الأخرى للطلب أو إضافتها.

## إنشاء وتطبيق القاعدة

لإنشاء وتطبيق قانون **إعادة كتابة الهجوم قبل التحقق النشط**:

1. انتقل إلى وحدة التحكم Wallarm → **القواعد** → إنشاء قانون **إعادة كتابة الهجوم قبل التحقق النشط**.
1. املأ استمارة إنشاء القانون اتباعًا للتعليمات:

      * **إذا كان الطلب** [يحدد](../../user-guides/rules/rules.md#branch-description) نقاط النهاية لتطبيق القانون عليها.
      * **القواعد** تحدد القيمة الجديدة للمعلمة المختارة في حقل **جزء من الطلب**. سيتم استخدام قيمة محددة عند إعادة تشغيل الهجوم.

        يجب فك تشفير القيمة وتعيينها باستخدام [لغة القالب Liquid](https://shopify.github.io/liquid/) على النحو التالي: موضوعة في أقواس مزدوجة `{{}}` واقتباسات مفردة `''`. على سبيل المثال: `{{'example.com'}}`.

        لاستبدال مسار الطلب الأصلي (`uri`)، يجب عليك تمرير القيمة الكاملة للمسار الجديد.

      * **جزء من الطلب** يشير إلى عنصر الطلب الأصلي الذي يجب تعديله قبل إعادة تشغيل الهجوم. تأكد من أن هذا العنصر موجود في الطلبات الأصلية حيث سيتم استبدال القيم الأصلية.

        !!! تحذير "القيم الممكنة"
            القيم المقبولة الوحيدة لحقل **جزء من الطلب** هي `header` و `uri`. لا يُسمح بأي قيم أخرى.

1. انتظر حتى [اكتمال تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

لتعيين العديد من الشروط لتعديل الطلب الأصلي أو لاستبدال قيم عدة عناصر في الطلب، قد تُنشئ عدة قواعد.

## أمثلة على القاعدة

### استبدال بيانات المصادقة الأصلية ببيانات اختبار

قد تطلب واجهات برمجة التطبيقات الخاصة بتطبيقك المصادقة. ومع ذلك، نظرًا لأن الوحدة [تزيل](overview.md#test-request-security) هذه البيانات قبل إعادة تشغيل الهجمات، قد لا يتم اكتشاف نقاط الضعف. لمعالجة هذا، ضع في اعتبارك إنشاء معلمات مصادقة محددة للتحقق من التهديدات النشطة عندما يتم تمرير هذه البيانات في رؤوس الطلبات. هذا النهج لا يمنح الوصول اللازم فحسب، بل يتيح لك أيضًا التحكم وتأمين عملية إعادة التشغيل.

لتزويد الطلبات المعاد تشغيلها بتفاصيل المصادقة اللازمة، قد تضيف قيم الاختبار لهذه المعلمات باستخدام قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**. على سبيل المثال: مفتاح API، الرمز، كلمة المرور أو معلمات أخرى.

على سبيل المثال، القاعدة التالية تضمن أن الهجمات المعاد تشغيلها على example.com تحمل القيمة `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` في رأس `COOKIE`. صيغة قيمة الرأس هي {`{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![مثال على القاعدة التي تعدل COOKIE](../../images/user-guides/rules/rewrite-request-example-cookie.png)

### تعديل عنوان التطبيق لإعادة تشغيل الهجوم

بشكل افتراضي، يتم إرسال الهجمات المعاد تشغيلها إلى عنوان التطبيق والمسار الممرر في الطلب الأصلي. يمكنك استبدال عنوان ومسار الأصليين بقيم أخرى سيتم استخدامها عند إعادة تشغيل الهجوم. يتم استبدال القيم باستخدام قاعدة **إعادة كتابة الهجوم قبل التحقق النشط** بالطريقة التالية:

* استبدال القيمة الأصلية لرأس `HOST` بعنوان مثيل تطبيق مختلف. على سبيل المثال، يمكن أن يكون مثيل التطبيق المنفصل بيئة تجريبية أو اختبارية.
* استبدال مسار الطلب الأصلي بمسار البيئة التجريبية أو الاختبارية، أو بمسار إلى الخادم الهدف لتجاوز الخادم الوكيل عند إعادة تشغيل الهجوم.

لتبديل كل من قيمة رأس `HOST` ومسار الطلب الأصلي، ستحتاج إلى إنشاء قاعدتين منفصلتين بنوع الإجراء **إعادة كتابة الهجوم قبل التحقق النشط**.

على سبيل المثال، تضبط القاعدة التالية الوحدة لإعادة تشغيل الهجمات التي أُرسلت أصلاً إلى `example.com` على بيئة الاختبار `example-test.env.srv.loc`. صيغة العنوان هي `{{'example-test.env.srv.loc'}}`.

![مثال على القاعدة التي تعدل HOST](../../images/user-guides/rules/rewrite-request-example-host.png)