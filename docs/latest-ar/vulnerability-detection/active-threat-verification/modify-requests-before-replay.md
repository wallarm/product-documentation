# إعادة كتابة الطلبات قبل إعادة تشغيل الهجوم <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

يمكنك تعديل الطلبات المستخدمة بواسطة وحدة [تحقق التهديدات النشطة من Wallarm](overview.md) لإعادة تشغيل الهجوم. يكون ذلك مفيدًا بشكل خاص عند استبدال بيانات المصادقة الأصلية ببيانات اختبار، أو إجراء إعادات تشغيل الهجمات على عناوين بديلة. يوفر هذا الدليل تعليمات حول كيفية تحقيق ذلك.

بشكل افتراضي، تحتفظ الوحدة ببيانات الطلب الأصلية، باستثناء [إزالة معايير المصادقة المحددة](overview.md#test-request-security). يُستخدم قاعدة **إعادة كتابة الهجوم قبل التحقق النشط** لتعديل عناصر الطلب الأصلية قبل إنشاء مجموعة اختبارات الهجوم بناءً عليها. يمكن تعديل العناصر التالية:

* الرأس مع بيانات المصادقة للطلب لاستبدال [بيانات المصادقة الأصلية ببيانات الاختبار](#replacing-original-authentication-data-with-test-data).
* رأس `HOST`. على سبيل المثال، يمكن تعديل الرأس `HOST` لإعادة تشغيل الهجوم على [بيئة المرحلة أو الاختبار](#modifying-the-application-address-for-attack-replaying).
* المسار لـ[إعادة كتابة عنوان التطبيق المستخدم لإعادة تشغيل الهجوم](#modifying-the-application-address-for-attack-replaying).

!!! تحذير "تعديل أي عنصر من عناصر الطلب الأصلي"
    تسمح القاعدة بتعديل الرؤوس (`header`) والمسارات (`uri`) للطلبات الأصلية فقط. لا يمكن تعديل عناصر الطلب الأخرى أو إضافتها.

## إنشاء وتطبيق القاعدة

لإنشاء وتطبيق قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**:

1. انتقل إلى وحدة تحكم Wallarm → **القواعد** → إنشاء قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**.
1. املأ نموذج إنشاء القاعدة باتباع التعليمات:

      * **إذا كان الطلب** [يُحدد](../../user-guides/rules/rules.md#rule-branches) نقاط النهاية لتطبيق القاعدة عليها.
      * **القواعد** تحدد القيمة الجديدة للمعامل المختار في حقل **جزء من الطلب**. ستُستخدم قيمة مُحددة عند إعادة تشغيل الهجوم.

        يجب أن تُفك ترميز القيمة وتُحدد باستخدام [لغة القوالب Liquid](https://shopify.github.io/liquid/) كما يلي: موضوعة في أقواس مزدوجة `{{}}` واقتباسات واحدة `''`. على سبيل المثال: `{{'example.com'}}`.

        لاستبدال مسار الطلب الأصلي (`uri`)، يجب تمرير القيمة الكاملة للمسار الجديد.

      * **جزء من الطلب** يشير إلى عنصر الطلب الأصلي الذي يجب تعديله قبل إعادة تشغيل الهجوم. تأكد من وجود هذا العنصر في الطلبات الأصلية حيث سيتم استبدال القيم الأصلية.

        !!! تحذير "القيم الممكنة"
            القيم المقبولة الوحيدة لحقل **جزء من الطلب** هي `header` و`uri`. لا تُسمح بقيم أخرى.

1. انتظر [اكتمال تجميع القاعدة](../../user-guides/rules/rules.md#ruleset-lifecycle).

لتحديد شروط عدة لتعديل الطلب الأصلي أو لاستبدال قيم عناصر الطلب العديدة، قد تحتاج إلى إنشاء قواعد عدة.

## أمثلة على القواعد

### استبدال بيانات المصادقة الأصلية ببيانات الاختبار

قد تتطلب واجهات برمجة التطبيقات لتطبيقك المصادقة. ومع ذلك، نظرًا إلى أن الوحدة [تزيل](overview.md#test-request-security) هذه البيانات قبل إعادة تشغيل الهجمات، قد تظل الثغرات الأمنية غير مكتشفة. لمعالجة هذا، ضع في اعتبارك إنشاء معايير مصادقة محددة للتحقق من التهديدات النشطة عند تمرير هذه البيانات في رؤوس الطلبات. لا يمنح هذا النهج الوصول اللازم فحسب، بل يتيح لك أيضًا التحكم في عملية إعادة اللعب وتأمينها.

لتزويد الطلبات المعاد تشغيلها بتفاصيل المصادقة اللازمة، يمكنك إضافة قيم اختبار لهذه المعايير باستخدام قاعدة **إعادة كتابة الهجوم قبل التحقق النشط**. على سبيل المثال: مفتاح API، رمز، كلمة مرور أو معايير أخرى.

على سبيل المثال، القاعدة التالية تضمن أن الهجمات المعاد تشغيلها على example.com تحمل القيمة `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` في رأس `COOKIE`. صيغة قيمة الرأس هي {`{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![مثال على القاعدة التي تعديل COOKIE](../../images/user-guides/rules/rewrite-request-example-cookie.png)

### تعديل عنوان التطبيق لإعادة تشغيل الهجوم

بشكل افتراضي، يتم إرسال الهجمات المعاد تشغيلها إلى عنوان التطبيق والمسار الممرر في الطلب الأصلي. يمكنك استبدال العنوان الأصلي والمسار بقيم أخرى سيتم استخدامها عند إعادة تشغيل الهجوم. يتم استبدال القيم باستخدام قاعدة **إعادة كتابة الهجوم قبل التحقق النشط** على النحو التالي:

* استبدال القيمة الأصلية للرأس `HOST` بعنوان مثيل تطبيق مختلف. على سبيل المثال، يمكن أن يكون مثيل التطبيق المنفصل بيئة مرحلية أو بيئة اختبار.
* استبدال مسار الطلب الأصلي بمسار إلى بيئة الاختبار أو المرحلة، أو إلى مسار الخادم الهدف لتجاوز الخادم الوكيل عند إعادة تشغيل الهجوم.

لتحل محل كل من قيمة رأس `HOST` ومسار الطلب الأصلي، ستحتاج إلى إنشاء قاعدتين منفصلتين بنوع الإجراء **إعادة كتابة الهجوم قبل التحقق النشط**.

على سبيل المثال، تُحدد القاعدة التالية وحدة لإعادة تشغيل الهجمات التي أُرسلت أصلاً إلى `example.com` على بيئة الاختبار `example-test.env.srv.loc`. صيغة العنوان هي `{{'example-test.env.srv.loc'}}`.

![مثال على القاعدة التي تُعدل HOST](../../images/user-guides/rules/rewrite-request-example-host.png)