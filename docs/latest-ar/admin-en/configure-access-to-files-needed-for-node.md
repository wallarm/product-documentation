# تهيئة حقوق الوصول للملفات اللازمة لتشغيل العقدة

عادة ما يُمنح خدمتي `wallarm-worker` و `nginx` الإذن تلقائيًا لقراءة محتوى الملفات الضرورية لتشغيل عقدة التصفية، مثل proton.db وملف مجموعة القواعد الخاصة. ومع ذلك، إذا أظهرت الاختبارات عدم وجود وصول، اقرأ الوصف أدناه لكيفية توفير الأذونات وكيف يمكن تهيئتها يدويًا.

## تهيئة وصول الملفات

يمكن تعيين المعلمات الخاصة بتشغيل العقدة بشكل صريح في `node.yaml`، الذي يتم إنشاؤه تلقائيًا بواسطة سكربت `register-node`.

* بالنسبة لتثبيت صورة Docker NGINX أو صورة السحابة أو التثبيت الشامل، ابحث عن الملف في `/opt/wallarm/etc/wallarm/node.yaml`، ما لم يتم تجاوزه بواسطة التوجيه [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).
* بالنسبة للتثبيتات الأخرى، يقع في `/etc/wallarm/node.yaml`، ما لم يتم تجاوزه بواسطة التوجيه [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).

قد يحتوي ملف `node.yaml` على المعلمات التالية لوصول الملفات:

| المعلمة             | الوصف |
|---------------------|--------|
| `syncnode.owner` | مالك الملفات اللازمة لتشغيل عقدة التصفية. |
| `syncnode.group` | المجموعة للملفات اللازمة لتشغيل عقدة التصفية. |
| `syncnode.mode`  | حقوق الوصول للملفات اللازمة لتشغيل عقدة التصفية. |

يبحث الخوارزمية عن أذونات الملفات بأداء الخطوات التالية (ينتقل إلى الخطوة التالية فقط إذا لم تعطِ الخطوة السابقة النتيجة):

1. المعلمات `syncnode.(النوع).(user,group,mode)` المُعدة بشكل صريح في ملف `node.yaml`.

    `(النوع)` يتيح لك تحديد الملف الخاص الذي تم تعيين المعلمة له. القيم الممكنة هي `proton.db` أو `lom`.

    !!! تحذير "معنى قيمة `lom`"
        لاحظ أن قيمة `lom` تشير إلى ملف [مجموعة القواعد الخاصة](../user-guides/rules/rules.md#ruleset-lifecycle) `/etc/wallarm/custom_ruleset` (`/opt/wallarm/etc/wallarm/custom_ruleset` لتثبيت صورة Docker NGINX أو التثبيت الشامل).

1. المعلمات `syncnode.(user,group,mode)` المُعدة بشكل صريح في ملف `node.yaml`.
1. بالنسبة لتثبيت NGINX، قيمة `nginx_group` في الملف `/usr/share/wallarm-common/engine/*`.

    توفر جميع الحزم المُثبتة للمحرك الملف `/usr/share/wallarm-common/engine/*` الذي يحتوي على `nginx_group=<VALUE>`.

    تُعدِل كل حزمة مع الوحدة النمطية قيمة `المجموعة` حسب NGINX الذي كانت مُعدة لأجله:

    * الوحدات النمطية لـ NGINX من nginx.org تضع `المجموعة` على `nginx`.
    * الوحدات النمطية لتوزيعات NGINX تضع `المجموعة` على `www-data`.
    * الوحدات النمطية المخصصة تستخدم القيم التي يوفرها العميل.
    
1. القيم الافتراضية:
    * `مالك`: `root`
    * `مجموعة`: `wallarm`
    * `وضع`: `0640`

لاحظ أنه يلزمك تكوين حقوق الوصول بشكل صريح فقط إذا لم تناسب النتيجة التي تم تحقيقها تلقائيًا احتياجاتك. بعد تكوين حقوق الوصول، تأكد من أن خدمتي `wallarm-worker` و `nginx` يمكنهما قراءة محتوى الملفات اللازمة لتشغيل عقدة التصفية.

## مثال على التكوين

لاحظ أنه إلى جانب معلمات وصول الملفات (قسم `syncnode`، المُوصوف في هذا المقال)، سيحتوي ملف `node.yaml` أيضًا على معلمات توفر لعقدة التصفية [وصولًا إلى السحابة](configure-cloud-node-synchronization-en.md) (أقسام عامة و `api`).

--8<-- "../include/node-cloud-sync-configuration-example.md"