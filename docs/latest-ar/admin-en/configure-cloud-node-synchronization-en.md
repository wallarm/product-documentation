# تكوين التزامن بين عقدة Wallarm والسحابة

تتزامن عقدة الفلترة بانتظام مع سحابة Wallarm لـ:

* الحصول على تحديثات لـ[قواعد معالجة الحركة (LOM)](../about-wallarm/protecting-against-attacks.md#custom-rules-for-request-analysis)
* الحصول على تحديثات [proton.db](../about-wallarm/protecting-against-attacks.md#library-libproton)
* إرسال بيانات حول الهجمات والثغرات المكتشفة
* إرسال مقاييس للحركة المعالجة

تصف هذه التعليمات المعايير والأساليب المستخدمة لتكوين تزامن عقدة الفلترة وسحابة Wallarm.

## معايير الوصول

تُعدّ المعايير مثل اسم عقدة الفلترة، UUID، ومفتاح السري لـ API Wallarm، والتي تمكن عقدة الفلترة من الوصول إلى السحابة، معيّنة بوضوح في `node.yaml`. يتم إنشاء هذا الملف تلقائيًا بواسطة السكربت `register-node`.

* بالنسبة لتثبيتات صورة Docker NGINX-based، صورة السحابة وجميع المثبتات الشاملة، يمكن العثور على الملف في `/opt/wallarm/etc/wallarm/node.yaml`، إلا إذا تم تجاوزه بواسطة الأمر [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).
* للتثبيتات الأخرى، يقع في `/etc/wallarm/node.yaml`، إلا إذا تم تجاوزه بواسطة الأمر [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).

قد يحتوي الملف `node.yaml` على المعايير الوصول التالية:

| المعيار        | الوصف                                                                           | القيمة الافتراضية     |
| ------------- | ------------------------------------------------------------------------------- | -------------------- |
| `hostname`    | اسم عقدة الفلترة. من ال**ضروري** تعيين هذا المتغير في ملف `node.yaml`.          | مقدمة بواسطة `register-node` |
| `regtoken`    | رمز للعقدة لكي تتمكن من الوصول إلى API Wallarm.                                | مقدمة بواسطة `register-node` |
| `uuid`        | UUID لعقدة الفلترة. من ال**ضروري** تعيين هذا المتغير في ملف `node.yaml`.       | مقدمة بواسطة `regtoken` |
| `secret`      | مفتاح السر للوصول إلى API Wallarm. من ال**ضروري** تعيين هذا المتغير في ملف `node.yaml`. | مقدمة بواسطة `regtoken` |
| `api.host`    | نقطة نهاية API Wallarm. يمكن أن تكون:<ul><li>`us1.api.wallarm.com` لسحابة الولايات المتحدة</li><li>`api.wallarm.com` لسحابة الاتحاد الأوروبي</li></ul> | `api.wallarm.com` |
| `api.port`    | منفذ API Wallarm.                                                                | `443`               |
| `api.use_ssl` | ما إذا كان يتم استخدام SSL عند الاتصال بـ API Wallarm.                        | `true`              |
| `api.ca_verify` | ما إذا كان سيتم تمكين/تعطيل التحقق من شهادة خادم API Wallarm. يمكن أن تكون:<ul><li>`true` لتمكين التحقق</li><li>`false` لتعطيل التحقق</li></ul>. | `true`              |
| `api.ca_file` | مسار ملف شهادة SSL.                                                             | `/usr/share/wallarm-common/ca.pem` |
| `api.localhost` | عنوان IP المحلي لواجهة الشبكة التي يتم من خلالها إرسال الطلبات إلى API Wallarm. هذا المعيار مطلوب إذا كانت واجهة الشبكة المستخدمة بشكل افتراضي تحد من الوصول إلى API Wallarm (على سبيل المثال، قد يتم إغلاق الوصول إلى الإنترنت). | - |
| `api.localport` | منفذ واجهة الشبكة التي يتم من خلالها إرسال الطلبات إلى API Wallarm. هذا المعيار مطلوب إذا كانت واجهة الشبكة المستخدمة بشكل افتراضي تحد من الوصول إلى API Wallarm (على سبيل المثال، قد يتم إغلاق الوصول إلى الإنترنت). | - |

لتغيير معايير التزامن، اتبع الخطوات التالية:

1. قم بإجراء التغييرات على ملف `node.yaml` بإضافة المعايير المطلوبة وتعيين القيم المرغوبة لها.
1. أعد تشغيل NGINX لتطبيق الإعدادات المحدثة على عملية التزامن:

    --8<-- "../include/waf/restart-nginx-4.4-and-above.md"

## فاصل التزامن

بشكل افتراضي، تتزامن عقدة الفلترة مع سحابة Wallarm كل 120-240 ثانية (2-4 دقائق). يمكنك تغيير فاصل التزامن عبر متغير البيئة النظام `WALLARM_SYNCNODE_INTERVAL`.

لتغيير الفاصل الزمني بين تزامن عقدة الفلترة وسحابة Wallarm:

1. افتح الملف `/etc/environment`.
2. أضف متغير `WALLARM_SYNCNODE_INTERVAL` إلى الملف وقم بتعيين قيمة مرغوبة للمتغير بالثواني. لا يمكن أن تكون القيمة أقل من القيمة الافتراضية (`120` ثانية). على سبيل المثال:

    ```bash
    WALLARM_SYNCNODE_INTERVAL=800
    ```
3. احفظ الملف `/etc/environment` المعدل. سيتم تطبيق قيمة الفاصل الجديدة تلقائيًا على عملية التزامن.

## مثال على التكوين

لاحظ أنه بالإضافة إلى المعايير التي توفر لعقدة الفلترة الوصول إلى السحابة (الأقسام العامة وقسم `api`، الموصوفة في هذا المقال)، قد يحتوي ملف `node.yaml` أيضًا على معايير توفر الوصول الى ملفات [المطلوبة لتشغيل العقدة](configure-access-to-files-needed-for-node.md) (`قسم syncnode`).

--8<-- "../include/node-cloud-sync-configuration-example.md"