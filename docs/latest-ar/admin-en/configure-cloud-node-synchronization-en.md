# تكوين التزامن بين عقدة Wallarm والسحابة

تتزامن عقدة التصفية بانتظام مع Wallarm Cloud لـ:

* الحصول على تحديثات لـ[قواعد معالجة الحركة (LOM)](../about-wallarm/protecting-against-attacks.md#custom-rules-for-request-analysis)
* الحصول على تحديثات لـ[proton.db](../about-wallarm/protecting-against-attacks.md#library-libproton)
* إرسال بيانات حول الهجمات والثغرات الأمنية المكتشفة
* إرسال مقاييس للحركة المعالجة

تصف هذه التعليمات الباراميترات والطرق المستخدمة لتكوين التزامن بين عقدة التصفية وسحابة Wallarm.

## باراميترات الوصول

باراميترات مثل اسم عقدة التصفية، UUID، ومفتاح سري API Wallarm، التي تمكن عقدة التصفية من الوصول إلى السحابة، يتم تحديدها صراحةً في ملف `node.yaml`. يتم إنشاء هذا الملف تلقائيًا بواسطة سكربت `register-node`.

* بالنسبة لتثبيت صورة NGINX المبنية على Docker، صورة السحابة ومثبت متكامل، يمكن العثور على الملف في `/opt/wallarm/etc/wallarm/node.yaml`، ما لم يتم تجاوزه بواسطة توجيه [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).
* بالنسبة لتثبيتات أخرى، يقع في `/etc/wallarm/node.yaml`، ما لم يتم تجاوزه بواسطة توجيه [`wallarm_api_conf`](configure-parameters-en.md#wallarm_api_conf).

قد يحتوي ملف `node.yaml` على باراميترات الوصول التالية:

| الباراميتر | الوصف | القيمة الافتراضية |
| --------- | ----------- | ------------- |
| `hostname`       | اسم عقدة التصفية. هذا المتغير **مطلوب** أن يتم تعيينه في ملف `node.yaml`. | مقدم من `register-node` |
| `regtoken`       | رمز للعقدة لكي تتمكن من الوصول إلى API Wallarm. | مقدم من `register-node` |
| `uuid`           | UUID لعقدة التصفية. هذا المتغير **مطلوب** أن يتم تعيينه في ملف `node.yaml`. | مقدم من `regtoken` |
| `secret`         | مفتاح سري للوصول إلى API Wallarm. هذا المتغير **مطلوب** أن يتم تعيينه في ملف `node.yaml`. | مقدم من `regtoken` |
| `api.host`       | نقطة النهاية لـ API Wallarm. يمكن أن يكون:<ul><li>`us1.api.wallarm.com` لسحابة الولايات المتحدة</li><li>`api.wallarm.com` لسحابة الاتحاد الأوروبي</li></ul> | `api.wallarm.com` |
| `api.port`       | منفذ API Wallarm. | `443` |
| `api.use_ssl`  | ما إذا كان يجب استخدام SSL عند الاتصال بـ API Wallarm. | `true` |
| `api.ca_verify`  | ما إذا كان يجب تمكين/تعطيل التحقق من شهادة خادم API Wallarm. يمكن أن يكون:<ul><li>`true` لتمكين التحقق</li><li>`false` لتعطيل التحقق</li></ul>. | `true` |
| `api.ca_file`  | مسار ملف شهادة SSL. | `/usr/share/wallarm-common/ca.pem` |
| `api.localhost` | عنوان IP المحلي لواجهة الشبكة التي يتم من خلالها إرسال الطلبات إلى API Wallarm. هذا الباراميتر مطلوب إذا كانت واجهة الشبكة المستخدمة بشكل افتراضي تحد من الوصول إلى API Wallarm (على سبيل المثال، قد يتم إغلاق الوصول إلى الإنترنت). | - |
| `api.localport` | منفذ واجهة الشبكة التي يتم من خلالها إرسال الطلبات إلى API Wallarm. هذا الباراميتر مطلوب إذا كانت واجهة الشبكة المستخدمة بشكل افتراضي تحد من الوصول إلى API Wallarm (على سبيل المثال، قد يتم إغلاق الوصول إلى الإنترنت). | - |

لتغيير باراميترات التزامن، اتبع الخطوات التالية:

1. قم بإجراء تغييرات على ملف `node.yaml` بإضافة الباراميترات المطلوبة وتعيين القيم المرغوبة لها.
1. أعد تشغيل NGINX لتطبيق الإعدادات المحدثة على عملية التزامن:

    --8<-- "../include/waf/restart-nginx-4.4-and-above.md"

## فترة التزامن

افتراضيًا، تتزامن عقدة التصفية مع Wallarm Cloud كل 120‑240 ثانية (2‑4 دقائق). يمكنك تغيير فترة التزامن عبر متغير البيئة النظامي `WALLARM_SYNCNODE_INTERVAL`.

لتغيير الفاصل الزمني بين تزامن عقدة التصفية وسحابة Wallarm:

1. افتح الملف `/etc/environment`.
2. أضف متغير `WALLARM_SYNCNODE_INTERVAL` إلى الملف وقم بتعيين قيمة مرغوبة للمتغير بالثواني. لا يمكن أن تكون القيمة أقل من القيمة الافتراضية (`120` ثانية). على سبيل المثال:

    ```bash
    WALLARM_SYNCNODE_INTERVAL=800
    ```
3. احفظ الملف `/etc/environment` بعد التغيير. سيتم تطبيق القيمة الجديدة للفترة على عملية التزامن تلقائيًا.

## مثال على التكوين

لاحظ أنه بالإضافة إلى الباراميترات التي توفر الوصول إلى السحابة لعقدة التصفية (الأقسام العامة و`api`، الموصوفة في هذا المقال)، قد يحتوي ملف  `node.yaml` أيضًا على باراميترات توفر الوصول إلى الملفات [الوصول إلى الملفات](configure-access-to-files-needed-for-node.md) المطلوبة لتشغيل العقدة (`syncnode` القسم).

--8<-- "../include/node-cloud-sync-configuration-example.md"