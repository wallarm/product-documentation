[link-doc-asg-guide]:               creating-autoscaling-group.md  
[link-docs-check-operation]:        /admin-en/installation-check-operation-en.md
[link-lb-comparison]:               https://cloud.google.com/load-balancing/docs/load-balancing-overview
[link-creating-instance-group]:     creating-autoscaling-group.md
[link-backup-resource]:             https://cloud.google.com/load-balancing/docs/target-pools#backupPool
[link-health-check]:                https://cloud.google.com/load-balancing/docs/health-checks
[link-session-affinity]:            https://cloud.google.com/load-balancing/docs/target-pools#sessionaffinity
[link-test-attack]:                 ../../installation-check-operation-en.md
[link-network-service-tier]:        https://cloud.google.com/network-tiers/docs/

[img-backend-configuration]:        ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/backend-configuration.png
[img-creating-lb]:                  ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/creating-load-balancer.png
[img-creating-tcp-lb]:              ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/creating-tcp-load-balancer.png
[img-new-frontend-ip-and-port]:     ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/frontend-configuration.png
[img-checking-attacks]:             ../../../images/admin-guides/test-attacks-quickstart.png

# إعداد توازن الطلبات الواردة على GCP

بعد أن قمت بتهيئة مجموعة النسخ المُدارة وقمت بتمكين التوسع التلقائي لها، يجب عليك إنشاء وتهيئة موازن الحمل الذي يقوم بتوزيع الاتصالات الواردة عبر HTTP وHTTPS بين عدة عقد تصفية من المجموعة.

يمكنك تهيئة الأنواع التالية لموازني الحمل على منصة Google Cloud:
*   موازن الحمل HTTP(S)
*   موازن الحمل TCP
*   موازن الحمل UDP

!!! info "الفروقات بين موازني الحمل"
    للحصول على معلومات مفصلة عن الفروقات بين موازني الحمل، يُرجى الانتقال إلى هذا [الرابط][link-lb-comparison]. 

يوضح هذا الوثيقة كيفية تهيئة واستخدام موازن الحمل TCP الذي يوزع حركة المرور على مستوى نقل البيانات في نموذج شبكة OSI/ISO.

أكمل الخطوات التالية لإنشاء موازن الحمل TCP لمجموعتك:

1.  انتقل إلى صفحة **توازن الحمل** في قسم **خدمات الشبكة** من القائمة وانقر على زر **إنشاء موازن الحمل**.

2.  انقر على زر **بدء التهيئة** على بطاقة **توازن الحمل TCP**.

3.  حدد الخيارات المطلوبة في الإعدادات التالية:

    1.  اختر خيار **من الإنترنت إلى VMs** في إعداد **الواجهة الأمامية للإنترنت أو الداخلية فقط** حتى يتحكم موازن الحمل في الطلبات الواردة من العملاء إلى الخادم الخاص بك.
    
    2.  اختر خيار **منطقة واحدة فقط** في إعداد **عدة مناطق أو منطقة واحدة**.
    
        !!! info "توازن الحركة للموارد الموجودة في مناطق مختلفة"
            تصف هذه الوثيقة تهيئة موازن الحمل لمجموعة نسخ موجودة في منطقة واحدة.
            
            في حالة توازن الحركة لعدة موارد موجودة في مناطق متعددة، اختر خيار **عدة مناطق (أو غير متأكد بعد)**.

    ![إنشاء موازن حمل][img-creating-lb]

    انقر على زر **متابعة**.

4.  أدخل اسم موازن الحمل في حقل **الاسم**.

5.  انقر على زر **تهيئة الخلفية** لاستخدام [مجموعة النسخ المُنشأة][link-creating-instance-group] كالخلفية التي سيوجه إليها موازن الحمل الطلبات الواردة.

6.  أملأ النموذج بالبيانات التالية:

    1.  اختر المنطقة التي تقع فيها مجموعة النسخ من قائمة **المنطقة**.
    
    2.  انتقل إلى علامة التبويب **اختيار مجموعات النسخ الموجودة** في إعداد **الخلفيات** واختر اسم مجموعة النسخ من قائمة **إضافة مجموعة نسخ**.
    
    3.  إذا لزم الأمر، حدد مسبح النسخ الاحتياطي بتحديد خيار **إنشاء مسبح احتياطي** من قائمة **مسبح النسخ الاحتياطي**. 
    
        !!! info "استخدام مسبح نسخ احتياطي"
            يتعامل مسبح النسخ الاحتياطي مع الطلبات إذا كانت مجموعة النسخ المختارة في الإعداد السابق غير متاحة. للحصول على معلومات مفصلة حول تهيئة مسبح نسخ احتياطي، يُرجى الانتقال إلى هذا [الرابط][link-backup-resource].
            
            لا يتم وصف تهيئة مسبح النسخ الاحتياطي في هذا المستند.
    
    4.  إذا لزم الأمر، قم بتهيئة فحص توافر مثيلات المجموعة بتحديد خيار **إنشاء فحص صحي** في قائمة **الفحص الصحي**. للحصول على معلومات مفصلة حول فحص توافر الآلة، يُرجى الانتقال إلى هذا [الرابط][link-health-check].
    
        !!! info "فحص التوافر"
            فحص التوافر ليس ضمن نطاق هذا المستند. لذا، هنا يتم اختيار خيار **بدون فحص صحي** في قائمة **الفحص الصحي**.
    
        ![تهيئة الخلفية][img-backend-configuration]

7.  انقر على زر **تهيئة الواجهة الأمامية** لتحديد عناوين الـ IP والمنافذ التي سيُرسل إليها العملاء طلباتهم.

8.  أملأ النموذج لإنشاء عناوين IP ومنافذ جديدة بالبيانات المطلوبة:

    1.  إذا لزم الأمر، أدخل اسم زوج العنوان IP والمنفذ الجديد في حقل **الاسم**.
    
    2.  حدد الطبقة الخدمية الشبكية المطلوبة في إعداد **طبقة الخدمة الشبكية**. للحصول على معلومات مفصلة حول طبقات الخدمة الشبكية، يُرجى الانتقال إلى هذا [الرابط][link-network-service-tier];
    
    3.  اختر عنوان IP الذي سوف يتلقى موازن الحمل الطلبات منه من قائمة **الـ IP**.
    
        1.  اختر خيار **عابر** إذا كنت ترغب في أن يحصل موازن الحمل على عنوان IP جديد عند كل بدء تشغيل للجهاز الافتراضي.
        
        2.  اختر خيار **إنشاء عنوان IP** لتوليد عنوان IP ثابت لموازن الحمل. 
        
        في النموذج الذي يظهر، أدخل اسم العنوان IP الجديد في حقل **الاسم** وانقر على زر **حجز**.
            
    4.  أدخل المنفذ الذي سيتلقى فيه موازن الحمل الطلبات في حقل **المنفذ**. 
    
        !!! info "اختيار المنفذ"
            في هذا المستند، يتم تحديد المنفذ `80` لتلقي الطلبات عبر بروتوكول HTTP.
    
    ![نموذج إنشاء عنوان IP ومنفذ أمامي جديد][img-new-frontend-ip-and-port]
    
    انقر على زر **تم** لإنشاء زوج عنوان IP والمنفذ المُهيأ.
    
    !!! info "المنافذ الأمامية المطلوبة"
        في هذا المستند، يتم تهيئة الموازن لتلقي الطلبات عبر بروتوكول HTTP. إذا كانت مجموعة النسخ تتلقى طلبات عبر بروتوكول HTTPS، قم بإنشاء زوج آخر من عنوان IP والمنفذ الذي يحدد المنفذ `443`.

9.  انقر على زر **إنشاء** لإنشاء موازن الحمل المُهيأ.

    ![إنشاء موازن حمل TCP][img-creating-tcp-lb]
    
انتظر حتى تنتهي عملية إنشاء موازن الحمل ويتصل موازن الحمل بمجموعة النسخ التي قمت بإنشائها مسبقًا.

نظرًا لأن موازن الحمل TCP الذي تم إنشاؤه يستخدم خدمة الخلفية (والتي تعمل مع الخلفية المُنشأة لمجموعة النسخ الخاصة بك)، لا تحتاج مجموعة النسخ إلى تعديلات في التهيئة لكي يتصل بها موازن الحمل.

الآن، ستقوم مجموعة العقد المتغيرة التوسع لفلاتر Wallarm بمعالجة حركة المرور الواردة إلى تطبيقك.

للتحقق من تشغيل عقد الفلترة الموزعة، قم بالخطوات التالية:
1.  تأكد من إمكانية الوصول إلى تطبيقك عبر عنوان IP أو اسم المجال لموازن الحمل وعقد فلترة Wallarm باستخدام متصفحك.
2.  تأكد من حماية خدمات Wallarm لتطبيقك بـ[تنفيذ هجوم اختباري][link-test-attack].

![علامة التبويب «الأحداث» في واجهة ويب Wallarm][img-checking-attacks]