[link-doc-asg-guide]:               creating-autoscaling-group.md  
[link-docs-check-operation]:        /admin-en/installation-check-operation-en.md
[link-lb-comparison]:               https://cloud.google.com/load-balancing/docs/load-balancing-overview
[link-creating-instance-group]:     creating-autoscaling-group.md
[link-backup-resource]:             https://cloud.google.com/load-balancing/docs/target-pools#backupPool
[link-health-check]:                https://cloud.google.com/load-balancing/docs/health-checks
[link-session-affinity]:            https://cloud.google.com/load-balancing/docs/target-pools#sessionaffinity
[link-test-attack]:                 ../../installation-check-operation-en.md
[link-network-service-tier]:        https://cloud.google.com/network-tiers/docs/

[img-backend-configuration]:        ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/backend-configuration.png
[img-creating-lb]:                  ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/creating-load-balancer.png
[img-creating-tcp-lb]:              ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/creating-tcp-load-balancer.png
[img-new-frontend-ip-and-port]:     ../../../images/installation-gcp/auto-scaling/common/load-balancing-guide/frontend-configuration.png
[img-checking-attacks]:             ../../../images/admin-guides/test-attacks-quickstart.png


#   إعداد موازنة الطلبات الواردة على GCP

الآن بعد أن قمت بتكوين [مجموعة النسخ المتماثلة المُدارة][link-doc-asg-guide] مع تفعيل التوسع التلقائي، تحتاج إلى إنشاء وتكوين موازن الحمولة الذي يوزع الاتصالات الواردة HTTP وHTTPS بين عدة عقد تصفية من مجموعة النسخ المتماثلة.

يمكنك تكوين أنواع التالية من موازنات الحمولة على منصة Google Cloud:
*   موازن حمولة HTTP(S)
*   موازن حمولة TCP
*   موازن حمولة UDP

!!! info "الفروقات بين موازنات الحمولة"
    للحصول على معلومات مفصلة حول الفروقات بين موازنات الحمولة، يرجى المتابعة إلى هذا [الرابط][link-lb-comparison]. 

هذا المستند يوضح كيفية تكوين واستخدام موازن الحمولة TCP الذي يوزع الحركة على مستوى النقل من نموذج الشبكة OSI/ISO.

أنشئ موازن حمولة TCP لمجموعة النسخ المتماثلة الخاصة بك بإكمال الإجراءات التالية:

1.  انتقل إلى صفحة **موازنة الحمولة** في قسم **خدمات الشبكة** من القائمة وانقر على زر **إنشاء موازن حمولة**.

2.  انقر على زر **بدء التكوين** على بطاقة **موازنة الحمولة TCP**.

3.  حدد الخيارات المطلوبة في الإعدادات التالية:

    1.  حدد خيار **من الإنترنت إلى VMs الخاصة بي** في إعداد **مواجه للإنترنت أو داخلي فقط** حتى يتحكم موازن الحمولة في الطلبات الواردة من العملاء إلى الخادم الخاص بك.
    
    2.  حدد خيار **إقليم واحد فقط** في إعداد **عدة أقاليم أو إقليم واحد**.
    
        !!! info "موازنة الحركة للموارد الموجودة في أقاليم مختلفة"
            هذا الدليل يصف تكوين موازن الحمولة لمجموعة نسخ متماثلة واحدة موجودة في إقليم واحد.
            
            في حالة موازنة الحركة لعدة موارد موجودة في عدة أقاليم، حدد خيار **عدة أقاليم (أو غير متأكد بعد)**.
            
    ![إنشاء موازن حمولة][img-creating-lb]

    انقر على زر **متابعة**.

4.  أدخل اسم موازن الحمولة في حقل **الاسم**.

5.  انقر على **تكوين الخلفية** لاستخدام [مجموعة النسخ المتماثلة المُنشأة][link-creating-instance-group] كخلفية التي سيوجه إليها موازن الحمولة الطلبات الواردة.

6.  املأ النموذج بالبيانات التالية:

    1.  حدد الإقليم الذي تقع فيه مجموعة النسخ المتماثلة من قائمة **الإقليم** المنسدلة.
    
    2.  انتقل إلى علامة التبويب **تحديد مجموعات النسخ المتماثلة الموجودة** في إعداد **الخلفيات** وحدد اسم مجموعة النسخ المتماثلة من قائمة **إضافة مجموعة نسخ متماثلة** المنسدلة.
    
    3.  إذا لزم الأمر، حدد مجموعة النسخ الاحتياطية عن طريق اختيار خيار **إنشاء مجموعة نسخ احتياطية** من قائمة **مجموعة النسخ الاحتياطية** المنسدلة.
    
        !!! info "استخدام مجموعة النسخ الاحتياطية"
            مجموعة النسخ الاحتياطية تعالج الطلبات إذا كانت مجموعة النسخ المتماثلة المحددة في الإعداد السابق غير متوفرة. للحصول على معلومات مفصلة حول تكوين مجموعة النسخ الاحتياطية، يرجى المتابعة إلى هذا [الرابط][link-backup-resource].
            
            هذا المستند لا يصف تكوين مجموعة النسخ الاحتياطية.
    
    4.  إذا لزم الأمر، قم بتكوين فحص توفر العقد عن طريق اختيار خيار **إنشاء فحص صحي** في قائمة **فحص صحي** المنسدلة. للحصول على معلومات مفصلة حول فحص توفر الآلة، يرجى المتابعة إلى هذا [الرابط][link-health-check].
    
        !!! info "فحص التوفر"
            فحص التوفر غير مكون ضمن نطاق هذا المستند. وبالتالي، هنا يتم اختيار خيار **لا يوجد فحص صحي** من قائمة **فحص صحي** المنسدلة.
    
    5.  إذا لزم الأمر، قم بتكوين طريقة اختيار عقدة لمعالجة الطلب عن طريق اختيار الخيار المناسب في قائمة **تقارب الجلسة** المنسدلة. المعلومات التفصيلية حول اختيار عقدة لمعالجة الطلب متوفرة على هذا [الرابط][link-session-affinity].
    
        !!! info "تكوين طريقة اختيار عقدة"
            طريقة اختيار عقدة لمعالجة الطلب غير مدرجة ضمن نطاق هذا المستند. وبالتالي، هنا يتم اختيار خيار **لا شيء** من قائمة **تقارب الجلسة** المنسدلة.
    
        ![تكوين خلفية][img-backend-configuration]

7.  انقر على زر **تكوين الواجهة الأمامية** لتحديد عناوين IP والمنافذ التي سيُرسل إليها العملاء طلباتهم.

8.  املأ النموذج الخاص بإنشاء عناوين IP والمنافذ الجديدة بالبيانات المطلوبة:

    1.  إذا لزم الأمر، أدخل اسم زوج عنوان IP والمنفذ الجديد في حقل **الاسم**.
    
    2.  حدد الدرجة الخدمية للشبكة المطلوبة في إعداد **درجة خدمة الشبكة**. للحصول على معلومات مفصلة حول درجات خدمة الشبكة، يرجى المتابعة إلى هذا [الرابط][link-network-service-tier].
    
    3.  حدد عنوان IP الذي سيستقبل عليه موازن الحمولة الطلبات من قائمة **IP** المنسدلة.
    
        1.  حدد خيار **عابر** إذا كنت تريد أن يحصل موازن الحمولة على عنوان IP جديد عند كل بدء تشغيل للآلة الافتراضية.
        
        2.  حدد خيار **إنشاء عنوان IP** لإنتاج عنوان IP ثابت لموازن الحمولة الخاص بك.
        
        في النموذج الذي يظهر، أدخل اسم عنوان IP الجديد في حقل **الاسم** وانقر على زر **حجز**.
            
    4.  أدخل المنفذ الذي سيستقبل عليه موازن الحمولة الطلبات في حقل **المنفذ**.
    
        !!! info "اختيار المنفذ"
            في هذا المستند، يتم تحديد المنفذ `80` لاستقبال الطلبات عبر بروتوكول HTTP.
    
    ![نموذج إنشاء عنوان IP ومنفذ جديد][img-new-frontend-ip-and-port]
    
    انقر على زر **تم** لإنشاء زوج عنوان IP والمنفذ المُكوّن.
    
    !!! info "المنافذ الأمامية المطلوبة"
        في هذا المستند، يتم تكوين الموازن لاستقبال الطلبات عبر بروتوكول HTTP. إذا كانت مجموعة النسخ المتماثلة الخاصة بك تستقبل الطلبات عبر بروتوكول HTTPS، أنشئ زوج عنوان IP ومنفذ آخر يحدد المنفذ `443`.

9.  انقر على زر **إنشاء** لإنشاء موازن الحمولة المُكوَّن.

    ![إنشاء موازن حمولة TCP][img-creating-tcp-lb]
    
انتظر حتى يتم الانتهاء من عملية إنشاء موازن الحمولة ويتصل الموازن بمجموعة النسخ المتماثلة التي قمت بإنشائها في وقت سابق.

نظرًا لأن الموازن TCP المُنشأ يستخدم خدمة الخلفية (التي تعمل مع الخلفية المنشأة لمجموعة النسخ المتماثلة الخاصة بك)، فلا تحتاج مجموعة النسخ المتماثلة إلى تعديلات في التكوين حتى يتصل بها الموازن.

الآن، مجموعة النسخ المتماثلة المتوسعة ديناميكيًا لعقد التصفية Wallarm ستعالج الحركة الواردة إلى تطبيقك.

للتحقق من تشغيل العقد التصفية المُنتشرة، قم بتنفيذ الخطوات التالية:
1.  تأكد من أن تطبيقك متاح من خلال موازن الحمولة وعقد التصفية Wallarm عن طريق الرجوع إلى عنوان IP للموازن أو اسم النطاق  باستخدام المتصفح الخاص بك.
2.  تأكد من أن خدمات Wallarm تحمي تطبيقك بواسطة [تنفيذ هجوم اختباري][link-test-attack].

![علامة تبويب «الأحداث» على واجهة ويب Wallarm][img-checking-attacks]