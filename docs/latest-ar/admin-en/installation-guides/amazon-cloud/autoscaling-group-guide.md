[link-doc-ami-creation]:        create-image.md
[link-doc-lb-guide]:            load-balancing-guide.md

[link-ssh-keys-guide]:          ../../../installation/cloud-platforms/aws/ami.md#1-create-a-pair-of-ssh-keys
[link-security-group-guide]:    ../../../installation/cloud-platforms/aws/ami.md#2-create-a-security-group

[link-doc-as-faq]:              https://aws.amazon.com/autoscaling/faqs/

[img-create-lt-wizard]:         ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/create-launch-template.png
[img-create-asg-wizard]:        ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/create-asg-with-template.png
[img-asg-wizard-1]:             ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/asg-wizard-1.png
[img-asg-increase-policy]:      ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/group-size-increase.png
[img-asg-decrease-policy]:      ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/group-size-decrease.png
[img-alarm-example]:            ../../../images/installation-ami/auto-scaling/common/autoscaling-group-guide/alarm-example.png
[img-check-asg-in-cloud]:       ../../../images/cloud-node-status.png

[anchor-lt]:    #1-creating-a-launch-template
[anchor-asg]:   #2-creating-an-auto-scaling-group


#   إعداد توسيع العقدة الشاشة التلقائي

!!! info "الحقوق المطلوبة"
    قبل الشروع في ضبط التوسع التلقائي، تأكد أن حسابك في Amazon AWS ممنوح أحد الحقوق التالية:
    
    *   `AutoScalingFullAccess`
    *   `AutoScalingConsoleFullAccess`

لإعداد توسع عقدة الفلترة تلقائيًا، اتبع الخطوات التالية:
1.  [إنشاء قالب نشر][anchor-lt]
2.  [إنشاء مجموعة توسع تلقائي][anchor-asg]

##  1.  إنشاء قالب النشر

يحدد قالب النشر نوع العينة المستخدمة أثناء نشر صورة الجهاز الأمازون (AMI) ويعد بعض الخصائص العامة للجهاز الوهمي.

أنشئ قالب النشر عبر الخطوات التالية:

1.  اذهب إلى تبويب **قوالب النشر** على لوحة التحكم Amazon EC2 باستخدام زر **إنشاء قالب نشر**.

2.  أدخل اسم القالب في الحقل **اسم قالب النشر**. 

3.  اختر [صورة الجهاز الأمازون المنشأة في السابق][link-doc-ami-creation]. لفعل هذا، اضغط على الرابط **البحث عن AMI** وحدد الصورة المطلوبة من الكتالوج **AMIs الخاصة بي**.

4.  اختر نوع العينة لإطلاق جهاز الفلترة الوهمي من القائمة **نوع العينة**.

    !!! warning "اختر نوع العينة المناسب"
        يجب اختيار نفس نوع العينة الذي استخدمته عندما قمت ببداية ضبط عقدة الفلترة أو نوع أكثر قوة.

        استخدام نوع العينة الأقل قد يؤدي إلى حدوث مشاكل في عمل العقدة.
        
5.  اختر اسم [زوج المفاتيح الذي تم إنشاؤه في السابق][link-ssh-keys-guide] للوصول إلى عقدة الفلترة من القائمة **اسم المفتاح الزوج**.

6.  اختر [مجموعة الأمان التي تم إنشاؤها في السابق][link-security-group-guide] من القائمة **مجموعات الأمان**.

7.  اضغط على الزر **إنشاء قالب نشر**.

    ![إنشاء قالب نشر][img-create-lt-wizard]
    
انتظر حتى يكتمل عملية إنشاء القالب.

بعد إنشاء قالب النشر، يمكنك الشروع في إنشاء مجموعة توسع تلقائي.

## 2.  إنشاء مجموعة توسع تلقائي

!!! info "اختيار طريقة التوسع التلقائي"
    هذا القسم يصف عملية إنشاء مجموعة توسع تلقائي باستخدام طريقة التوسع التلقائي EC2. 

    يمكنك أيضًا استخدام طريقة التوسع التلقائي AWS. 

    إذا أردت الاطلاع على الأسئلة الشائعة حول طرق التوسع التلقائي من أمازون، انتقل إلى هذا [الرابط][link-doc-as-faq].

لإنشاء مجموعة توسع تلقائي، اتبع الخطوات التالية:

1.  اذهب إلى تبويب **مجموعات التوسع التلقائي** على لوحة التحكم Amazon EC2 واضغط على زر **إنشاء مجموعة توسع تلقائي**.

2.  اختر أوبشن **قالب النشر**، ثم اختر [قالب النشر المنشأ سابقًا][anchor-lt] من القائمة وانقر على زر **الخطوة التالية**.

    ![إنشاء مجموعة توسع تلقائي][img-create-asg-wizard]
    
3.  قم بإدخال اسم مجموعة التوسع التلقائي المطلوب في حقل **اسم المجموعة**.

4.  اختر الإصدار **الأخير** لقالب النشر من القائمة **نسخة قالب النشر**.

5.  اختر نوع العينة المطلوب لمجموعة التوسع التلقائي عن طريق اختيار أحد أوبشنات **تكوين الأسطول**.

    إذا تبعت هذا الدليل عند إنشاء قالب نشر وتم تحديد نوع العينة لإطلاق الجهاز الوهمي، ثم يمكنك استخدم أوبشن **الالتزام بقالب النشر**.

    !!! info "حدد نوع العينة المناسب"
        يمكنك أيضًا اختيار أوبشن **دمج خيارات الشراء والعينات** إذا لم يتم تحديد نوع العينة في قالب النشر أو إذا كنت ترغب في اختيار أنواع عينات متعددة ومختلفة للتوسع التلقائي.

        حدد نوع العينة نفسها التي استخدمتها عندما قمت بضبط عقدة الفلترة في البداية أو نوعًا أكثر قوة. استخدام نوع أقل قد يؤدي إلى مشاكل في عمل العقدة.
        
6.  أدخل حجم مجموعة التوسع التلقائي الأولية في حقل **حجم المجموعة** (على سبيل المثال، عينتين).

7.  حدد VPC الصحيح من القائمة المنسدلة **الشبكة**.

8.  حدد الشبكات الفرعية الصحيحة من القائمة المنسدلة **الشبكات الفرعية**.

    !!! warning "توفير اتصال بالإنترنت للعقدة الشاشة"
        يتطلب العقد الشاشة الوصول إلى خادم Wallarm API للعمل الصحيح. باختار خادم Wallarm API يعتمد على السحابة Wallarm التي تستعملها:

        * إذا كنت تستعمل السحابة US، يجب منح العقدة الوصول إلى `https://us1.api.wallarm.com`.
        * إذا كنت تستعمل السحابة EU، يجب منح العقدة الوصول إلى `https://api.wallarm.com`.

        تأكد من اختيار VPC وشبكات فرعية صحيحة و[تهيئة مجموعة أمان][link-security-group-guide] بطريقة لا تمنع وصول العقدة الفلترة إلى خوادم Wallarm API.

    ![إعدادات مجموعة التوسع التلقائي العامة][img-asg-wizard-1]
    
9.  اذهب إلى صفحة **تهيئة السياسات التوسع** بالنقر على زر **التالي: تهيئة السياسات التوسع**.

10. اختر أوبشن **استخدم سياسات التوسع لضبط سعة هذه المجموعة** لتمكين التوسع التلقائي.

11. أدخل حجم مجموعة التوسع التلقائي الأدنى والأقصى.

    !!! info "حجم مجموعة التوسع التلقائي"
        لاحظ أن حجم مجموعة التوسع التلقائي الأدنى يمكن أن تكون أقل من حجم المجموعة الأولية المحددة في الخطوة السادسة.
    
12. فعل وضع تهيئة سياسات التدرج بتحديد خيار **توسع مجموعة التوسع بسياسات التدرج أو البساطة**.

13. تهيئة سياسة زيادة حجم المجموعة باستخدام فئة المعايير **زيادة حجم المجموعة**.

    ![سياسة زيادة حجم مجموعة التوسع التلقائي][img-asg-increase-policy]
    
    1.  إذا كان ضروريًا، حدد اسم سياسة زيادة حجم المجموعة باستخدام المعيار **الاسم**.

    2.  حدد الحدث من **تنفيذ السياسة عند** لتحديد الحدث الذي سيتسبب في زيادة حجم المجموعة. إذا لم تقم بإنشاء أي أحداث في السابق، قم بالضغط على زر **إضافة إنذار** لإنشاء حدث.

    3.  يمكنك ضبط اسم الحدث، والمقياس المشروف عليه، والإشعارات حول حدوث الحدث.
    
        !!! info "الأدوار المطلوبة لتهيئة الإشعارات"
            تحتاج حسابك في Amazon AWS إلى **AutoScalingNotificationAccessRole** لتهيئة الإشعارات.

        !!! info "مثال"
            يمكنك تعيين حدث باسم **استهلاك عالي للمعالج** عند الوصول إلى حمل قدره 60% على المعالج بالمتوسط خلال خمس دقائق:

            ![مثال على الإنذار][img-alarm-example]
            
        !!! info "المقاييس القياسية المتوفرة للسحابة أمازون"
            * استهلاك المعالج (بالنسبة المئوية)
            * القراءة من القرص (بالبايت)
            * الكتابة على القرص (بالبايت)
            * عدد عمليات القراءة من القرص
            * عدد عمليات الكتابة على القرص
            * الشبكة الداخلة (بالبايت)
            * الشبكة الخارجة (بالبايت)
    
    4.  اضغط على الزر **إنشاء إنذار** لإنشاء حدث.
    
    5.  حدد الإجراء الذي يجب متخذه في حالة تنفيذ حدث **استهلاك عالي للمعالج**. على سبيل المثال، قد تكوين سياسة التوسع التلقائي لإضافة (باستخدام الإجراء **إضافة**) عينة واحدة عند تنفيذ الحدث.
    
    6.  قد يتم تنفيذ الحدث مبكرًا إذا حدثت نتائج واضحة في استهلاك الموارد بعد إضافة عينة جديدة. لتجنب هذا، يمكنك ضبط فترة الاحماء بالثواني باستخدام المعيار **حاجة العينات إلى `X` ثوانٍ للاحترار**. لن يتم تنفيذ أي حداث في هذه الفترة من الوقت.
    
14. بطريقة مماثلة، استخدم فئة المعايير **تقليل حجم المجموعة** لتهيئة سياسة تقليل حجم المجموعة.

    ![سياسة تقليل حجم المجموعة][img-asg-decrease-policy]

15. إذا كان ضروريًا، قم بتهيئة الإشعارات والعلامات لمجموعة التوسع التلقائي أو اذهب إلى مراجعة التغييرات بالضغط على زر **مراجعة**.

16. تأكد من صحة جميع المعايير المختارة ثم ابدأ عملية إنشاء مجموعة التوسع التلقائي بالضغط على زر **إنشاء مجموعة التوسع التلقائي**.

سيتم إطلاق العدد المحدد من العينات تلقائيًا عند إتمام عملية إنشاء مجموعة التوسع التلقائي بنجاح.

يمكنك التأكد أن مجموعة التوسع التلقائي قد تم إنشائها بصورة صحيحة عبر فحص عدد العينات المطلقة في المجموعة ومقارنة هذه البيانات مع عدد العقد الشاشة المتصلة بالسحابة Wallarm.

يمكنك القيام بذلك باستخدام Wallarm Console. على سبيل المثال، إذا كان هناك عينتين تعملان مع العقد الشاشة في نفس الوقت، ستقوم Wallarm Console بعرض هذا العدد للعقدة الشاشة المناسبة في القسم **العقد**.

![التأكد من حالة مجموعة التوسع التلقائي][img-check-asg-in-cloud]

يمكنك الآن البدء ب[إنشاء وتهيئة][link-doc-lb-guide] موازن الحمل.