# إنشاء صورة آلة أمازون بها عقدة ترشيح والارم

يمكنك إعداد التحجيم التلقائي لعقد الترشيح والارم المنشورة على السحابة الأمازون. تتطلب هذه الوظيفة صور آلات افتراضية معدة مسبقًا.

يوصف هذا المستند بإجراء إعداد صورة آلة أمازون (AMI) مع تثبيت عقدة ترشيح والارم. صورة AMI مطلوبة لإعداد التحجيم التلقائي لعقدة الترشيح. لرؤية معلومات مفصلة حول إعداد التحجيم التلقائي، تابع إلى هذا [الرابط][link-docs-aws-autoscaling].

لإنشاء AMI مع عقدة ترشيح والارم، قم بإجراء الإجراءات التالية:

1. [إنشاء وتكوين نسخة عقدة الترشيح في السحابة الأمازون][anchor-node]
2. [إنشاء AMI على أساس نسخة عقدة الترشيح المكونة][anchor-ami]


##  1. إنشاء وتكوين نسخة عقدة ترشيح والارم في السحابة الأمازون

قبل إنشاء AMI تحتاج إلى إجراء تكوين أولي لعقدة ترشيح والارم واحدة. لتكوين عقدة الترشيح، قم بما يلي:

1. [إنشاء][link-docs-aws-node-setup] نسخة عقدة الترشيح في السحابة الأمازون.
    
    !!! تحذير "مفتاح SSH خاص"
        تأكد من أنك تملك الوصول إلى مفتاح SSH الخاص (المحفوظ بتنسيق PEM) الذي [أنشأته][link-ssh-keys-guide] مسبقًا للاتصال بعقدة الترشيح.

    !!! تحذير "توفير اتصال بالإنترنت لعقدة الترشيح"
        تتطلب عقدة الترشيح الوصول إلى خادم API والارم للتشغيل السليم. اختيار خادم API والارم يعتمد على السحابة والارم التي تستخدمها:
        
        *   إذا كنت تستخدم السحابة الأمريكية، تحتاج عقدتك إلى الوصول إلى `https://us1.api.wallarm.com`.
        *   إذا كنت تستخدم السحابة الأوروبية، تحتاج عقدتك إلى الوصول إلى `https://api.wallarm.com`.
        
    تأكد من أنك اخترت VPC والشبكات الفرعية الصحيحة و[قمت بتكوين مجموعة أمان][link-security-group-guide] بطريقة لا تمنع عقدة الترشيح من الوصول إلى خوادم API والارم.

2. [توصيل][link-cloud-connect-guide] عقدة الترشيح بالسحابة والارم.

    !!! تحذير "استخدام رمز للاتصال بالسحابة والارم"
        يرجى ملاحظة أنك بحاجة لتوصيل عقدة الترشيح بالسحابة والارم باستخدام رمز. يُسمح بتوصيل عدة عقد ترشيح بالسحابة والارم باستخدام نفس الرمز.
        
        وبالتالي، عند تحجيم عقد الترشيح تلقائيًا، لن تحتاج إلى الاتصال يدويًا بكل عقدة ترشيح بالسحابة والارم.

3. [تكوين][link-docs-reverse-proxy-setup] عقدة الترشيح لتعمل كبروكسي عكسي لتطبيق الويب الخاص بك.

4. [التحقق][link-docs-check-operation] من أن عقدة الترشيح مكونة بشكل صحيح وتحمي تطبيق الويب الخاص بك ضد الطلبات الضارة.

بعد الانتهاء من تكوين عقدة الترشيح، أوقف الآلة الافتراضية من خلال إكمال الإجراءات التالية:

1. نتقل إلى علامة التبويب **النسخ** على لوحة تحكم أمازون EC2.
2. اختر نسخة عقدة الترشيح المكونة الخاصة بك.
3. اختر **حالة النسخة** ثم **إيقاف** من قائمة **الإجراءات** المنسدلة.

!!! معلومة "إيقاف التشغيل بأمر `poweroff`"
    يمكنك أيضًا إيقاف تشغيل الآلة الافتراضية بالاتصال بها عبر بروتوكول SSH وتشغيل الأمر التالي:
    
    ``` bash
    poweroff
    ```

##  2. إنشاء صورة آلة أمازون

يمكنك الآن إنشاء صورة آلة افتراضية بناءً على نسخة عقدة الترشيح المكونة. لإنشاء صورة، اتبع الخطوات التالية:

1. انتقل إلى علامة التبويب **النسخ** على لوحة تحكم أمازون EC2.
2. اختر نسخة عقدة الترشيح المكونة الخاصة بك.
3. ابدأ معالج إنشاء الصورة بتحديد **الصورة** ثم **إنشاء صورة** من قائمة **الإجراءات** المنسدلة.

    ![بدء معالج إنشاء صورة AMI][img-launch-ami-wizard]
    
4. ستظهر استمارة **إنشاء صورة**. أدخل اسم الصورة في حقل **اسم الصورة**. يمكنك ترك بقية الحقول دون تغيير.

    ![تكوين المعلمات في معالج إنشاء AMI][img-config-ami-wizard]
    
5. انقر على زر **إنشاء صورة** لبدء عملية إنشاء صورة الآلة الافتراضية.
    
    عند الانتهاء من عملية إنشاء الصورة، يتم عرض الرسالة المناسبة. انتقل إلى علامة التبويب **AMIs** في لوحة تحكم أمازون EC2 للتأكد من أن الصورة تم إنشاؤها بنجاح ولديها حالة **متاحة**.
    
    ![استكشاف الصورة الآلة الافتراضية المنشأة][img-explore-created-ami]

!!! معلومة "رؤية الصورة"
    نظرًا لأن الصورة المعدة تحتوي على إعدادات محددة لتطبيقك ورمز والارم، لا يُنصح بتغيير إعداد رؤية الصورة وجعلها عامة (بشكل افتراضي، يتم إنشاء AMIs بإعداد الرؤية **خاص**).

الآن يمكنك [إعداد][link-docs-aws-autoscaling] التحجيم التلقائي لعقد الترشيح والارم في السحابة الأمازون باستخدام الصورة المعدة.