# كيف تعمل وحدة التصفية في البيئات المنفصلة

قد يتم توزيع التطبيق على عدة بيئات مختلفة: الإنتاج، التجريب، الاختبار، التطوير، إلخ. توفر هذه التعليمات معلومات حول الطرق المقترحة لإدارة وحدة التصفية للبيئات المختلفة.

## ما هي البيئة
قد تختلف تعريف البيئة من شركة إلى شركة، ولغرض هذه التعليمات، يتم استخدام التعريف أدناه.

ال**بيئة** هي مجموعة أو جزء فرعي من الموارد الحاسوبية المعزولة التي تخدم غايات مختلفة (مثل الإنتاج، التجريب، الاختبار، التطوير، إلخ) ويتم إدارتها باستخدام نفس المجموعة من السياسات أو مجموعة مختلفة من السياسات (من حيث تكوينات الشبكة/البرمجيات، إصدارات البرمجيات، المراقبة، إدارة التغيير، إلخ) بواسطة نفس الفرق أو فرق مختلفة (SRE، QA، التطوير، إلخ) لشركة.

من وجهة نظر أفضل الممارسات، يُنصح بالحفاظ على تزامن تكوين وحدات Wallarm عبر جميع البيئات المستخدمة في قطاع منتج واحد (مراحل التطوير، الاختبار، التجريب والإنتاج).

## ميزات Wallarm ذات الصلة

هناك ثلاث ميزات رئيسية تتيح لك إدارة تكوينات وحدة التصفية المختلفة للبيئات المختلفة وأداء طرح تدريجي لتغييرات وحدة التصفية:

* [تعريف الموارد](#resource-identification)
* [حسابات Wallarm المنفصلة والحسابات الفرعية](#separate-wallarm-accounts-and-sub-accounts)
* [وضع تشغيل وحدة التصفية](../../configure-wallarm-mode.md)

### تعريف الموارد

هناك طريقتان لتكوين وحدة التصفية لبيئة معينة باستخدام التعريف:

* معرفات Wallarm الفريدة لكل بيئة،
* أسماء نطاقات URL المختلفة للبيئات (إذا كانت مكونة بالفعل في هيكلك).

#### تعريف البيئة بالمعرف

يتيح مفهوم التطبيقات لك تعيين معرفات مختلفة لبيئات محمية مختلفة، وإدارة قواعد وحدة التصفية بشكل منفصل لكل بيئة.

عند تكوين وحدة تصفية يمكنك إضافة معرفات Wallarm لبيئاتك باستخدام مفهوم التطبيقات. لضبط المعرفات:

1. أضف أسماء البيئات ومعرفاتها في حساب Wallarm الخاص بك → **الإعدادات** → قسم **التطبيقات**.

    ![إضافة البيئات](../../../images/admin-guides/configuration-guides/waf-in-separate-environments/added-applications.png)
2. حدد تكوين المعرف في وحدة التصفية:

    * باستخدام توجيه [`wallarm_application`](../../configure-parameters-en.md#wallarm_application) لتطبيقات قائمة على Linux، وتطبيقات الواجهة الجانبية Kubernetes وتطبيقات قائمة على Docker؛
    * باستخدام تعليق [`nginx.ingress.kubernetes.io/wallarm-application`](../../configure-kubernetes-en.md#ingress-annotations) لتطبيقات تحكم NGINX Ingress لـ Kubernetes. الآن، عند إنشاء قاعدة جديدة لوحدة التصفية من الممكن تحديد أن القاعدة سيتم تعيينها لمجموعة معينة من معرفات التطبيق. بدون السمة، سيتم تطبيق قاعدة جديدة تلقائيًا على جميع الموارد المحمية في حساب Wallarm.

![إنشاء قاعدة للمعرف](../../../images/admin-guides/configuration-guides/waf-in-separate-environments/create-rule-for-id.png)

#### تعريف البيئة بالنطاق

إذا كانت كل بيئة تستخدم أسماء نطاقات URL مختلفة ممررة في رأس طلب HTTP `HOST` فمن الممكن استخدام أسماء النطاقات كمعرفات فريدة لكل بيئة.

لاستخدام الميزة، يرجى إضافة مؤشر لرأس `HOST` المناسب لكل قاعدة وحدة التصفية المكونة. في المثال التالي، ستتم تفعيل القاعدة فقط لطلبات مع رأس `HOST` مساوٍ لـ `dev.domain.com`:

![إنشاء قاعدة لـ HOST](../../../images/admin-guides/configuration-guides/waf-in-separate-environments/create-rule-for-host.png)

### حسابات Wallarm المنفصلة والحسابات الفرعية

إحدى الخيارات السهلة لعزل تكوين وحدة التصفية لبيئات مختلفة هي استخدام حسابات Wallarm منفصلة لكل بيئة أو مجموعة من البيئات. يوصي العديد من مزودي الخدمات السحابية بهذه الممارسة الأفضل، بما في ذلك Amazon AWS.

لتسهيل إدارة عدة حسابات Wallarm، من الممكن إنشاء حساب Wallarm `رئيسي` منطقي وتعيين حسابات Wallarm الأخرى المستخدمة كحسابات فرعية للحساب `الرئيسي`. بهذه الطريقة، يمكن استخدام مجموعة واحدة من بيانات اعتماد واجهة المستخدم للوحة التحكم وAPI لإدارة جميع حسابات Wallarm التابعة لمنظمتك.

لتفعيل حساب `رئيسي` وحسابات فرعية، يرجى الاتصال بفريق [الدعم الفني لـ Wallarm](mailto:support@wallarm.com). تتطلب الميزة رخصة Wallarm مؤسسية منفصلة.

!!! تحذير "القيود المعروفة"
    * ستتلقى جميع وحدات التصفية المتصلة بنفس حساب Wallarm نفس مجموعة قوانين التصفية لحركة البيانات. لا يزال بإمكانك تطبيق قواعد مختلفة لتطبيقات مختلفة باستخدام [معرفات التطبيق المناسبة أو رؤوس طلبات HTTP الفريدة](#resource-identification).
    * إذا قررت وحدة التصفية حظر عنوان IP بشكل تلقائي (على سبيل المثال، بسبب اكتشاف ثلاثة متجهات هجوم أو أكثر من عنوان الـ IP) سيتم حظر الـ IP لجميع التطبيقات في حساب Wallarm.