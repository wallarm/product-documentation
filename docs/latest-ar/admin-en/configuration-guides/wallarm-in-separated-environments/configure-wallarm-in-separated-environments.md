# توصيات بشأن تكوين عقد التصفية للبيئات المنفصلة

لقد تعلمت بالفعل [كيف تعمل عقد التصفية في Wallarm في البيئات المنفصلة](how-wallarm-in-separated-environments-works.md). لكي تعمل العقد كما وصف، تعلم التوصيات على تكوين العقد في البيئات المنفصلة من هذا المقال.

## عملية إطلاق الحماية الأولية لـ Wallarm

إذا كنت تقوم بتنفيذ الإطلاق الأولي لحماية Wallarm للبيئات، يُنصح باستخدام النهج التالي (مع إمكانية تعديله حسب الحاجة):

1. تعرف على خيارات نشر عقد Wallarm المتاحة [هنا](../../../installation/supported-deployment-options.md).
2. إذا لزم الأمر، تعرف على الخيارات المتاحة لإدارة تكوين عقد التصفية لبيئاتك بشكل منفصل. يمكنك العثور على هذه المعلومات [هنا](how-wallarm-in-separated-environments-works.md#relevant-wallarm-features).
3. نشر عقد التصفية Wallarm في بيئاتك غير الإنتاجية مع ضبط وضع الفلترة على `monitoring`.
4. تعرف على كيفية التشغيل والتوسع والمراقبة لحل Wallarm؛ تأكد من استقرار المكون الشبكي الجديد.
5. نشر عقد التصفية Wallarm في بيئة الإنتاج مع ضبط وضع الفلترة على `monitoring`.
6. تنفيذ إدارة التكوين وعمليات المراقبة الصحيحة لمكون Wallarm الجديد.
7. احتفظ بمرور الحركة عبر عقد التصفية في جميع بيئاتك، بما في ذلك الاختبار والإنتاج، لمدة 7-14 يومًا لإعطاء نظام Wallarm السحابي بعض الوقت للتعلم عن تطبيقك.
8. فعّل وضع الفلترة `blocking` في جميع بيئاتك غير الإنتاجية واستخدم اختبارات آلية أو يدوية للتأكد من أن التطبيق المحمي يعمل كما هو متوقع.
9. فعّل وضع الفلترة `blocking` في بيئة الإنتاج. باستخدام الطرق المتاحة، تأكد من أن التطبيق يعمل كما هو متوقع.

!!! info
    لضبط وضع الفلترة، يرجى استخدام هذه [التعليمات](../../configure-wallarm-mode.md).

## طرح تدريجي لتغييرات عقدة Wallarm الجديدة

من وقت لآخر، قد تكون هناك حاجة إلى تغييرات في بنية Wallarm القائمة لديك. حسب سياسة إدارة التغيير في منظمتك، قد يتطلب منك اختبار جميع التغييرات المحتملة المحفوفة بالمخاطر في بيئة غير إنتاجية، ثم تطبيق التغييرات في بيئة الإنتاج.

يُنصح بالنهج التالية لاختبار وتغيير تكوين مكونات وميزات Wallarm المختلفة بشكل تدريجي:
* [التكوين المنخفض المستوى لعقد التصفية Wallarm بكل أشكالها](#low-level-onfiguration-of-wallarm-filtering-nodes-in-all-form-factors)
* [تكوين قواعد عقدة Wallarm](#configuration-of-wallarm-node-rules)

### التكوين المنخفض المستوى لعقد التصفية Wallarm بكل أشكالها

يتم التكوين المنخفض المستوى لعقد التصفية عبر متغيرات بيئة Docker، ملف التكوين NGINX المقدم، معاملات تحكم Kubernetes Ingress، إلخ. طريقة التكوين تعتمد على [خيار النشر](../../../installation/supported-deployment-options.md).

يمكن إدارة التكوين المنخفض المستوى بشكل منفصل لبيئات العملاء المختلفة باستخدام عمليات إدارة التغيير الحالية لموارد البنية التحتية.

### تكوين قواعد عقدة Wallarm

نظرًا لأن كل سجل قاعدة يمكن أن يُربط بـ[مجموعة مختلفة](how-wallarm-in-separated-environments-works.md#resource-identification) من معرّفات مثيلات التطبيق أو رؤوس طلب `HOST`، يُوصى بالخيارات التالية:

* أولًا، طبق تكوينًا جديدًا على بيئة اختبار أو تطوير، تحقق من وظائفه، ثم طبق التغيير على بيئة الإنتاج.
* استخدم قاعدة `إنشاء مؤشر هجوم مستند إلى regexp` في وضع `Experimental`. يسمح هذا الوضع بنشر القاعدة مباشرة في بيئة الإنتاج دون خطر حظر طلبات المستخدمين الصحيحة عن طريق الخطأ.

    ![إنشاء قاعدة تجريبية](../../../images/admin-guides/configuration-guides/waf-in-separate-environments/define-attack-experimental.png)

* استخدم قاعدة `ضبط وضع الفلترة` للتحكم في وضع فلترة Wallarm لبيئات وطلبات محددة. توفر هذه القاعدة مرونة إضافية في كيفية طرح حماية Wallarm بشكل تدريجي لحماية نقاط نهائية جديدة وموارد أخرى في بيئات مختلفة. بشكل افتراضي، يُستخدم قيمة [`wallarm_mode`](../../configure-parameters-en.md#wallarm_mode) اعتمادًا على إعداد [`wallarm_mode_allow_override`](../../configure-parameters-en.md#wallarm_mode_allow_override).

    ![إنشاء قاعدة لتجاوز وضع الفلترة](../../../images/admin-guides/configuration-guides/waf-in-separate-environments/rule-overwrite-filtering-mode.png)