# حماية يدوية من هجمات BOLA

الهجمات السلوكية مثل [هجوم التفويض المكسور على مستوى الكائن (BOLA)](../../attacks-vulns-list.md#broken-object-level-authorization-bola) تستغل ثغرة بنفس الاسم. تسمح هذه الثغرة للمهاجم بالوصول إلى كائن بواسطة معرفه عبر طلب API وإما قراءة أو تعديل بياناته دون مرور بآلية التفويض. يصف هذا المقال تدابير حماية BOLA التي توفرها مشغلات [WAAP](../../about-wallarm/waap-overview.md).

!!! info "تدابير حماية BOLA الأخرى"
    بديلًا أو إضافة، يمكنك تهيئة [حماية BOLA التلقائية للنقاط النهائية التي وجدها اكتشاف API](protecting-against-bola.md).

## التهيئة

بشكل افتراضي، يكتشف Wallarm فقط الثغرات من نوع BOLA (المعروف أيضاً بIDOR) ولكنه لا يكتشف محاولات استغلالها.

لكي يتعرف عقدة Wallarm على هجمات BOLA:

1. افتح وحدة التحكم Wallarm → **المشغلات** وتابع إلى إعداد مشغل **BOLA**.
1. حدد شروط تعريف الطلبات كهجوم BOLA:

    * عدد **الطلبات من نفس عنوان IP** لفترة معينة من الزمن.
    * **URI** ليتم حمايته من هجمات BOLA واستقبال عدد محدد من الطلبات. يجب أن تكون القيمة نقطة نهاية API تشير إلى كائن بمعرفه حيث أن هذا النوع من النقاط النهائية معرض بشكل محتمل لهجمات BOLA.

        لتحديد معامل PATH الذي يحدد كائنًا، استخدم الرمز `*`، على سبيل المثال:

        ```bash
        example.com/shops/*/financial_info
        ```

        يمكن تهيئة URI عبر [منشئ URI](../../user-guides/rules/rules.md#uri-constructor) أو [نموذج تحرير متقدم](../../user-guides/rules/rules.md#advanced-edit-form) في نافذة إنشاء المشغل.

    * (اختياري) [**التطبيق**](../../user-guides/settings/applications.md) المراد حمايته من هجمات BOLA واستقبال عدد محدد من الطلبات.

        إذا كنت تستخدم نفس الاسم لعدة نطاقات، يوصى باستخدام هذا الفلتر لتوجيهه إلى التطبيق الذي يُعين له نطاق في فلتر **URI**.

    * (اختياري) عنوان أو أكثر لـ **IP** مصدر الطلبات.
1. حدد ردود فعل المشغل:

    * **تمييز كـ BOLA**. يتم وسم الطلبات التي تتجاوز العتبة كهجوم BOLA وعرضها في قسم **الهجمات** في وحدة التحكم Wallarm. لا تحظر عقدة Wallarm هذه الطلبات الضارة.
    * [**إدخال عناوين IP في القائمة السوداء**](../../user-guides/ip-lists/overview.md) المصدرة للطلبات الضارة وفترة الحظر.
    
        ستحظر عقدة Wallarm كلاً من الطلبات الشرعية والضارة (بما في ذلك هجمات BOLA) الصادرة من عناوين IP في القائمة السوداء.
    
    * [**إدخال عناوين IP في القائمة الرمادية**](../../user-guides/ip-lists/overview.md) المصدرة للطلبات الضارة وفترة الحظر.
    
        ستحظر عقدة Wallarm الطلبات الصادرة من عناوين IP في القائمة الرمادية فقط إذا احتوت الطلبات على [علامات التحقق من الإدخال](../../about-wallarm/protecting-against-attacks.md#input-validation-attacks)، [قاعدة `vpatch`](../../user-guides/rules/vpatch-rule.md) أو [علامات الهجوم الشخصية](../../user-guides/rules/regex-rule.md).
        
        !!! info "هجمات BOLA الصادرة من عناوين IP في القائمة الرمادية"
            لا يتم حظر هجمات BOLA الصادرة من عناوين IP في القائمة الرمادية.

        ![مشغل BOLA](../../images/user-guides/triggers/trigger-example7.png)

1. احفظ المشغل وانتظر [إتمام تزامن السحابة والعقدة](../configure-cloud-node-synchronization-en.md) (عادةً ما يستغرق ذلك 2-4 دقائق).

## اختبار

1. إرسال عدد الطلبات الذي يتجاوز العتبة المهيئة إلى الـ URI المحمي. مثال، 50 طلباً بقيم `{shop_id}` مختلفة إلى النقطة النهائية `https://example.com/shops/{shop_id}/financial_info`:

    ```bash
    for (( i=0 ; $i<51 ; i++ )) ; do curl https://example.com/shops/$i/financial_info ; done
    ```
1. إذا كان رد الفعل المشغل هو **إدخال عنوان IP في القائمة السوداء**، افتح وحدة التحكم Wallarm → **قوائم IP** → **القائمة السوداء** وتحقق من أن عنوان IP المصدر محظور.

    إذا كان رد الفعل المشغل هو **إدخال عنوان IP في القائمة الرمادية**، تحقق من قسم **قوائم IP** → **القائمة الرمادية** في وحدة التحكم Wallarm.
1. افتح قسم **الهجمات** وتحقق من أن الطلبات معروضة في القائمة كهجوم BOLA.

    ![هجوم BOLA في واجهة المستخدم](../../images/user-guides/events/bola-attack.png)

    يطابق عدد الطلبات المعروضة عدد الطلبات التي أُرسلت بعد تجاوز عتبة المشغل ([مزيد من التفاصيل حول اكتشاف الهجمات السلوكية](../../attacks-vulns-list.md#behavioral-attacks)). إذا كان هذا العدد أعلى من 5، يتم تطبيق أخذ عينات الطلبات وتُعرض التفاصيل فقط لأول 5 طلبات ([مزيد من التفاصيل حول أخذ عينات الطلبات](../../user-guides/events/analyze-attack.md#sampling-of-hits)).

    للبحث عن هجمات BOLA، يمكنك استخدام العلامة `bola`. يتم وصف جميع الفلاتر في [التعليمات حول استخدام البحث](../../user-guides/search-and-filters/use-search.md).

## أولويات معالجة المشغل

--8<-- "../include/trigger-processing-priorities.md"

## المتطلبات والقيود

**المتطلبات**

لحماية الموارد من هجمات BOLA، مطلوب عناوين IP الحقيقية للعملاء. إذا تم نشر عقدة التصفية خلف خادم وكيل أو موزع الأحمال، [قم بالتهيئة](../using-proxy-or-balancer-en.md) لعرض عناوين IP الحقيقية للعملاء.

**القيود**

عند البحث عن علامات هجوم BOLA، تحلل عقد Wallarm طلبات HTTP التي لا تحتوي على علامات أنواع الهجمات الأخرى.