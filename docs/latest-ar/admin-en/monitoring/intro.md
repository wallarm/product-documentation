# مقدمة في مراقبة عقدة التصفية

يمكنك مراقبة حالة عقدة التصفية باستخدام المقاييس التي توفرها العقدة. تصف هذه المقالة كيفية التعامل مع المقاييس التي يجمعها خدمة [`collectd`][link-collectd] والتي يتم تثبيتها على كل عقدة تصفية في Wallarm. توفر خدمة `collectd` عدة طرق لنقل البيانات ويمكن أن تكون مصدراً للمقاييس لأنظمة المراقبة المختلفة، مما يوفر لك التحكم في حالة عقد التصفية.

بالإضافة إلى المقاييس من `collectd`، توفر لك Wallarm بتنسيق مقاييس متوافق مع Prometheus ومقاييس JSON الأساسية. اقرأ عن هذه التنسيقات في [المقال المنفصل](../configure-statistics-service.md).

!!! تحذير "دعم خدمة المراقبة على عقدة CDN"
    يرجى ملاحظة أن خدمة `collectd` غير مدعومة بواسطة [عقد CDN من Wallarm](../../installation/cdn-node.md).

## الحاجة إلى المراقبة

يمكن أن يؤدي الفشل أو العمل غير المستقر في وحدة Wallarm إلى الرفض الكامل أو الجزئي لطلبات المستخدمين لتطبيق محمي بواسطة عقدة التصفية.

يمكن أن يؤدي الفشل أو العمل غير المستقر في وحدة التحليلات اللاحقة إلى عدم إمكانية الوصول إلى الوظائف التالية:
*   تحميل بيانات الهجوم إلى سحابة Wallarm. نتيجة لذلك، لن يتم عرض الهجمات على بوابة Wallarm.
*   اكتشاف الهجمات السلوكية (انظر [هجمات القوة الغاشمة][av-bruteforce]).
*   الحصول على معلومات حول بنية التطبيق المحمي.

يمكنك مراقبة كل من وحدة Wallarm ووحدة التحليلات اللاحقة حتى لو كانت الأخيرة [مُثبتة بشكل منفصل][doc-postanalitycs].

!!! معلومات "اتفاقية المصطلحات"

    لمراقبة وحدة Wallarm ووحدة التحليلات اللاحقة، يتم استخدام نفس الأدوات والطرق؛ لذلك، سيُشار إلى كلا الوحدتين كـ "عقدة تصفية" طوال هذا الدليل، ما لم يُذكر خلاف ذلك.
    
    جميع المستندات التي تصف كيفية إعداد المراقبة لعقدة التصفية مناسبة لـ

    *   وحدات Wallarm المنشورة بشكل منفصل،
    *   وحدات التحليلات اللاحقة المنشورة بشكل منفصل، و
    *   وحدات Wallarm والتحليلات اللاحقة المنشورة بشكل مشترك.


## متطلبات المراقبة

لكي تعمل المراقبة، يشترط أن:

* NGINX يعيد الإحصائيات إلى عقدة التصفية (`wallarm_status on`),
* وضع التصفية في [وضع](../configure-wallarm-mode.md#available-filtration-modes) `المراقبة`/`الحجب الآمن`/`الحجب`.
  
بشكل افتراضي، هذه الخدمة متاحة على `http://127.0.0.8/wallarm-status`. قد يختلف العنوان إذا كنت قد [غيرت](../configure-statistics-service.md#changing-an-ip-address-andor-port-of-the-statistics-service)ه.

## كيف تبدو المقاييس

### شكل مقاييس `collectd`

يملك معرف مقياس `collectd` التالي الصيغة:

```
host/plugin[-plugin_instance]/type[-type_instance]
```

حيث
*   `host`: اسم المجال الكامل المؤهل (FQDN) للمضيف الذي يتم الحصول على المقياس له
*   `plugin`: اسم الإضافة التي تم الحصول على المقياس بها،
*   `-plugin_instance`: نموذج الإضافة، إذا كان موجودًا،
*   `type`: نوع قيمة المقياس. الأنواع المسموح بها:
    *   `counter`
    *   `derive`
    *   `gauge` 
    
    معلومات مفصلة حول أنواع القيم متوفرة [هنا][link-data-source].

*   `-type_instance`: نموذج النوع، إذا كان موجودًا. نموذج النوع معادل للقيمة التي نرغب في الحصول على المقياس لها.

وصف كامل لتنسيقات المقاييس متوفر [هنا][link-collectd-naming].

### شكل مقاييس `collectd` الخاصة بـ Wallarm

تستخدم عقدة التصفية `collectd` لجمع مقاييس خاصة بـ Wallarm.

مقاييس NGINX مع وحدة Wallarm لها الصيغة التالية:

```
host/wallarm_nginx/type-type_instance
```

مقاييس وحدة التحليلات اللاحقة لها الصيغة التالية:

```
host/wallarm-tarantool/type-type_instance
```


!!! معلومات "أمثلة على المقاييس"
    بالنسبة لعقدة التصفية على المضيف `node.example.local`:

    * `node.example.local/wallarm_nginx/gauge-abnormal` هو مقياس عدد الطلبات المعالجة؛
    * `node.example.local/wallarm-tarantool/gauge-export_delay` هو مقياس تأخير تصدير Tarantool بالثواني.
    
    قائمة كاملة بالمقاييس التي يمكن مراقبتها متاحة [هنا][doc-available-metrics].


## طرق جمع المقاييس

يمكنك جمع المقاييس من عقدة التصفية بعدة طرق:
*   عن طريق تصدير البيانات مباشرة من خدمة `collectd`
    *   [عبر إضافة الشبكة لـ `collectd`][doc-network-plugin].
    
        تمكن هذه [الإضافة][link-network-plugin] من تنزيل المقاييس من عقدة التصفية إلى خادم [`collectd`][link-collectd-networking] أو إلى قاعدة بيانات [InfluxDB][link-influxdb].
        
        
        !!! معلومات "InfluxDB"
            يمكن استخدام InfluxDB لتجميع المقاييس من `collectd` ومصادر بيانات أخرى مع تصور لاحق (على سبيل المثال، نظام مراقبة [Grafana][link-grafana] لتصور المقاييس المخزنة في InfluxDB).
        
    *   [عبر إحدى إضافات الكتابة لـ `collectd`][doc-write-plugins].
  
        على سبيل المثال، يمكنك تصدير البيانات المجمعة إلى [Graphite][link-graphite] باستخدام إضافة `write_graphite`.
  
        
        !!! معلومات "Graphite"
            يمكن استخدام Graphite كمصدر للبيانات لأنظمة المراقبة والتصور (على سبيل المثال، [Grafana][link-grafana]).
        
  
    هذه الطريقة مناسبة لأنواع نشر عقد التصفية التالية:

    *   في السحاب: Amazon AWS، Google Cloud؛
    *   على منصات Linux لـ NGINX/NGINX Plus.

*   [عن طريق تصدير البيانات عبر أداة `collectd-nagios`][doc-collectd-nagios].
  
    تتلقى هذه [الأداة][link-collectd-nagios] قيمة المقياس المحدد من `collectd` وتقدمها بتنسيق [متوافق مع Nagios][link-nagios-format].
  
    يمكنك تصدير المقاييس إلى أنظمة المراقبة [Nagios][link-nagios] أو [Zabbix][link-zabbix] باستخدام هذه الأداة.
  
    هذه الطريقة مدعومة بواسطة أي عقدة تصفية لـ Wallarm، بغض النظر عن طريقة النشر.
  
*   [عن طريق إرسال الإشعارات من `collectd`][doc-collectd-notices] عندما تصل المقياس إلى قيمة عتبة محددة مسبقًا.

    هذه الطريقة مدعومة بواسطة أي عقدة تصفية لـ Wallarm، بغض النظر عن طريقة النشر.