[img-zabbix-hosts]:           ../../images/monitoring/zabbix-hosts.png
[img-zabbix-items]:           ../../images/monitoring/zabbix-items.png
[img-zabbix-widget]:          ../../images/monitoring/zabbix-widget.png
[img-global-view-0]:          ../../images/monitoring/global-view-0-value.png
[img-global-view-16]:         ../../images/monitoring/global-view-16-value.png

[doc-zabbix-parameters]:      collectd-zabbix.md#4-add-custom-parameters-to-the-zabbix-agent-configuration-file-on-the-filter-node-host-to-get-the-metrics-you-need

#   التعامل مع مقاييس عقدة الفلتر في Zabbix

ادخل لـ `http://10.0.30.30` للوصول إلى صفحة تسجيل الدخول لواجهة ويب Zabbix. سجل الدخول إلى الواجهة الويب باستخدام اسم المستخدم المعياري (`Admin`) وكلمة المرور (`zabbix`). 

لمراقبة مقاييس عقدة الفلتر `node.example.local`, قم بالإجراءات التالية:

1.  إنشاء مستضيف جديد باتباع الخطوات التالية:
    1.  انتقل إلى التبويب *إعداد → المستضيفون* واضغط على زر *إنشاء مستضيف*.
    2.  املأ الاسم الكامل المؤهل لمستضيف عقدة الفلتر في حقل *اسم المستضيف* (`node.example.local`).
    3.  اختر المجموعة التي تريد وضع المستضيف فيها من حقل *المجموعات* (على سبيل المثال، يمكنك استخدام مجموعة "خوادم لينكس" المحددة مسبقاً، أو إنشاء مجموعة مخصصة).
    4.  املأ عنوان IP لعقدة الفلتر (`10.0.30.5`) في مجموعة معامل *واجهات الوكيل*. اترك قيمة المنفذ الافتراضية (`10050`) دون تغيير.
      
        
        !!! معلومة "الاتصال باستخدام اسم النطاق"
            إذا لزم الأمر، يمكنك إعداد اسم نطاق للاتصال بوكيل Zabbix. للقيام بذلك، قم بتغيير الإعدادات المناسبة وفقًا لذلك.
        
      
    5.  قم بضبط الإعدادات الأخرى، إذا لزم الأمر.
    6.  تأكد من تحديد خانة الاختيار *مُفعل*.
    7.  أكمل عملية إنشاء المستضيف بالضغط على زر *إضافة*.
    
    ![ضبط مُستضيف Zabbix][img-zabbix-hosts]
   
2.  إضافة المقاييس التي ينبغي مراقبتها لمستضيف عقدة الفلتر. لإضافة مقياس واحد، اتبع الخطوات أدناه:
    1.  اضغط على اسم المستضيف المُنشأ `node.example.local` الموجود في قائمة المستضيفين على التبويب *إعداد → المستضيفون*.
    2.  ستفتح صفحة بيانات المستضيف. انتقل إلى تبويب *العناصر* واضغط على زر *إنشاء عنصر*.
    3.  املأ اسم المقياس في حقل *الاسم* (على سبيل المثال، `هجمات Wallarm NGINX`).
    4.  اترك المعاملات *النوع*، *واجهة المستضيف*، و*نوع المعلومات* دون تغيير.
    5.  أدخل اسم مفتاح المقياس في حقل *المفتاح* (كما هو محدد في `UserParameter=` في [تكوين وكيل Zabbix][doc-zabbix-parameters]؛ على سبيل المثال، `wallarm_nginx-gauge-abnormal`).
    6.  إذا لزم الأمر، قم بضبط تكرار تحديث قيمة المقياس والمعاملات الأخرى.
    7.  تأكد من تحديد خانة الاختيار *مُفعل*.
    8.  أكمل عملية إضافة المقياس بالضغط على زر *إضافة*.
    
    ![إضافة مقياس][img-zabbix-items]

3.  تكوين تصور المقاييس المضافة:
    1.  اضغط على شعار Zabbix في الزاوية العلوية اليسرى لواجهة الويب للوصول إلى لوحة التحكم. 
    2.  اضغط على زر *تعديل لوحة التحكم* لإجراء تغييرات عليها:
        1.  أضف ودجة بالضغط على زر *إضافة ودجة*.
        2.  اختر نوع الودجة المطلوب (على سبيل المثال، "نص عادي") من قائمة *النوع* المنسدلة.
        3.  املأ أي اسم مناسب في حقل *الاسم*.
        4.  أضف المقياس المطلوب إلى قائمة *العناصر* (مثل `هجمات Wallarm NGINX` الجديد).
        5. تأكد من تحديد خانتي الاختيار *عرض النص كـ HTML* و*العناصر الديناميكية*.
        6. أكمل مرشح *إضافة ودجة* بالضغط على زر *إضافة*.
        
        ![إضافة ودجة بالمقياس][img-zabbix-widget]
      
    3.  احفظ التغييرات التي قمت بها على لوحة التحكم بالضغط على زر *حفظ التغييرات*.

4.  تحقق من عملية المراقبة: 
    1.  تأكد من أن العدد الحالي للطلبات المُعالجة في ودجة Zabbix يتطابق مع إخراج `wallarm-status` على عقدة الفلتر.
    
        1.  نفذ الأمر `curl http://127.0.0.8/wallarm-status` إذا كانت التهيئة الافتراضية لخدمة الإحصاءات قيد الاستخدام. 
        2.  وإلا، راجع ملف التكوين `/etc/nginx/conf.d/wallarm-status.conf` (`/etc/nginx/wallarm-status.conf` للمثبت كل في واحد) لبناء الأمر الصحيح المشابه لما سبق ذكره.
        ```
        {"requests":64,"attacks":16,"blocked":0,"abnormal":64,"tnt_errors":0,"api_errors":0,"requests_lost":0,"segfaults":0,"memfaults":0,"softmemfaults":0,"time_detect":0,"db_id":46,"custom_ruleset_id":4,"proton_instances": { "total":2,"success":2,"fallback":0,"failed":0 },"stalled_workers_count":0,"stalled_workers":[] }
        ```

        ![عرض قيمة المقياس][img-global-view-0]

    2.  قم بأداء هجوم اختباري على تطبيق محمي بواسطة عقدة الفلتر. للقيام بذلك، يمكنك إرسال طلب ضار للتطبيق إما بأداة `curl` أو متصفح.
        
        --8<-- "../include/monitoring/sample-malicious-request.md"
        
    3. تأكد من أن عداد الطلبات قد زاد في كل من إخراج `wallarm-status` وودجة Zabbix:
    
        --8<-- "../include/monitoring/wallarm-status-output-padded-latest.md"

        ![عرض تغيير قيمة المقياس][img-global-view-16]

لوحة التحكم Zabbix تعرض الآن المقياس `curl_json-wallarm_nginx/gauge-abnormal` لعقدة الفلتر `node.example.local`.