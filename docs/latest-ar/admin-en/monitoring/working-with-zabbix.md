[img-zabbix-hosts]:           ../../images/monitoring/zabbix-hosts.png
[img-zabbix-items]:           ../../images/monitoring/zabbix-items.png
[img-zabbix-widget]:          ../../images/monitoring/zabbix-widget.png
[img-global-view-0]:          ../../images/monitoring/global-view-0-value.png
[img-global-view-16]:         ../../images/monitoring/global-view-16-value.png

[doc-zabbix-parameters]:      collectd-zabbix.md#4-add-custom-parameters-to-the-zabbix-agent-configuration-file-on-the-filter-node-host-to-get-the-metrics-you-need

#   العمل مع مقاييس عقدة الفلترة في زابيكس

اذهب إلى `http://10.0.30.30` للوصول إلى صفحة تسجيل الدخول لواجهة ويب زابيكس. سجّل الدخول إلى الواجهة الويب باستخدام اسم المستخدم الافتراضي (`Admin`) وكلمة المرور (`zabbix`).

لمراقبة مقاييس عقدة الفلترة `node.example.local`، قم بالخطوات التالية:

1.  أنشئ مضيفاً جديداً عبر الخطوات التالية:
    1.  اذهب إلى تبويب *التكوين → المضيفون* واضغط على زر *إنشاء مضيف*.
    2.  املأ الاسم الكامل لمضيف عقدة الفلترة في حقل *اسم المضيف* (`node.example.local`).
    3.  اختر المجموعة التي تريد وضع المضيف فيها من حقل *المجموعات* (على سبيل المثال، يمكنك استخدام مجموعة "خوادم لينكس" المعرفة مسبقاً، أو إنشاء مجموعة مخصصة).
    4.  املأ عنوان الـ IP لمضيف عقدة الفلترة (`10.0.30.5`) في مجموعة معطيات *واجهات العميل*. اترك قيمة المنفذ الافتراضي (`10050`) دون تغيير.
        
        
        !!! info "الاتصال باستخدام اسم النطاق"
            إذا لزم الأمر، يمكنك ضبط اسم النطاق للاتصال بعميل زابيكس. للقيام بذلك، قم بتغيير الإعدادات المناسبة وفقاً لذلك.
        
        
    5.  قم بتكوين الإعدادات الأخرى إذا لزم الأمر.
    6.  تأكد من أن خانة الاختيار *مُفعل* محددة.
    7.  أكمل عملية إنشاء المضيف بالضغط على زر *إضافة*.
    
    ![تكوين مضيف زابيكس][img-zabbix-hosts]
   
2.  أضف المقاييس التي يجب مراقبتها لمضيف عقدة الفلترة. لإضافة مقياس واحد، اتبع الخطوات التالية:
    1.  انقر على اسم المضيف المُنشأ `node.example.local` في قائمة المضيفين ضمن تبويب *التكوين → المضيفون*.
    2.  ستفتح صفحة بيانات المضيف. قم بالتبديل إلى تبويب *العناصر* واضغط على زر *إنشاء عنصر*.
    3.  املأ اسم المقياس في حقل *الاسم* (مثلاً، `هجمات Wallarm NGINX`).
    4.  اترك معطيات *النوع*، *واجهة المضيف*، و*نوع المعلومة* دون تغيير.
    5.  أدخل اسم المفتاح للمقياس في حقل *المفتاح* (كما هو مُحدَّد في `UserParameter=` في [إعدادات عميل زابيكس][doc-zabbix-parameters]؛ على سبيل المثال، `wallarm_nginx-gauge-abnormal`).
    6.  إذا لزم الأمر، قم بضبط تواتر تحديث قيمة المقياس والمعطيات الأخرى.
    7.  تأكد من أن خانة الاختيار *مُفعل* محددة.
    8.  أكمل عملية إضافة المقياس بالضغط على زر *إضافة*.
    
    ![إضافة مقياس][img-zabbix-items]

3.  قم بتكوين تصور المقاييس المضافة:
    1.  اضغط على شعار زابيكس في الزاوية اليسرى العليا من الواجهة الويب للوصول إلى اللوحة الرئيسية.
    2.  اضغط على زر *تعديل اللوحة* لإجراء التغييرات على اللوحة:
        1.  أضف قطعة بالضغط على زر *إضافة قطعة*.
        2.  اختر نوع القطعة المطلوب (على سبيل المثال، “نص بسيط”) من القائمة المنسدلة *النوع*.
        3.  املأ أي اسم مناسب في حقل *الاسم*.
        4.  أضف المقياس المطلوب إلى قائمة *العناصر* (مثلاً، المقياس الجديد `هجمات Wallarm NGINX`).
        5. تأكد من تحديد خانتي الاختيار *عرض النص كـ HTML* و*العناصر الديناميكية*.
        6. أكمل معالج *إضافة قطعة* بالضغط على زر *إضافة*.
        
        ![إضافة قطعة بالمقياس][img-zabbix-widget]
      
    3.  احفظ التغييرات التي قمت بها على اللوحة بالضغط على زر *حفظ التغييرات*.

4.  تحقق من عملية المراقبة:
    1.  تأكد من أن عدد الطلبات المُعالجة الحالي في قطعة زابيكس يطابق ناتج `wallarm-status` على عقدة الفلترة.
    
        1.  نفذ الأمر `curl http://127.0.0.8/wallarm-status` إذا كان استخدام التكوين الافتراضي لخدمة الإحصائيات.
        2.  وإلا، راجع ملف التكوين `/etc/nginx/conf.d/wallarm-status.conf` (`/etc/nginx/wallarm-status.conf` للمُثبت الشامل) لتكوين الأمر الصحيح المماثل لما سبق.
        ```
        {"requests":64,"attacks":16,"blocked":0,"abnormal":64,"tnt_errors":0,"api_errors":0,"requests_lost":0,"segfaults":0,"memfaults":0,"softmemfaults":0,"time_detect":0,"db_id":46,"custom_ruleset_id":4,"proton_instances": {"total":2,"success":2,"fallback":0,"failed":0},"stalled_workers_count":0,"stalled_workers":[]}
        ```

        ![عرض قيمة المقياس][img-global-view-0]

    2.  نفذ هجوم تجريبي على تطبيق محمي بواسطة عقدة الفلترة. للقيام بذلك، يمكنك إرسال طلب ضار إلى التطبيق إما بواسطة أداة `curl` أو متصفح.
        
        --8<-- "../include/monitoring/sample-malicious-request.md"
        
    3.  تأكد من زيادة عداد الطلبات في كل من ناتج `wallarm-status` وقطعة زابيكس:
    
        --8<-- "../include/monitoring/wallarm-status-output-padded-latest.md"

        ![عرض تغير قيمة المقياس][img-global-view-16]

لوحة زابيكس تعرض الآن المقياس `curl_json-wallarm_nginx/gauge-abnormal` لعقدة الفلترة `node.example.local`.