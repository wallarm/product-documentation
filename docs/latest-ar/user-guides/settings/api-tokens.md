# رموز API

في واجهة Wallarm → **الإعدادات** → **رموز API**، يمكنكم إدارة الرموز الخاصة ب[مصادقة طلبات API](../../api/overview.md).

![رمز Wallarm API][img-api-tokens-edit]

هذا القسم متاح لمستخدمي **[جميع الأدوار][user-roles-article]** باستثناء **القراءة فقط** و**مطور API**.

## تكوين الرموز

يمكن للمستخدمين إنشاء رموزهم الخاصة واستخدامها (أي، مشاهدة قيمة الرمز وتضمينها في طلب API لمصادقته). يمكنك تعيين أذونات لكل رمز خاص بك، ولكن لا يمكن أن تكون أوسع من الأذونات التي لديك. بشكل اختياري، يمكنك تحديد تاريخ انتهاء صلاحية للرمز - إذا تم تحديده، سيتم تعطيل الرمز بعد ذلك التاريخ. كذلك، يمكنك تعطيل/تفعيل رموزك يدويًا.

يمكن تجديد قيمة الرمز في أي لحظة.

يمكن ل**المدراء** / **المدراء العامين** مشاهدة وإدارة جميع الرموز في حساب الشركة. بجانب الرموز الخاصة، يمكنهم إنشاء رموز مشتركة، يمكن للمدراء الآخرين رؤيتها/استخدامها. عند تحديد الأذونات للرموز، يمكنهم اختيار أخذ هذه الأذونات من الدور المحدد:

* مدير
* محلل
* مطور API
* قراءة فقط
* النشر - يُستخدم الرمز ذو هذا الدور ل[نشر عقد Wallarm](../../user-guides/nodes/nodes.md#creating-a-node)
* مخصص - يعود إلى اختيار الأذونات يدويًا. لإنشاء رمز ل[اختبار أمان OpenAPI]، الدور المخصص بالأذونات المقابلة مطلوب.

!!! info "خصوصية الرمز"
    لا يمكن للمستخدمين الآخرين (حتى المدراء) استخدام الرموز الخاصة بك (أي، مشاهدة أو نسخ قيمة الرمز). بالإضافة إلى ذلك، لن يتمكن المستخدمون غيرالمدراء حتى من رؤية رموزك.

ضع في اعتبارك أنه:

* إذا تم [تعطيل](../../user-guides/settings/users.md#disable-access-for-a-user) مالك الرمز، جميع رموزه ستتم تعطيلها تلقائيًا كذلك.
* إذا تم تقليص أذونات مالك الرمز، سيتم إزالة الأذونات المقابلة من جميع رموزه.
* جميع الرموز المعطلة تُحذف تلقائيًا بعد أسبوع من تعطيلها.
* لتفعيل رمز تم تعطيله سابقًا، احفظه بتاريخ انتهاء صلاحية جديد.

## إنشاء الرموز بأذونات دور عالمية

لإنشاء رمز API بأذونات مبنية على ال[أدوار](../../user-guides/settings/users.md#user-roles) العالمية مثل المدير العالمي أو المحلل العالمي أو القراءة فقط العالمية، اتبع الخطوات التالية:

1. تسجيل الدخول إلى واجهة Wallarm الأمريكية [US](https://us1.my.wallarm.com/) أو الأوروبية [EU](https://my.wallarm.com/) تحت [المستخدم المناسب](#configuring-tokens).
1. في الأعلى اليمين، اختر `؟` → **واجهة Wallarm API**. تُفتح واجهة Wallarm API:

    * https://apiconsole.us1.wallarm.com/ للسحابة الأمريكية
    * https://apiconsole.eu1.wallarm.com/ للسحابة الأوروبية

    لاحظ أن واجهة Wallarm API تسترجع بيانات المصادقة من واجهة Wallarm. إذا غيرت المستخدم في واجهة Wallarm، قم بتحديث صفحة واجهة Wallarm API للمصادقة الجديدة.
 
1. إرسال طلب POST إلى المسار `/v2/api_tokens` بالمعاملات التالية:

    ```bash
    {
    "client_id": <CLIENT_ID>,
    "realname": "<اسم_رمز_API_الخاص_بك>",
    "user_id": <USER_ID>,
    "enabled": true,
    "expire_at": "<تاريخ_ووقت_انتهاء_صلاحية_الرمز>",
    "permissions": [
        "<الدور_العالمي_المطلوب>"
    ]
    }
    ```

    حيث:

    * "<اسم_رمز_API_الخاص_بك>" يُوصى بأن يوضح غرض الرمز.
    * "<USER_ID>" يحدد المستخدم الذي يمتلك الرمز، و"<CLIENT_ID>" - حساب الشركة الذي ينتمي إليه هذا المستخدم.
    
        يمكن الحصول على هذه الأرقام التعريفية بإرسال طلب POST إلى المسار `/v1/user`.

    * "<تاريخ_ووقت_انتهاء_صلاحية_الرمز>" بتنسيق [ISO 8601](https://www.cl.cam.ac.uk/~mgk25/iso-time.html)، على سبيل المثال `2033-06-13T04:56:01.037Z`.
    * "<الدور_العالمي_المطلوب>" يمكن أن يكون:
        
        * `partner_admin` للمدير العالمي
        * `partner_analytic` للمحلل العالمي
        * `partner_auditor` للقراءة فقط العالمية

    ??? info "مثال"
        ```bash
        {
        "client_id": 1010,
        "realname": "رمز لإنشاء مستأجر",
        "user_id": 10101011,
        "enabled": true,
        "expire_at": "2033-06-13T04:56:01.037Z",
        "permissions": [
            "partner_admin"
        ]
        }
        ```

        ينشئ هذا الطلب رمز API بأذونات المدير العالمي الذي يمكن استخدامه ل[إنشاء مستأجر](../../installation/multi-tenant/configure-accounts.md#step-3-create-the-tenant-via-the-wallarm-api).

1. من الاستجابة، احصل على `id` الرمز المُنشأ وأرسل طلب GET إلى المسار `/v2/api_tokens/{id}/secret` باستخدام هذا `id`.
1. انسخ قيمة `secret` من الاستجابة واستخدمها كرمز API لمصادقة الطلب.

    !!! info "نسخ الرمز من واجهة Wallarm"
        نظرًا لأن رمز API المُنشأ يتم عرضه في واجهة Wallarm، يمكنك أيضًا نسخه من قائمة الرمز في **الإعدادات** → **رموز API**.

## الرموز التوافقية الخلفية

كان يتم استخدام UUID ومفتاح سري للمصادقة على الطلبات والذي تم استبداله الآن بالرموز. UUID ومفتاح السري الذي كنت تستخدمه تم تحويلهما تلقائيًا إلى رمز **توافقي خلفي**. مع هذا الرمز، ستستمر الطلبات المصادق عليها بـ UUID ومفتاح السري في العمل.

!!! warning "تجديد الرمز أو تفعيل SSO"
    إذا جددت قيمة الرمز التوافقي الخلفي أو فعّلت [SSO/SSO الصارم](../../admin-en/configuration-guides/sso/employ-user-auth.md) لمالك هذا الرمز، فإن التوافق الخلفي ينتهي - جميع الطلبات المصادق عليها بـ UUID ومفتاح السري القديم ستتوقف عن العمل.

يمكنك أيضًا استخدام القيمة المنشأة للرمز التوافقي الخلفي بتمريرها في معامل الرأس `X-WallarmApi-Token` لطلباتك.

يتمتع الرمز التوافقي الخلفي بنفس أذونات دور المستخدم، ولا يتم عرض هذه الأذونات في نافذة الرمز ولا يمكن تغييرها. إذا كنت ترغب في التحكم بالأذونات، تحتاج إلى إزالة رمز توافقي خلفي وإنشاء رمز جديد.

## رموز API مقابل رموز العقد

يمكن استخدام رموز API الموضحة في هذا المقال لمصادقة [طلبات Wallarm Cloud API](../../api/overview.md) من أي عميل وبأي مجموعة من الأذونات.

أحد العملاء الذين يصلون إلى Wallarm Cloud API هو عقدة تصفية Wallarm نفسها. لمنح عقدة تصفية وصول إلى API Wallarm Cloud، بجانب رموز API، يمكنك استخدام رموز العقد. [اعرف الاختلاف وما يجب التفضيل ←](../../user-guides/nodes/nodes.md#api-and-node-tokens-for-node-creation)

!!! info "رموز API غير مدعومة ببعض خيارات النشر"
    حاليًا، لا يمكن استخدام رموز API لمتحكمات [Kong Ingress](../../installation/kubernetes/kong-ingress-controller/deployment.md) ونشر AWS القائم على [وحدة Terraform](../../installation/cloud-platforms/aws/terraform-module/overview.md). استخدم رموز العقد بدلاً من ذلك.