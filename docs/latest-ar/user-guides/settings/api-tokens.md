[user-roles-article]:       ../../user-guides/settings/users.md#user-roles
[img-api-tokens-edit]:      ../../images/api-tokens-edit.png

# رموز الواجهة البرمجية للتطبيقات 

في وحدة تحكم Wallarm → **الإعدادات** → **رموز الواجهة البرمجية للتطبيقات**، يُمكنك إدارة الرموز لـ[مصادقة طلب الواجهة البرمجية للتطبيقات](../../api/overview.md).

![رمز واجهة برمجة تطبيقات Wallarm][img-api-tokens-edit]

هذا القسم متاح للمستخدمين من **[جميع الأدوار][user-roles-article]** باستثناء **القراءة فقط** و **مطور الواجهة البرمجية للتطبيقات**.

## تكوين الرموز

يمكن للمستخدمين إنشاء رموزهم الخاصة واستخدامها (أي عرض قيمة الرمز وتضمينه في طلب الواجهة البرمجية للتطبيقات لمصادقته). لكل رمز خاص بك، يمكنك تعيين الأذونات، ولكن ليس أوسع من التي لديك كمستخدم. اختياريًا، يمكنك تعيين تاريخ انتهاء للرمز - إذا تم تعيينه، سيتم تعطيل الرمز بعد هذا التاريخ. كما يمكنك تعطيل أو تمكين رموزك يدويًا.

يمكنك تجديد قيمة الرمز في أي وقت.

**المدراء** / **المدراء العالميين** يمكنهم عرض وإدارة جميع الرموز في حساب الشركة. بجانب الرموز الخاصة، يمكنهم إنشاء رموز مشتركة، يمكن عرضها/استخدامها من قبل المدراء الآخرين. عند تحديد الأذونات للرموز، يمكنهم اختيار أخذ هذه الأذونات من الدور المحدد:

* المدير
* المحلل
* مطور الواجهة البرمجية للتطبيقات
* القراءة فقط
* النشر - تُستخدم رموز الواجهة البرمجية للتطبيقات ذات هذا الدور لـ[نشر عقد Wallarm](../../user-guides/nodes/nodes.md#creating-a-node)
* مخصص - يعود إلى اختيار الأذونات اليدوي. لإنشاء رمز لـ[اختبار أمان OpenAPI]، الدور المخصص بالأذونات المقابلة مطلوب.

!!! info "خصوصية الرمز"
    لا يمكن لأي مستخدمين آخرين (حتى المدراء) استخدام رموزك الخاصة (أي عرض أو نسخ قيمة الرمز). بالإضافة إلى ذلك، لن يتمكن غير المدراء حتى من رؤية رموزك.

خذ بعين الاعتبار أن:

* إذا تم [تعطيل](../../user-guides/settings/users.md#disable-access-for-a-user) صاحب الرمز، ستتم تعطيل جميع رموزه تلقائيًا أيضًا.
* إذا تم تقليص أذونات صاحب الرمز، سيتم إزالة الأذونات المقابلة من جميع رموزه.
* جميع الرموز المعطلة سيتم إزالتها تلقائيًا بعد أسبوع من التعطيل.
* لتمكين رمز سبق تعطيله، احفظه مع تاريخ انتهاء جديد.

## إنشاء رموز بأذونات دور عالمي

لإنشاء رمز واجهة برمجية للتطبيقات بأذونات تعتمد على [الأدوار](../../user-guides/settings/users.md#user-roles) العالمية مثل المدير العالمي، المحلل العالمي أو القراءة العالمية فقط، اتبع الخطوات التالية:

1. قم بتسجيل الدخول إلى وحدة تحكم Wallarm الخاصة ب[الولايات المتحدة](https://us1.my.wallarm.com/) أو [الاتحاد الأوروبي](https://my.wallarm.com/) تحت [المستخدم المناسب](#configuring-tokens).
1. في الجزء العلوي الأيمن، حدد `؟` → **وحدة تحكم واجهة برمجة تطبيقات Wallarm**. سيتم فتح وحدة تحكم واجهة برمجة تطبيقات Wallarm:

    * https://apiconsole.us1.wallarm.com/ لسحابة الولايات المتحدة
    * https://apiconsole.eu1.wallarm.com/ لسحابة الاتحاد الأوروبي

    لاحظ أن وحدة تحكم واجهة برمجة تطبيقات Wallarm تسترجع بيانات المصادقة من وحدة تحكم Wallarm. إذا قمت بتغيير المستخدم في وحدة تحكم Wallarm، قم بتحديث صفحة وحدة تحكم واجهة برمجة تطبيقات Wallarm للمصادقة الجديدة.
 
1. أرسل طلب POST إلى مسار `/v2/api_tokens` بالمعلمات التالية:

    ```bash
    {
    "client_id": <CLIENT_ID>,
    "realname": "<NAME_FOR_YOUR_API_TOKEN>",
    "user_id": <USER_ID>,
    "enabled": true,
    "expire_at": "<TOKEN_EXPIRATION_DATE_AND_TIME>",
    "permissions": [
        "<REQUIRED_GLOBAL_ROLE>"
    ]
    }
    ```

    حيث:

    * `<NAME_FOR_YOUR_API_TOKEN>` يُوصى بشرح غرض الرمز.
    * `<USER_ID>` يُعرف المستخدم الذي يمتلك الرمز، و `<CLIENT_ID>` - حساب الشركة الذي ينتمي إليه هذا المستخدم.
    
        احصل على هذه المعرفات بإرسال طلب POST إلى مسار `/v1/user`.

    * `<TOKEN_EXPIRATION_DATE_AND_TIME>` بتنسيق [ISO 8601](https://www.cl.cam.ac.uk/~mgk25/iso-time.html)، على سبيل المثال `2033-06-13T04:56:01.037Z`.
    * `<REQUIRED_GLOBAL_ROLE>` يمكن أن يكون:
        
        * `partner_admin` للمدير العالمي
        * `partner_analytic` للمحلل العالمي
        * `partner_auditor` للقراءة العالمية فقط

    ??? info "المثال"
        ```bash
        {
        "client_id": 1010,
        "realname": "Token for tenant creation",
        "user_id": 10101011,
        "enabled": true,
        "expire_at": "2033-06-13T04:56:01.037Z",
        "permissions": [
            "partner_admin"
        ]
        }
        ```

        هذا الطلب ينشئ رمز واجهة برمجية للتطبيقات بأذونات المدير العالمي الذي يمكن استخدامه لـ[إنشاء المستأجر](../../installation/multi-tenant/configure-accounts.md#step-3-create-the-tenant-via-the-wallarm-api).

1. من الاستجابة، احصل على `id` الرمز المُنشأ وأرسل طلب GET إلى مسار `/v2/api_tokens/{id}/secret` باستخدام هذا `id`.
1. انسخ قيمة `secret` من الاستجابة واستخدمها كرمز واجهة برمجية للتطبيقات لمصادقة الطلب.

    !!! info "نسخ الرمز من وحدة تحكم Wallarm"
        تظهر الرموز الواجهة برمجية للتطبيقات المنشأة في وحدة تحكم Wallarm، يمكنك أيضًا نسخها من قائمة الرمز في **الإعدادات** → **رموز الواجهة البرمجية للتطبيقات**.

## رموز متوافقة مع الإصدارات السابقة

كان يُستخدم سابقًا معرف UUID ومفتاح سري لمصادقة الطلب والذي تم استبداله الآن بالرموز. تم تحويل معرف UUID والمفتاح السري الذي تستخدمه تلقائيًا إلى الرمز **المتوافق مع الإصدارات السابقة**. مع هذا الرمز، ستستمر الطلبات المصادق عليها بمعرف UUID والمفتاح السري في العمل.

!!! warning "تجديد الرمز أو تمكين SSO"
    إذا جددت قيمة الرمز المتوافق مع الإصدارات السابقة أو مكنت [SSO/SSO الصارم](../../admin-en/configuration-guides/sso/employ-user-auth.md) لمالك هذا الرمز، تنتهي التوافقية الخلفية - جميع الطلبات التي تم مصادقتها بمعرف UUID والمفتاح السري القديم ستتوقف عن العمل.

يمكنك أيضًا استخدام القيمة المُنشأة للرمز المتوافق مع الإصدارات السابقة مرورًا بها في معلمة رأس `X-WallarmApi-Token` لطلباتك.

للرمز المتوافق مع الإصدارات السابقة نفس الأذونات كما يفعل دور المستخدم، لا تُعرض هذه الأذونات في نافذة الرمز ولا يمكن تغييرها. إذا كنت ترغب في التحكم في الأذونات، تحتاج إلى إزالة رمز متوافق مع الإصدارات السابقة وإنشاء واحد جديد.

## رموز واجهة برمجية للتطبيقات مقابل رموز العقد

يمكنك استخدام رموز الواجهة البرمجية للتطبيقات الموصوفة في هذا المقال لـ[مصادقة طلب واجهة برمجية للتطبيقات للسحابة Wallarm](../../api/overview.md) من أي عميل وبأي مجموعة من الأذونات.

أحد العملاء الذين يصلون إلى واجهة برمجية التطبيقات لسحابة Wallarm هو عقدة التصفية Wallarm نفسها. لمنح عقدة التصفية الوصول إلى واجهة برمجية التطبيقات لسحابة Wallarm، بجانب رموز الواجهة البرمجية للتطبيقات، يمكنك استخدام رموز العقد. [تعرف على الفرق وما يفضل استخدامه →](../../user-guides/nodes/nodes.md#api-and-node-tokens-for-node-creation)

!!! info "رموز الواجهة برمجية للتطبيقات غير مدعومة ببعض خيارات النشر"
    حاليًا لا يمكن استخدام رموز واجهة برمجية التطبيقات لـ[متحكمات Kong Ingress](../../installation/kubernetes/kong-ingress-controller/deployment.md) والنشر باستخدام [وحدة Terraform لـ AWS](../../installation/cloud-platforms/aws/terraform-module/overview.md). استخدم بدلاً من ذلك رموز العقد.