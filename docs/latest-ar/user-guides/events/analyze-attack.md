[link-check-attack]:        check-attack.md
[link-false-attack]:        false-attack.md
[img-analyze-attack]:       ../../images/user-guides/events/analyze-attack.png
[img-analyze-attack-raw]:   ../../images/user-guides/events/analyze-attack-raw.png
[img-current-attack]:       ../../images/user-guides/events/analyze-current-attack.png
[glossary-attack-vector]:   ../../glossary-en.md#malicious-payload

# تحليل الأحداث 

يمكنك التحقق من الأحداث في أقسام **الهجمات** و **الحوادث** من وحدة تحكم Wallarm.

## تحليل حدث

يمكنك الحصول على معلومات حول حدث من نوع معين (هجوم أو حادث) من خلال التحقيق في جميع أعمدة الجدول الموضحة في [فحص الهجمات](check-attack.md) و [فحص الحوادث](check-incident.md).

## تحليل الطلبات في حدث

1. حدد هجومًا أو حادثًا تهمك.
2. انقر على الرقم في عمود *الطلبات*.

بالنقر فوق الرقم سيتم فتح جميع الطلبات في الحدث المحدد.

![الطلبات في الحدث][img-analyze-attack]

يعرض كل طلب المعلومات المرتبطة الموجودة في الأعمدة التالية:

* *التاريخ*: تاريخ ووقت الطلب.
* *الحمولة*: [الحمولة الخبيثة][glossary-attack-vector]. النقر على القيمة في عمود الحمولة يعرض معلومات الإشارة عن نوع الهجوم.
* *المصدر*: عنوان IP الذي انطلقت منه الطلب. النقر على عنوان IP يضيف قيمة عنوان IP إلى حقل البحث. يتم عرض المعلومات التالية أيضًا إذا تم العثور عليها في قاعدة بيانات IP2Location أو ما يشابهها:
     * البلد / المنطقة التي تم فيها تسجيل عنوان IP.
     * نوع المصدر، على سبيل المثال **الوكيل**، **Tor** أو منصة السحابة التي تم تسجيل IP فيها، إلخ.
     * سيظهر تسمية **عناوين IP الخبيثة** إذا كان معروفًا أن عنوان IP مستخدم في أنشطة خبيثة. هذا يعتمد على السجلات العامة والتحقق من الخبراء.
* *الحالة*: حالة حجب الطلب (تعتمد على [وضع ترشيح المرور](../../admin-en/configure-wallarm-mode.md)).
* *الرمز*: رمز حالة الاستجابة لخادم الطلب. إذا كان العقدة المرشحة قد حظرت الطلب، سيكون الرمز `403` أو [قيمة مخصصة أخرى](../../admin-en/configuration-guides/configure-block-page-and-code.md).
* *الحجم*: حجم استجابة الخادم.
* *الوقت*: وقت استجابة الخادم.

إذا كان الهجوم يحدث في اللحظة الحالية، يتم عرض تسمية *"الآن"* تحت رسم الطلب.

![هجوم يحدث حاليًا][img-current-attack]

توفر عرض الطلبات الخيارات التالية لضبط السلوك الدقيق لـ Wallarm:

* [**تمييز كإيجابي زائف** و **كاذب**](false-attack.md) للإبلاغ عن طلبات مشروعة تم وضع علامة عليها كهجمات.
* **تعطيل base64** للإشارة إلى أن تحليل القاعدة base64 تم تطبيقه بشكل غير صحيح على عنصر الطلب.

    يفتح الزر نموذجًا مملوءًا مسبقًا لإعداد [القاعدة التي تعطل التحليل](../../user-guides/rules/request-processing.md#managing-parsers).
*   **القاعدة** لخلق [أي قاعدة فردية](../rules/rules.md#rule) للتعامل مع بعض الطلبات.

    يفتح الزر نموذجًا لإعداد القاعدة مملوءًا مسبقًا ببيانات الطلب.

* يتم عرض قسم **اكتشاف من قواعد مخصصة** إذا تم اكتشاف الهجوم بواسطة [قاعدة عميل تعتمد على التعبير النظامي](../../user-guides/rules/regex-rule.md). يحتوي القسم على رابط للقاعدة المتناظرة (يمكن أن يكون هناك أكثر من واحد) - انقر على الرابط للوصول إلى تفاصيل القاعدة وتحريرها إذا لزم الأمر.

    ![هجوم تم اكتشافه بواسطة قاعدة عميل تعتمد على التعبير النظامي - تحرير القاعدة](../../images/user-guides/search-and-filters/detected-by-custom-rule.png)

    [تعلم كيفية البحث عن هذه الهجمات →](../../user-guides/search-and-filters/use-search.md#search-by-regexp-based-customer-rule)

## تحليل الطلب بتنسيق الأصلي

تنسيق الأصلي للطلب هو أقصى مستوى ممكن من التفصيل. يتيح عرض تنسيق الأصلي في وحدة تحكم Wallarm أيضًا نسخ الطلب بتنسيق cURL.

لعرض طلب بتنسيق الأصلي، قم بتوسيع هجوم مطلوب ثم الطلب ضمنه.

![التنسيق الأصلي للطلب][img-analyze-attack-raw]

## تحليل الطلبات من عناوين IP مدرجة في القائمة السوداء

تثبت [إدراج في القائمة السوداء](../../user-guides/ip-lists/overview.md) كإجراء دفاعي فعال ضد هجمات عالية الحجم من أنواع مختلفة. يتم تحقيق هذا عن طريق حظر الطلبات في أقرب مرحلة من المعالجة. في نفس الوقت، من الأهمية بمكان جمع معلومات شاملة عن جميع الطلبات المحظورة للتحليل اللاحق.

تقدم Wallarm القدرة على جمع وعرض الإحصائيات بشأن الطلبات المحظورة من عناوين IP المصدر المدرجة في القائمة السوداء. هذا يمنحك القدرة على تقييم قوة الهجمات الصادرة عن عناوين IP المدرجة في القائمة السوداء، وإجراء تحليل دقيق للطلبات من هذه العناوين IP، واستكشاف مختلف المعلمات.

!!! معلومات "توافر الميزة"
    الميزة متاحة بدءًا من إصدار العقدة 4.8، للعقد المستندة إلى NGINX. بشكل افتراضي هو [تمكين](../../admin-en/configure-parameters-en.md#wallarm_acl_export_enable).
    
في Wallarm، هناك عدة طرق للحصول على عنوان IP في القائمة السوداء. اعتمادا على الطريقة المستخدمة، ستحتاج إلى [البحث](../../user-guides/search-and-filters/use-search.md#search-by-attack-type) عن الأحداث المرتبطة باستخدام علامات / مرشحات مختلفة:

* أنت تضيفه يدويًا (في قسم **الهجمات**، استخدم البحث `blocked_source` أو فلتر `Blocked Source`)
* يؤدي هجوم سلوكي وتم إدراجه تلقائيًا في القائمة السوداء بواسطة:
    * [وحدة الوقاية من سوء استخدام الواجهة البرمجية](../../user-guides/ip-lists/overview.md#automatic-bots-ips-denylisting) (`api_abuse` البحث, `API Abuse` فلتر)
    * [وحدة الوقاية من التخمين](../../admin-en/configuration-guides/protecting-against-bruteforce.md) (`brute`, `Brute force`)
    * [وحدة الوقاية من التصفح العشوائي](../../admin-en/configuration-guides/protecting-against-bruteforce.md) (`dirbust`, `Forced browsing`)
    * [وحدة الوقاية من BOLA](../../admin-en/configuration-guides/protecting-against-bola.md) (`bola`, `BOLA`)
    * وحدة `عدد الحمولات الخبيثة` (`multiple_payloads`, `Multiple payloads`)

لا يمكن اكتشاف الهجمات السلوكية المذكورة إلا بعد جمع بعض الإحصائيات التي تتطلب كمية معينة تعتمد على حدود التحكم المقابلة. وبالتالي، في المرحلة الأولى، قبل إدراجها في القائمة السوداء، تقوم Wallarm بجمع هذه المعلومات ولكن جميع الطلبات تمر ويتم عرضها ضمن أحداث `الرصد`.

بمجرد تجاوز حدود التحكم، يعتبر النشاط الخبيث محددًا، وتضع Wallarm العنوان IP في القائمة السوداء، تبدأ العقدة الحظر الفوري لجميع الطلبات الصادرة منهم.

بمجرد تمكين إرسال معلومات حول الطلبات من عناوين IP المدرجة في القائمة السوداء، سترى الطلبات `المحظورة` من هذه العناوين IP في قائمة الأحداث. ينطبق هذا أيضا على عناوين IP المدرجة يدويًا في القائمة السوداء.

![الأحداث المرتبطة بعناوين IP المدرجة في القائمة السوداء - تمكين إرسال البيانات](../../images/user-guides/events/events-denylisted-export-enabled.png)

لاحظ أن البحث / الفلاتر سيعرض أحداث `الرصد` و - إذا تم تمكين إرسال المعلومات - الأحداث `المحظورة` لكل نوع هجوم. للعناوين IP المدرجة يدويًا في القائمة السوداء، لا يوجد حدث `الرصد`.

ضمن الأحداث `المحظورة`، استخدم العلامات للتبديل إلى سبب إدراجها في القائمة السوداء - إعدادات BOLA، وحدة الوقاية من سوء استخدام الواجهة البرمجية، التحكم أو السجل التسبب في توقيفها في القائمة السوداء.

## ضبط الدقة للأحداث

### تجميع الضربات

يمكنك تحسين قوائم الهجمات والحوادث عن طريق تجميع [الضربات](../../glossary-en.md#hit) المرسلة من نفس عنوان IP في هجوم واحد.

التجميع مفعل بشكل افتراضي في وحدة تحكم Wallarm → **التحكمات** باستخدام التحكم الافتراضي **الضربات من نفس IP** الذي يتفعل عندما ينشأ أكثر من 50 ضربة من عنوان IP واحد في غضون 15 دقيقة.

![مثال عن تحكم لتجميع الضربات](../../images/user-guides/triggers/trigger-example-group-hits.png)

إذا كانت الضربات المجمعة لديها أنواع هجمات مختلفة وحمولات خبيثة وروابط، سيتم وضع علامة على معلمات الهجمات بتسمية `[multiple]` في قائمة الهجمات.

الضربات التي لديها أنواع هجمات القوة الغامرة، التصفح العشوائي، تجاوز الحد من الموارد، القنبلة البيانات، أو القعدة الافتراضية لا يتم اعتبارها في هذا التحكم.

يمكنك تعطيل التحكم الافتراضي مؤقتًا. يمكنك أيضًا تعديل السلوك الذي يقدمه التحكم الافتراضي - للقيام بذلك، قم بإنشاء التحكمات المخصصة الخاصة بك من نوع **الضربات من نفس IP**. إنشاء أي تحكم مخصص يحذف التحكم الافتراضي، إذا حذفت جميع التحكمات المخصصة الخاصة بك، يتم استعادة التحكم الافتراضي.

### تجريب الضربات

#### نظرة عامة

المرور الخبيث غالبًا ما يتكون من [ضربات](../../about-wallarm/protecting-against-attacks.md#what-is-attack-and-what-are-attack-components) مماثلة ومتطابقة. تؤدي تخزين جميع الضربات إلى إدخالات مكررة في قائمة الأحداث التي تزيد من كل من الوقت المستغرق لتحليل الحدث والحمل على سحابة Wallarm.

يحسن تجريب الضربات تخزين البيانات والتحليل عن طريق إسقاط الضربات غير الفريدة من التحميل إلى سحابة Wallarm.

!!! تحذير "الضربات المسقطة في عدد الطلبات في الثانية"
    نظرًا لأن الطلبات المسقطة ما زالت طلبات يتم معالجتها بواسطة عقدة Wallarm، تزيد قيمة الطلبات في الثانية في واجهة المستخدم لتفاصيل العقدة مع كل ضربة مسقطة.

    يتضمن عدد الطلبات والضربات على [لوحة القيادة لوقاية من التهديدات](../dashboards/threat-prevention.md) أيضًا عدد الضربات المسقطة.

لا يؤثر تجريب الضربات على جودة اكتشاف الهجمات ويساعد فقط على تجنب تأخره. عقدة Wallarm تواصل اكتشاف الهجوم و[الحظر](../../admin-en/configure-wallarm-mode.md#available-filtration-modes) حتى مع تمكين تجريب الضربات.

#### التمكين

* لهجمات [التحقق من الإدخال](../../about-wallarm/protecting-against-attacks.md#input-validation-attacks)، يتم تعطيل تجريب الضربات بشكل افتراضي. إذا كانت نسبة الهجمات في حركة مرورك عالية، يتم تنفيذ تجريب الضربات في مرحلتين متتاليتين: **القصوى** و **العادية**.
* لهجمات [السلوكية](../../about-wallarm/protecting-against-attacks.md#behavioral-attacks)، هجمات [قنبلة البيانات](../../attacks-vulns-list.md#data-bomb) و [تجاوز حد التاريخ](../../attacks-vulns-list.md#overlimiting-of-computational-resources): خوارزمية التجريب **العادية** مفعلة افتراضيًا. التجريب **القصوى** يبدأ فقط إذا كانت نسبة الهجمات في حركة مرورك عالية.
* بالنسبة للأحداث من عناوين IP المدرجة في القائمة السوداء، يتم تكوين التجريب على جانب العقدة. يقوم فقط بتحميل أول 10 طلبات متطابقة إلى السحابة بينما يطبق خوارزمية التجريب على بقية الضربات.

عند تمكين خوارزمية التجريب، في قسم **الهجمات**، يتم عرض إشعار **تم تمكين نموذج الضربات**.

سيتم تعطيل التجريب تلقائيًا بمجرد أن تنخفض نسبة الهجمات في حركة المرور.

#### المنطق الأساسي

يتم تنفيذ تجريب الضربات في مرحلتين متتاليتين: **القصوى** و **العادية**.

خوارزمية عادية تعالج فقط الضربات المحفوظة بعد المرحلة القصوى، ما لم تكن الضربات من النوع [السلوكي](../../about-wallarm/protecting-against-attacks.md#behavioral-attacks)،[قنبلة البيانات](../../attacks-vulns-list.md#data-bomb) أو [تجاوز حد التاريخ](../../attacks-vulns-list.md#overlimiting-of-computational-resources). إذا تم تعطيل التجريب القصوى لضربات هذه الأنواع، تعالج الخوارزمية العادية المجموعة الأصلية للضربات.

**التجريب القصوى**

لدى خوارزمية التجريب القصوى المنطق الأساسي التالي:

* إذا كانت الضربات من نوع [التحقق من الإدخال](../../about-wallarm/protecting-against-attacks.md#input-validation-attacks)، ترفع الخوارزمية فقط تلك التي لديها [حمولات خبيثة](../../about-wallarm/protecting-against-attacks.md#what-is-attack-and-what-are-attack-components) فريدة إلى السحابة. إذا تم اكتشاف عدة ضربات بنفس الحمولة في غضون ساعة، فإن السحابة تقوم فقط بتحميل الأولى منها والبقية يتم تجاوزها.
* إذا كانت الضربات من الأنواع [السلوكية](../../about-wallarm/protecting-against-attacks.md#behavioral-attacks)،[قنبلة البيانات](../../attacks-vulns-list.md#data-bomb) أو [تجاوز حد التاريخ](../../attacks-vulns-list.md#overlimiting-of-computational-resources)، فإن الخوارزمية ترفع إلى السحابة فقط أول 10% منها المكتشفة في غضون ساعة.

**التجريب العادي**

لدى خوارزمية التجريب العادية المنطق الأساسي التالي:

1. الخمس ضربات المتطابقة الأولى لكل ساعة يتم حفظها في النموذج في سحابة Wallarm. الباقي من الضربات لا يتم حفظها في النموذج، ولكن يتم تسجيل عددها في معلمة منفصلة.

    الضربات متطابقة إذا كانت جميع العوامل التالية لديها نفس القيم:

    * نوع الهجوم
    * المعلمة التي بها الحمولة الخبيثة
    * عنوان الهدف
    * طريقة الطلب
    * كود الاستجابة
    * عنوان IP المصدر
2. يتم تجميع نماذج الضربات في [الهجمات](../../about-wallarm/protecting-against-attacks.md#what-is-attack-and-what-are-attack-components) في قائمة الأحداث.

يتم عرض الضربات المجمعة في قسم **الهجمات** أو **الحوادث** من وحدة تحكم Wallarm على النحو التالي:

![الضربات المسقطة](../../images/user-guides/events/bruteforce-dropped-hits.png)

لتصفية قائمة الأحداث حتى تعرض فقط الضربات النموذجية، انقر فوق إشعار **تم تمكين نموذج الضربات**. سيتم إضافة السمة `sampled` إلى حقل البحث، وستعرض قائمة الأحداث فقط الضربات النموذجية.

!!! معلومات "عرض الضربات المسقطة في قائمة الأحداث"
    نظرًا لأن الضربات المسقطة لا يتم تحميلها إلى سحابة Wallarm، يمكن أن تكون بعض الضربات أو الهجمات بأكملها غائبة في قائمة الأحداث. 

<!-- ## فديوهات العرض التوضيحي

<div class="video-wrapper">
  <iframe width="1280" height="720" src="https://www.youtube.com/embed/spD3BnI6fq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div> -->