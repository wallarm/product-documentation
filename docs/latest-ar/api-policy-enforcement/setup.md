# إعداد تطبيق سياسة واجهة برمجة التطبيقات

يوضح هذا المقال كيفية تمكين وتكوين حماية واجهة برمجة التطبيقات الخاصة بك بناءً على [مواصفات واجهة برمجة التطبيقات التي قمت برفعها](overview.md).

## الخطوة 1: رفع المواصفات

1. في قسم **مواصفات واجهة برمجة التطبيقات** في [السحابة الأمريكية](https://us1.my.wallarm.com/api-specifications/) أو [السحابة الأوروبية](https://my.wallarm.com/api-specifications/)، انقر على **رفع المواصفات**.
1. اضبط معايير رفع المواصفات وابدأ الرفع.

    ![رفع المواصفات](../images/api-policies-enforcement/specificaton-upload.png)

لاحظ أنك لن تتمكن من بدء تكوين تطبيق سياسة واجهة برمجة التطبيقات بناءً على المواصفات، حتى يتم رفع ملف المواصفات بنجاح.

## الخطوة 2: تحديد الإجراءات لانتهاكات السياسات

1. انقر على علامة التبويب **تطبيق سياسة واجهة برمجة التطبيقات**.

    !!! معلومة "اكتشاف واجهة برمجة التطبيقات الخارجة عن القانون"
        * بالإضافة إلى تطبيق السياسة، يمكن استخدام المواصفات بواسطة وحدة [اكتشاف واجهة برمجة التطبيقات](../api-discovery/overview.md) لـ [اكتشاف واجهة برمجة التطبيقات الخارجة عن القانون](../api-discovery/rogue-api.md). يتم عرض العلامة إذا تم تمكين اكتشاف واجهة برمجة التطبيقاس.
        * قبل استخدام المواصفات لتطبيق السياسة، يُنصح باستخدامها للبحث عن واجهة برمجة التطبيقات الخارجة عن القانون (الظل، الزومبي، واليتيمة) باستخدام اكتشاف واجهة برمجة التطبيقاس. بهذه الطريقة ستتمكن من فهم مقدار الاختلاف بين المواصفات والطلبات الفعلية لعملائك - هذه الاختلافات ستؤدي على الأرجح إلى حظر الطلبات ذات الصلة بعد تطبيق السياسة.

1. حدد **استخدام المواصفات لتطبيق سياسة واجهة برمجة التطبيقات**.
1. حدد المضيف أو نقطة النهاية التي ترغب في تفعيل إجراءات انتهاك السياسة بها.

    * لاحظ أنه إذا قمت بتحديد نقاط النهاية التي يجب تطبيق المواصفات المرفوعة عليها بشكل غير صحيح، سيكون هناك العديد من الأحداث [الإيجابية الخاطئة](../about-wallarm/protecting-against-attacks.md#false-positives).
    * إذا كان لديك عدة مواصفات تنطبق على نفس المضيف، ولكن على نقاط نهاية مختلفة (على سبيل المثال `domain.com/v1/api/users/` و `domain.com/v1/api/orders/`)، **يجب** أن تُشير إلى أي نقاط النهاية يجب تطبيق المواصفات عليها.
    * إذا أضفت مواصفات إلى مضيف، ثم أضفت مواصفات أخرى إلى نقاط نهاية فردية لهذا المضيف، سيتم تطبيق كلتا المواصفاتين على هذه النقاط.
    * يمكن تكوين القيمة عبر [منشئ عنوان URI](../user-guides/rules/rules.md#uri-constructor) أو [نموذج التحرير المتقدم](../user-guides/rules/rules.md#advanced-edit-form).

1. حدد كيف يجب أن تتفاعل النظام إذا خالفت الطلبات مواصفاتك.

    ![المواصفات - استخدام لتطبيق سياسة واجهة برمجة التطبيقات](../images/api-policies-enforcement/specification-use-for-api-policies-enforcement.png)

    التفاصيل عن انتهاكات محتملة:

    --8<-- "../include/api-policies-enforcement/api-policies-violations.md"

    عند استخدام المواصفات لتطبيق سياسة واجهة برمجة التطبيقات لأول مرة، يُنصح بتحديد `Monitor` كرد فعل للتأكد من أن المواصفات يتم تطبيقها على نقاط النهاية اللازمة وتكتشف الأخطاء الحقيقية.

## الخطوة 3: تكوين حالات محددة أو تعطيل

تحتاج إلى تكوين إضافي عند استخدام تطبيق سياسة واجهة برمجة التطبيقات مع عقد Wallarm المستندة إلى NGINX المثبتة باستخدام:

* [مثبت شامل](../installation/nginx/all-in-one.md)
* [صورة Docker](../admin-en/installation-docker-en.md) - فقط عندما تقوم بـ[تثبيت](../admin-en/installation-docker-en.md#run-the-container-mounting-the-configuration-file) ملف التكوين الخاص بك

تحتاج إلى:

1. أضف القطعة التالية في ملفات تكوين NGINX، في كل قسم `server` حيث يجب تشغيل تطبيق سياسة واجهة برمجة التطبيقات:

    ```
    location ~ ^/wallarm-apifw(.*)$ {
        wallarm_mode off;
        proxy_pass http://127.0.0.1:8088$1;
        error_page 404 431         = @wallarm-apifw-fallback;
        error_page 500 502 503 504 = @wallarm-apifw-fallback;
    }
    location @wallarm-apifw-fallback {
        wallarm_mode off;
        return 500 "API FW fallback";
    }
    ```

1. بما أن تطبيق سياسة واجهة برمجة التطبيقات لا يدعم [gRPC](https://en.wikipedia.org/wiki/GRPC)، إذا كان بعض العقد أو المواقع/الخوادم الخاصة بك تستخدم gRPC، قم بتعطيل تطبيق سياسة واجهة برمجة التطبيقات لها كما هو موضح أدناه.

**التعطيل**

في بعض الحالات، قد يكون من الضروري تعطيل وظيفة تطبيق سياسة واجهة برمجة التطبيقات لبعض أجزاء واجهة برمجة التطبيقات الخاصة بك. يمكن القيام بذلك:

* لتثبيتات الحزم [NGINX](../installation/supported-deployment-options.md#packages) بما في ذلك تلك المثبتة عبر [مثبت شامل](../installation/nginx/all-in-one.md)، لأي قسم `server` يستخدم فيه تطبيق سياسة واجهة برمجة التطبيقات من خلال توجيه NGINX [`wallarm_enable_apifw`](../admin-en/configure-parameters-en.md#wallarm_enable_apifw) المحدد على `off`.
* لصورة Docker المستندة إلى NGINX، من خلال متغير البيئة `WALLARM_APIFW_ENABLE` [المحدد](../admin-en/installation-docker-en.md#run-the-container-passing-the-environment-variables) على `false`.
* لمتحكم الدخول NGINX، من خلال مجموعة قيم [`controller.wallarm.apifirewall`](../admin-en/configure-kubernetes-en.md#controllerwallarmapifirewall) مع `enable` المحدد على `false`.