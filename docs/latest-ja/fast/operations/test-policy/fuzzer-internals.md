[img-search-for-anomalies]: ../../../images/fast/operations/en/test-policy/fuzzer/search-for-anomalies-scheme.png
[img-anomaly-description]: ../../../images/fast/operations/common/test-policy/fuzzer/anomaly-description.png

[doc-fuzzer-configuration]: fuzzer-configuration.md

[link-payloads-section]: fuzzer-configuration.md#the-payloads-section
[link-stop-fuzzing-section]: fuzzer-configuration.md#the-stop-fuzzing-if-response-section


# ファズ調査装置の作動原則

ファズ調査装置は`0x01`から`0xFF`までの255 *異常バイト* をチェックします。リクエスト箇所にこのようなバイトが一つまたはそれ以上挿入されると、対象アプリケーションの挙動に異常が生じることがあります。

個々のバイトを確認する代わりに、ファズ調査装置は異常バイトの配列（*ペイロード*）を箇所に追加し、変更されたリクエストをアプリケーションに送信します。

承認された箇所を変更するため、ファズ調査装置は以下を行います:

* ペイロードを挿入します:

    * 値の先頭
    * 値のランダムな位置
    * 値の末尾
* 以下のペイロード値を置き換えます:

    * ランダムなセグメント
    * 最初の`M`バイト
    * 最後の`M`バイト
    * 完全な文字列

[fuzzer configuration][doc-fuzzer-configuration] により、FASTからアプリケーションへのリクエストに含まれるペイロードのサイズ`M`がバイト単位で設定されます。これにより以下の項目に影響を与えます:

* ペイロード挿入が使用された場合、箇所の値に追加されるバイト数
* ペイロード置換が使用された場合、箇所の値で置き換えられるバイト数
* アプリケーションに送信されるリクエストの数

ペイロードを含むリクエストへのレスポンスで異常な挙動が検出された場合、ファズ調査装置は特定のリクエストを各ペイロードバイトに対してアプリケーションに送信します。これにより、特定のバイトが異常な挙動を引き起こしたことをファズ調査装置は検出します。

![異常バイトをチェックするスキーム][img-search-for-anomalies]

すべての検出されたバイトは異常の説明で提供されます:

![異常の説明][img-anomaly-description]

??? info "ファズ調査装置の作動例"
    ペイロードサイズが250バイトとし、その[replace](fuzzer-configuration.md#payloads-section)が特定の箇所の最初の250バイトを置き換えるとします。

    これらの条件下、ファズ調査装置はすべての既知の異常バイトを送信するために二つのリクエストを作成します。一つは250バイトのペイロードを持ち、もう一つは5バイトのペイロードを持ちます。

    ベースラインリクエスト内の元の箇所の値は以下のように変更されます:

    * 値が250バイトより長い場合：最初に値の最初の250バイトがペイロードの250バイトに置き換えられ、その後値の最初の250バイトがペイロードの5バイトに置き換えられます。
    * 値が250バイト未満の場合：最初に値がペイロードの250バイトで完全に置き換えられ、その後値がペイロードの5バイトで完全に置き換えられます。

    長い箇所の値`_250バイト長ヘッド_qwerty`の最初の250バイトを5バイトのペイロード`ABCDE`が置き換え、異常を引き起こしたとします。言い換えると、箇所の値が`ABCDEqwerty`であるテストリクエストが異常を引き起こしました。

    この場合、ファズ調査装置は以下の箇所の値を持つ各バイトをチェックする5つの追加リクエストを作成します:

    * `Aqwerty`
    * `Bqwerty`
    * `Cqwerty`
    * `Dqwerty`
    * `Eqwerty`

    これらのリクエストの一つまたはそれ以上が再度異常を引き起こし、ファズ調査装置は検出された異常バイトのリストを作成します。たとえば、`A`や`C`です。

次に、[fuzzing configuration][doc-fuzzer-configuration]と異常が見つかったかどうかを定義するルールの説明についての情報を取得できます。

FASTのファズ調査装置は反復ごとに一つの許可された箇所を処理します（*ファジング*）。 [ファジング停止ルール][link-stop-fuzzing-section] により、一つ以上の箇所が順番に処理されます。