[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

# Matchフェーズ

!!! info "フェーズの範囲"  
    このフェーズは変更を行う拡張で使用し、動作上は任意です（YAMLファイルの`match`セクションは存在してもしなくてもかまいません）。

    このフェーズは変更を行わない拡張のYAMLファイルには含めないでください。
    
    拡張の種類の詳細は[こちら][link-ext-logic]をご覧ください。

!!! info "リクエスト要素の記述構文"
     FAST拡張を作成する際は、ポイントを用いて操作する必要があるリクエスト要素を正しく記述できるよう、アプリケーションに送信されるHTTPリクエストおよびアプリケーションから受信するHTTPレスポンスの構造を理解する必要があります。 
    
    詳細はこの[リンク][link-points]をご覧ください。
 
 このフェーズは、受信したベースラインリクエストが指定された条件に一致するかどうかを確認します。

拡張のYAMLファイル内の`match`セクションには、`<key: value>`ペアの配列が含まれます。各ペアはリクエストの特定の要素（キー）と、その要素のデータ（値）を記述します。キーと値には、[Ruby正規表現形式][link-ruby-regexp]の正規表現を含めることができます。

Matchフェーズは、ベースラインリクエスト内で、与えられたすべての`<key: value>`ペアに対する一致を探します。
* 必要なデータを伴う必要な要素（例: URLのパス値、GETパラメータ、HTTPヘッダー）がリクエストに存在するかどうかを確認します。 
    
    ??? info "例1"
        `'GET_a_value': '^\d+$'` — 値が数字のみで構成される、名前が`a`のGETパラメータがリクエストに存在している必要があります。
    
    ??? info "例2"
        `'GET_b*_value': '.*'` — 名前が`b`で始まり、値は任意（空値を含む）のGETパラメータがリクエストに存在している必要があります。
    
* 指定したキーに対して値が`null`に設定されている場合は、対応する要素がリクエストに存在しないことを確認します。
    
    ??? info "例"
        `'GET_a': null` — `a`という名前のGETパラメータはリクエストに存在していてはいけません。

ベースラインリクエストがMatchフェーズを通過するには、`match`セクション内のすべての`<key: value>`ペアの条件を満たす必要があります。`match`セクションで記述された`<key: value>`ペアのうちいずれかに一致が見つからない場合、そのリクエストは破棄されます。

??? info "例"
    以下の`match`セクションには、`<key: values>`ペアの一覧が含まれています。ベースラインリクエストがMatchフェーズを通過するには、これらすべてのペアを満たす必要があります。

    ```
    match:
    - 'HEADER_HOST_value': 'example.com'
    - 'GET_password_value': '^\d+$'
    - 'HEADER_CONTENT-TYPE_value': null
    ```

    1. ベースラインリクエストには、値に`example.com`が部分文字列として含まれる、`Header`という名前のHTTPヘッダーが含まれている必要があります。
    2. GETパラメータ`password`の値は数字のみで構成されている必要があります。
    3. `Content-Type`ヘッダーは存在していてはいけません。