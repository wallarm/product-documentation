```markdown
[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

# マッチフェーズ

!!! info "フェーズのスコープ"  
    このフェーズは変更を行う拡張機能で使用されますが、機能実行に必須ではありません（YAMLファイルにおける`match`セクションは存在しても存在しなくても構いません）。

    非変更拡張機能のYAMLファイルには、このフェーズは存在していない必要があります。
    
    拡張機能のタイプの詳細については[こちら][link-ext-logic]をご参照ください。

!!! info "リクエスト要素記述構文"
     FAST拡張機能を作成する際は、アプリケーションに送信されるHTTPリクエストおよびアプリケーションから受信されるHTTPレスポンスの構造を理解し、作業対象のリクエスト要素を正しく記述するためにポイントを使用する必要がございます。
    
    詳細についてはこの[リンク][link-points]をご覧ください。
 
このフェーズは、着信したベースラインリクエストが指定された条件に一致するかどうかを確認します。

拡張機能のYAMLファイル内の`match`セクションには、＜key: value＞ペアの配列が含まれます。各ペアはリクエストの特定の要素（key）とその要素のデータ（value）を記述します。keyおよびvalueには、[Ruby正規表現形式][link-ruby-regexp]による正規表現を含めることができます。

マッチフェーズは、ベースラインリクエスト内のすべての指定された＜key: value＞ペアに一致する項目を探します。
* リクエストは、必要なデータを持つ必要な要素（例：URL内のパス値、GETパラメータ、またはHTTPヘッダー）の存在に対して検査されます。 
    
    ??? info "例1"
        `'GET_a_value': '^\d+$'` — 数字のみを含む値を持つGETパラメータ`a`がリクエストに存在している必要があります。
    
    ??? info "例2"
        `'GET_b*_value': '.*'` — `b`で始まる名前を持つGETパラメータが、空の値を含むいかなる値でも構わないので、リクエストに存在している必要があります。
    
* 特定のkeyに対してvalueが`null`に設定されている場合は、リクエスト内で該当する要素の欠如が確認されます。
    
    ??? info "例"
        `'GET_a': null` — GETパラメータ`a`がリクエストに存在していない必要があります。

ベースラインリクエストがマッチフェーズを通過するためには、リクエストが`match`セクションに記述されたすべての＜key: value＞ペアを満たしている必要があります。もし、ベースラインリクエスト内に`match`セクションに記述されたどの＜key: value＞ペアにも一致する項目が見つからなかった場合、そのリクエストは破棄されます。

??? info "例"
    下記に示す`match`セクションには＜key: value＞ペアのリストが含まれています。ベースラインリクエストがマッチフェーズを通過するためには、これらすべてのペアを満たす必要があります。

    ```
    match:
    - 'HEADER_HOST_value': 'example.com'
    - 'GET_password_value': '^\d+$'
    - 'HEADER_CONTENT-TYPE_value': null
    ```

    1. ベースラインリクエストは、`Header`というHTTPヘッダーを含み、その値に`example.com`を部分文字列として含んでいる必要があります。
    2. GETパラメータ`password`の値は、数字のみで構成されている必要があります。
    3. HTTPヘッダー`Content-Type`は存在していない必要があります。
```