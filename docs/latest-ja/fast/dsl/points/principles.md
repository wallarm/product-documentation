[link-ruby]:        http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-yaml]:        https://yaml.org/spec/1.2/spec.html

# ポイント構築の基本原則

!!! warning "予約語"
    予約語との衝突を防ぐため、ベースラインリクエストの要素には次の名前やキーを使用しないでください:
        
    * パーサーの名前と一致する名前やキー
    * フィルターの名前と一致する名前やキー
    * サービスワード`name`および`value`と一致する名前やキー 

カスタム拡張を開発する際には、普遍的なポイント構築の原則をいくつか考慮する必要があります。

* すべてのポイントは正規表現として扱われます。
    
    **例:**

    * `HEADER_A.*_value`ポイントは、リクエストにそのようなヘッダーが存在する場合、名前が`A`で始まるヘッダーを参照します。
    * `PATH_\d_value`ポイントは、リクエストのURIパスの先頭10個の部分を参照します。

* ポイントの各部分は`_`記号で区切る必要があります。
    
    **例:** 
    
    `URI_value`.

* パーサーおよびフィルターの名前は大文字でポイントに追加する必要があります。
    
    **例:** 
    
    `ACTION_EXT_value`.

* リクエスト要素の名前は、ベースラインリクエストに現れるとまったく同じとおりにポイントへ追加する必要があります。
    
    **例:** 
    
    `GET http://example.com/login/?Uid=01234`リクエストの場合、`GET_Uid_value`ポイントはクエリ文字列パラメータ`Uid`を参照します。
    
    !!! info "特殊記号のエスケープ"
        ポイント内で使用する際に、サービス記号の一部はエスケープが必要になる場合があります。詳細については、[Rubyプログラミング言語の正規表現][link-ruby]のドキュメントを参照してください。

* ポイントは、拡張に次のいずれかの方法で指定できます:
    * `"`記号で囲みます。 
            
        **例:** 
            
        `"PATH_.*_value"`.
    
    * `'`記号で囲みます。 
            
        **例:** 
            
        `'GET_.*_value'`.
    
    * いかなる記号でも囲みません。 
            
        **例:** 
            
        `HEADER_.*_value`.
    
    !!! info "ポイントを記号で囲むことについて"
        YAML構文では、ポイントを囲む際に使用する各種記号の違いが定義されています。詳細については、この[リンク][link-yaml]を参照してください。

* `,`記号で区切られ、`[`と`]`記号で囲まれたポイントは、ポイントの配列として扱われます。 
    
    **例:** 
    
    `[GET_uid_value, GET_passwd_value]`.

* 拡張がリクエスト要素の名前に対して動作するのか、値に対して動作するのかを示すため、ポイントの末尾には常にサービスワードを付与する必要があります。 
    * リクエスト要素の名前を対象に動作させるには、サービスワード`name`を指定する必要があります。 
        
        サービスワード`name`は次のフィルターと併用できます:
        
        * Xml_pi;
        * Xml_dtd_entity.
        
        **例:** 
        
        `POST_XML_XML_DTD_ENTITY_0_name`ポイントは、リクエストボディのXMLデータに指定された最初のDTDスキーマディレクティブの名前を参照します。
    
    * リクエスト要素の値を対象に動作させるには、サービスワード`value`を指定する必要があります。
        
        サービスワード`value`は、利用可能なFAST DSLのあらゆるフィルターやパーサーと併用できます。
        
        **例:** 
        
        `PATH_0_value`ポイントは、リクエストURIパスの最初の部分の値を参照します。