```markdown
# 生成フェーズ

!!! info "フェーズの範囲"
    このフェーズは変更拡張で使用され、その動作に必須ではありません（YAMLファイルで`generate`セクションが存在しない場合もあります）。

    このフェーズは変更を行わない拡張のYAMLファイルに含まれてはなりません。
    
    拡張の種類についての詳細は[こちら][link-ext-logic]をお読みください。

!!! info "リクエスト要素記述構文"
    FAST拡張を作成する際は、アプリケーションに送信されるHTTPリクエストの構造およびアプリケーションから受信されるHTTPレスポンスの構造を理解し、ポイントを用いて作業する必要のあるリクエスト要素を正しく記述できるようにしてください。
     
    詳細情報については、この[リンク][link-points]に進んでください。
 
このフェーズは、ベースラインリクエストの特定のパラメータに挿入されるペイロードを指定し、このリクエストに基づいたテストリクエストを生成します。

`generate`セクションは以下の構造になっています:

```
generate:
  - into:
    - parameter 1
    - parameter 2
    - …
    - parameter N
  - method:
    - postfix
    - prefix
    - random
    - replace
  - payload:
    - payload 1
    - payload 2
    - …
    - payload N
```

* `into`パラメータは、ペイロードを挿入するリクエスト要素を単一または複数指定することができます。このパラメータの値は文字列または文字列の配列で指定できます。`into`パラメータの値として[Ruby形式の正規表現][link-ruby-regexp]を使用することも可能です。
    
    このパラメータはオプションであり、セクションに含まれなくてもかまいません。`into`パラメータが省略された場合、与えられたテストポリシーに従い変更可能なリクエスト要素にペイロードが挿入されます。
    
    例えば、テストポリシーに従いベースラインリクエストから以下の変更可能なリクエスト要素が抽出されたと仮定します:
    
    * `GET_uid_value`
    * `HEADER_COOKIE_value`
    
    拡張はこれらの変更可能な要素（挿入ポイントとも呼ばれます）を順次処理します。 
    
    `into`パラメータが省略された場合、最初に`GET_uid_value`パラメータへペイロードが順次挿入され、生成されたテストリクエストを用いてターゲットアプリケーションの脆弱性をチェックします。その後、テストリクエストの結果が処理されると、拡張は`HEADER_COOKIE_value`パラメータを処理し、同様に該当パラメータへペイロードを挿入します。
    
    以下の例のように`into`パラメータに`GET_uid_value`リクエストパラメータが含まれている場合、ペイロードは`GET_uid_value`パラメータに挿入され、`HEADER_COOKIE_value`パラメータには挿入されません。
    
    ```
    into: 
      - 'GET_uid_value'
    ```
    次の例はパラメータが一つだけ含まれているため、intoパラメータの値を一行で記述することもできます:
    
    `into: 'GET_uid_value'`

* `method` ― このオプションパラメータは、ペイロードをベースラインリクエスト要素に挿入するために使用されるメソッドのリストを指定します。 
    * `prefix` ― ベースラインリクエスト要素の値の前にペイロードを挿入します。
    * `postfix` ― ベースラインリクエスト要素の値の後にペイロードを挿入します。
    * `random` ― ベースラインリクエスト要素の値のランダムな位置にペイロードを挿入します。
    * `replace` ― ベースラインリクエスト要素の値をペイロードに置き換えます。
    
    ![Payload insertion methods][img-generate-methods]
    
    `method`パラメータが省略された場合、デフォルトで`replace`メソッドが使用されます。
    
    生成されるテストリクエストの数は、指定された`method`の数に依存します：挿入メソッドごとに1つのテストリクエストが生成されます。
    
    例えば、以下の挿入メソッドが指定されている場合:
    
    ```
    method:
      - prefix
      - replace
    ```
    
    単一のペイロードに対して2つのテストリクエストが生成され、2つのペイロードの場合はそれぞれのペイロードに対して2つずつ、合計4つのテストリクエストが生成されます。

* `payload`パラメータは、ターゲットアプリケーションの脆弱性をテストするためのテストリクエストを生成するため、リクエストパラメータに挿入されるペイロードのリストを指定します。
    
    このパラメータは必須であり、セクション内に常に存在しなければなりません。リストには少なくとも1つのペイロードが含まれている必要があります。ペイロードが複数ある場合、FASTノードはリクエストパラメータに順次ペイロードを挿入し、生成された各テストリクエストを使用してターゲットアプリケーションの脆弱性をテストします。
    
    ![Payload generation][img-generate-payload]
    
    ペイロードは、リクエスト処理中にパラメータへ挿入される文字列です。
    
    ??? info "複数ペイロードの例"
        ```
        payload:
          - "') or 1=('1"
          - "/%5c../%5c../%5c../%5c../%5c../%5c../%5c../etc/passwd/"
        ```
    
    特殊なマーカーをペイロードの一部として使用し、脆弱性検出の可能性をさらに広げることができます:

    * **`STR_MARKER`** ― `STR_MARKER`が指定された位置にランダムな文字列を挿入します。 
        
        例えば、`STR_MARKER`はXXS脆弱性のチェックに使用できます。
        
        ??? info "例"
            `'userSTR_MARKER'`
    
    * **`CALC_MARKER`** ― `CALC_MARKER`が指定された位置にランダムな算術式を含む文字列（例：`1234*100`）を挿入します。
        
        例えば、`CALC_MARKER`はRCE脆弱性のチェックに使用できます。
        
        ??? info "例"
            `'; bc <<< CALC_MARKER'`
    
    * **`DNS_MARKER`** ― `DNS_MARKER`が指定された位置にランダムなドメイン名（例：`r4nd0m.wlrm.tl`）を含む文字列を挿入します。
        
        例えば、`DNS_MARKER`はDNS Out-of-Bound脆弱性のチェックに使用できます。

        ??? info "マーカーの動作ロジック"
            Detectフェーズがサーバのレスポンス内の任意のペイロードからマーカーを検出した場合、攻撃は成功とみなされ、脆弱性が正常に悪用されたことを意味します。マーカーを使用したDetectフェーズの動作に関する詳細情報については、この[リンク][link-markers]に進んでください。
```