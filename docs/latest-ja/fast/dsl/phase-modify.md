[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

[img-modify]:           ../../images/fast/dsl/common/phases/modify.png

# Modifyフェーズ

!!! info "フェーズの適用範囲"
    このフェーズは変更を行う拡張で使用され、拡張の動作上は任意です（YAMLファイル内の`modify`セクションは存在していてもいなくてもかまいません）。

    変更を行わない拡張のYAMLファイルには、このフェーズを含めないでください。
    
    拡張の種類の詳細は[こちら][link-ext-logic]をご覧ください。

!!! info "リクエスト要素の記述構文"
    FAST拡張を作成する際には、アプリケーションに送信されるHTTPリクエストとアプリケーションから受信するHTTPレスポンスの構造を理解し、ポイントを使用して操作する必要があるリクエスト要素を正しく記述する必要があります。 

    詳細は[こちら][link-points]をご参照ください。
 
 このフェーズは、必要に応じてベースラインリクエストのパラメータ値を変更します。なお、Modifyフェーズではベースラインリクエストに存在しない新しい要素を追加することはできません。例えば、ベースラインリクエストに`Cookie` HTTPヘッダーが含まれていない場合は追加できません。 

拡張のYAMLファイル内の`modify`セクションには、`<key: value>`のペアからなる配列が含まれます。各ペアは特定のリクエスト要素（キー）と、その要素に挿入すべきデータ（値）を表します。キーには[Rubyの正規表現形式][link-ruby-regexp]の正規表現を含めることができます。キーの値に対して正規表現を適用することはできません。

Modifyフェーズでは、要素に新しい値を割り当てることも、その要素のデータを削除することもできます。

* キーの値が設定されている場合は、その値が対応するベースラインリクエスト要素に割り当てられます。ベースラインリクエストにキーに対応する要素が存在しない場合でも、新しい要素の挿入は行われません。
    
    ??? info "例1"
        `'HEADER_COOKIE_value': 'C=qwerty123'`

        ![Modifyフェーズ][img-modify]

* キーの値が設定されていない場合は、対応するベースラインリクエスト要素の値がクリアされます。
    
    ??? info "例"
        `'HEADER_COOKIE_value': ""`

??? info "例"
    次の例では、ベースラインリクエストは次のように変更されます。

    1.  `Content-Type`ヘッダーの値が`application/xml`に置き換えられます。
    2.  `uid`のGETパラメータの値がクリアされます（パラメータ自体は削除されません）。

    ```
    modify:
    - "HEADER_CONTENT-TYPE_value": "application/xml"
    - "GET_uid_value": ""
    ```