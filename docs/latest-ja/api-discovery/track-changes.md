# APIの変更を追跡 <a href="../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../images/api-security-tag.svg" style="border: none;"></a>

APIに変更が発生した場合、[API Discovery](overview.md)は構築されたAPIインベントリを更新し、変更をハイライトし、いつ何が変更されたかについての情報を提供します。さらに、すべてまたは一部の変更について通知を設定することができます。

![API Discovery - 変更を追跡](../images/about-wallarm-waf/api-discovery/api-discovery-track-changes.png)

会社には複数のチーム、異なるプログラミング言語、さまざまな言語フレームワークが存在する場合があります。そのため、APIに対する変更は、さまざまなソースからいつでも発生する可能性があり、管理が困難になることがあります。セキュリティ担当者にとっては、変更をできるだけ早く検出し分析することが重要です。見逃された場合、たとえば以下のようなリスクを抱えることになります：

* 開発チームがサードパーティのライブラリを使用し始め、セキュリティ専門家に通知せずに別のAPIを使用する場合、会社は監視されておらず脆弱性のチェックが行われていないエンドポイントを取得します。これらは潜在的な攻撃方向となり得ます。
* PIIデータがエンドポイントに転送され始める。計画外のPIIの転送は、規制当局の要件とのコンプライアンス違反につながるだけでなく、評判リスクにつながる可能性があります。
* ビジネスロジックに重要なエンドポイント（例：`/login`、`/order/{order_id}/payment/`）がもはや呼び出されない。
* エンドポイントに転送されるべきではない他のパラメーター（例：`is_admin`（誰かがエンドポイントにアクセスし、管理者権限で行おうとする））が転送され始める。

## APIの変更をハイライト表示

**API Discovery**セクションを開くたびに、**Since**フィルターは`Last week`状態になり、これは最後の週に発生した変更がハイライト表示されることを意味します。期間を変更するには、**Changes since**フィルターで日付を再定義します。

エンドポイントリストでは、APIの変更を以下のマークでハイライト表示します：

* **New**は、期間内にリストに追加されたエンドポイントのためのものです。
* **Changed**は、期間内に新たに発見されたパラメーター、または`Unused`ステータスを取得したパラメーターを持つエンドポイントのためのものです。エンドポイントの詳細では、このようなパラメーターに対応するマークがあります。

    * パラメーターは、期間内に発見された場合`New`ステータスを取得します。
    * パラメーターが7日間データを渡さない場合、`Unused`ステータスを取得します。
    * 後に`Unused`ステータスのパラメーターが再びデータを渡すと、`Unused`ステータスを失います。

* **Unused**は、期間内に`Unused`ステータスを取得したエンドポイントのためのものです。

    * エンドポイントは、7日間リクエストされない（レスポンスでコード200）場合、`Unused`ステータスを取得します。
    * 後に`Unused`ステータスのエンドポイントが再びリクエストされる（レスポンスでコード200）と、`Unused`ステータスを失います。

選択された期間に関係なく、**New**、**Changed**、または**Unused**マークで何もハイライト表示されていない場合、それはその期間にAPIの変更がないことを意味します。

![API Discovery - 変更を追跡](../images/about-wallarm-waf/api-discovery/api-discovery-track-changes.png)

悪質とマークされたエンドポイントのための迅速なヒント：

* **New**、**Changed**、または**Unused**ラベルにマウスを合わせると、変更がいつ発生したかが表示されます
* **Changed**エンドポイントの詳細に移動して、このステータスの理由を確認します：**New**パラメーターと**Unused**ステータスを得たパラメーター - ラベルにマウスを合わせると、パラメーター変更が発生した時刻が表示されます
* 最後の7日間のすべてのタイプの変更のカウンターは、[API Discovery Dashboard](dashboard.md)に表示されます。

## APIの変更をフィルタリング

**API Discovery**セクションでは、**Changes since**フィルターを使用すると、選択した期間内に変更されたエンドポイントのみがハイライト表示されますが、変更されていないエンドポイントはフィルターされません。

**Changes in API**フィルターは異なって動作し、選択された期間内に変更されたエンドポイント**のみ**を表示し、他のすべてをフィルタリングします。

<a name="example"></a>例を考えてみましょう：あなたのAPIには今日10個のエンドポイントがあります（12個ありましたが、そのうち3つは10日前にUnusedとマークされました）。この10個の中で1つは昨日追加され、2つはそのパラメーターに5日前と10日前に変更があった：

* 今日**API Discovery**セクションを開くたびに、**Changes since**フィルターは`Last week`状態になります。ページは10個のエンドポイントを表示し、**Changes**列の中で1個が**New**マークを、1個が**Changed**マークを持ちます。
* **Changes since**を`Last 2 weeks`に切り替えると - 13個のエンドポイントが表示され、**Changes**列の中で1個が**New**マークを、2個が**Changed**マークを、3個が**Unused**マークを持ちます。
* **Changes in API**を`Unused endpoints`に設定すると - 3個のエンドポイントが表示され、すべてが**Unused**マークを持ちます。
* **Changes in API**を`New endpoints + Unused endpoints`に変更すると - 4個のエンドポイントが表示され、3個が**Unused**マークを、1個が**New**マークを持ちます。
* **Changes since**を`Last week`に戻すと - 1個のエンドポイントが表示され、**New**マークを持ちます。

## 通知を受け取る

APIの変更について、メールやメッセンジャーに即時通知を受け取るには、**APIの変更**条件を持つ[トリガー](../user-guides/triggers/triggers.md)を設定します。

新規、変更された、または使用されなくなったエンドポイントについてのメッセージを受け取ることができます。また、監視したいアプリケーションやホスト、提示された機密データの種類によって通知を絞り込むこともできます。

**トリガー例：Slackでの新規エンドポイントに関する通知**

この例では、API Discoveryモジュールによって`example.com`APIホストの新規エンドポイントが発見されると、設定済みのSlackチャンネルに通知が送信されます。

![APIの変更トリガー](../images/user-guides/triggers/trigger-example-changes-in-api.png)

**トリガーをテストするには：**

1. Wallarmコンソール → [US](https://us1.my.wallarm.com/integrations/)または[EU](https://my.wallarm.com/integrations/)クラウドの**インテグレーション**にアクセスし、[Slackとの連携を設定](../user-guides/settings/integrations/slack.md)します。
1. **トリガー**セクションで、上記のようなトリガーを作成します。
1. `example.com/users`エンドポイントに複数のリクエストを送信して`200`（`OK`）のレスポンスを得ます。
1. **API Discovery**セクションで、エンドポイントが**New**マークで追加されたことを確認します。
1. Slackチャンネルのメッセージを確認します：
    ```
    [wallarm] APIで新しいエンドポイントが発見されました

    通知タイプ: api_structure_changed

    新しいGET example.com/usersエンドポイントがAPIで発見されました。

        クライアント: Client 001
        クラウド: US

        詳細:

          アプリケーション: Application 1802
          ドメイン: example.com
          エンドポイントパス: /users
          HTTPメソッド: GET
          変更タイプ: added
          リンク: https://my.wallarm.com/api-discovery?instance=1802&method=GET&q=example.com%2Fusers
    ```