# Wallarm オンプレミス展開（プレリリース）

Wallarm は、パートナー、大企業、および包括的なオンプレミスセキュリティシステムを求めるあらゆる組織向けに、オンプレミスソリューションのプレリリース版を提供しています。この提供により、自身の環境に直接 Wallarm のセキュリティインフラを統合することができます。この記事では、この提供にアクセスし、利用する方法について説明します。

!!! info "お問い合わせ"
    ソリューションがプレリリース中のため、オンプレミス展開に関して質問やリクエストがある場合は、[Wallarm のセールスチーム](mailto:sales@wallarm.com)にご連絡ください。

Wallarm のアーキテクチャは[二つの主要コンポーネント](../about-wallarm/overview.md#how-wallarm-works)を中心に構築されています：

* フィルターノード：ニーズに合わせて柔軟な展開オプションを提供するために、インフラストラクチャ内に展開されます。
* Wallarm Cloud：通常、Wallarm によって外部でホストされます。オンプレミス展開モデルでは、自身のインフラストラクチャ内に Wallarm Cloud を展開する方法を提供しています。このアプローチには、サービス展開の包括的な性質のため、全体のインフラストラクチャを整理する必要があります。必要なすべてのサービスを自動的に開始するスクリプトを提供し、このプロセスを簡素化します。

![オンプレミス展開](../images/waf-installation/on-premise.png)

## Wallarm Cloud をオンプレミスで展開

オンプレミスで Wallarm Cloud を展開するには、インフラストラクチャ上に Wallarm Cloud を展開する必要があります。Wallarm は、必要な Cloud サービスを数ステップで展開するスクリプトを提供し、バックエンドとフロントエンドの両コンポーネント（Wallarm Console UI）を含むプロセスを簡素化します。

### 要件

Wallarm Cloud を展開するには、以下の基準を満たす計算インスタンスを準備します：

* Ubuntu 22.04 LTS または RedHat 9.x で、最小限の追加ソフトウェアがインストールされていること。
* 最低 16 物理 CPU コア、48 GB RAM、およびルートパーティションに 300 GB の SSD ディスクスペース（追加マウントなし）。本番環境では、500+ GB の SSD スペースを推奨。
* 3-5 レベルの DNS ワイルドカードがインスタンスで設定されていること。例：`*.wallarm.companyname.tld`。
* 信頼できる CA または内部 CA から発行された有効な SSL/TLS ワイルドカード証明書（およびキー）。すべてのフィルターノードインスタンスとブラウザーは、この SSL/TLS 証明書/キー ペアを信頼として認識する必要があります。
* ライセンスキーおよびインストール/アップグレードパッケージのダウンロードのため、Wallarm のオンプレミスライセンスサービス IP アドレス（単一の静的 IP アドレス；統合中に提供される）への送信接続が許可されていること。

### 手順

オンプレミスで Wallarm Cloud を展開するには：

1. Cloud サービスの展開スクリプト、対応する指示、および初期資格情報を取得するため、[セールスチーム](mailto:sales@wallarm.com?subject=Wallarm%20on-premise%20deployment&body=Dear%20Wallarm%20Sales%20Team%2C%0A%0AI%20am%20writing%20to%20express%20my%20interest%20in%20deploying%20the%20Wallarm%20platform%20on-premise.%20Could%20you%20please%20provide%20me%20with%20the%20necessary%20scripts%20for%20deployment%2C%20detailed%20information%20on%20the%20appropriate%20subscription%20plans%2C%20and%20comprehensive%20instructions%3F)に連絡してください。
1. 上記の要件に従って仮想（または物理）マシンを準備します。
1. インストールパッケージを準備されたインスタンスにアップロードし、実行してソリューションコンポーネントを展開します。
1. DNS ワイルドカードレコードを準備されたインスタンスの IP アドレスを指すように設定します。例えば、ワイルドカード DNS レコード `*.wallarm.companyname.tld` を委任したい場合、少なくとも `my.wallarm.companyname.tld` および `api.wallarm.companyname.tld` が準備されたインスタンスの IP アドレスに解決されることを確認してください。
1. インストールパッケージに付属する初期設定ガイドに従ってください。
1. 設定後、`https://my.wallarm.companyname.tld`（または設定した対応するドメインレコード）にアクセスし、インストールパッケージに付属する初期資格情報を使用してログインを試みてください。

これで、オンプレミス UI を介して Wallarm プラットフォームを、ホステッド Cloud バージョンと同じように構成できます。例えば：

* [ノード展開用のトークンを生成する](../user-guides/settings/api-tokens.md)
* [攻撃とヒットをレビューする](../user-guides/events/check-attack.md)
* [トラフィックフィルタリングルールを変更する](../user-guides/rules/rules.md)
* [API Discovery](../api-discovery/overview.md)などの追加プラットフォームモジュールを管理します。

すべての機能は、このドキュメントサイトで説明されています。異なるクラウドからの Wallarm Console UI のリンクを記事で参照する場合、自身のドメインとオンプレミスで展開したWallarm Cloud のインターフェースを使用してください。

## Wallarm フィルターノードを展開

オンプレミス Wallarm フィルターノードの展開プロセスは、標準的なフィルターノード展開手順に似ています。ニーズとインフラに合った展開オプションを選択し、選択した展開方法の特定の要件を考慮してガイドに従ってください。

### 要件

フィルターノードを展開するには、以下の基準を満たす計算インスタンスを準備します：

* ノードを NGINX モジュールとして展開する、またはインスタンスに NGINX をインストールすることを含む設定の場合、NGINX アーティファクトへのアクセスが必要。
* トラフィック量に応じてノード操作をサポートするのに十分な CPU、メモリ、およびストレージ。一般的なリソース割り当ての推奨事項は[こちら](../admin-en/configuration-guides/allocate-resources-for-node.md)を参照してください。
* オンプレミス Cloud インスタンスの TCP/80 および TCP/443 ポートへのアクセス。
* 選択した展開方法の記事で指定された他の要件に従ってください。

### 手順

オンプレミスでフィルターノードを展開するには：

1. 利用可能なオプションから[展開オプション](supported-deployment-options.md)を選択し、提供される指示に従ってください。インラインおよびアウトオブバンド (OOB) 構成を含むすべてのオプションは、オンプレミス展開をサポートしています。

    ノード設定中、Wallarm Cloud ホストを定義するパラメーターに、以前作成した Wallarm Cloud インスタンスのアドレスを指定します。
1. 実行中のインスタンスのドメインがその IP アドレスに解決されていることを確認します。例えば、ドメインが `my.wallarm.node.com` として設定されている場合、このドメインはインスタンスの IP にポイントする必要があります。

## 展開をテスト

展開をテストするには：

1. フィルターノードインスタンスを対象としたパストラバーサル攻撃のテストを実行します：

    ```bash
    curl http://localhost/etc/passwd
    ```
1. 展開された Wallarm Console UI を開き、対応する攻撃が攻撃リストに表示されるかを確認してください。