# `overlimit_res` 攻撃検出の微調整

Wallarm ノードは一つの受信要求に対する処理に制限時間を費やします。その時間が超過すると、そのリクエストを[リソース超限 (`overlimit_res`)](../../attacks-vulns-list.md#overlimiting-of-computational-resources) 攻撃とマークします。**`overlimit_res` 攻撃検出の微調整** ルールにより、一つのリクエスト処理に割り当てられた時間と、時間を超過した場合のノードのデフォルトの動作をカスタマイズできます。

リクエスト処理時間を制限することで、Wallarm ノードを目指したバイパス攻撃を防ぎます。場合によっては、`overlimit_res` とマークされたリクエストは、Wallarm ノードのモジュールに割り当てられたリソースが不足していて、リクエスト処理に時間がかかっていることを示すことがあります。

## ノードのデフォルトの動作

デフォルトでは、Wallarm ノードは一つの受信要求処理に対して、多くとも **1,000 ミリ秒** を費やすように設定されています。

もし時間制限を超過した場合、Wallarm ノードは:

1. リクエスト処理を停止します。
1. リクエストを `overlimit_res` 攻撃とマークし、攻撃の詳細をWallarm クラウドにアップロードします。

    処理済みのリクエスト部分に他の[攻撃类型](../../attacks-vulns-list.md)も含まれる場合、Wallarm ノードはそれらの詳細もクラウドにアップロードします。

    該当するタイプの攻撃は、Wallarm Console の[イベントリスト](../events/check-attack.md)に表示されます。
1. <a name="request-blocking"></a> **監視** [モード](../../admin-en/configure-wallarm-mode.md)では、ノードがオリジナルのリクエストをアプリケーションアドレスに転送します。アプリケーションは、処理済みおよび未処理のリクエスト部分に含まれる攻撃によって搾取されるリスクがあります。

    **安全ブロッキング**モードでは、もしリクエストが[グレーリスト](../ip-lists/graylist.md)の IP アドレスから発信されていれば、ノードはリクエストをブロックします。そうでなければ、ノードはリクエストをアプリケーションアドレスに転送します。アプリケーションは、処理済みおよび未処理のリクエスト部分に含まれる攻撃によって搾取されるリスクがあります。

    **ブロック**モードでは、ノードはリクエストをブロックします。

!!! info "「無効化」モードでのリクエスト処理"
    **無効化** [モード](../../admin-en/configure-wallarm-mode.md)では、ノードは着信トラフィックを解析せず、したがってリソース超限を狙った攻撃を捕捉しません。

## デフォルトのノードの動作を変える

!!! warning "保護のバイパスまたはシステムメモリの不足のリスク"
    * カスタムのノードの動作は、大きなファイルのアップロードなど特定の場所でのみ変更することを推奨します。そこでは保護のバイパスや脆弱性の悪用のリスクがありません。
    * 高い時間制限と/または時間を過ぎてもリクエストの処理を続けることは、メモリ枯渇や時間超過のリクエスト処理を引き起こす可能性があります。

**`overlimit_res` 攻撃検出の微調整** ルールにより、デフォルトのノードの動作を以下のように変更できます:

* 単一リクエスト処理のカスタム制限を設定する
* 時間制限を超えたときに、リクエスト処理を停止または続行する

    ノードが時間制限を超えた後もリクエスト処理を続行する場合、リクエスト処理が完全に完了した後にのみ、検出された攻撃に関するデータをクラウドにアップロードします。
* リクエスト処理時間制限を超えたときに、`overlimit_res` 攻撃を登録するかどうか

    ノードが攻撃を登録するように設定されている場合、フィルタリングモードに依存して、リクエストを[ブロックまたはアプリケーションアドレスに転送します](#request-blocking)。

    ノードが攻撃を登録するように設定されていない場合、そしてリクエストに他の攻撃タイプが含まれていない場合、ノードはオリジナルのリクエストをアプリケーションアドレスに転送します。もしリクエストに他の攻撃タイプが含まれていた場合、ノードはリクエストをブロックするか、フィルタリングモードに応じてアプリケーションアドレスに転送します。

ルールは次のことを許可していません：

* `overlimit_res`攻撃のブロックモードを他の設定から別々に設定する。 **イベントで登録と表示**オプションが選択された場合、ノードは `overlimit_res` 攻撃をブロックするか、該当エンドポイントに設定された[フィルタリングモード](../../admin-en/configure-wallarm-mode.md)に依存して、アプリケーションアドレスに転送します。

## ルールの例

* このルールでは、各POSTリクエストの処理時間制限を `https://example.com/upload` に1,020 ミリ秒まで拡張します。この特定のエンドポイントは大きなファイルのアップロードを行います。
* ノードの他の動作パラメーターはデフォルトのままです - ノードがリクエストを 1,020 ミリ秒より長く処理する場合、リクエスト処理を停止し、`overlimit_res` 攻撃を登録します。

![「イベントで登録および表示」ルールの例](../../images/user-guides/rules/fine-tune-overlimit-detection-example.png)