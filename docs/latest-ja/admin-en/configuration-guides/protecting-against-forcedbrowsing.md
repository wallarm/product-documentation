# 強制ブラウジング対策

強制ブラウジング攻撃は、Wallarmの標準設定では検出されない攻撃タイプの一つであり、このガイドに記載されているように適切に検出設定を行う必要があります。

[強制ブラウジング](../../attacks-vulns-list.md#forced-browsing)攻撃は、限定された時間枠で異なるURIへのリクエストに対して大量の404レスポンスコードが返されることが特徴です。

この攻撃の目的は、隠されたリソース（例えば、アプリケーションコンポーネントに関する情報を含むディレクトリやファイル）の列挙とアクセスです。強制ブラウジング攻撃タイプは通常、攻撃者がアプリケーションに関する情報を収集し、その情報を利用して他の攻撃タイプを実行することを可能にします。

強制ブラウジングからの保護に加えて、[ブルートフォース攻撃](protecting-against-bruteforce.md)に対する保護も同様の方法で設定できることに注意してください。

## 設定

強制ブラウジングに対する保護を設定するには：

1. Wallarm Console → **Triggers** を開き、トリガー作成ウィンドウを開きます。
1. **強制ブラウジング**の条件を選択します。
1. 同一のオリジンIPリクエストに対して返される404レスポンスコードの数の閾値を設定します。
1. 必要に応じて、特定のエンドポイントへのリクエストにのみトリガーを有効にするために、**URI**を指定します。例えば：

    * リソースファイルディレクトリのURIを指定します。
    * ネストされたURIを使用する場合は、[トリガー処理の優先順位](#trigger-processing-priorities)を考慮します。
    * URIが指定されていない場合、閾値を超えたリクエストの数が任意のエンドポイントでトリガーが有効になります。

    URIはトリガー作成ウィンドウの[URIコンストラクタ](../../user-guides/rules/rules.md#uri-constructor)または[詳細編集フォーム](../../user-guides/rules/rules.md#advanced-edit-form)を通じて設定できます。

1. 必要に応じて、他のトリガーフィルターを設定します：

    * リクエストが向けられた**アプリケーション**。
    * リクエストが送信された一つまたは複数の**IP**。

1. トリガーの反応を選択します：

    * **強制ブラウジングとしてマーク**。閾値を超えた後に受信したリクエストは強制ブラウジング攻撃としてマークされ、Wallarm Consoleの**攻撃**セクションに表示されます。
    * **デニーリストIPアドレス**およびIPアドレスのブロック期間、悪意のあるリクエストソースのIPアドレスを[デニーリスト](../../user-guides/ip-lists/overview.md)に追加して、閾値を超えた後にノードが発信元のIPのすべてのリクエストをブロックします。
    * **グレイリストIPアドレス**および期間、悪意のあるリクエストソースのIPアドレスを[グレイリスト](../../user-guides/ip-lists/overview.md)に追加します。ノードはグレイリストされたIPからのリクエストを[入力検証](../../about-wallarm/protecting-against-attacks.md#input-validation-attacks)、[`vpatch`](../../user-guides/rules/vpatch-rule.md)または[カスタム](../../user-guides/rules/regex-rule.md)攻撃サインが含まれている場合のみブロックします。グレイリストされたIPからのブルートフォース攻撃はブロックされません。

    ![強制ブラウジングトリガーの例](../../images/user-guides/triggers/trigger-example5.png)

1. トリガーを保存し、[クラウドとノードの同期完了](../configure-cloud-node-synchronization-en.md)を待ちます（通常、2-4分かかります）。

ブルートフォース保護のために複数のトリガーを設定することができます。

## テスト

1. 設定された閾値を超えるリクエスト数を保護されたURIに送信します。例えば、`https://example.com/config.json`（`https://example.com/**.**`に一致）に対して31リクエスト：

    ```bash
    for (( i=0 ; $i<32 ; i++ )) ; do curl https://example.com/config.json ; done
    ```
2. トリガーの反応が**デニーリストIPアドレス**の場合、Wallarm Console → **IPリスト** → **デニーリスト** を開いて、送信元IPアドレスがブロックされているかを確認します。

    トリガーの反応が**グレイリストIPアドレス**の場合、Wallarm Consoleのセクション**IPリスト** → **グレイリスト**を確認します。
3. **攻撃**セクションを開いて、リクエストが強制ブラウジング攻撃としてリストに表示されているかを確認します。

    ![インターフェースの強制ブラウジング攻撃](../../images/user-guides/events/forced-browsing-attack.png)

    表示されるリクエストの数は、トリガーの閾値を超えた後に送信されたリクエストの数に対応しています（[行動攻撃の検出の詳細](../../attacks-vulns-list.md#behavioral-attacks)）。この数が5より大きい場合、リクエストのサンプリングが適用され、最初の5ヒットの詳細のみが表示されます（[リクエストサンプリングの詳細](../../user-guides/events/analyze-attack.md#sampling-of-hits)）。

    強制ブラウジング攻撃を検索するために、`dirbust`フィルターを使用することができます。すべてのフィルターは、[検索の使用方法の説明](../../user-guides/search-and-filters/use-search.md)に記載されています。

## トリガー処理の優先順位
            
--8<-- "../include-ja/trigger-processing-priorities.md"

## 要件と制限

**要件**

強制ブラウジング攻撃からリソースを保護するためには、実際のクライアントのIPアドレスが必要です。フィルタリングノードがプロキシサーバーやロードバランサーの背後に配置されている場合は、実際のクライアントのIPアドレスを表示するように[設定](../using-proxy-or-balancer-en.md)します。

**制限**

強制ブラウジング攻撃の兆候を探す際、Wallarmノードは他の攻撃タイプの兆候を含まないHTTPリクエストのみを分析します。