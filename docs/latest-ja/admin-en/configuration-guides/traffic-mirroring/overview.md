# ミラーリングされたトラフィックのフィルタリング

Wallarm nodeのデプロイ方法の1つに、ミラーリングされたHTTPトラフィックをフィルタリングするための非同期型デプロイがあります。本記事では、このデプロイを実装するために必要な設定について説明し、いくつかの例を示します。

トラフィックのミラーリングにより、元の受信トラフィックを複数のバックエンドへ並行して送信できます。追加のバックエンドとしてWallarm nodeを導入すると、クライアントに影響を与えることなくトラフィックのミラー（コピー）をフィルタリングできます。すべての受信リクエストは宛先のサーバーに到達します。

ミラーリングオプションを有効にした場合のトラフィックフロー図の例です:

![ミラーリングの構成図](../../../images/waf-installation/aws/terraform/wallarm-for-mirrored-traffic.png)

## このアプローチのユースケース

ミラーリングされたトラフィックをフィルタリングするためにWallarm nodeを導入すると、次の目的に役立ちます:

* セキュリティソリューションがアプリケーションのパフォーマンスに影響しないことを確認します。
* 本番システムでモジュールを稼働させる前に、トラフィックのコピーでWallarmソリューションをトレーニングします。

## ミラーリングされたトラフィックのフィルタリングの制限事項

このデプロイ方法は安全ですが、いくつかの制限があります:

* ミラーリングされたトラフィックのフィルタリングをサポートするのはNGINXベースのWallarm nodeのみです。
* 実際のトラフィックフローとは独立して解析が進むため、Wallarm nodeは悪意のあるリクエストを即時にブロックしません。
* ノードが保持するのは受信リクエストのコピーのみであり、サーバー応答はミラーリングできないため、WallarmはアプリケーションおよびAPIの[脆弱性](../../../about-wallarm/detecting-vulnerabilities.md)を検出しません。
* このソリューションには、トラフィックのミラーリングを提供するWebサーバーまたは同様のツール（例: NGINX、Envoy、Istio、Traefik、カスタムKongモジュールなど）という追加コンポーネントが必要です。

## 設定

ミラーリングされたトラフィックをフィルタリングするためにWallarmを実装するには、次のようにします:

1. Webサーバーを構成し、受信トラフィックを追加のバックエンドにミラーリングするようにします。
1. 追加のバックエンドとしてWallarm nodeを[インストール](../../../installation/supported-deployment-options.md)し、ミラーリングされたトラフィックをフィルタリングするように設定します。

トラフィックのミラーリングは多くのWebサーバーでサポートされています。以下のリンク先に、代表的なWebサーバー向けの設定例があります:

* [NGINX](nginx-example.md)
* [Traefik](traefik-example.md)
* [Envoy](envoy-example.md)
* [Istio](istio-example.md)