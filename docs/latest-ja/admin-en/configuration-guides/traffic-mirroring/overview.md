# ミラーリングされたトラフィックのフィルタリング

Wallarmノードの展開手法の1つは、非同期ベースのミラーリングHTTPトラフィックフィルタリングを実装しております。この展開実装に必要な設定方法をご説明し、いくつかの例を提供します。

トラフィックミラーリングにより、元の着信トラフィックが複数のバックエンドへ並行して送信されます。追加バックエンドとしてWallarmノードをインストールすることで、クライアントに影響を与えることなくミラーリングトラフィック（コピー）のフィルタリングを実行でき、いかなる着信リクエストも宛先サーバーへ到達します。

以下は、ミラーリングオプションが有効になっているトラフィックフローダイアグラムの例です。

![ミラースキーム](../../../images/waf-installation/aws/terraform/wallarm-for-mirrored-traffic.png)

## ユースケース

追加バックエンドとしてWallarmノードを設置してミラーリングトラフィックをフィルタリングすることは、以下の場合に有用です：

* セキュリティソリューションがアプリケーションのパフォーマンスに影響を及ぼさないことを確認します。
* 本番環境でモジュールを稼働する前に、コピーされたトラフィックでWallarmソリューションの学習を行います。

## ミラーリングトラフィックフィルタリングの制限事項

展開アプローチは安全ですが、以下のような制限事項があります：

* NGINXベースのWallarmノードのみがミラーリングトラフィックフィルタリングをサポートします。
* 実際のトラフィックフローに関係なくトラフィック分析が進むため、Wallarmノードは悪意のあるリクエストを即時にブロックしません。
* ノードは着信リクエストのコピーのみを保持しており、サーバー応答をミラーリングできないため、WallarmはアプリケーションおよびAPIの[脆弱性](../../../about-wallarm/detecting-vulnerabilities.md)を検出しません。
* 本ソリューションは、トラフィックミラーリングまたは同様の機能を提供するウェブサーバー（NGINX,Envoy,Istio,Traefik,カスタムKongモジュール等）などの追加コンポーネントを必要とします。

## 設定

Wallarmを使用してミラーリングトラフィックをフィルタリングするには：

1. ウェブサーバーを設定して、着信トラフィックを追加バックエンドへミラーリングするようにします。
1. 追加バックエンドとしてWallarmノードを[インストール](../../../installation/supported-deployment-options.md)し、ミラーリングされたトラフィックのフィルタリングを行うように設定します。

多くのウェブサーバーがトラフィックミラーリングに対応します。以下のリンクに最も普及しているものの**設定例**が掲載されています：

* [NGINX](nginx-example.md)
* [Traefik](traefik-example.md)
* [Envoy](envoy-example.md)
* [Istio](istio-example.md)