# Reescrever Solicitações Antes de Repetir Ataques <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

Você pode modificar as solicitações usadas pelo módulo [Verificação Ativa de Ameaças do Wallarm](overview.md) para repetir um ataque. Isso pode ser particularmente útil ao substituir os dados de autenticação originais por dados de teste ou ao realizar repetições de ataques em endereços alternativos. Este guia fornece instruções sobre como fazer isso.

Por padrão, o módulo mantém os dados da solicitação original, exceto pela [remoção de parâmetros específicos de autenticação](overview.md#test-request-security). A regra **Reescrever ataque antes da verificação ativa** é usada para modificar os elementos da solicitação original antes de gerar um conjunto de teste de ataques com base neles. Os seguintes elementos podem ser modificados:

* Cabeçalho com os dados de autenticação da solicitação para substituir [dados de autenticação originais por dados de teste](#replacing-original-authentication-data-with-test-data).
* Cabeçalho `HOST`. Por exemplo, o cabeçalho `HOST` poderia ser modificado para repetir o ataque em [ambiente de teste ou preparação](#modifying-the-application-address-for-attack-replaying).
* Caminho para [reescrever o endereço da aplicação usado para a repetição do ataque](#modifying-the-application-address-for-attack-replaying).

!!! alerta "Modificação de qualquer elemento original da solicitação"
    A regra permite a modificação apenas dos cabeçalhos (`header`) e caminhos (`uri`) das solicitações originais. Outros elementos da solicitação não podem ser modificados ou adicionados.

## Criação e aplicação da regra

Para criar e aplicar a regra **Reescrever ataque antes da verificação ativa**:

1. Vá para o Console Wallarm → **Regras** → crie a regra **Reescrever ataque antes da verificação ativa**.
1. Preencha o formulário de criação da regra seguindo as instruções:

      * **Se a solicitação for** [especifica](../../user-guides/rules/rules.md#branch-description) os endpoints aos quais a regra deverá ser aplicada.
      * **Regras** define o novo valor para o parâmetro selecionado no campo **Parte da solicitação**. Um valor definido será usado ao repetir o ataque.

        O valor deve ser decodificado e definido usando a [linguagem de template Liquid](https://shopify.github.io/liquid/), da seguinte forma: colocado entre chaves duplas `{{}}` e aspas simples `''`. Por exemplo: `{{'example.com'}}`.

        Para substituir o caminho da solicitação original (`uri`), você deve passar o valor completo do novo caminho.

      * **Parte da solicitação** aponta para o elemento original da solicitação que deve ser modificado antes de repetir o ataque. Certifique-se de que esse elemento esteja presente nas solicitações originais, já que os valores originais serão substituídos.

        !!! alerta "Valores possíveis"
            Os únicos valores aceitáveis para o campo **Parte da solicitação** são `header` e `uri`. Nenhum outro valor é permitido.

1. Aguarde a [conclusão da compilação da regra](../../user-guides/rules/rules.md).

Para definir várias condições para a modificação da solicitação original ou para substituir os valores de vários elementos da solicitação, você pode criar várias regras.

## Exemplos de regras

### Substituindo dados de autenticação originais por dados de teste

As APIs do seu aplicativo podem exigir autenticação. No entanto, como o módulo [remove](overview.md#test-request-security) esses dados antes de repetir ataques, as vulnerabilidades podem passar despercebidas. Para resolver isso, considere a criação de parâmetros específicos de autenticação para a verificação ativa de ameaças quando esses dados são passados nos cabeçalhos da solicitação. Essa abordagem não apenas concede o acesso necessário, mas também permite que você controle e proteja o processo de repetição.

Para fornecer as solicitações repetidas com detalhes de autenticação necessários, você pode adicionar valores de teste para esses parâmetros usando a regra **Reescrever ataque antes da verificação ativa**. Por exemplo: chave da API, token, senha ou outros parâmetros.

Por exemplo, a seguinte é a regra para garantir que os ataques repetidos em example.com levem o valor `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` no cabeçalho `COOKIE`. O formato do valor do cabeçalho é {`{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![Exemplo da regra modificando COOKIE](../../images/user-guides/rules/rewrite-request-example-cookie.png)

### Modificando o endereço da aplicação para repetição do ataque

Por padrão, os ataques repetidos são enviados para o endereço e caminho da aplicação passados na solicitação original. Você pode substituir o endereço e caminho original por outros valores que serão usados ao repetir o ataque. Os valores são substituídos usando a regra **Reescrever ataque antes da verificação ativa** da seguinte maneira:

* Substitua o valor original do cabeçalho `HOST` por um endereço de instância de aplicação diferente. Por exemplo, uma instância de aplicação separada poderia ser um ambiente de teste ou preparação.
* Substitua o caminho da solicitação original pelo caminho para ambiente de teste ou preparação, ou para o caminho ao servidor alvo para contornar o servidor proxy ao repetir o ataque.

Para substituir tanto o valor do cabeçalho `HOST` quanto o caminho da solicitação original, você precisará criar duas regras separadas com o tipo de ação **Reescrever ataque antes da verificação ativa**.

Por exemplo, a seguinte regra define o módulo para repetir ataques originalmente enviados para `example.com` no ambiente de teste `example-test.env.srv.loc`. O formato do endereço é `{{'example-test.env.srv.loc'}}`.

![Exemplo da regra modificando HOST](../../images/user-guides/rules/rewrite-request-example-host.png)
