# Habilitando a Verificação de Ameaças Ativas Globalmente ou para Endpoints Específicos <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

O módulo [Verificação de Ameaças Ativas da Wallarm](overview.md) pode ser habilitado globalmente, afetando todos os endpoints onde o nó de filtragem está configurado, ou individualmente para endpoints específicos. Este artigo fornece instruções sobre como gerenciar o comportamento do módulo.

## Habilitando o módulo globalmente

A Verificação de Ameaças Ativas está desabilitada por padrão. Para habilitá-la globalmente:

1. Certifique-se de que você tem uma [assinatura do plano](../../about-wallarm/subscription-plans.md#subscription-plans) **Advanced API Security** ativa. O módulo está disponível apenas neste plano.

    Se você estiver em um plano diferente, entre em contato com nossa [equipe de vendas](mailto:sales@wallarm.com) para fazer a transição para o necessário.
1. Acesse o Console da Wallarm → **Vulnerabilidades** → **Configurar** seguindo o link para a [Nuvem dos EUA](https://us1.my.wallarm.com/vulnerabilities/active?configure=true) ou [Nuvem da UE](https://my.wallarm.com/vulnerabilities/active?configure=true), e ative o interruptor **Verificação de ameaças ativas**.

Esta ação habilita o módulo para todos os recursos onde o nó de filtragem está configurado.

![!Configurações de varredura de vulnerabilidades](../../images/user-guides/vulnerabilities/vuln-scan-settings.png)

## Controlando o modo do módulo para endpoints específicos

Uma vez que o módulo está [habilitado globalmente](#enabling-the-module-globally), você pode personalizar seu comportamento para endpoints específicos usando a regra correspondente. Veja como:

1. Acesse o Console da Wallarm → **Regras** → crie a regra **Definir modo de verificação de ameaças ativas**.
1. Preencha o formulário de criação de regra seguindo as instruções:

    * **Se a solicitação for** [especifica](../../user-guides/rules/rules.md#branch-description) os endpoints para aplicar a regra.
    * **Desabilitar / Habilitar** define o modo do módulo para ataques enviados aos endpoints especificados.

    Use a configuração **Habilitar** para fazer exceções para uma regra que desabilita o módulo (por exemplo, habilitando para `https://example.com/module/user/create` enquanto está desabilitado para `https://example.com/module/user/*`).
1. Aguarde a [compilação do conjunto de regras personalizadas ser concluída](../../user-guides/rules/rules.md).

### Habilitando o módulo para endpoints específicos

Para habilitar o módulo apenas para endpoints específicos:

1. Habilite o módulo globalmente no Console da Wallarm → **Vulnerabilidades** → **Configurar**.
1. Desabilite o módulo para todos os endpoints criando a regra **Definir modo de verificação de ameaças ativas** e deixando a seção **Se a solicitação for** vazia.
1. Crie regras **Definir modo de verificação de ameaças ativas** para habilitar o módulo para hosts, aplicativos ou endpoints específicos, descrevendo-os na seção da regra **Se a solicitação for**.

Aqui está como a regra parece quando desabilita o módulo para todos os endpoints:

![!Exemplo da regra "Definir modo de verificação de ameaças ativas"](../../images/user-guides/rules/disable-atv-for-all-endpoints.png)

Se a regra mencionada acima já estiver ativa, a seguinte regra habilitaria o módulo para `https://example.com/module/user/create`:

![!Exemplo da regra "Definir modo de verificação de ameaças ativas"](../../images/user-guides/rules/disable-active-threat-verification-deeper-path-example.png)

Alternativamente, você pode desabilitar o módulo aplicando uma regra para a URL e depois habilitá-lo para endpoints específicos relacionados a essa URL.

### Desabilitando o módulo para endpoints específicos

Para endpoints sem um ambiente de staging, especialmente aqueles que não são idempotentes ou que não têm um mecanismo de autenticação, é recomendável desabilitar a repetição de ataques. Sem essas salvaguardas, o módulo pode inadvertidamente repetir ações prejudiciais, como processar transações monetárias várias vezes ou criar repetidamente novas contas.

Para desabilitar o módulo para endpoints específicos:

1. Habilite o módulo globalmente no Console da Wallarm → **Vulnerabilidades** → **Configurar**.
1. Desabilite o módulo para os endpoints necessários usando a regra **Definir modo de verificação de ameaças ativas**. Descreva esses endpoints na seção da regra **Se a solicitação for**.

Considere um endpoint não idempotente como POST `https://example.com/api/purchase` em uma plataforma de compras online que realiza ações como deduzir estoque e cobrar contas de usuário. Se essa ação for acidentalmente repetida pelo módulo, isso poderia levar a consequências como várias cobranças por um único item. Portanto, para tais endpoints em um ambiente de produção, é recomendável desativar a repetição de ataques. Para tal endpoint, a regra teria esta aparência:

![!Exemplo da regra "Definir modo de verificação de ameaças ativas"](../../images/user-guides/rules/disable-atv-for-non-indemponent-end.png)