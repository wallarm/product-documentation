# Üretim Dışı Sistemlerde Aktif Tehdit Doğrulama Testlerinin Çalıştırılması <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

[Wallarm'ın Aktif Tehdit Doğrulaması](overview.md), saldırganları kendi penetrasyon testersızınıza dönüştürür. Bir saldırganın isteğini analiz ettikten sonra, potansiyel açığı ortaya çıkaran istekleri uygulamanızda hazırlar ve test eder. Varsayılan yapılandırma, testleri orijinal istek adresine gönderirken, Wallarm, testleri bir sahneleme ortamına yönlendirmek için modülün yapılandırılmasını önerir. Bu yapılandırma, üretim öncesi uygulamaları ve API'leri test etmek için üretim saldırı trafiğini kullanmanıza olanak sağlar. Bu makale, Wallarm'ı bu önerilen kullanım durumu için nasıl yapılandıracağınız hakkında size rehberlik eder.

Gerçek üretim verilerini kullanarak üretim ortamında test yapmak, kapsamlı testler nedeniyle arızaya neden olma veya gerçek kullanıcı verilerini tehlikeye atma gibi riskler taşıyabilir. Bir sahneleme veya geliştirme ortamında test yapmak bu riskleri ortadan kaldırır. Bu yaklaşım, ilişkili sorunlar olmadan üretim gibi verileri kullanarak açıklıkları test etmenize olanak sağlar. Bunun yanı sıra, canlı sistemlerinizin güvenliğini sağlarken aynı zamanda geliştirme sırasında açıklıkları tespit eder.

Modülü üretim-dışı test için ayarlamak için aşağıdaki adımları izleyin:

1. Üretim-dışı bir ortam ana bilgisayarını yapılandırın.
1. Üretim-dışı bir kimlik doğrulama çerezini veya API anahtarını yapılandırın.
1. Aktif Tehdit Doğrulamasını etkinleştirin.

Aşağıdaki diyagram, bu kullanım durumunda modülün nasıl çalıştığını göstermektedir:

![ATV şeması](../../images/vulnerability-detection/active-threat-verification-scheme-staging.png)

## 1. Üretim-dışı bir ortam ana bilgisayarını yapılandırın

[**Saldırıyı aktif doğrulamadan önce yeniden yazma**](modify-requests-before-replay.md) kuralı, saldırı oynatma adresini, orijinal `HOST` başlık değerini veya istek yollarını değiştirerek düzenlemenize olanak sağlar. Bunu başarmak için:

1. Wallarm Konsolu → **Kurallar** → **Saldırıyı aktif doğrulamadan önce yeniden yazma** kuralını oluşturun.
1. Kural oluşturma formunu aşağıdaki talimatlara göre doldurun:

      * **Eğer istek şu şekildeyse** [belirtir](../../user-guides/rules/rules.md#branch-description) kuralın uygulanacağı uç noktaları.
      * **Kurallar** `HOST` başlığının veya istek yolunun (alan adı olmadan URL segmenti, örneğin, `/test-blogs/new`) yeni değerini belirtir.

        Değer, [Liquid şablon dilinde](https://shopify.github.io/liquid/) şu şekilde kodlanmalı ve belirlenmelidir: çift süslü parantezler `{{}}` ve tek tırnaklar `''` ile çevrelenmiş hali. Örneğin: `{{'example.com'}}`.
      
      * **İstek parçası**: isteği değiştirmeyi düşündüğünüz segmente göre `header: HOST` veya `uri` seçin.
1. [Kural derlemesinin tamamlanmasını](../../user-guides/rules/rules.md) bekleyin.

Örneğin, aşağıdaki `example.com` adresine yönelik saldırıları, `example-test.env.srv.loc` test ortamında çalıştırmak için kuraldır. Adres formatı `{{'example-test.env.srv.loc'}}` şeklindedir.

![!HOST'u düzenleyen kural örneği](../../images/user-guides/rules/rewrite-request-example-host.png)

## 2. Üretim-dışı bir kimlik doğrulama çerezini veya API anahtarını yapılandırın

Uygulamanızın API'leri kimlik doğrulama gerektirebilir. Ancak, modül [saldırıları](overview.md#test-request-security) çalmadan önce kimlik doğrulama verilerini çıkarır veya üretim kimlik doğrulama verileri sahneleme veya geliştirme ortamları için geçerli olmadığından, açıklıklar fark edilemeyebilir.

Bu sorunu gidermek için, aktif tehdit doğrulama için üretim-dışı ortamlarınızda belirli kimlik doğrulama parametreleri belirlemeyi düşünebilirsiniz. Bu, aşağıdaki durumlarda yapılabilir:

* Veri, istek başlıklarında dahil edilmiştir ve
* İstek başlıkları, orijinal ve yeni üretim-dışı ortamlar arasında tutarlıdır.

Bu yöntem, sadece gerekli erişimi sağlamakla kalmaz, aynı zamanda oynatma sürecini güvenli bir şekilde kontrol edebilmenizi sağlar.

Yeniden oynatılan isteklere gerekli kimlik doğrulama ayrıntılarını sağlamak için:

1. Wallarm Konsolu → **Kurallar** → **Saldırıyı aktif doğrulamadan önce yeniden yazma** kuralını oluşturun.
1. Kural oluşturma formunu aşağıdaki talimatlara göre doldurun:

    * **Eğer istek şu şekildeyse** [belirtir](../../user-guides/rules/rules.md#branch-description) kuralın uygulanacağı uç noktaları.
    * **Kurallar** aktif tehdit doğrulama istekleri için tasarlanmış çerez veya token değerini sağlar.

        Değer, [Liquid şablon dilinde](https://shopify.github.io/liquid/) şu şekilde kodlanmalı ve belirlenmelidir: çift süslü parantezler `{{}}` ve tek tırnaklar `''` ile çevrelenmiş hali. Örneğin: `{{'example.com'}}`.

    * **İstek parçası**: `header`'ı seçin ve kimlik doğrulama verilerini geçirmek için başlık adını belirtin.
1. [Kural derlemesinin tamamlanmasını](../../user-guides/rules/rules.md) bekleyin.

Örneğin, aşağıdaki kural, `example.com` üzerinde tekrar oynatılan saldırıların `COOKIE` başlığında `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` değerini taşımasını sağlar.

Başlık değerinin formatı `{{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}` şeklindedir.

![!COOKIE'yi düzenleyen kural örneği](../../images/user-guides/rules/rewrite-request-example-cookie.png)

## 3. Modülü etkinleştirin

Üretim-dışı ortamlarda saldırı oynatmalarını çalıştırmak için gerekli tüm ayarları belirttikten sonra, açığın tespit sürecini başlatmak için modülü etkinleştirin:

1. Aktif **Advanced API Security** [abonelik planınızın](../../about-wallarm/subscription-plans.md#subscription-plans) olması gerekmektedir. Modül, yalnızca bu plan altında mevcuttur.

    Farklı bir planınız varsa, lütfen gereken plana geçiş yapmak için [satış ekibimizle](mailto:sales@wallarm.com) iletişime geçin.
1. Wallarm Konsolu → **Zayıflıklar** → **Yapılandırma**'ya [US Cloud](https://us1.my.wallarm.com/vulnerabilities/active?configure=true) veya [EU Cloud](https://my.wallarm.com/vulnerabilities/active?configure=true) bağlantısı üzerinden gidin, **Aktif tehdit doğrulama** geçişini açın.

![!Vuln tarama ayarları](../../images/user-guides/vulnerabilities/vuln-scan-settings.png)

Bu işlem, filtreleme düğümünün yapılandırıldığı tüm kaynaklar için modülü etkinleştirir. Oynatma, daha önce belirttiğiniz ayarı göz önünde bulundurarak çalışacaktır.

Ayrıca, belirli uç noktalar için modülü [etkinleştirebilir veya devre dışı bırakabilirsiniz](enable-disable-active-threat-verification.md).

## Algılanan zayıflıkların izlenmesi ve ele alınması

Algılanan zayıflıklarla ilgili zamanında [bildirimler](../../user-guides/settings/integrations/integrations-intro.md) almayı seçebilirsiniz. Sistemler, Splunk, OpsGenie vb. gibi sistemlere. Zayıflık bildirimlerini günlük iş akışınıza entegre etmek, potansiyel tehditlere karşı yanıt zamanınızı önemli ölçüde hızlandırır.

![Opsgenie entegrasyonu](../../images/user-guides/settings/integrations/add-opsgenie-integration-vulns.png)

Tüm zayıflıkların, uygulama tarafında düzeltilmesi gerekmektedir çünkü bu zayıflıklar sisteminizi kötü amaçlı eylemlere daha savunmasız hale getirir. Bir zayıflığın düzeltilmesi mümkün değilse, ilgili saldırıları engellemeye yardımcı olabilecek  [sanal yama](../../user-guides/rules/vpatch-rule.md) kuralını kullanabilirsiniz ve bir olayın riskini ortadan kaldırır.

Keşfedilen zayıflıklar ayrıca Wallarm Konsolu UI'nin [**Zayıflıklar**](../../user-guides/vulnerabilities.md) bölümünde de kataloglanır. Burada onları analiz edebilir ve yönetebilirsiniz.

![Zayıflıklar sekmesi](../../images/user-guides/vulnerabilities/check-vuln.png)
