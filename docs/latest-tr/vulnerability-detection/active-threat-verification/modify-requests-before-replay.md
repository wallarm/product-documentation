# Saldırı Yeniden Oynatma Öncesi İstekleri Yeniden Yazma <a href="../../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../../images/api-security-tag.svg" style="border: none;"></a>

[Wallarm'ın Aktif Tehdit Doğrulama](overview.md) modülü tarafından kullanılan istekleri saldırı yeniden oynatma için düzenleyebilirsiniz. Bu, özellikle orijinal kimlik doğrulama verilerini test verileriyle değiştirirken veya alternatif adresler üzerinde saldırı yeniden oynatmaları gerçekleştirirken son derece yararlı olabilir. Bu kılavuz, bunu nasıl başarabileceğiniz konusunda talimatlar sağlar.

Varsayılan olarak, modül orijinal istek verilerini korur, yalnızca [spesifik kimlik doğrulama parametrelerini çıkartır](overview.md#test-request-security). **Aktif doğrulama öncesinde saldırıyı yeniden yazma** kuralı, test saldırı setini oluşturmadan önce orijinal istek elementlerini değiştirmek için kullanılır. Aşağıdaki elementler değiştirilebilir:

* İstek kimlik doğrulama verileri ile başlık değiştirilir [orijinal kimlik doğrulama verileri test verisiyle değiştirilir](#replacing-original-authentication-data-with-test-data).
* `HOST` başlığı. Örneğin, `HOST` başlığı [sahneleme veya test ortamında](#modifying-the-application-address-for-attack-replaying) saldırının yeniden oynatılması için değiştirilebilir.
* [Saldırı yeniden oynatma için kullanılan uygulama adresini yeniden yazmak](#modifying-the-application-address-for-attack-replaying) için yol.

!!! warning "Herhangi bir orijinal istek elementinin değiştirilmesi"
    Kural, yalnızca orijinal isteklerin başlıklarını (`header`) ve yollarını (`uri`) değiştirmeye izin verir. Diğer istek elementleri değiştirilemez veya eklenemez.

## Kuralı oluşturma ve uygulama

**Aktif doğrulama öncesi saldırıyı yeniden yazma** kuralını oluşturmak ve uygulamak için:

1. Wallarm Konsolu → **Kurallar** → **Aktif doğrulama öncesi saldırıyı yeniden yazma** kuralını oluşturun.
1. Kural oluşturma formunu aşağıdaki talimatlara göre doldurun:

      * **Eğer istek** kuralın uygulanacağı noktaları [belirtir](../../user-guides/rules/add-rule.md#branch-description).
      * **Kurallar**, **İstek Parçası** alanında seçilen parametre için yeni değeri belirler. Set edilen değer, saldırı oynatılırken kullanılır.

        Değer, şu şekilde çözülerek ve [şablon dili Liquid](https://shopify.github.io/liquid/) kullanılarak belirlenmelidir: çift süslü parantezlere `{{}}` ve tek tırnaklara `''` yerleştirilmiş. Örneğin: `{{'example.com'}}`.

        Orijinal isteğin yolunu (`uri`) değiştirmek için, yeni yolun tam değerini geçirmelisiniz.

      * **İstek Parçası**, saldırı oynatılmadan önce değiştirilmesi gereken orijinal istek öğesine işaret eder. Bu öğenin, orijinal değerlerin yerine geçirilmesi için orijinal isteklerde mevcut olduğundan emin olun.

        !!! warning "Olası değerler"
            **İstek Parçası** alanı için kabul edilebilir tek değerler `header` ve `uri` 'dir. Başka değerlere izin verilmemektedir.

1. [Kural derlemenin tamamlanmasını](../../user-guides/rules/compiling.md) bekleyin.

Orijinal istek değişikliği için birkaç koşul belirlemek veya birkaç istek öğesinin değerlerini değiştirmek için, birkaç kural oluşturabilirsiniz.

## Kural örnekleri

### Orijinal kimlik doğrulama verilerinin test verileri ile değiştirilmesi

Uygulamanızın API'leri kimlik doğrulama gerektirebilir. Ancak, modül bu verileri saldırıları yeniden oynatmadan önce [çıkardığı](overview.md#test-request-security) için, açıklıklar tespit edilemeyebilir. Bunu çözmek için, bu verilerin istek başlıklarında geçtiği durumda aktif tehdit doğrulaması için belirli kimlik doğrulama parametreleri oluşturmayı düşünün. Bu yaklaşım, gerekli erişimi sağlamanın yanı sıra yeniden oynatma sürecini kontrol etmenizi ve güvence altına almanızı sağlar.

Yeniden oynatılan isteklere gerekli kimlik doğrulama ayrıntıları sağlamak için, bu parametreler için test değerlerini **Aktif doğrulama öncesi saldırıyı yeniden yazma** kuralını kullanarak ekleyebilirsiniz. Örneğin: API anahtarı, belirteç, şifre veya diğer parametreler.

Örneğin, yeniden oynatılan saldırıların example.com üzerinde `COOKIE` başlığında `PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low` değerini taşımasını sağlamak için aşağıdaki kural kullanılır. Başlık değerinin formatı {`{'PHPSESSID=mntdtbgt87j3auaq60iori2i63; security=low'}}`.

![COOKIE'yi değiştiren kural örneği](../../images/user-guides/rules/rewrite-request-example-cookie.png)

### Saldırı yeniden oynatma için uygulama adresinin değiştirilmesi

Varsayılan olarak, yeniden oynatılan saldırılar orijinal istekte geçen uygulama adresine ve yoluna gönderilir. Orijinal adresi ve yolu, saldırı yerine oynatılırken kullanılacak diğer değerlerle değiştirebilirsiniz. Değerler, aşağıdaki şekilde **Aktif doğrulama öncesi saldırıyı yeniden yazma** kuralı kullanılarak değiştirilir:

* Başlık `HOST` 'un orijinal değerini farklı bir uygulama örneği adresiyle değiştirin. Örneğin, ayrı bir uygulama örneği bir sahneleme veya test ortamı olabilir.
* Orijinal isteğin yolunu, test ortamına veya sahnelemeye veya hedef sunucuya gösteren yola veya saldırıyı yeniden oynatırken proxy sunucusunu atlamak için hedef sunucuya gösteren yola değiştirin.

Hem `HOST` başlığının değerini hem de orijinal isteğin yolunu değiştirmek için, **Aktif doğrulama öncesi saldırıyı yeniden yazma** eylem türü ile iki ayrı kural oluşturmanız gerekir.

Örneğin, aşağıdaki kural, orijinal olarak `example.com` adresine gönderilen yeniden oynatma saldırılarını test ortamı `example-test.env.srv.loc` üzerinde ayarlar. Adresin formatı `{{'example-test.env.srv.loc'}}`.

![HOST'u değiştiren kural örneği](../../images/user-guides/rules/rewrite-request-example-host.png)
