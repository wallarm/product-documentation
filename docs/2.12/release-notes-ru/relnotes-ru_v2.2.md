# Wallarm Node - Обновление 2.2

## Изменения в системе

* Добавлены ограничения потребляемых ресурсов. Запрос, который обрабатывается
  дольше указанного времени, считается атакой. Ограничения времени анализа и
  решения о блокировки настраиваются параметрами
  `wallarm_process_time_limit_block` и `wallarm_process_time_limit`.
  Ограничение памяти на рабочий процесс NGINX настраивается директивой
  `wallarm_worker_rlimit_vmem`.

  Значения по умолчанию:

   * Время анализа одного запроса ограничено 1 секундой (без учета времени
     ответа бэкенда).
   * Память для рабочего процесса NGINX ограничена 1 ГБ.

  Подробнее о параметрах: [Тонкая настройка конфигурации Валарм](../admin-en/configure-parameters-en.md).

* Добавлена возможность управлять поведением NGINX при ошибках загрузки правил
  фильтрации. Теперь можно создавать резервные копии proton.db и [ЛОМ](../glossary-en.md#лом).
  Данные копии могут быть использованы, если правила фильтрации отсутствуют
  или повреждены. При невозможности использовать и резервные копии тоже
  модуль Валарм будет отключен, а NGINX продолжит работу. Ранее при
  невозможности загрузки правил фильтрации NGINX не мог быть запущен.
  Поведение при ошибках загрузки правил определяется параметрами файла
  конфигурации `wallarm_fallback` и `wallarm_cache_path`.

  Подробнее о параметрах: [Тонкая настройка конфигурации Валарм](../admin-en/configure-parameters-en.md).

* Улучшены механизмы обнаружения атак.

* Оптимизировано потребление памяти сервером NGINX.

* Добавлена возможность управлять режимом блокировки через правила фильтрации.
  Данная возможность настраивается параметром ``wallarm_mode_allow_override``.

  Подробнее о параметрах: [Тонкая настройка конфигурации Валарм](../admin-en/configure-parameters-en.md).

* Триггер `/etc/wallarm/triggers.d/nginx` переименован в
  `/etc/wallarm/triggers.d/nginx-wallarm`. Этот триггер используется пакетом `nginx-wallarm`.

## Новые возможности установки

* Постаналитика может быть установлена на отдельную группу серверов.

* Подсистема для обработки трафика может быть построена на базе уже
  используемого сервера NGINX. Данная схема работы имеет очень строгие
  ограничения бинарной совместимости: модуль Валарм совместим с конкретной
  версией NGINX и может работать только с ней. Валарм поддерживает последнюю
  стабильную версию NGINX. Список свежих версий NGINX доступен на сайте
  [www.nginx.org](https://www.nginx.org).

!!! warning "Зависимость от пакета NGINX"
    В пакете модуля Валарм не прописана зависимость от пакета NGINX. Отслеживать соответствие NGINX и модуля Валарм следует самостоятельно.
