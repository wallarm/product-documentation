# Anotações do Pod Suportadas pelo Sidecar da Wallarm

A [solução Sidecar da Wallarm](deployment.md) pode ser configurada via anotações em uma base per-pod. A lista de anotações suportadas nesta solução está descrita neste documento.

!!! info "Prioridades das configurações globais e per-pod"
    As anotações per-pod [têm precedência](customization.md#configuration-area) sobre os valores do gráfico Helm.

## Lista de anotações

| Anotação e valor de gráfico correspondente                          | Descrição                                                      | 
|-------------------------------------|------------------------------------------------------------------|
| **Anotação:** `sidecar.wallarm.io/sidecar-injection-schema`<br><br>`config.injectionStrategy.schema` | [Padrão de implantação do container Wallarm](customization.md#single-and-split-deployment-of-containers): `single` (padrão) ou `split`.                                                                                                                                                                                                                                                                     |
| **Anotação:** `sidecar.wallarm.io/sidecar-injection-iptables-enable`<br><br>`config.injectionStrategy.iptablesEnable` | [Se deseja iniciar o contêiner `iptables` init](customization.md#incoming-traffic-interception-port-forwarding): `true` (padrão) ou `false`.                                                                                                                                                                                                                                |
| **Anotação:** `sidecar.wallarm.io/wallarm-application`<br><br>Sem valor de gráfico   | [ID de aplicação da Wallarm][applications-docs].                                                                                                                                                                                                                                                                           |
| **Anotação:** `sidecar.wallarm.io/wallarm-block-page`<br><br>Sem valor de gráfico | [Página de bloqueio e código de erro][custom-blocking-page-docs] para retornar a solicitações bloqueadas.                                                                                                                                                        |
| **Anotação:** `sidecar.wallarm.io/wallarm-enable-libdetection`<br><br>`config.wallarm.enableLibDetection`                         | Se deseja validar adicionalmente os ataques de Injeção de SQL usando a biblioteca [libdetection][libdetection-docs]: `on` (padrão) ou `off`.                                                                                                                                                                                                             |
| **Anotação:** `sidecar.wallarm.io/wallarm-fallback`<br><br>`config.wallarm.fallback`                                          | [Modo fallback da Wallarm][fallback-mode-docs]: `on` (padrão) ou  `off`. |
| **Anotação:** `sidecar.wallarm.io/wallarm-mode`<br><br>`config.wallarm.mode`                                              | [Modo de filtragem de tráfego][wallarm-modes-docs]: `monitoring` (padrão), `safe_blocking`, `block` ou `off`.                                                                                                                                                                                                                                                                       |
| **Anotação:** `sidecar.wallarm.io/wallarm-mode-allow-override`<br><br>`config.wallarm.modeAllowOverride`                                 | Gerencia a [capacidade de substituir os valores `wallarm_mode` por meio de configurações na Nuvem][filtration-mode-priorities-docs]: `on` (padrão), `off` ou `strict`.                                                                                                                                                                                       |
| <a name="wallarm-node-group"></a>**Anotação:** `sidecar.wallarm.io/wallarm-node-group`<br><br>`config.wallarm.api.nodeGroup`                                 | Especifica o nome do grupo de nós de filtragem que você deseja adicionar aos nós recém-implantados. Agrupamento de nós desta maneira está disponível somente quando você cria e conecta nós à Nuvem usando um token de API com a função **Deploy** (seu valor é passado no parâmetro `config.wallarm.api.token`).<br>Este valor não surte efeito nos pods Tarantool, nós para eles são sempre vinculados ao grupo de nós especificado no valor do gráfico Helm `config.wallarm.api.nodeGroup`.                                                                                                                                                                                      |
| **Anotação:** `sidecar.wallarm.io/wallarm-parser-disable`<br><br>Sem valor de gráfico                                                            | Permite desativar [os analisadores][parsers-docs]. Os valores da diretiva correspondem ao nome do analisador a ser desativado, por exemplo, `json`. Múltiplos analisador podem ser especificados, dividindo-os por ponto e vírgula, por exemplo, `json;base64`.                                                                                                                     |
| **Anotação:** `sidecar.wallarm.io/wallarm-parse-response`<br><br>`config.wallarm.parseResponse`                                     | Se deseja analisar as respostas do aplicativo para ataques: `on` (padrão) ou `off`. A análise da resposta é necessária para a detecção de vulnerabilidades durante a [detecção passiva][passive-detection-docs] e a [verificação de ameaça ativa][active-threat-verification-docs].                                                                                                                                                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/wallarm-acl-export-enable`<br><br>`config.wallarm.aclExportEnable`                                     | Habilita `on` / desabilita `off` o envio de estatísticas sobre as solicitações de IPs na [lista de negação][denylist-docs] do nó para a Nuvem.<ul><li>Com o valor `"on"` (padrão), as estatísticas sobre as solicitações dos IPs na lista de negação serão [exibidas][denylist-view-events-docs] na seção **Eventos**.</li><li>Com o valor `"off"`, as estatísticas sobre as solicitações dos IPs na lista de negação não serão exibidas.</li></ul>                                                                                                                                |
| **Anotação:** `sidecar.wallarm.io/wallarm-parse-websocket`<br><br>`config.wallarm.parseWebsocket`                                    | Wallarm tem suporte total para WebSockets. Por padrão, as mensagens de WebSockets não são analisadas quanto a ataques. Para forçar o recurso, ative o plano de assinatura de Segurança da API [subscription plan][subscriptions-docs] e use esta anotação: `on` ou `off` (padrão).                                                                                                                                                                                                                                                 |
| **Anotação:** `sidecar.wallarm.io/wallarm-unpack-response`<br><br>`config.wallarm.unpackResponse`                                    | Se deseja decomprimir dados comprimidos retornados na resposta do aplicativo: `on` (padrão) ou `off`.                                                                                                                                                                                                                          |
| **Anotação:** `sidecar.wallarm.io/wallarm-upstream-connect-attempts`<br><br>`config.wallarm.upstream.connectAttempts`                          | Define o número de reconexões imediatas para Tarantool ou API Wallarm.                                                                                                                                                                                                                                         |
| **Anotação:** `sidecar.wallarm.io/wallarm-upstream-reconnect-interval`<br><br>`config.wallarm.upstream.reconnectInterval`                        | Define o intervalo entre tentativas de reconectar ao Tarantool ou Wallarm API depois que o número de tentativas sem sucesso excedeu o limite para o número de reconexões imediatas.                                                                                                                                                                                                                                |
| **Anotação:** `sidecar.wallarm.io/application-port`<br><br>`config.nginx.applicationPort`                                     | O contêiner Wallarm espera que as solicitações de entrada sejam direcionadas para esta porta, caso [não sejam encontradas portas de aplicativo de pod expostas](customization.md#application-container-port-auto-discovery).                                                                                             |
| **Anotação:** `sidecar.wallarm.io/nginx-listen-port`<br><br>`config.nginx.listenPort`                                          | Porta escutada pelo contêiner Wallarm. Esta porta está reservada para uso pela solução sidecar Wallarm, ela não pode ser a mesmo que a `application-port`.                                                                                                                                                                 |
| **Anotação:** `sidecar.wallarm.io/nginx-http-include`<br><br>Sem valor de gráfico                                                               | Matriz de caminhos para os arquivos de configuração NGINX que devem ser [incluídos no nível `http` da configuração NGINX](customization.md#using-custom-nginx-configuration). O arquivo deve ser montado no contêiner e este caminho deve apontar para o arquivo no contêiner.                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/nginx-http-snippet`<br><br>Sem valor de gráfico                                                               | [Configuração adicional inline](customization.md#using-custom-nginx-configuration) que deve ser incluída no nível `http` da configuração NGINX.                                                                                                                                      |
| **Anotação:** `sidecar.wallarm.io/nginx-server-include`<br><br>Sem valor de gráfico                                                               | Matriz de caminhos para os arquivos de configuração NGINX que devem ser [incluídos no nível `server` da configuração NGINX](customization.md#using-custom-nginx-configuration). O arquivo deve ser montado no contêiner e este caminho deve apontar para o arquivo no contêiner.                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/nginx-server-snippet`<br><br>Sem valor de gráfico                                                               | [Configuração adicional inline](customization.md#using-custom-nginx-configuration) que deve ser incluída no nível `server` da configuração NGINX.                                                                                                                                      |
| **Anotação:** `sidecar.wallarm.io/nginx-location-include`<br><br>Sem valor de gráfico                                                               | Matriz de caminhos para os arquivos de configuração NGINX que devem ser [incluídos no nível `location` da configuração NGINX](customization.md#using-custom-nginx-configuration). O arquivo deve ser montado no contêiner e este caminho deve apontar para o arquivo no contêiner.                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/nginx-location-snippet`<br><br>Sem valor de gráfico                                                               | [Configuração adicional inline](customization.md#using-custom-nginx-configuration) que deve ser incluída no nível `location` da configuração NGINX.                                                                                                                                      |
| **Anotação:** `sidecar.wallarm.io/nginx-extra-modules`<br><br>Sem valor de gráfico                                                               | Matriz de [módulos NGINX adicionais](customization.md#enabling-additional-nginx-modules) que devem ser habilitados.                                                                                                                                                                                                                  |
| **Anotação:** `sidecar.wallarm.io/proxy-extra-volumes`<br><br>Sem valor de gráfico                                                               | [Volumes personalizados](customization.md#include) a serem adicionados ao Pod (matriz). O valor da anotação deve ser envolvido em aspas simples `''`.                                                                                                                                                                                  |
| **Anotação:** `sidecar.wallarm.io/proxy-extra-volume-mounts`<br><br>Sem valor de gráfico                                                               | [Montagens de volume personalizadas](customization.md#include) a serem adicionadas ao contêiner `sidecar-proxy` (objeto JSON). O valor da anotação deve ser envolvido em aspas simples `''`.                                                                                                                                                                              |
| **Anotação:** `sidecar.wallarm.io/proxy-cpu`<br><br>`config.sidecar.containers.proxy.resources.requests.cpu`           | [CPU solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-proxy`.                                                                                                                                                                                                                                                                                |
| **Anotação:** `sidecar.wallarm.io/proxy-memory`<br><br>`config.sidecar.containers.proxy.resources.requests.memory`        | [Memória solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-proxy`.                                                                                                                                                                                                                                                                             |
| **Anotação:** `sidecar.wallarm.io/proxy-cpu-limit`<br><br>`config.sidecar.containers.proxy.resources.limits.cpu`             | [Limite de CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-proxy`.                                                                                                                                                                                                                                                                                    |
| **Anotação:** `sidecar.wallarm.io/proxy-memory-limit`<br><br>`config.sidecar.containers.proxy.resources.limits.memory`          | [Limite de memória](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-proxy`.                                                                                                                                                                                                                                                                                 |
| **Anotação:** `sidecar.wallarm.io/helper-cpu`<br><br>`config.sidecar.containers.helper.resources.requests.cpu`          | [CPU solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-helper`.                                                                                                                                                                                                                                                                               |
| **Anotação:** `sidecar.wallarm.io/helper-memory`<br><br>`config.sidecar.containers.helper.resources.requests.memory`       | [Memória solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-helper`.                                                                                                                                                                                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/helper-cpu-limit`<br><br>`config.sidecar.containers.helper.resources.limits.cpu`            | [Limite de CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-helper`.                                                                                                                                                                                                                                                                                  |
| **Anotação:** `sidecar.wallarm.io/helper-memory-limit`<br><br>`config.sidecar.containers.helper.resources.limits.memory`         | [Limite de memória](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-helper`.                                                                                                                                                                                                                                                                                |
| **Anotação:** `sidecar.wallarm.io/init-iptables-cpu`<br><br>`config.sidecar.initContainers.iptables.resources.requests.cpu`    | [CPU solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-iptables`.                                                                                                                                                                                                                                                                        |
| **Anotação:** `sidecar.wallarm.io/init-iptables-memory`<br><br>`config.sidecar.initContainers.iptables.resources.requests.memory` | [Memória solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-iptables`.                                                                                                                                                                                                                                                                     |
| **Anotação:** `sidecar.wallarm.io/init-iptables-cpu-limit`<br><br>`config.sidecar.initContainers.iptables.resources.limits.cpu`      | [Limite de CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-iptables`.                                                                                                                                                                                                                                                                            |
| **Anotação:** `sidecar.wallarm.io/init-iptables-memory-limit`<br><br>`config.sidecar.initContainers.iptables.resources.limits.memory`   | [Limite de memória](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-iptables`.                                                                                                                                                                                                                                                                         |
| **Anotação:** `sidecar.wallarm.io/init-helper-cpu`<br><br>`config.sidecar.initContainers.helper.resources.requests.cpu`      | [CPU solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-helper`.                                                                                                                                                                                                                                                                          |
| **Anotação:** `sidecar.wallarm.io/init-helper-memory`<br><br>`config.sidecar.initContainers.helper.resources.requests.memory`   | [Memória solicitada](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-helper`.                                                                                                                                                                                                                                                                       |
| **Anotação:** `sidecar.wallarm.io/init-helper-cpu-limit`<br><br>`config.sidecar.initContainers.helper.resources.limits.cpu`        | [Limite de CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-helper`.                                                                                                                                                                                                                                                                              |
| **Anotação:** `sidecar.wallarm.io/init-helper-memory-limit`<br><br>`config.sidecar.initContainers.helper.resources.limits.memory`     | [Limite de memória](customization.md#per-pod-basis-allocation-via-pods-annotations) para o contêiner `sidecar-init-helper`.                                                                                                                                                                                                                                                                           |
| **Anotação:** `sidecar.wallarm.io/profile`<br><br>Sem valor de gráfico | A anotação é usada para atribuir um perfil TLS específico a um pod da aplicação para [Encerramento de TLS/SSL](customization.md#ssltls-termination).<br><br>Esta anotação e o encerramento de TLS/SSL são suportados a partir do gráfico Helm 4.6.1.                                                                                                                                                                                                                                                                           |

Existem mais [diretivas NGINX suportadas pela Wallarm][nginx-directives-docs] que não são abrangidas por anotações diretas. No entanto, você também pode configurá-las usando as anotações [`nginx-*-snippet` e `nginx-*-include`](customization.md#using-custom-nginx-configuration).

## Como usar anotações

Para aplicar uma anotação a um pod, especifique-a nas configurações do objeto `Deployment` da aplicação apropriada, por exemplo:


```bash
kubectl edit deployment -n <APLICAÇÃO_DO_NAMESPACE> <APLICAÇÃO_LABEL_VALUE>
```

```yaml hl_lines="17"
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
        wallarm-sidecar: enabled
      annotations:
        sidecar.wallarm.io/wallarm-mode: block
    spec:
      containers:
        - name: application
          image: kennethreitz/httpbin
          ports:
            - name: http
              containerPort: 80
```