## المتطلبات

* حساب AWS
* فهم AWS EC2، مجموعات الأمان
* أي منطقة AWS حسب اختيارك، لا توجد قيود محددة على المنطقة لنشر عقدة Wallarm
* الوصول إلى الحساب بدور **المدير** والمصادقة ذو العاملين معطلة في وحدة تحكم Wallarm لـ [السحابة الأمريكية](https://us1.my.wallarm.com/) أو [السحابة الأوروبية](https://my.wallarm.com/)
* الوصول إلى `https://us1.api.wallarm.com:444` للعمل مع سحابة Wallarm الأمريكية أو إلى `https://api.wallarm.com:444` للعمل مع سحابة Wallarm الأوروبية. إذا كان بالإمكان تكوين الوصول عبر خادم الوكيل فقط، فاستخدم [التعليمات][wallarm-api-via-proxy]
* تنفيذ جميع الأوامر على عقدة Wallarm كمستخدم متميز (مثل `root`)

## 1. إنشاء زوج من مفاتيح SSH في AWS

أثناء عملية النشر، ستحتاج إلى الاتصال بالجهاز الافتراضي عبر SSH. يسمح Amazon EC2 بإنشاء زوج مسمى من مفاتيح SSH العامة والخاصة التي يمكن استخدامها للاتصال بالعُقدة.

لإنشاء زوج من المفاتيح:

1. انتقل إلى علامة التبويب **مفاتيح الزوج** على لوحة تحكم Amazon EC2.
2. انقر على الزر **إنشاء زوج المفاتيح**.
3. أدخل اسم زوج المفاتيح وانقر على زر **إنشاء**.

سيبدأ تنزيل مفتاح SSH الخاص بتنسيق PEM تلقائيًا. احفظ المفتاح للاتصال بالعُقدة المُنشأة في المستقبل.

للاطلاع على معلومات مفصلة حول إنشاء مفاتيح SSH، تابع إلى [وثائق AWS][link-ssh-keys].

## 2. إنشاء مجموعة أمان

تحدد مجموعة الأمان الاتصالات الواردة والصادرة المسموح بها والممنوعة للآلات الافتراضية. تعتمد القائمة النهائية للاتصالات على التطبيق المحمي (مثل السماح بجميع الاتصالات الواردة إلى منافذ TCP/80 وTCP/443).

لإنشاء مجموعة أمان لعقدة التصفية:

1. انتقل إلى علامة التبويب **مجموعات الأمان** على لوحة تحكم Amazon EC2 وانقر على الزر **إنشاء مجموعة أمان**.
2. أدخل اسم مجموعة الأمان ووصف اختياري في نافذة الحوار التي تظهر.
3. حدد VPC المطلوب.
4. قم بتكوين قواعد الاتصالات الواردة والصادرة على علامات التبويب **الوارد** و**الصادر**.
5. انقر على زر **إنشاء** لإنشاء مجموعة الأمان.

![إنشاء مجموعة أمان][img-create-sg]

!!! تحذير "قواعد الاتصالات الصادرة من مجموعة الأمان"
    عند إنشاء مجموعة أمان، جميع الاتصالات الصادرة مسموح بها بشكل افتراضي. إذا كنت تقيد الاتصالات الصادرة من عقدة التصفية، تأكد من منح الوصول إلى خادم API Wallarm. اختيار خادم API Wallarm يعتمد على سحابة Wallarm التي تستخدمها:

    *   إذا كنت تستخدم السحابة الأمريكية، يجب منح عُقدتك الوصول إلى `us1.api.wallarm.com`.
    *   إذا كنت تستخدم السحابة الأوروبية، يجب منح عُقدتك الوصول إلى `api.wallarm.com`.
    
    تتطلب عُقدة التصفية الوصول إلى خادم API Wallarm للتشغيل الصحيح.

للاطلاع على معلومات مفصلة حول إنشاء مجموعة أمان، تابع إلى [وثائق AWS][link-sg].

## 3. إطلاق عُقدة Wallarm

لإطلاق عُقدة مع عُقدة تصفية Wallarm، تابع إلى هذا [الرابط](https://aws.amazon.com/marketplace/pp/B073VRFXSD) واشترك في عُقدة التصفية.

عند إنشاء عُقدة، تحتاج إلى تحديد [مجموعة الأمان التي تم إنشاؤها مسبقًا][anchor1] كما يلي:

1. أثناء العمل مع معالج إطلاق العُقدة، تابع إلى خطوة إطلاق العُقدة **6. تكوين مجموعة الأمان** عن طريق النقر على علامة التبويب المناسبة.
2. اختر خيار **تحديد مجموعة أمان موجودة** في إعداد **تعيين مجموعة أمان**.
3. حدد مجموعة الأمان من القائمة التي تظهر.

بعد تحديد جميع إعدادات العُقدة المطلوبة، انقر على زر **مراجعة وإطلاق**، تحقق من أن العُقدة مكونة بشكل صحيح، وانقر على زر **إطلاق**.

في النافذة التي تظهر، حدد زوج المفاتيح [الذي تم إنشاؤه مسبقًا][anchor2] من خلال تنفيذ الإجراءات التالية:

1. في قائمة الانتقاء الأولى، حدد خيار **اختيار زوج مفاتيح موجود**.
2. في القائمة الثانية، حدد اسم زوج المفاتيح.
3. تأكد من أن لديك الوصول إلى مفتاح PEM الخاص من زوج المفاتيح الذي حددته في القائمة الثانية وقم بوضع علامة في مربع الاختيار لتأكيد ذلك.
4. انقر على زر **إطلاق العُقد**.

سيتم إطلاق العُقدة مع العُقدة التصفية المثبتة مسبقًا.

للاطلاع على معلومات مفصلة حول إطلاق العُقد في AWS، تابع إلى [وثائق AWS][link-launch-instance].

## 4. الاتصال بعُقدة التصفية عبر SSH

للاطلاع على معلومات مفصلة حول طرق الاتصال بعُقدة عبر SSH، تابع إلى [وثائق AWS](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html).

تحتاج إلى استخدام اسم المستخدم `admin` للاتصال بالعُقدة.

!!! معلومات "استخدام المفتاح للاتصال عبر SSH"
    استخدم المفتاح الخاص بتنسيق PEM الذي [أنشأته مسبقًا][anchor2] للاتصال بالعُقدة عبر SSH. يجب أن يكون هذا المفتاح الخاص من زوج مفاتيح SSH الذي حددته عند إنشاء عُقدة.

## 5. توليد رمز لربط العُقدة بسحابة Wallarm

تحتاج العُقدة المحلية لتصفية Wallarm إلى الاتصال بسحابة Wallarm باستخدام رمز Wallarm من [النوع المناسب][wallarm-token-types]. يسمح رمز API بإنشاء مجموعة عُقد في واجهة مستخدم وحدة تحكم Wallarm، مما يساعد في تنظيم عُقدك بشكل فعال.

![عُقد مجمعة][img-grouped-nodes]

ولد الرمز كما يلي:

=== "رمز API"

    1. افتح واجهة وحدة تحكم Wallarm → **الإعدادات** → **رموز API** في [السحابة الأمريكية](https://us1.my.wallarm.com/settings/api-tokens) أو [السحابة الأوروبية](https://my.wallarm.com/settings/api-tokens).
    1. اعثر على رمز API أو أنشئ رمزاً بدور مصدر `النشر`.
    1. انسخ هذا الرمز.
=== "رمز العُقدة"

    1. افتح واجهة وحدة تحكم Wallarm → **العُقد** في [السحابة الأمريكية](https://us1.my.wallarm.com/nodes) أو [السحابة الأوروبية](https://my.wallarm.com/nodes).
    1. قم بواحدة من الخطوات التالية: 
        * أنشئ عُقدة من نوع **عُقدة Wallarm** وانسخ الرمز المُنتَج.
        * استخدم مجموعة عُقد موجودة - انسخ الرمز باستخدام قائمة العُقدة → **نسخ رمز**.