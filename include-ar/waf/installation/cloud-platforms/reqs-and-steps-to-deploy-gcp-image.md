## المتطلبات

* حساب GCP
* وصول للحساب بدور **المدير** وتعطيل المصادقة الثنائية في وحدة تحكم Wallarm لـ [السحابة الأمريكية](https://us1.my.wallarm.com/) أو [السحابة الأوروبية](https://my.wallarm.com/)
* الوصول إلى `https://us1.api.wallarm.com:444` للعمل مع سحابة Wallarm الأمريكية أو إلى `https://api.wallarm.com:444` للعمل مع سحابة Wallarm الأوروبية. إذا كان يمكن تكوين الوصول عبر خادم الوكيل فقط، استخدم [التعليمات][wallarm-api-via-proxy]
* تنفيذ جميع الأوامر على نسخة Wallarm كمستخدم فائق (مثلاً `root`)

## 1. تشغيل نسخة فلترة العقد

### تشغيل النسخة عبر واجهة مستخدم Google Cloud

لتشغيل نسخة فلترة العقد عبر واجهة مستخدم Google Cloud، يُرجى فتح [صورة عقدة Wallarm في Google Cloud Marketplace](https://console.cloud.google.com/launcher/details/wallarm-node-195710/wallarm-node) والنقر على **ابدأ**.

سيتم تشغيل النسخة مع نسخة فلترة العقد المثبتة مسبقًا. للاطلاع على معلومات مفصلة حول تشغيل النسخ في Google Cloud، يُرجى التوجه إلى [وثائق Google Cloud Platform الرسمية][link-launch-instance].

### تشغيل النسخة عبر Terraform أو أدوات أخرى

عند استخدام أداة مثل Terraform لتشغيل نسخة فلترة العقد باستخدام صورة Wallarm GCP، قد تحتاج إلى توفير اسم هذه الصورة في تكوين Terraform.

* يكون لاسم الصورة النسق التالي:

    ```bash
    wallarm-node-195710/wallarm-node-<IMAGE_VERSION>-build
    ```
* لتشغيل النسخة بنسخة فلترة العقد 4.10، يُرجى استخدام اسم الصورة التالي:

    ```bash
    wallarm-node-195710/wallarm-node-4-10-20240220-234618
    ```

للحصول على اسم الصورة، يمكنك أيضًا اتباع هذه الخطوات:

1. تثبيت [Google Cloud SDK](https://cloud.google.com/sdk/docs/install).
2. تنفيذ الأمر [`gcloud compute images list`](https://cloud.google.com/sdk/gcloud/reference/compute/images/list) مع البارامترات التالية:

    ```bash
    gcloud compute images list --project wallarm-node-195710 --filter="name~'wallarm-node-4-10-*'" --no-standard-images
    ```
3. نسخ قيمة النسخة من اسم أحدث صورة متاحة ولصق القيمة المنسوخة في نسق اسم الصورة المعطى. على سبيل المثال، سيكون لنسخة العقد فلترة 4.10 الاسم التالي:

    ```bash
    wallarm-node-195710/wallarm-node-4-10-20240220-234618
    ```

## 2. تكوين نسخة فلترة العقد

قم بالأعمال التالية لتكوين نسخة فلترة العقد التي تم تشغيلها:

1.  الانتقال إلى صفحة **نسخ الVM** في قسم **محرك الحوسبة** من القائمة.
2.  اختيار نسخة فلترة العقد التي تم تشغيلها والنقر على زر **تعديل**.
3.  السماح بأنواع المرور الوارد المطلوبة من خلال وضع علامات اختيار في خيارات **جدران الحماية**.
4.  إذا لزم الأمر، يمكنك تقييد الاتصال بالنسخة باستخدام مفاتيح SSH للمشروع واستخدام زوج مفاتيح SSH مخصص للاتصال بتلك النسخة. للقيام بذلك، قم بالإجراءات التالية:
    1.  وضع علامة على خانة **حجب على مستوى المشروع** في إعداد **مفاتيح SSH**.
    2.  النقر على زر **عرض وتعديل** في إعداد **مفاتيح SSH** لتوسيع الحقل لإدخال مفتاح SSH.
    3.  توليد زوج من المفاتيح العامة والخاصة SSH. على سبيل المثال، يمكنك استخدام `ssh-keygen` و `PuTTYgen`.
       
        ![توليد مفاتيح SSH باستخدام PuTTYgen][img-ssh-key-generation]

    4.  نسخ مفتاح عام بتنسيق OpenSSH من واجهة مولد المفاتيح المستخدم (في المثال الحالي، يجب نسخ المفتاح العام من منطقة **المفتاح العام للصق في ملف authorized_keys OpenSSH** من واجهة PuTTYgen) ولصقه في الحقل الذي يحتوي على تلميح **أدخل بيانات المفتاح كاملاً**.
    5.  حفظ المفتاح الخاص. سيكون مطلوبًا للاتصال بالنسخة المكونة في المستقبل.
5.  النقر على زر **حفظ** في أسفل الصفحة لتطبيق التغييرات.

## 3. الاتصال بنسخة فلترة العقد عبر SSH

للاطلاع على معلومات مفصلة حول طرق الاتصال بالنسخ، يُرجى التوجه إلى هذا [الرابط](https://cloud.google.com/compute/docs/instances/connecting-to-instance).

--8<-- "../include/gcp-autoscaling-connect-ssh.md"

## 4. إنشاء رمز لربط النسخة بسحابة Wallarm

تحتاج نسخة Wallarm المحلية إلى الاتصال بسحابة Wallarm باستخدام رمز Wallarm من [النوع المناسب][wallarm-token-types]. يتيح لك رمز API إنشاء مجموعة عقد في واجهة مستخدم وحدة تحكم Wallarm، مما يساعد في تنظيم نسخ العقد الخاصة بك بشكل فعّال.

![العقد المجمعة][img-grouped-nodes]

قم بإنشاء الرمز على النحو التالي:

=== "رمز API"

    1. فتح وحدة تحكم Wallarm → **الإعدادات** → **رموز API** في [السحابة الأمريكية](https://us1.my.wallarm.com/settings/api-tokens) أو [السحابة الأوروبية](https://my.wallarm.com/settings/api-tokens).
    1. البحث عن رمز API أو إنشاء واحد بدور المصدر `Deploy`.
    1. نسخ هذا الرمز.
=== "رمز العقدة"

    1. فتح وحدة تحكم Wallarm → **العقد** في [السحابة الأمريكية](https://us1.my.wallarm.com/nodes) أو [السحابة الأوروبية](https://my.wallarm.com/nodes).
    1. قم بواحدة مما يلي:
        * إنشاء العقدة من نوع **عقدة Wallarm** ونسخ الرمز المُنشأ.
        * استخدام مجموعة العقد الموجودة - نسخ الرمز باستخدام قائمة العقدة → **نسخ الرمز**.